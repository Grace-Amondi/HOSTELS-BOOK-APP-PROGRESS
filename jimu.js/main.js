// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./dijit/LoadingIndicator esri/config esri/tasks/GeometryService".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b){function u(b,e){var w=f.clone(b),c=a.widgetProperties;"undefined"===typeof e&&(e=!1);delete w.mode;delete w.configWabVersion;a.visitElement(w,function(b,
g){b.widgets?(delete b.isOnScreen,delete b.gid,"jimu.js/images/group_icon.png"===b.icon&&delete b.icon,delete b.openType,g.isOnScreen&&b.panel&&a.isEqual(b.panel,w.widgetOnScreen.panel)&&delete b.panel):(b.icon&&b.icon===b.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete b.icon,delete b.panel,delete b.folderUrl,delete b.amdFolder,delete b.thumbnail,delete b.configFile,delete b.gid,delete b.isOnScreen,delete b.isRemote,delete b.featureActions,c.forEach(function(a){delete b[a]}),
e?"undefined"===typeof b.openAtStart&&(b.openAtStart=!1):(b.visible&&delete b.visible,b.manifest&&b.label===b.manifest.label&&delete b.label,b.isDefaultConfig&&(delete b.config,delete b.isDefaultConfig)),delete b.manifest)});delete w.rawAppConfig;delete w._ssl;delete w.getConfigElementById;delete w.getConfigElementsByName;delete w.processNoUriWidgets;delete w.addElementId;delete w.getCleanConfig;delete w.visitElement;delete w.agolConfig;delete w._itemData;delete w.oldWabVersion;return w}var t=null,
v;v=n(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(b){this.urlParams=b||{};this.listenBuilderEvents();this.versionManager=new c;this.widgetManager=k.getInstance();this.configLoader=r.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&f.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(d);"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&
f.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(d);a.isMobileUa()||q(window,"resize",f.hitch(this,this._onWindowResize));q(window,"orientationchange",f.hitch(this,this._onOrientationChange))},listenBuilderEvents:function(){d.subscribe("builder/widgetChanged",f.hitch(this,this._onWidgetChanged));d.subscribe("builder/groupChanged",f.hitch(this,this._onGroupChanged));d.subscribe("builder/widgetPoolChanged",f.hitch(this,this._onWidgetPoolChanged));d.subscribe("builder/openAtStartChange",
f.hitch(this,this._onOpenAtStartChanged));d.subscribe("builder/mapChanged",f.hitch(this,this._onMapChanged));d.subscribe("builder/mapOptionsChanged",f.hitch(this,this._onMapOptionsChanged));d.subscribe("builder/appAttributeChanged",f.hitch(this,this._onAppAttributeChanged));d.subscribe("builder/setAppConfig",f.hitch(this,this._onAppConfigSet));d.subscribe("builder/themeChanged",f.hitch(this,this._onThemeChanged));d.subscribe("builder/layoutChanged",f.hitch(this,this._onLayoutChanged));d.subscribe("builder/styleChanged",
f.hitch(this,this._onStyleChanged));d.subscribe("builder/syncExtent",f.hitch(this,this._onSyncExtent));d.subscribe("builder/loadingPageChanged",f.hitch(this,this._onLoadingPageChanged));d.subscribe("builder/templateConfigChanged",f.hitch(this,this._onTemplateConfigChanged));d.subscribe("builder/appProxyForMapChanged",f.hitch(this,this._onAppProxyForMapChanged));d.subscribe("builder/appProxyForUrlChanged",f.hitch(this,this._onAppProxyForUrlChanged))},loadConfig:function(){if("preview"!==this.urlParams.mode&&
"config"!==this.urlParams.mode){var b=new p;b.placeAt(window.jimuConfig.layoutId);return this.configLoader.loadConfig().then(f.hitch(this,function(w){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(w);window.appInfo.isRunInMobile=a.inMobileSize();console.timeEnd("Load Config");w=this.getAppConfig();b.destroy();d.publish("appConfigLoaded",w);return w}),f.hitch(this,function(a){b.destroy();console.error(a);a&&a.message&&"string"===typeof a.message&&this._showErrorMessage(a.message)}))}},
_showErrorMessage:function(a){h.create("div",{"class":"app-error",innerHTML:a},document.body)},getAppConfig:function(){var b;window.appInfo.isRunInMobile?(b=f.clone(this._getMobileConfig(this.appConfig)),b._originConfig=f.clone(this.appConfig)):b=f.clone(this.appConfig);b.getConfigElementById=function(b){return a.getConfigElementById(this,b)};b.getConfigElementsByName=function(b){return a.getConfigElementsByName(this,b)};b.getCleanConfig=function(a){return this._originConfig?u(this._originConfig,
a):u(this,a)};b.visitElement=function(b){a.visitElement(this,b)};return b},_onOrientationChange:function(){this.appConfig&&d.publish("appConfigChanged",this.getAppConfig(),"layoutChange")},_onWindowResize:function(){var b=a.inMobileSize();window.appInfo.isRunInMobile!==b&&(window.appInfo.isRunInMobile=b,this.appConfig&&d.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_getMobileConfig:function(b){return a.mixinAppConfigPosition(b,b.mobileLayout)},_onWidgetChanged:function(b){var e=
a.reCreateObject(b);b=a.getConfigElementById(this.appConfig,b.id);!1!==e.inPanel||b.uri||(e.closeable=!0);for(var c in e)b[c]=e[c];delete b.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"widgetChange",e)},_onGroupChanged:function(b){var e=a.reCreateObject(b);b=a.getConfigElementById(this.appConfig,b.id);for(var c in e)b[c]=e[c];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
d.publish("appConfigChanged",this.getAppConfig(),"groupChange",e)},_onWidgetPoolChanged:function(b){var e=a.reCreateObject(b);1===this.widgetManager.getControllerWidgets().length?(this.appConfig.widgetPool.widgets=e.widgets,this.appConfig.widgetPool.groups=e.groups):(b=a.getConfigElementById(this.appConfig,e.controllerId),l.forEach(b.controlledWidgets,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this),l.forEach(b.controlledGroups,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,
a)},this),this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?e.widgets:this.appConfig.widgetPool.widgets.concat(e.widgets),this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?e.groups:this.appConfig.widgetPool.groups.concat(e.groups),this.configLoader.addNeedValues(this.appConfig),b.controlledWidgets=l.map(e.widgets,function(a){return a.id}),b.controlledGroups=l.map(e.groups,function(a){return a.id}));this.configLoader.addNeedValues(this.appConfig);
this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,function(a){this.appConfig=a;this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",e)}))},_removeWidgetOrGroupFromPoolById:function(a,b){l.some(a.widgetPool.widgets,function(e,c){if(e.id===b)return a.widgetPool.widgets.splice(c,1),!0});l.some(a.widgetPool.groups,function(e,c){if(e.id===b)return a.widgetPool.groups.splice(c,1),!0})},_onOpenAtStartChanged:function(b){var e=
a.reCreateObject(b),c=this.appConfig;b.isOnScreen?(c=c.widgetOnScreen&&c.widgetOnScreen.widgets)&&0<c.length&&l.forEach(c,f.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})):((c=c.widgetPool)&&c.groups&&0<c.groups.length&&l.forEach(c.groups,f.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})),c&&c.widgets&&0<c.widgets.length&&l.forEach(c.widgets,f.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})));
d.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",e)},_onAppAttributeChanged:function(b){b=a.reCreateObject(b);f.mixin(this.appConfig,b);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"attributeChange",b)},_onLoadingPageChanged:function(b){b=a.reCreateObject(b);var e;"backgroundColor"in b?this.appConfig.loadingPage.backgroundColor=b.backgroundColor:
"backgroundImage"in b?(e=this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=f.mixin(e,b.backgroundImage)):"loadingGif"in b&&(e=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=f.mixin(e,b.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",b)},_onAppProxyForMapChanged:function(b){b=a.reCreateObject(b);"appProxy"in
this.appConfig.map?this.appConfig.map.appProxy.mapItemId!==b.mapItemId?this.appConfig.map.appProxy=b:l.forEach(b.proxyItems,f.hitch(this,function(a){l.some(this.appConfig.map.appProxy.proxyItems,function(b){if(b.sourceUrl===a.sourceUrl)return b.useProxy=a.useProxy,b.proxyUrl=a.proxyUrl||"",b.proxyId=a.proxyId||"",!0})})):this.appConfig.map.appProxy=b;d.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",b)},_onAppProxyForUrlChanged:function(b){b=a.reCreateObject(b);this.appConfig.appProxies=
b;d.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",b)},_onTemplateConfigChanged:function(b){b=a.reCreateObject(b);this.appConfig.templateConfig=b;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",b)},_onMapChanged:function(b){var e=a.reCreateObject(b);this.appConfig.map.mapOptions&&a.deleteMapOptions(this.appConfig.map.mapOptions);f.mixin(this.appConfig.map,e);this.configLoader.addNeedValues(this.appConfig);
this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,function(a){this.appConfig=a;this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"mapChange",e)}))},_onMapOptionsChanged:function(b){b=a.reCreateObject(b);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});f.mixin(this.appConfig.map.mapOptions,b);d.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",b)},_onThemeChanged:function(a){this._getAppConfigFromTheme(a).then(f.hitch(this,
function(b){this.appConfig=b;d.publish("appConfigChanged",this.getAppConfig(),"themeChange",a.getName())}))},_onLayoutChanged:function(b){this.appConfig=a.mixinAppConfigPosition(this.appConfig,b.layoutConfig);this._addDefaultPanelAndPosition(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"layoutChange",b.name)},_onStyleChanged:function(a){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,a.name);a.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:a.styleColor}:
delete this.appConfig.theme.customStyles;d.publish("appConfigChanged",this.getAppConfig(),"styleChange",a.name)},_onSyncExtent:function(a){d.publish("syncExtent",a)},_genStyles:function(a,b){var e=[];e.push(b);l.forEach(a,function(a){0>e.indexOf(a)&&e.push(a)});return e},_getAppConfigFromTheme:function(a){var b=new m,e,c=[],c=this.getAppConfig().getCleanConfig();c.mode=this.urlParams.mode;l.forEach(c.widgetPool.groups,function(a){delete a.panel},this);if(a.appConfig)e=f.clone(a.appConfig),e.map=c.map,
e.map.position=a.appConfig.map.position,this._copyPoolToThemePool(c,e),e.links=c.links,e.title=c.title,e.subtitle=c.subtitle,e.logo=c.logo;else{var g=a.getCurrentLayout(),p=a.getCurrentStyle();e=f.clone(c);g=f.clone(g.layoutConfig);e.widgetOnScreen=g.widgetOnScreen;g.widgetPool&&(l.forEach(g.widgetPool.widgets,function(a){a.isPreconfiguredInTheme=!0}),l.forEach(g.widgetPool.groups,function(a){a.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(c,g);e.widgetPool=g.widgetPool;g.map&&g.map.position&&
(e.map.position=g.map.position);e.mobileLayout=g.mobileLayout;c=this._genStyles(l.map(a.getStyles(),function(a){return a.name}),p.name);e.theme={name:a.getName(),styles:c,version:a.getVersion()}}this.configLoader.addNeedValues(e);this.configLoader.loadWidgetsManifest(e).then(f.hitch(this,function(a){return this.configLoader.loadAndUpgradeAllWidgetsConfig(a)})).then(f.hitch(this,function(){this._addDefaultValues(e);b.resolve(e)}));return b},_copyPoolToThemePool:function(a,b){var e=a.widgetPool;b.widgetPool||
(b.widgetPool={});var c=b.widgetPool,g=l.filter(c.widgets,function(a){if(a.isPreconfiguredInTheme||!l.some(e.widgets,function(b){return b.name===a.name}))return!0}),p=l.filter(c.groups,function(a){return a.isPreconfiguredInTheme}),k=l.filter(e.widgets,function(a){return!a.isPreconfiguredInTheme}),u=l.filter(e.groups,function(a){return!a.isPreconfiguredInTheme}),k=this._getPoolWidgetsWithoutDuplicated(k,b.widgetOnScreen.widgets||[]);c.widgets=k.concat(g);c.groups=u.concat(p)},_getPoolWidgetsWithoutDuplicated:function(b,
e){for(var c=f.clone(b),g=this.getAppConfig(),p=b.length-1;0<=p;p--)for(var k=e.length-1;0<=k;k--)if(e[k].uri){var u=e[k].name;u||(u=a.getWidgetNameFromUri(e[k].uri));var w=g.getConfigElementById(b[p].id);b[p]&&b[p].name===u&&!1===w.supportMultiInstance&&(console.log("Widget",b[p].name,"is not copied to new theme because this widget exists in new theme."),c.splice(p,1))}return c},_onAppConfigSet:function(b){b=a.reCreateObject(b);window.appInfo.isRunInMobile=a.inMobileSize();this.configLoader.processProxy(b);
this.configLoader.addNeedValues(b);this.configLoader.loadAndUpgradeAllWidgetsConfig(b).then(f.hitch(this,function(b){this._addDefaultValues(b);g.setPortalUrl(b.portalUrl);window.portalUrl=b.portalUrl;this.appConfig?(a.deleteMapOptions(b.map.mapOptions),this.appConfig=b,d.publish("appConfigChanged",this.getAppConfig(),"resetConfig",b)):(this.appConfig=b,d.publish("appConfigLoaded",this.getAppConfig()))}))},_addDefaultValues:function(a){this._addDefaultPortalUrl(a);this._addDefaultGeometryService(a);
this._addDefaultStyle(a);this._addDefaultMap(a);this._addDefaultVisible(a);"undefined"===typeof a.widgetOnScreen&&(a.widgetOnScreen={});"undefined"===typeof a.widgetPool&&(a.widgetPool={});this._addDefaultPanelAndPosition(a);this._addDefaultOfWidgetGroup(a);(a.widgetPool.widgets&&0<a.widgetPool.widgets.length&&void 0===a.widgetPool.widgets[0].index||a.widgetPool.groups&&0<a.widgetPool.groups.length&&void 0===a.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(a);return a},_addDefaultPortalUrl:function(a){"undefined"===
typeof a.portalUrl&&(a.portalUrl="http://www.arcgis.com/");a.portalUrl&&"/"!==a.portalUrl.substr(a.portalUrl.length-1)&&(a.portalUrl+="/")},_addDefaultGeometryService:function(a){var c=a&&a.geometryService,c=c&&"string"===typeof c&&f.trim(c)?f.trim(c):this.portalSelf.helperServices.geometry.url;a.geometryService=c;e.defaults.geometryService=new b(a.geometryService)},_addDefaultStyle:function(a){!a.theme||a.theme.styles&&0!==a.theme.styles.length||(a.theme.styles=["default"])},_addDefaultMap:function(a){a.map.id=
"map";"undefined"===typeof a.map["3D"]&&"undefined"===typeof a.map["2D"]&&(a.map["2D"]=!0);"undefined"===typeof a.map.position&&(a.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof a.map.portalUrl&&(a.map.portalUrl=a.portalUrl)},_addDefaultVisible:function(b){a.visitElement(b,function(a){void 0===a.visible&&(a.visible=!0)})},_addDefaultPanelAndPosition:function(a){this._addOnScreenDefaultPanelAndPosition(a);this._addPoolDefaultPanelAndPosition(a)},_addOnScreenDefaultPanelAndPosition:function(a){var b,
e;if(a=a.widgetOnScreen){b=a.panel&&a.panel.positionRelativeTo?a.panel.positionRelativeTo:"map";"undefined"===typeof a.panel||"undefined"===typeof a.panel.uri?a.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof a.panel.position?a.panel.position={relativeTo:b}:"undefined"===typeof a.panel.position.relativeTo&&(a.panel.position.relativeTo=b);if(a.widgets)for(b=0;b<a.widgets.length;b++)a.widgets[b].position||(a.widgets[b].position={}),a.widgets[b].position.relativeTo||
(a.widgets[b].position.relativeTo=a.widgets[b]&&a.widgets[b].positionRelativeTo?a.widgets[b].positionRelativeTo:"map"),!0!==a.widgets[b].inPanel||a.widgets[b].panel||(a.widgets[b].panel=f.clone(a.panel),a.widgets[b].panel.position=a.widgets[b].position,a.widgets[b].panel.position.relativeTo=a.widgets[b].position.relativeTo);if(a.groups)for(b=0;b<a.groups.length;b++)for(a.groups[b].panel||(a.groups[b].panel=a.panel),a.groups[b].panel&&!a.groups[b].panel.position&&(a.groups[b].panel.position={}),a.groups[b].panel.position.relativeTo||
(a.groups[b].panel.position.relativeTo=a.groups[b].panel.positionRelativeTo?a.groups[b].panel.positionRelativeTo:"map"),a.groups[b].widgets||(a.groups[b].widgets=[]),e=0;e<a.groups[b].widgets.length;e++)a.groups[b].widgets[e].panel=a.groups[b].panel}},_addPoolDefaultPanelAndPosition:function(a){var b,e,c=a.widgetPool;if(c){b=c.panel&&c.panel.positionRelativeTo?c.panel.positionRelativeTo:"map";"undefined"===typeof c.panel||"undefined"===typeof c.panel.uri?c.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:
"undefined"===typeof c.panel.position?c.panel.position={relativeTo:b}:"undefined"===typeof c.panel.position.relativeTo&&(c.panel.position.relativeTo=b);if(c.groups)for(b=0;b<c.groups.length;b++)for(c.groups[b].panel?c.groups[b].panel.position.relativeTo||(c.groups[b].panel.position.relativeTo=c.groups[b].panel.positionRelativeTo?c.groups[b].panel.positionRelativeTo:"map"):c.groups[b].panel=c.panel,c.groups[b].widgets||(c.groups[b].widgets=[]),e=0;e<c.groups[b].widgets.length;e++)c.groups[b].widgets[e].panel=
c.groups[b].panel;if(c.widgets)for(b=0;b<c.widgets.length;b++)!1===c.widgets[b].inPanel?(e=c.widgets[b].positionRelativeTo?c.widgets[b].positionRelativeTo:"map",c.widgets[b].position)?c.widgets[b].position.relativeTo||(c.widgets[b].position.relativeTo=e):c.widgets[b].position={relativeTo:e}:c.widgets[b].panel||(c.widgets[b].panel=a.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(b){a.visitElement(b,f.hitch(this,function(a,b){a.isOnScreen=b.isOnScreen;a.widgets?(a.gid=a.id,1===a.widgets.length?
(a.label||(a.label=a.widgets[0].label?a.widgets[0].label:"Group"),a.icon||(a.icon=a.widgets[0].uri?this._getDefaultIconFromUri(a.widgets[0].uri):"jimu.js/images/group_icon.png")):(a.icon=a.icon?a.icon:"jimu.js/images/group_icon.png",a.label=a.label?a.label:"Group_"+b.index)):a.gid=b.groupId}))},_getDefaultIconFromUri:function(a){a=a.split("/");a.pop();return a.join("/")+"/images/icon.png?wab_dv\x3d"+window.deployVersion},_addIndexForWidgetPool:function(a){var b=0,e,c;if(a.widgetPool.widgets)for(e=
0;e<a.widgetPool.widgets.length;e++)a.widgetPool.widgets[e].index=b,b++;if(a.widgetPool.groups)for(e=0;e<a.widgetPool.groups.length;e++)for(a.widgetPool.groups[e].index=b,b++,c=0;c<a.widgetPool.groups[e].widgets.length;c++)a.widgetPool.groups[e].widgets[c].index=c}});v.getInstance=function(a){null===t?t=new v(a):a&&(t.urlParams=a,t.configLoader&&(t.configLoader.urlParams=a));window.getAppConfig=f.hitch(t,t.getAppConfig);return t};return v})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/tasks/FeatureSet esri/symbols/PictureMarkerSymbol esri/urlUtils esri/request esri/tasks/query esri/tasks/QueryTask esri/graphicsUtils jimu/portalUrlUtils ./shared/utils".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z,x,A,B,F,E,C,G,H,I,K,Q,O,L,S,P){function M(a,b){a=a||"";for(var e=0,c=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!D.file.isEnabledFlash(),failure:[a+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){e++;e===c.length&&b()}}],g=0;g<c.length;g++)testLoad(c[g])}function N(a,b){var e=a.match(/url\([^)]+\)/gi),c,g;if(null===e||""===b)return a;for(c=0;c<e.length;c++)if(g=e[c].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=g.length){var p=
g[2];b.endWith("/")||(b+="/");a=a.replace(g[1]+p+g[3],g[1]+b+p+g[3])}return a}function J(a,b){var e=Array.isArray(b),c=e&&[]||{};e?(a=a||[],c=c.concat(a),b.forEach(function(b,e){"undefined"===typeof a[e]?c[e]=b:"object"===typeof b?c[e]=J(a[e],b):-1===a.indexOf(b)&&c.push(b)})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(b){c[b]=a[b]}),Object.keys(b).forEach(function(e){c[e]="object"===typeof b[e]&&b[e]?a[e]?J(a[e],b[e]):b[e]:b[e]}));return c}function R(a,b,e){function c(a,b){return n.isArray(a[b.key])?
a[b.key][b.index]:a[b.key]}b=function(a){var b=[];a.split("_").forEach(function(a){var e=!1,c;"--"===a.slice(a.length-2)&&(e=!0,a=a.slice(0,a.length-2));c=a.search(/\[[0-9]+\]/);-1===c&&(c=a.length);b.push({key:a.slice(0,c),index:Number(a.slice(c+1,-1)),deleteFlag:e})});return b}(b);for(var g=1;g<b.length-1;g++)if(a=c(a,b[g]),!a)return;if(b[b.length-1].deleteFlag)!0===e&&(n.isArray(a[b[b.length-1].key])?delete a[b[b.length-1].key][b[b.length-1].index]:delete a[b[b.length-1].key]);else if(n.isArray(a[b[b.length-
1].key])){if(void 0===e)return a[b[b.length-1].key][b[b.length-1].index];a[b[b.length-1].key][b[b.length-1].index]=e}else{if(void 0===e)return a[b[b.length-1].key];a[b[b.length-1].key]=e}}function X(a,b,e){function c(e){e=D.template.getSearchRange(b,e,"]");var c=b.slice(e.firstPos,e.lastPos);return-1!==e.firstPos?(c=b.slice(e.firstPos+c.indexOf("[")+1,e.lastPos-1),e=b.slice(e.lastPos+1),(c=D.getConfigElementById(a,c))?{object:c,key:"section_"+e,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}
var g=a,p=b=b.replace(/\//g,"_"),k=c("groups\\[.+\\]");if("deleted"!==k.state&&("isSection"===k.state&&(g=k.object,p=k.key),k=c("widgets\\[.+\\]"),"delete"!==k.state))return"isSection"===k.state&&(g=k.object,p=k.key),R(g,p,e)}var D={},W={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};n.mixin(D,P);window.atob||(window.atob=function(a){a=u.decode(a);for(var b="",e=0,c=a.length;e<c;e++)b+=String.fromCharCode(a[e]);return b});window.btob||(window.btob=
function(a){for(var b=[],e=0,c=a.length;e<c;e++)b.push(String.charCodeAt(a[e]));return u.encode(b)});var V="unload",Z=[];require.on("error",function(a){f.forEach(Z,function(b){a.info[0]&&-1<a.info[0].indexOf(b.resKey)&&b.def.reject(a);for(var e in a.info)-1<e.indexOf(b.resKey)&&b.def.reject(a)})});D.checkError=function(a,b){Z.push({resKey:a,def:b})};D.replacePlaceHolder=function(a,b){var e=r.stringify(a),c=e.match(/\$\{(\w)+\}/g),g;if(null===c)return a;for(g=0;g<c.length;g++){var p=c[g].match(/(\w)+/g)[0];
b[p]&&(e=e.replace(c[g],b[p]))}return r.parse(e)};D.changeUnit=function(a){var b=Math.abs(a),e;a=Math.floor(b);e=Math.floor(60*(b-a));b=(60*(60*(b-a)-e)).toFixed(2);return a+"\u00b0"+(10>e?"0"+e:e)+"'"+(10>b?"0"+b:b)+'"'};D.formatTime=function(a){var b=a/1E3;a=Math.floor(b/60);b=Number(b-60*a).toFixed(1);return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)};D.parseTime=function(a){var b=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!b.test(a))return console.log("wrong time format."),-1;a=a.match(b);return 1E3*(60*parseInt(a[1],
10)+parseInt(a[2],10)+parseInt(a[3],10)/10)};D.preloadImg=function(a,b){var e=[],e="string"===typeof a?[a]:a;f.forEach(e,function(a){(new Image).src=b?b+a:a})};var T=null;D.getImagesSize=function(a){var b=new k;if(!a||0!==a.indexOf("http"))return b.reject(),b;null===T&&(T=l.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var e=c(T,"load",function(){clearTimeout(g);g=null;e.remove();var a=l.getContentBox(T);1===a.w&&1===a.h||0===a.w||0===
a.h?b.reject():b.resolve([a.w,a.h])},{}),g=setTimeout(function(){clearTimeout(g);g=null;b.reject()},5E3);l.setAttr(T,"src",a);return b};D.getPositionStyle=function(a){var b={};if(!a)return b;a=n.clone(a);if(window.isRTL){var e;"undefined"!==typeof a.left&&"undefined"!==typeof a.right?(e=a.left,a.left=a.right,a.right=e):"undefined"!==typeof a.left?(a.right=a.left,delete a.left):"undefined"!==typeof a.right&&(a.left=a.right,delete a.right);"undefined"!==typeof a.paddingLeft&&"undefined"!==typeof a.paddingRight?
(e=a.paddingLeft,a.paddingLeft=a.paddingRight,a.paddingRight=e):"undefined"!==typeof a.paddingLeft?(a.paddingRight=a.paddingLeft,delete a.paddingLeft):"undefined"!==typeof a.paddingRight&&(a.paddingLeft=a.paddingRight,delete a.paddingRight)}e="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom".split(" ");for(var c=0;c<e.length;c++){var g=e[c];"number"===typeof a[g]?b[g]=a[g]+"px":"undefined"!==typeof a[g]?b[g]=a[g]:"padding"===g.substr(0,7)?b[g]=0:b[g]="auto"}b.zIndex=
"undefined"===typeof a.zIndex?"auto":a.zIndex;return b};D.isEqual=function(a,b){function e(a,b){var p;if(null===a&&null===b||"undefined"===typeof a&&"undefined"===typeof b)return!0;if(null===a&&null!==b||null===b&&null!==a||"undefined"===typeof a&&"undefined"!==typeof b||"undefined"===typeof b&&"undefined"!==typeof a)return!1;if(isNaN(a)&&isNaN(b)&&"number"===typeof a&&"number"===typeof b||a===b)return!0;if("function"===typeof a&&"function"===typeof b||a instanceof Date&&b instanceof Date||a instanceof
RegExp&&b instanceof RegExp||a instanceof String&&b instanceof String||a instanceof Number&&b instanceof Number)return a.toString()===b.toString();if(-1<c.indexOf(a)||-1<g.indexOf(b))return!1;if(null!==b){for(p in b)if(b.hasOwnProperty(p)!==a.hasOwnProperty(p)||typeof b[p]!==typeof a[p])return!1;for(p in a){if(b.hasOwnProperty(p)!==a.hasOwnProperty(p)||typeof b[p]!==typeof a[p])return!1;switch(typeof a[p]){case "object":case "function":c.push(a);g.push(b);if(!e(a[p],b[p]))return!1;c.pop();g.pop();
break;default:if(isNaN(a[p])&&isNaN(b[p])&&"number"===typeof a[p]&&"number"===typeof b[p])return!0;if(a[p]!==b[p])return!1}}}return!0}var c,g;c=[];g=[];return e(a,b)?!0:!1};D.file={loadFileAPI:function(){var a=new k;if("unload"===V){var b=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:b+"libs/polyfills/fileAPI/",flashUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};M(b,n.hitch(this,function(){V="loaded";
a.resolve()}));V="loading"}else"loaded"===V&&a.resolve();return a},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return h("safari")&&6>h("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var a=null;if(document.all)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(U){a=null}else navigator.plugins&&0<navigator.plugins.length&&(a=navigator.plugins["Shockwave Flash"]);return!!a},
containSeparator:function(a){return 0<=a.indexOf("/")?!0:0<=a.indexOf("\\")?!0:!1},getNameFromPath:function(a){var b="",b=0<=a.indexOf("/")?"/":"\\";a=a.split(b);return 0<a.length?a[a.length-1]:null},getFolderFromPath:function(a){return a.substr(0,a.length-D.file.getNameFromPath(a).length)},readFile:function(a,b,e,c){if(this.supportHTML5()){var g=a.target.files[0];g&&(g.type.match(b)?g.size>=e?c({errCode:"exceed"}):(a=new FileReader,a.onload=function(a){c(null,g.name,a.target.result)},a.readAsDataURL(g)):
c({errCode:"invalidType"}))}else if(this.supportFileAPI()){var p=window.FileAPI.getFiles(a);p[0].type.match(b)?p[0].size>=e?c({errCode:"exceed"}):window.FileAPI.readAsDataURL(p[0],function(a){a&&a.result?c(null,p[0].name,a.result):c({errCode:"readError"})}):c({errCode:"invalidType"})}}};D.getUriInfo=function(a){var b,e={};b=a.indexOf("/");a.substring(0,b);b=a.substring(0,a.lastIndexOf("/")+1);e.folderUrl=require(D.getRequireConfig()).toUrl(b);e.amdFolder=b;e.url=e.folderUrl;if(/^http(s)?:\/\//.test(a)||
/^\/\//.test(a))e.isRemote=!0;return e};D.widgetJson=function(){return{addManifest2WidgetJson:function(a,b){n.mixin(a,b.properties);a.name=b.name;a.label||(a.label=b.label);a.manifest=b;a.isRemote=b.isRemote;a.isRemote&&(a.itemId=b.itemId);b.featureActions&&(a.featureActions=b.featureActions);a.icon||(a.icon=b.icon);a.thumbnail||(a.thumbnail=b.thumbnail);a.folderUrl=b.folderUrl;a.amdFolder=b.amdFolder},removeManifestFromWidgetJson:function(a){if(a.manifest){for(var b in a.manifest.properties)a[b]=
void 0;a.name=void 0;a.label=void 0;a.featureActions=void 0;a.manifest=void 0}}}}();D.getRequireConfig=function(){if(jimuConfig){var a=[];jimuConfig.widgetsPackage&&(a=a.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(a=a.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(a=a.concat(jimuConfig.configsPackage));return{packages:a}}return{}};D.getTypeByGeometryType=function(a){var b="",e="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),
c=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(a)?b="point":0<=e.indexOf(a)?b="polyline":0<=c.indexOf(a)&&(b="polygon");return b};D.getSymbolTypeByGeometryType=function(a){var b=null;a=D.getTypeByGeometryType(a);"point"===a?b="marker":"polyline"===a?b="line":"polygon"===a&&(b="fill");return b};D.getServices=function(){return W};D.getArcGISDefaultGeometryService=function(){return new E(W.geometryService)};D.restoreToDefaultWebMapExtent=
function(a,b,e){var c=new k;if(!a||"esri.Map"!==a.declaredClass)return setTimeout(function(){c.reject("Invalid map.")},0),c;b=b&&b.itemInfo;if(!b)return setTimeout(function(){c.reject("Invalid itemInfo")},0),c;b=b.item&&b.item.extent;if(!b)return setTimeout(function(){c.reject("Invalid itemInfo.item.extent")}),c;var g=new y({wkid:4326}),g=new z(b[0][0],b[0][1],b[1][0],b[1][1],g);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(g);if(a.spatialReference.isWebMercator())return g=F.geographicToWebMercator(g),
a.setExtent(g);b=new C;b.geometries=[g];b.outSR=a.spatialReference;g=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;g&&"esri.tasks.GeometryService"===g.declaredClass||(e&&"string"===typeof e&&n.trim(e)?(e=n.trim(e),g=new E(e)):g=D.getArcGISDefaultGeometryService());g.project(b).then(function(b){if(b=b&&b[0])return a.setExtent(b);c.reject("Invalid projected geometry.");return c},function(a){console.error(a);c.reject(a);return c});return c};D.getAncestorWindow=function(){for(var a=
window;a&&a.parent&&a!==a.parent;)a=a.parent;return a};D.getAncestorDom=function(a,b,e){if(a&&1===a.nodeType&&b&&"function"===typeof b){var c=100,g=document.body;e&&("number"===typeof e?(e=parseInt(e,10),0<e&&(c=e)):1===e.nodeType&&(g=e));for(e=0;a.parentNode&&e<c&&l.isDescendant(a.parentNode,g);){if(b(a.parentNode))return a.parentNode;a=a.parentNode;e++}}return null};D.bindClickAndDblclickEvents=function(a,b,e,g){var p=null;if(a&&1===a.nodeType&&b&&"function"===typeof b&&e&&"function"===typeof e){var k=
200;g&&"number"===typeof g&&(g=parseInt(g,10),0<g&&(k=g));var u=0,p=c(a,"click",function(a){u++;1===u?setTimeout(function(){1===u&&(u=0,b(a))},k):2===u&&(u=0,e(a))})}return p};D.isScrollToBottom=function(a){var b=l.getContentBox(a);return 1>a.scrollHeight-(a.scrollTop+b.h)};D.getAllItemTypes=function(){var a=[],a=a.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return a=a.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};D.getItemQueryStringByTypes=function(a){var b="",e=D.getAllItemTypes();if(a&&0<a.length&&0<a.length){var c="";f.forEach(a,function(b,e){c+=' type:"'+b+'" ';e!==a.length-1&&(c+=" OR ")});b=" ( "+c+" ) ";e=a.concat(e);e=f.filter(e,function(b){return f.every(a,
function(a){return 0>a.toLowerCase().indexOf(b.toLowerCase())})});f.forEach(e,function(a){b+=' -type:"'+a+'" '})}return b};D.getItemQueryStringByTypeKeywords=function(a){var b="";a&&0<a.length&&(b=' typekeywords:"'+a.join(",")+'" ');return b};D.isNotEmptyString=function(a,b){var e=a&&"string"===typeof a;return e?b?e&&n.trim(a):!0:!1};D.isValidNumber=function(a){return"number"===typeof a&&!isNaN(a)};D.isObject=function(a){return a&&"object"===typeof a};D.createWebMap=function(a,b,e,c){a=S.getStandardPortalUrl(a);
a=S.getBaseItemUrl(a);v.arcgisUrl=a;return v.createMap(b,e,c)};D.getRandomString=function(){var a=Math.random().toString();return a=a.slice(2,a.length)};D._getDomainsByServerName=function(a){var b=a.split("."),e=b.length;return f.map(b,n.hitch(this,function(a,c){var g=b.slice(c,e),p="",k=g.length-1;f.forEach(g,n.hitch(this,function(a,b){p+=a;b!==k&&(p+=".")}));return p}))};D.removeCookie=function(a,b){var e=this._getDomainsByServerName(window.location.hostname);f.forEach(e,n.hitch(this,function(e){g(a,
null,{expires:-1,path:b});g(a,null,{expires:-1,path:b,domain:e});g(a,null,{expires:-1,path:b,domain:"."+e})}))};D.isLocaleChanged=function(a,b){return!a.startWith(b)};D.hashToObject=function(a){a=a.replace("#","");a=m.queryToObject(a);for(var b in a)if(a.hasOwnProperty(b))try{a[b]=r.parse(a[b])}catch(ba){}return a};D.reCreateObject=function(a){function b(a){var c=[];a.forEach(function(a){Array.isArray(a)?c.push(b(a)):"object"===typeof a?c.push(e(a)):c.push(a)});return c}function e(a){var c={},g;for(g in a)a.hasOwnProperty(g)&&
(null===a[g]?c[g]=null:Array.isArray(a[g])?c[g]=b(a[g]):c[g]="object"===typeof a[g]?e(a[g]):a[g]);return c}return Array.isArray(a)?b(a):e(a)};D.setVerticalCenter=function(a){setTimeout(function(){var b=q(".jimu-vcenter-text",a),e,c;f.forEach(b,function(a){e=l.getContentBox(a).h;l.setStyle(a,{lineHeight:e+"px"})},this);b=q(".jimu-vcenter",a);f.forEach(b,function(a){e=l.getContentBox(a).h;c=l.getContentBox(q(a).parent()[0]).h;l.setStyle(a,{marginTop:(c-e)/2+"px"})},this)},10)};D.merge=J;D.loadStyleLink=
function(a,b,e){var g=new k,p,u=require(D.getRequireConfig()).toUrl(b);if(require.cache["url:"+u]){p=require.cache["url:"+u];var t=u.split("/").pop(),u=u.substr(0,u.length-t.length);p=N(p,u);a=e?l.create("style",{id:a,type:"text/css"},l.byId(e),"before"):l.create("style",{id:a,type:"text/css"},document.getElementsByTagName("head")[0]);a.styleSheet&&!a.sheet?a.styleSheet.cssText=p:a.appendChild(l.toDom(p));g.resolve("load");return g}p=e?l.create("link",{id:a,rel:"stylesheet",type:"text/css",href:u+
"?wab_dv\x3d"+window.deployVersion},l.byId(e),"before"):l.create("link",{id:a,rel:"stylesheet",type:"text/css",href:u+"?wab_dv\x3d"+window.deployVersion},document.getElementsByTagName("head")[0]);c(p,"load",function(){g.resolve("load")});var d=setInterval(function(){var a;if(f.some(document.styleSheets,function(e){if(e.href&&e.href.substr(e.href.indexOf(b),e.href.length)===b)return a=e,!0}))try{!g.isFulfilled()&&(a.cssRules&&a.cssRules.length||a.rules&&a.rules.length)&&g.resolve("load"),clearInterval(d)}catch(ga){}},
50);return g};D.changeLocation=function(a){window.history.pushState&&window.history.pushState({path:a},"",a)};D.urlToObject=function(a){var b=null;-1===a.indexOf("#")?(b=I.urlToObject(a),b.hash=null):(a=a.split("#"),b=I.urlToObject(a[0]),b.hash=a[1]?-1<a[1].indexOf("\x3d")?m.queryToObject(a[1]):a[1]:null);return b};D.manifest=function(){function a(a){a.panels.forEach(function(a){a.uri="panels/"+a.name+"/Panel.js"});a.styles.forEach(function(a){a.uri="styles/"+a.name+"/style.css"});a.layouts.forEach(function(a){a.uri=
"layouts/"+a.name+"/config.json";a.icon="layouts/"+a.name+"/icon.png";a.RTLIcon="layouts/"+a.name+"/icon_rtl.png"})}return{addManifestProperies:function(b){b.icon||(b.icon=b.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion);b.thumbnail||(b.thumbnail=b.folderUrl+"images/thumbnail.png");"theme"===b.category?a(b):("undefined"!==typeof b["2D"]&&(b.support2D=b["2D"]),"undefined"!==typeof b["3D"]&&(b.support3D=b["3D"]),"undefined"===typeof b["2D"]&&"undefined"===typeof b["3D"]&&(b.support2D=
!0),delete b["2D"],delete b["3D"],"undefined"===typeof b.properties&&(b.properties={}),P.processWidgetProperties(b))},processManifestLabel:function(a,b){var e=b.split("-")[0];a.label=a.i18nLabels&&(a.i18nLabels[b]||a.i18nLabels[e]||a.i18nLabels.defaultLabel)||a.label||a.name;a.layouts&&f.forEach(a.layouts,function(e){var c="i18nLabels_layout_"+e.name;e.label=a[c]&&(a[c][b]||a[c].defaultLabel)||e.label||e.name});a.styles&&f.forEach(a.styles,function(e){var c="i18nLabels_style_"+e.name;e.label=a[c]&&
(a[c][b]||a[c].defaultLabel)||e.label||e.name})},addI18NLabel:function(a){var b=new k;if(a.i18nLabels)return b.resolve(a),b;a.i18nLabels={};if(a.properties&&!1===a.properties.hasLocale)return b.resolve(a),b;var e;e=a.isRemote?a.amdFolder+"nls/strings.js":a.amdFolder+"nls/strings";require(D.getRequireConfig(),["dojo/i18n!"+e],function(e){var c={};c[dojoConfig.locale]=e;P.addI18NLabelToManifest(a,null,c);b.resolve(a)});return b}}}();D.getUniqueValues=function(a,b,e,c){return function(){var b=new k;
c?b.resolve(c):b=K({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});return b}().then(function(c){return D._getUniqueValues(a,b,e,c).then(function(a){var e=[],e=D.getFieldInfoByFieldName(c.fields,b),g=null,p=0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(e.type);e&&(p&&(a=f.map(a,function(a){a=parseFloat(a);isNaN(a)&&(a=null);return a})),e.domain&&e.domain.codedValues&&0<e.domain.codedValues.length?
(g={},f.forEach(e.domain.codedValues,function(a){g[a.code]=a.name})):c.typeIdField===b&&(g={},f.forEach(c.types,function(a){g[a.id]=a.name})));return e=f.map(a,function(a){var b=null,b=null===a||void 0===a?"\x3cNull\x3e":g&&g.hasOwnProperty(a)?g[a]:p?D.localizeNumber(a):a;return{value:a,label:b}})})})};D._getUniqueValues=function(a,b,e,c){var g=new k;a=a.replace(/\/*$/g,"");e||(e="1\x3d1");/\/ImageServer$/gi.test(a)?g=D._getUniqueValuesByQueryTask(a,b,e):(g=D.getFieldInfoByFieldName(c.fields,b),g=
0<D._getCodedValuesOrTypesCount(g,c)?D._getUniqueValuesByQueryTask(a,b,e):D._getUniqueValuesByGenerateRenderer(a,b,e));return g};D._getCodedValuesOrTypesCount=function(a,b){if(a){if(a.domain&&"codedValue"===a.domain.type&&a.domain.codedValues)return a.domain.codedValues.length;if(b.typeIdField===a.name&&b.types)return b.types.length}return 0};D._getUniqueValuesByQueryTask=function(a,b,e){var c=new Q;c.where=e;c.returnDistinctValues=!0;c.returnGeometry=!1;c.outFields=[b];return(new O(a)).execute(c).then(function(a){var e=
[];a.features&&0<a.features.length&&f.forEach(a.features,function(a){a&&a.attributes&&e.push(a.attributes[b])});return e})};D._getUniqueValuesByGenerateRenderer=function(a,b,e){var c=new k;a=a.replace(/\/*$/g,"")+"/generateRenderer";b=r.stringify({type:"uniqueValueDef",uniqueValueFields:[b]});K({url:a,content:{classificationDef:b,f:"json",where:e},handleAs:"json",callbackParamName:"callback"}).then(n.hitch(this,function(a){var b=[];(a=a&&a.uniqueValueInfos)&&0<a.length&&(b=f.map(a,n.hitch(this,function(a){return a.value})));
c.resolve(b)}),n.hitch(this,function(a){c.reject(a)}));return c};D.isCodedValuesSupportFilter=function(a,b){var e=parseFloat(a.currentVersion);return b<=parseFloat(a.maxRecordCount)&&10.1<e};D.combineRadioCheckBoxWithLabel=function(a,b){var e=!1;if(a&&1===a.nodeType&&"input"===a.tagName.toLowerCase()){var c=a.getAttribute("type")||"",c=c.toLowerCase();if("radio"===c||"checkbox"===c)e=!0}c=!1;b&&1===b.nodeType&&"label"===b.tagName.toLowerCase()&&(c=!0);e&&c&&(e=a.getAttribute("id"),e||(e="input_"+
D.getRandomString(),a.setAttribute("id",e)),b.setAttribute("for",e),l.setStyle(b,"cursor","pointer"))};D.groupRadios=function(a,b){var e=[],g="radiogroup_"+D.getRandomString();f.forEach(a,function(a){a.name=g;b&&(a=c(a,"change",b),e.push(a))});return e};D.convertExtentToPolygon=function(a){var b=a.xmin,e=a.xmax,c=a.ymin,g=a.ymax;return new B({rings:[[[b,g],[e,g],[e,c],[b,c],[b,g]]],spatialReference:a.toJson()})};D.combineGeometries=function(a){function b(a){var b={points:[],spatialReference:a[0].spatialReference.toJson()};
f.forEach(a,function(a){"point"===a.type?b.points=b.points.concat([[a.x,a.y]]):"multipoint"===a.type&&(b.points=b.points.concat(a.points))});return new x(b)}function e(a){var b={paths:[],spatialReference:a[0].spatialReference.toJson()};f.forEach(a,function(a){b.paths=b.paths.concat(a.paths)});return new A(b)}function c(a){var b={rings:[],spatialReference:a[0].spatialReference.toJson()};f.forEach(a,function(a){"polygon"===a.type?b.rings=b.rings.concat(a.rings):"extent"===a.type&&(a=D.convertExtentToPolygon(a),
b.rings=b.rings.concat(a.rings))});return new B(b)}var g=null;if(a&&0<a.length)if(1===a.length)g=a[0];else{for(var p=null,k=null,u=null,t=null,d=0;d<a.length;d++){p=a[d];switch(p.type){case "point":case "multipoint":t="point";break;case "polyline":t="polyline";break;case "polygon":case "extent":t="polygon";break;default:return null}if(0===d)u=t;else if(u!==t)return null;if(d!==a.length-1&&(k=a[d+1],!p.spatialReference.equals(k.spatialReference)))return null}"point"===t?g=b(a):"polyline"===t?g=e(a):
"polygon"===t&&(g=c(a))}return g};D.combineGeometriesByGraphics=function(a){var b=null;a&&0<a.length&&(a=f.map(a,function(a){return a.geometry}),b=D.combineGeometries(a));return b};D.isFeaturelayerUrlSupportQuery=function(a,b){var e=!1,c=/\/featureserver\//gi.test(a),g=/\/mapserver\//gi.test(a);b=(b||"").toLowerCase();c?e=0<=b.indexOf("query"):g&&(e=0<=b.indexOf("data"));return e};D.isImageServiceSupportQuery=function(a){return 0<=(a||"").toLowerCase().indexOf("catalog")};D.isStringEndWith=function(a,
b){return a.lastIndexOf(b)+b.length===a.length};D.localizeNumber=function(a,b){var e=(a.toString().split(".")[1]||"").length,c="",c=b&&isFinite(b.places)&&b.places,c=0<c||0<e?"#,###,###,##0.0"+Array.prototype.join.call({length:0<c?c+1:e},"0"):"#,###,###,##0",e={locale:d.locale,pattern:c};n.mixin(e,b||{});try{return p.format(a,e)}catch(da){return console.error(da),a.toLocaleString()}};D.parseNumber=function(a,b){var e={locale:d.locale};n.mixin(e,b||{});try{return p.parse(a,e)}catch(Y){return console.error(Y),
a}};D.localizeDate=function(a,b){var c={locale:d.locale,fullYear:!0};n.mixin(c,b||{});try{return e.format(a,c)}catch(Y){return console.error(Y),"date"===c.selector?a.toLocaleDateString():"time"===c.selector?a.toLocaleTimeString():a.toLocaleString()}};D.localizeNumberByFieldInfo=function(a,e){var c=null,c=n.exists("format.places",e)&&e.format.places,c=D.localizeNumber(a,{places:c});return n.exists("format.digitSeparator",e)&&!e.format.digitSeparator?c.toString().replace(new RegExp("\\"+b.group,"g"),
""):c};D.localizeDateByFieldInfo=function(a,b){var e=null;try{var c={date:a instanceof Date?a.getTime():a},g=n.exists("format.dateFormat",b)?b.format.dateFormat:"longMonthDayYear",e=t.substitute(c,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+w.prototype._dateFormats[g]}})}catch(ea){console.error(ea),e=a}return e};D.fieldFormatter={getFormattedUrl:function(a){if(a&&"string"===typeof a){var b=a.indexOf("http:");-1===b&&(b=a.indexOf("https:"));if(-1<b&&-1===a.indexOf("href\x3d")){var e=
a.indexOf(" ",b);-1===e&&(e=a.length);var c=a.substring(b,e);a=a.substring(0,b)+'\x3cA href\x3d"'+c+'" target\x3d"_blank"\x3e'+c+"\x3c/A\x3e"+a.substring(e,a.length)}}return a||""},getFormattedNumber:function(a,b){if("number"===typeof a){var e=(a.toString().split(".")[1]||"").length;a=D.localizeNumberByFieldInfo(a,{format:{places:b&&"number"===typeof b.places?parseInt(b.places,10):e,digitSeparator:b&&b.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(a||"")+"\x3c/span\x3e"}return a},
getFormattedDate:function(a,b){if("number"===typeof a||a instanceof Date)a=D.localizeDateByFieldInfo(a,{format:b});return a||""},getCodedValue:function(a,b){if(a&&a.codedValues){for(var e=0,c=a.codedValues.length;e<c;e++){var g=a.codedValues[e];if(t.isDefined(b)&&n.exists("code",g)&&b.toString()===g.code.toString())return g.name}return b}return b||null},getTypeName:function(a,b){for(var e=b.length,c=0;c<e;c++)if(a===b[c].id)return b[c].name;return a}};D.addRelativePathInCss=N;D.url={isAbsolute:function(a){return a?
a.startWith("http")||a.startWith("/"):!1},removeQueryParamFromUrl:function(a,b){var e=I.urlToObject(a);e.query&&delete e.query[b];var c=e.path,g;for(g in e.query)c=c===e.path?c+"?"+g+"\x3d"+e.query[g]:c+"\x26"+g+"\x3d"+e.query[g];return c},addQueryParamToUrl:function(a,b,e){a=I.urlToObject(a);a.query||(a.query={});a.query[b]=e;b=a.path;for(var c in a.query)b=b===a.path?b+"?"+c+"\x3d"+a.query[c]:b+"\x26"+c+"\x3d"+a.query[c];return b}};D.processUrlInWidgetConfig=function(a,b){if(a)return a.startWith("data:")||
a.startWith("http")||a.startWith("/")?a:a.startWith("${appPath}")?a.replace("${appPath}",window.appInfo.appPath):b+a};D.processUrlInAppConfig=function(a){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:window.appInfo.appPath+a};D.getLocationUrlWithoutHashAndQueryParams=function(){var a=window.location,b=a.protocol+"//"+a.host+a.pathname,a=I.urlToObject(a.href);a.query&&a.query.apiurl&&(b=D.url.addQueryParamToUrl(b,"apiurl",a.query.apiurl));return b};D.getDefaultWebMapThumbnail=
function(){return require.toUrl("jimu/images/webmap.png")};D.invertColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?"#000000":"#ffffff"};D.mixinAppConfigPosition=function(a,b){var e=n.clone(a);if(!b)return e;b=n.clone(b);var c=e.widgetOnScreen,g=b.widgetOnScreen;g&&g.widgets&&("[object Object]"===Object.prototype.toString.call(g.widgets)?f.forEach(c.widgets,function(a,b){var e;e=a.uri?
a.uri:"ph_"+b;g.widgets[e]&&g.widgets[e].position&&(g.widgets[e].position.relativeTo||(g.widgets[e].position.relativeTo="map"),a.position=g.widgets[e].position)},this):f.forEach(g.widgets,function(a,b){a.position&&!a.position.relativeTo&&(a.position.relativeTo="map");c.widgets[b]&&a.position&&(c.widgets[b].position=a.position)}));g&&g.groups&&("[object Object]"===Object.prototype.toString.call(g.groups)?f.forEach(c.groups,function(a,b){var e;e=a.label?a.label:"g_"+b;g.groups[e]&&g.groups[e].panel&&
g.groups[e].panel.position&&(g.groups[e].panel.position.relativeTo||(g.groups[e].panel.position.relativeTo="map"),a.panel.position=g.groups[e].panel.position)},this):f.forEach(g.groups,function(a,b){a.panel&&a.panel.position&&!a.panel.position.relativeTo&&(a.panel.position.relativeTo="map");c.groups[b]&&a.panel.position&&(c.groups[b].panel.position=a.panel.position)}));b.map&&b.map.position&&(e.map?e.map.position=b.map.position:e.map={position:b.map.position});b.widgetPool&&b.widgetPool.panel&&(b.widgetPool.panel.position&&
!b.widgetPool.panel.position.relativeTo&&(b.widgetPool.panel.position.relativeTo="map"),e.widgetPool.panel.position=b.widgetPool.panel.position);b.mobileLayout&&(e.mobileLayout=b.mobileLayout);return e};D.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(a,b,e){var c=-1;b=a.search(new RegExp(b));0<=b&&(a=a.slice(b,a.length),a=a.indexOf(e),c=b+a+e.length);return{firstPos:b,lastPos:c}},setConfigValue:function(a,b,e){R(a,b,e)},getConfigValue:function(a,
b){return R(a,b)},setConfigValueWithId:function(a,b,e){X(a,b,e)},getConfigValueWithId:function(a,b){return X(a,b)},getKeyInfo:function(a){var b=this.getWidgetIdByKey(a);if(null!==b)return{type:"widget",id:b};a=this.getGroupIdByKey(a);return null!==a?{type:"group",id:a}:{type:"unknow",id:null}},getWidgetIdByKey:function(a){var b=D.template.getSearchRange(a,D.template.widgetIdentification,"]");if(-1===b.firstPos)a=null;else{var e=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+e.indexOf("[")+1,b.lastPos-
1)}return a},getGroupIdByKey:function(a){var b=D.template.getSearchRange(a,D.template.groupIdentification,"]");if(-1===b.firstPos)a=null;else{var e=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+e.indexOf("[")+1,b.lastPos-1)}return a},getConfigedWidgetsByTemplateConfig:function(a){var b=[],e=D.template.widgetIdentification+"_config",c;f.forEach(a.configurationSettings,function(a){f.forEach(a.fields,function(a){a.fieldName&&(c=D.template.getSearchRange(a.fieldName,e,"]"),0<=c.firstPos&&(a=D.template.getWidgetIdByKey(a.fieldName),
-1===b.indexOf(a)&&b.push(a)))},this)},this);return b},mergeTemplateAppConfigToAppConfig:function(a,b,e){function c(a){var b=[];f.forEach(a,function(a){a&&b.push(a)},this);return b}var g=a.widgetOnScreen,p=a.portalUrl;b.values.webmap&&(a.map.itemId=b.values.webmap);e&&(a.map.mapOptions&&D.deleteMapOptions(a.map.mapOptions),a.map.portalUrl=p,b.values.app_title||(b.values.app_title=e.title),b.values.app_subtitle||(b.values.app_subtitle=e.snippet));for(var k in b.values)"webmap"!==k&&D.template.setConfigValueWithId(a,
k,b.values[k]);a.widgetPool.widgets=c(a.widgetPool.widgets);g.widgets=c(g.widgets);if(a.widgetPool.groups)for(b=0;b<a.widgetPool.groups.length;b++)a.widgetPool.groups[b].widgets=c(a.widgetPool.groups[b].widgets);if(g.groups)for(b=0;b<g.groups.length;b++)g.groups[b].widgets=c(g.groups[b].widgets);return a}};D.deleteMapOptions=function(a){a&&(delete a.extent,delete a.lods,delete a.center,delete a.scale,delete a.zoom,delete a.maxScale,delete a.maxZoom,delete a.minScale,delete a.minZoom)};D.graphicsExtent=
function(a,b){var e=null;try{0<a.length&&(e=L.graphicsExtent(a))&&"number"===typeof b&&0<b&&(e=e.expand(b))}catch(Y){console.error(Y)}return e};D.sanitizeHTML=function(a){return html_sanitize(a,function(a){return a},function(a){return a})};D.stripHTML=function(a){return a?-1<a.indexOf("\x3c")&&-1<a.indexOf("\x3e")?a.replace(/<(?:.|\s)*?>/g,""):a:a};D.removeSuffixSlashes=function(a){return a.replace(/\/*$/g,"")};D.getBestDisplayAttributes=function(a,b){var e={},c=null,g;for(g in a)c=D.getBestDisplayValue(g,
a,b),e[g]=c;return e};D.getBestDisplayValue=function(a,b,e){var c="",g=null;n.isArrayLike(e)?g=D.getFieldInfoByFieldName(e,a):"object"===typeof e&&e.name===a&&(g=e);g&&(c=b[a],"esriFieldTypeDate"===g.type?c&&(a=new Date(parseInt(c,10)),c=D._tryLocaleDate(a)):"number"===typeof c&&(g.domain&&"codedValue"===g.domain.type?f.some(g.domain.codedValues,function(a){if(a.code===c)return c=a.name,!0}):c=D._tryLocaleNumber(c)));if(null===c||void 0===c)c="";return c};D.getDefaultPortalFieldInfo=function(a){var b=
a.name,b={fieldName:b,label:a.alias||b,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(a.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":b.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":b.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":b.format={dateFormat:"longMonthDayYear"}}return b};D._tryLocaleNumber=function(a){var b=D.localizeNumber(a);if(null===b||void 0===b)b=a;return b};D._tryLocaleDate=
function(a){var b=D.localizeDate(a);b||(b=a.toLocaleDateString());return b};D.getFieldInfoByFieldName=function(a,b){var e=null;a&&0<a.length&&f.some(a,n.hitch(this,function(a){return a.name===b?(e=a,!0):!1}));return e};D.containsNonLatinCharacter=function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1};D.has=function(a){var b=h(a);if(b)return b;if("ie"===a.toLowerCase()){a=0;var e=/MSIE (\d+\.\d+);/.test(navigator.userAgent),c=!!navigator.userAgent.match(/Trident\/7.0/),g=
navigator.userAgent.indexOf("rv:11.0");e&&(a=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(a=10);c&&-1!==g&&(a=11);return 11===a&&11||b}if("edge"===a.toLowerCase())return navigator.userAgent.split("Edge/")[1]||b};D.detectUserAgent=function(){var a={},b={},e=navigator.userAgent,c=navigator.platform,g=e.match(/Web[kK]it[\/]{0,1}([\d.]+)/),p=e.match(/(Android);?[\s\/]+([\d.]+)?/),k=!!e.match(/\(Macintosh\; Intel /),u=e.match(/(iPad).*OS\s([\d_]+)/),t=e.match(/(iPod)(.*OS\s([\d_]+))?/),
d=!u&&e.match(/(iPhone\sOS)\s([\d_]+)/),w=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),c=/Win\d{2}|Windows/.test(c),r=e.match(/Windows Phone ([\d.]+)/),v=w&&e.match(/TouchPad/),m=e.match(/Kindle\/([\d.]+)/),q=e.match(/Silk\/([\d._]+)/),h=e.match(/(BlackBerry).*Version\/([\d.]+)/),f=e.match(/(BB10).*Version\/([\d.]+)/),B=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),x=e.match(/PlayBook/),z=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),y=e.match(/Firefox\/([\d.]+)/),l=e.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),
A=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),F=!z&&e.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),E=F||e.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);b.webkit=!!g;b.webkit&&(b.version=g[1]);p&&(a.android=!0,a.version=p[2]);d&&!t&&(a.ios=a.iphone=!0,a.version=d[2].replace(/_/g,"."));u&&(a.ios=a.ipad=!0,a.version=u[2].replace(/_/g,"."));t&&(a.ios=a.ipod=!0,a.version=t[3]?t[3].replace(/_/g,"."):null);r&&(a.wp=!0,a.version=r[1]);w&&(a.webos=
!0,a.version=w[2]);v&&(a.touchpad=!0);h&&(a.blackberry=!0,a.version=h[2]);f&&(a.bb10=!0,a.version=f[2]);B&&(a.rimtabletos=!0,a.version=B[2]);x&&(b.playbook=!0);m&&(a.kindle=!0,a.version=m[1]);q&&(b.silk=!0,b.version=q[1]);!q&&a.android&&e.match(/Kindle Fire/)&&(b.silk=!0);z&&(b.chrome=!0,b.version=z[1]);y&&(b.firefox=!0,b.version=y[1]);l&&(a.firefoxos=!0,a.version=l[1]);A&&(b.ie=!0,b.version=A[1]);E&&(k||a.ios||c)&&(b.safari=!0,a.ios||(b.version=E[1]));F&&(b.webview=!0);a.tablet=!!(u||x||p&&!e.match(/Mobile/)||
y&&e.match(/Tablet/)||A&&!e.match(/Phone/)&&e.match(/Touch/));a.phone=!(a.tablet||a.ipod||!(p||d||w||h||f||z&&e.match(/Android/)||z&&e.match(/CriOS\/([\d.]+)/)||y&&e.match(/Mobile/)||A&&e.match(/Touch/)));return{os:a,browser:b}};D.isMobileUa=function(){var a=D.detectUserAgent();return!0===a.os.phone||!0===a.os.tablet?!0:!1};D.inMobileSize=function(){var a=l.getMarginBox(window.jimuConfig.layoutId);if(a.w<=window.jimuConfig.breakPoints[0]||a.h<=window.jimuConfig.breakPoints[0])return l.addClass(window.jimuConfig.layoutId,
"jimu-ismobile"),!0;l.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1};D.getObjectIdField=function(a){if(a.objectIdField)return a.objectIdField;a=a.fields;for(var b=0;b<a.length;b++){var e=a[b];if("esriFieldTypeOID"===e.type)return e.name}return null};D.isNeedHttpsButNot=function(){var a=navigator.geolocation,b=window.hasOwnProperty("isSecureContext");return(b&&window.isSecureContext||!b&&"https:"===window.location.protocol)&&a?!1:!0};D.toFeatureSet=function(a){var b=new G;"[object Object]"===
Object.prototype.toString.call(a)&&(a=[a]);b.features=a;if(0<a.length){var e;f.some(a,function(a){if(a.geometry)return e=a,!0});if(e){a=e.getLayer();var c={};a&&(b.displayFieldName=a.displayField,f.forEach(a.fields,n.hitch(this,function(a){var b=a.name;c[b]=a.alias||b})),b.fieldAliases=c);b.geometryType=e.geometry.type;b.spatialReference=e.geometry.spatialReference}}return b};D.showValidationErrorTipForFormDijit=function(a){try{!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),setTimeout(n.hitch(this,
function(){a.focusNode.blur()}),100))}catch(U){console.error(U)}};D.getFeatureLayerDefinition=function(a){var b=null,e=a.graphics;a.graphics=[];var c=a.toJson();a.graphics=e;c&&(b=c.layerDefinition);return b};D.simulateClickEvent=function(a){if(h("safari")){var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!0);a.dispatchEvent(b)}else a.click()};D.getFeatureSetByLayerAndFeatures=function(a,b){var e=new G;e.fields=n.clone(a.fields);e.features=b;e.geometryType=a.geometryType;e.fieldAliases=
{};f.forEach(e.fields,n.hitch(this,function(a){var b=a.name;e.fieldAliases[b]=a.alias||b}));return e};D.featureAction=function(){return{zoomTo:function(a,b,e){e||(e={});e.hasOwnProperty("extentFactor")||(e.extentFactor=1.2);if(a&&b&&0<b.length){var c=f.every(b,function(a){return a&&a.spatialReference&&a.type});if(f.every(b,function(a){return a&&a.geometry&&a.geometry.spatialReference&&a.geometry.type})||c)c&&(b=f.map(b,function(a){return{geometry:a}})),1===b.length&&"point"===b[0].type?(e=15,e=-1<
a.getMaxZoom()?a.getMaxZoom():.1,a.centerAndZoom(b[0].geometry,e)):(b=L.graphicsExtent(b),a.setExtent(b.expand(e.extentFactor)))}},flash:function(a,b){function e(a,b){f.forEach(g,function(e,c){e.setSymbol(b?a:k[c]||u)})}function c(a){return function(){setTimeout(function(){e(t,!0);g[0]&&b&&b.redraw();setTimeout(function(){e(null,!1);g[0]&&b&&b.redraw();a()},200)},200)}}if(f.every(a||[],function(a){return a&&a.geometry})){var g=a,p=g[0],k=f.map(g,function(a){return a.symbol}),u=p.symbol||n.getObject("renderer.symbol",
!1,b),t=null;b&&"esriGeometryPoint"===b.geometryType?t=new H(require.toUrl("jimu")+"/images/flash.gif",20,20):(t=n.clone(u))&&(t.outline?t.outline.setColor("#ffc500"):t.setColor("#ffc500"));p&&u&&t&&b&&("esriGeometryPoint"===b.geometryType?(e(t,!0),b.redraw(),setTimeout(function(){e(null,!1);b.redraw()},2E3)):c(c(c(function(){})))())}},panTo:function(a,b){if(f.every(b||[],function(a){return a&&a.geometry})){var e;0<b.length?e=L.graphicsExtent(b).getCenter():(e=b[0].geometry,e="polyline"===e.type||
"polygon"===e.type?e.getExtent().getCenter():"extent"===e.type?e.getCenter():"multipoint"===e.type?1<e.points.length?e.getExtent().getCenter():e.getPoint(0):e);a.centerAt(e)}},showPopup:function(a,b){if(f.every(b||[],function(a){return a&&a.geometry})){var e=a.infoWindow;e.setFeatures(b);var c=b[0];"point"===c.geometry.type?e.show(c.geometry,{closetFirst:!0}):e.show(c.geometry.getExtent().getCenter(),{closetFirst:!0})}}}}();D.isInConfigOrPreviewWindow=function(){var a=!1;try{a=!window.isBuilder&&
window.parent&&window.parent!==window&&window.parent.isBuilder}catch(U){console.log(U),a=!1}return!!a};D.getAppHref=function(){var a="";return a=D.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};D.getAppIdFromUrl=function(){var a=!0,b=D.getAppHref();if(-1!==b.indexOf("id\x3d")||-1!==b.indexOf("appid\x3d")||-1!==b.indexOf("apps"))a=!1;if(!0===a)return b;a=this.urlToObject(window.location.href);if(a.query&&(a.query.id||a.query.appid))return a.query.id||a.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;
if(window.appInfo.appPath){if(a=window.appInfo.appPath.split("/"),a.length&&2<a.length)return a[a.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};D.getEditorContentHeight=function(a,b,e){var c=new k;this._content=a;this._dom=b;this._domParam=e;var g=setTimeout(n.hitch(this,function(){clearTimeout(g);g=null;var a=0,b=this._domParam.contentWidth;try{var e=document.createElement("div");e.setAttribute("id","fakeContent");l.setStyle(e,"background-size","contain");e.innerHTML=this._content;this._dom.appendChild(e);
if(e){var p=q("img",e);p&&p.length&&p.style({maxWidth:b-20+"px"});l.setStyle(e,"position","absolute");l.setStyle(e,"width",b+"px");l.setStyle(e,"left","-99999px");l.setStyle(e,"top","-99999px");l.setStyle(e,"visibility","hidden");var k=l.getContentBox(e);k.h&&(a=k.h,a+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(ca){console.error("can't getEditorContentHeight"+ca),a=200}c.resolve(a)}),1500);return c};D.getBase64Data=function(a){var b=new k;if(a&&a.startWith("data:image"))b.resolve(a);
else try{K({url:a,handleAs:"arraybuffer"}).then(function(a){var e=new FileReader;e.onloadend=function(){b.resolve(e.result)};e.onerror=function(){b.resolve(null)};e.readAsDataURL(new Blob([a],{type:"image/png"}))},function(){b.resolve(null)})}catch(ba){console.warn(ba),b.resolve(null)}return b};D.getEditorTextColor=function(a,b){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:D.getColorRecordName(a),forceAttr:b}}};D.getEditorBackgroundColor=function(a){return{name:"dijit.editor.plugins.EditorBackgroundColor",
custom:{recordUID:D.getColorRecordName(a)}}};D.getColorRecordName=function(a){return"wab_cr_"+(a||"")};return D})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(n,f,l){var h=n.NodeList;f.extend(h,{_buildArrayFromCallback:function(d){for(var m=[],q=0;q<this.length;q++){var a=d.call(this[q],this[q],m);a&&(m=m.concat(a))}return m},_getUniqueAsNodeList:function(d){for(var m=[],q=0,a;a=d[q];q++)1==a.nodeType&&-1==l.indexOf(m,a)&&m.push(a);return this._wrap(m,
null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(d,m){var q=this._getUniqueAsNodeList(d),q=m?n._filterResult(q,m):q;return q._stash(this)},_getRelatedUniqueNodes:function(d,m){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(m),d)},children:function(d){return this._getRelatedUniqueNodes(d,function(d,q){return f._toArray(d.childNodes)})},closest:function(d,m){return this._getRelatedUniqueNodes(null,function(q,a){do if(n._filterResult([q],d,m).length)return q;while(q!=
m&&(q=q.parentNode)&&1==q.nodeType);return null})},parent:function(d){return this._getRelatedUniqueNodes(d,function(d,q){return d.parentNode})},parents:function(d){return this._getRelatedUniqueNodes(d,function(d,q){for(var a=[];d.parentNode;)d=d.parentNode,a.push(d);return a})},siblings:function(d){return this._getRelatedUniqueNodes(d,function(d,q){for(var a=[],k=d.parentNode&&d.parentNode.childNodes,c=0;c<k.length;c++)k[c]!=d&&a.push(k[c]);return a})},next:function(d){return this._getRelatedUniqueNodes(d,
function(d,q){for(var a=d.nextSibling;a&&1!=a.nodeType;)a=a.nextSibling;return a})},nextAll:function(d){return this._getRelatedUniqueNodes(d,function(d,q){for(var a=[],k=d;k=k.nextSibling;)1==k.nodeType&&a.push(k);return a})},prev:function(d){return this._getRelatedUniqueNodes(d,function(d,q){for(var a=d.previousSibling;a&&1!=a.nodeType;)a=a.previousSibling;return a})},prevAll:function(d){return this._getRelatedUniqueNodes(d,function(d,q){for(var a=[],k=d;k=k.previousSibling;)1==k.nodeType&&a.push(k);
return a})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(d,m){return 0!=m%2})},odd:function(){return this.filter(function(d,m){return 0==m%2})}});return h})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],function(n){n=n.getObject("dojox.encoding.base64",!0);n.encode=function(f){for(var l=[],
h=f.length,d=h%3,h=h-d,m=0;m<h;){var q=f[m++]<<16|f[m++]<<8|f[m++];l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>18&63));l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>12&63));l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>6&63));l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q&63))}switch(d){case 2:q=f[m++]<<16|f[m++]<<8;l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>
18&63));l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>12&63));l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>6&63));l.push("\x3d");break;case 1:q=f[m++]<<16,l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>18&63)),l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>12&63)),l.push("\x3d"),l.push("\x3d")}return l.join("")};n.decode=function(f){f=f.split("");
for(var l=[],h=f.length;"\x3d"==f[--h];);for(var d=0;d<h;){var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[d++])<<18;d<=h&&(m|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[d++])<<12);d<=h&&(m|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[d++])<<6);d<=h&&(m|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[d++]));l.push(m>>>16&255);l.push(m>>>8&255);l.push(m&255)}for(;0==l[l.length-
1];)l.pop();return l};return n})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(n,f,l,h,d,m,q,a){n=n(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var k=l.map(this.geometries,function(a){return a.toJson()}),c={};c.outSR=this.outSR.wkid||h.toJson(this.outSR.toJson());
c.inSR=this.geometries[0].spatialReference.wkid||h.toJson(this.geometries[0].spatialReference.toJson());c.geometries=h.toJson({geometryType:a.getJsonType(this.geometries[0]),geometries:k});this.transformation&&(c.transformation=this.transformation.wkid||h.toJson(this.transformation));q.isDefined(this.transformForward)&&(c.transformForward=this.transformForward);return c}});d("extend-esri")&&f.setObject("tasks.ProjectParameters",n,m);return n})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang",
"jimu/shared/basePortalUrlUtils"],function(n,f){var l=n.clone(f);l.declaredClass="jimu.portalUrlUtils";l.getPortalUrlFromLocation=function(){return l.getPortalServerFromLocation()+l.getDeployContextFromLocation()};l.getPortalSignInUrlFromLocation=function(){var h=l.getPortalUrlFromLocation();return l.setHttpsProtocol(h+"home/signin.html")};l.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};l.getDeployContextFromLocation=function(){var h=window.location.href.split("?")[0],
d=h.indexOf("/home");0>d&&(d=h.indexOf("/apps"));h=h.substring(h.indexOf(window.location.host)+window.location.host.length+1,d);"/"!==h&&(h="/"+h+"/");return h};l.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+l.getDeployContextFromLocation()+"sharing/rest/"};return l})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var n={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=
function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(f){return this.substr(0,f.length)===f});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(f){return this.substr(this.length-f.length,f.length)===f});n.getServerByUrl=function(f){f=(f||"").trim();f=f.replace(/^(http(s?):?)\/\//gi,"");0===f.indexOf("//")&&(f=f.slice(2));return f.split("/")[0]};n.getServerWithProtocol=function(f){var l=
"";if(f=(f||"").trim()){var h=n.getServerByUrl(f);if(!h)return l;var d=n.getProtocol(f);d?l=d+"://"+h:0===f.indexOf("//")&&(l="//"+h)}return l};n.isSameServer=function(f,l){f=n.getServerByUrl(f)||"";l=n.getServerByUrl(l)||"";return f.toLowerCase()===l.toLowerCase()};n.getDomain=function(f){var l="";if(f=n.getServerByUrl(f))f=f.replace(/:\d+$/,""),f=f.match(/[^.]\w+\.\w+$/),null!==f&&(l=f[0],/^\d+\.\d+$/.test(l)&&(l=""));return l};n.isSameDomain=function(f,l){var h=n.getDomain(f),d=n.getDomain(l);
return""!==h&&h===d};n.isOrgOnline=function(f){return 0<=n.getServerByUrl(f).toLowerCase().indexOf(".maps.arcgis.com")};n.isOnline=function(f){return 0<=n.getServerByUrl(f).toLowerCase().indexOf(".arcgis.com")};n.isArcGIScom=function(f){f=n.getServerByUrl(f).toLowerCase();return"www.arcgis.com"===f||"arcgis.com"===f};n.getStandardPortalUrl=function(f){var l=n.getServerByUrl(f);if(""===l)return"";n.isOnline(l)?(n.isArcGIScom(l)&&(l="www.arcgis.com"),f=n.addProtocol(f),f=n.getProtocol(f)+"://"+l):(f=
(f||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),f=n.addProtocol(f),f.replace(new RegExp("http(s?)://"+l,"g"),"")||(f+="/arcgis"));return f};n.isSamePortalUrl=function(f,l){var h=/^http(s?):\/\//gi,d=/^\/\//gi;f=n.getStandardPortalUrl(f).toLowerCase().replace(h,"").replace(d,"");l=n.getStandardPortalUrl(l).toLowerCase().replace(h,"").replace(d,"");return f===l};n.addProtocol=function(f){if(-1>=f.toLowerCase().indexOf("http://")&&-1>=f.toLowerCase().indexOf("https://")){var l="";"undefined"!==
typeof window&&window.location?(l=window.location.protocol,f=f.startWith("//")?l+f:f.startWith("/")?l+"//"+window.location.host+f:l+"//"+f):(l="http:",f=f.startWith("//")?l+f:l+"//"+f)}return f};n.getProtocol=function(f){var l="";f=f.toLowerCase();0===f.indexOf("https://")?l="https":0===f.indexOf("http://")&&(l="http");return l};n.updateUrlProtocolByOtherUrl=function(f,l){l=l.toLowerCase();0===l.indexOf("https://")?f=n.setHttpsProtocol(f):0===l.indexOf("http://")&&(f=n.setHttpProtocol(f));return f};
n.removeProtocol=function(f){return f.replace(/^http(s?):\/\//i,"//")};n.setHttpProtocol=function(f){f=n.addProtocol(f);return f.replace(/^https:\/\//,"http://")};n.setHttpsProtocol=function(f){f=n.addProtocol(f);return f.replace(/^http:\/\//,"https://")};n.setProtocol=function(f,l){return 0<=l.indexOf("https")?n.setHttpsProtocol(f):0<=l.indexOf("http")?n.setHttpProtocol(f):f};n.getSharingUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/sharing/rest");return l};n.getOAuth2Url=function(f){var l=
"";(f=n.getStandardPortalUrl(f))&&(l=f+"/sharing/rest/oauth2");return l};n.getAppIdUrl=function(f,l){var h="",d=n.getStandardPortalUrl(f);d&&(h=d+"/sharing/rest/oauth2/apps/"+l);return h};n.getSignInUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/home/signin.html");return l};n.getBaseSearchUrl=function(f){var l="";f=n.getStandardPortalUrl(f);(f=f.replace(/\/*$/g,""))&&(l=f+"/sharing/rest/search");return l};n.getBaseItemUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/sharing/rest/content/items");
return l};n.getItemUrl=function(f,l){var h="",d=n.getBaseItemUrl(f);d&&l&&(h=d+"/"+l);return h};n.getItemDataUrl=function(f,l){var h="",d=n.getItemUrl(f,l);d&&(h=d+"/data");return h};n.getItemGroupsUrl=function(f,l){var h="",d=n.getItemUrl(f,l);d&&(h=d+"/groups");return h};n.getGenerateTokenUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/sharing/generateToken");return l};n.getItemDetailsPageUrl=function(f,l){var h="";f&&l&&(f=n.getStandardPortalUrl(f),h=f+"/home/item.html?id\x3d"+l);
return h};n.getUserProfilePageUrl=function(f,l){var h="";f&&l&&(f=n.getStandardPortalUrl(f),h=f+"/home/user.html?user\x3d"+l);return h};n.getBaseGroupUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/sharing/rest/community/groups");return l};n.getPortalSelfInfoUrl=function(f){var l="";(f=n.getStandardPortalUrl(f||""))&&(l=f+"/sharing/rest/portals/self");return l};n.getCommunitySelfUrl=function(f){var l="";(f=n.getStandardPortalUrl(f||""))&&(l=f+"/sharing/rest/community/self");return l};
n.getBaseUserUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/sharing/rest/community/users");return l};n.getUserUrl=function(f,l){var h="",d=n.getBaseUserUrl(f);f&&l&&(h=d+"/"+l);return h};n.getUserTagsUrl=function(f,l){var h="",d=n.getUserUrl(f,l);f&&l&&(h=d+"/tags");return h};n.getUserThumbnailUrl=function(f,l,h){var d="";(f=n.getUserUrl(f,l))&&h&&(d=f+"/info/"+h);return d};n.getContentUrl=function(f){var l="";f&&(f=n.getStandardPortalUrl(f),l=f+"/sharing/rest/content");return l};
n.getUserContentUrl=function(f,l,h){var d="",d="";f&&l&&(d=n.getContentUrl(f),d=h?d+"/users/"+l+"/"+h:d+"/users/"+l);return d};n.getAddItemUrl=function(f,l,h){var d="",d="";f&&l&&(d=n.getUserContentUrl(f,l,h),d+="/addItem");return d};n.getDeleteItemUrl=function(f,l,h){var d="";(f=n.getUserItemsUrl(f,l))&&(d=f+"/"+h+"/delete");return d};n.getUserItemsUrl=function(f,l,h){var d="",d="";f&&l&&(d=n.getUserContentUrl(f,l,h),d+="/items");return d};n.getUpdateItemUrl=function(f,l,h,d){var m="",m="";f&&l&&
(m=n.getUserItemsUrl(f,l,d),m=m+"/"+h+"/update");return m};n.shareItemUrl=function(f,l,h,d){var m="",m="";f&&l&&(m=n.getUserItemsUrl(f,l,d),m=m+"/"+h+"/share");return m};n.getHomeIndexUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/home/index.html");return l};n.getHomeMapViewerUrl=function(f,l){var h="",d=n.getStandardPortalUrl(f);d&&(h=d+"/home/webmap/viewer.html",h=l?h+("?webmap\x3d"+l):h+"?useExisting\x3d1");return h};n.getHomeSceneViewerUrl=function(f,l){var h="",d=n.getStandardPortalUrl(f);
d&&(h=d+"/home/webscene/viewer.html",l&&(h+="?webscene\x3d"+l));return h};n.getHomeGalleryUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/home/gallery.html");return l};n.getHomeGroupsUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/home/groups.html");return l};n.getHomeMyContentUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/home/content.html");return l};n.getHomeMyOrganizationUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/home/organization.html");
return l};n.getHomeUserUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/home/user.html");return l};n.getPortalHelpUrl=function(f,l){var h="",d=n.getStandardPortalUrl(f);d&&(h=d+"/portalhelp/"+(l||"en")+"/website/help/");return h};n.getPortalAdminHelpUrl=function(f,l){var h="",d=n.getStandardPortalUrl(f);d&&(h=d+"/portalhelp/"+(l||"en")+"/admin/help/");return h};n.getPortalProxyUrl=function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/sharing/proxy");return l};n.getOAuth2SignOutUrl=
function(f){var l="";(f=n.getStandardPortalUrl(f))&&(l=f+"/sharing/rest/oauth2/signout");return l};n.getNewPrintUrl=function(f){var l="";if(f=n.getStandardPortalUrl(f))f=n.setHttpProtocol(f),l=f+"/sharing/tools/newPrint";return l};n.getSwitchAccoutnsUrl=function(f,l,h){var d="";if(f=n.getStandardPortalUrl(f))d=f+"/home/pages/Account/manage_accounts.html#client_id\x3d"+l,h&&(d+="\x26redirect_uri\x3d"+h);d&&(d=n.setHttpsProtocol(d));return d};return n})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],
function(n){function f(d,m){function q(a,k){var c,r,g,p,e="widgetOnScreen"===a;if(d[a]){if(d[a].groups)for(c=0;c<d[a].groups.length;c++)if(g=d[a].groups[c],k(g,{index:c,isWidget:!1,groupId:g.id,isThemeWidget:!1,isOnScreen:e}),d[a].groups[c].widgets)for(r=0;r<d[a].groups[c].widgets.length;r++)p=d[a].groups[c].widgets[r],k(p,{index:r,isWidget:!0,groupId:g.id,isThemeWidget:p.uri&&-1<p.uri.indexOf("themes/"+d.theme.name),isOnScreen:e});if(d[a].widgets)for(c=0;c<d[a].widgets.length;c++)p=d[a].widgets[c],
k(d[a].widgets[c],{index:c,isWidget:!0,groupId:a,isThemeWidget:p.uri&&-1<p.uri.indexOf("themes/"+d.theme.name),isOnScreen:e})}}q("widgetOnScreen",m);q("widgetPool",m)}var l={},h="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance".split(" ");l.visitElement=f;l.getConfigElementById=function(d,m){var q;if("map"===m)return d.map;f(d,function(a){if(a.id===
m)return q=a,!0});return q};l.getConfigElementByLabel=function(d,m){var q;if("map"===m)return d.map;f(d,function(a){if(a.label||a.name===m)return q=a,!0});return q};l.getConfigElementsByName=function(d,m){var q=[];if("map"===m)return[d.map];f(d,function(a){a.name===m&&q.push(a)});return q};l.getWidgetNameFromUri=function(d){d=d.split("/");d.pop();return d.pop()};l.getAmdFolderFromUri=function(d){d=d.split("/");d.pop();return d.join("/")+"/"};l.widgetProperties=h;l.processWidgetProperties=function(d){"undefined"===
typeof d.properties.isController&&(d.properties.isController=!1);"undefined"===typeof d.properties.isThemeWidget&&(d.properties.isThemeWidget=!1);"undefined"===typeof d.properties.hasVersionManager&&(d.properties.hasVersionManager=!1);h.forEach(function(m){"undefined"===typeof d.properties[m]&&(d.properties[m]=!0)})};l.getControllerWidgets=function(d){var m=[];d.visitElement(function(d){d.isController&&m.push(d)});return m};l.addI18NLabelToManifest=function(d,m,q){function a(a,c){c[k]&&(d.i18nLabels[a]=
c[k]);"theme"===d.category&&(d.layouts&&d.layouts.forEach(function(g){d["i18nLabels_layout_"+g.name]||(d["i18nLabels_layout_"+g.name]={});d["i18nLabels_layout_"+g.name][a]=c["_layout_"+g.name]}),d.styles&&d.styles.forEach(function(g){d["i18nLabels_style_"+g.name]||(d["i18nLabels_style_"+g.name]={});d["i18nLabels_style_"+g.name][a]=c["_style_"+g.name]}));"widget"===d.category&&d.featureActions&&d.featureActions.forEach(function(g){d["i18nLabels_featureAction_"+g.name]||(d["i18nLabels_featureAction_"+
g.name]={});d["i18nLabels_featureAction_"+g.name][a]=c["_featureAction_"+g.name]})}d.i18nLabels={};var k="widget"===d.category?"_widgetLabel":"_themeLabel";m&&m.root&&m.root[k]&&(d.i18nLabels.defaultLabel=m.root[k],"theme"===d.category&&(d.layouts&&d.layouts.forEach(function(a){d["i18nLabels_layout_"+a.name]={};d["i18nLabels_layout_"+a.name].defaultLabel=m.root["_layout_"+a.name]}),d.styles&&d.styles.forEach(function(a){d["i18nLabels_style_"+a.name]={};d["i18nLabels_style_"+a.name].defaultLabel=m.root["_style_"+
a.name]})),"widget"===d.category&&d.featureActions&&d.featureActions.forEach(function(a){d["i18nLabels_featureAction_"+a.name]={};d["i18nLabels_featureAction_"+a.name].defaultLabel=m.root["_featureAction_"+a.name]}));for(var c in q)a(c,q[c])};l.isHostedService=function(d){var m=n.getServerByUrl(d);return(new RegExp(m+"/[^/]+/[^/]+/rest/services","gi")).test(d)};return l})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u){var t=null,v=n(q,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(m.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),m.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(m.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),m.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(m.subscribe("app/sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),m.subscribe("app/sceneViewChanged",
f.hitch(this,this._onSceneViewChanged))):(m.subscribe("sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),m.subscribe("sceneViewChanged",f.hitch(this,this._onSceneViewChanged)));window.isBuilder?(m.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),m.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(m.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),m.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));m.subscribe("userSignIn",
f.hitch(this,this._onUserSignIn));m.subscribe("userSignOut",f.hitch(this,this._onUserSignOut));m.subscribe("builder/actionTriggered",f.hitch(this,this._onActionTriggered));m.subscribe("/dnd/move/start",f.hitch(this,this._onMoveStart))},loadWidget:function(a){var b=new d,e;a=f.clone(a);(e=this.getWidgetById(a.id))?b.resolve(e):p([this.loadWidgetClass(a),this.loadWidgetManifest(a)]).then(f.hitch(this,function(a){var e=a[0],c=a[1];this.loadWidgetResources(c).then(f.hitch(this,function(a){try{var g=this.createWidget(c,
e,a);h.setAttr(g.domNode,"data-widget-name",c.name);console.log("widget ["+c.uri+"] created.")}catch(C){console.log("create ["+c.uri+"] error:"+C.stack),new u({message:window.jimuNls.widgetManager.createWidgetError+": "+c.uri}),b.reject(C)}setTimeout(f.hitch(this,function(){b.resolve(g);this.emit("widget-created",g);m.publish("widgetCreated",g)}),50)}),function(a){b.reject(a)})}),function(a){b.reject(a)});return b},loadWidgetClass:function(a){var b=new d,c;c=a.isRemote?a.uri+".js":a.uri;require(e.getRequireConfig(),
[c],f.hitch(this,function(a){b.resolve(a)}));e.checkError(a.uri,b);return b},loadWidgetResources:function(a){var b=new d,e,c,g,k=[];g=f.clone(a);a=this.tryLoadWidgetConfig(g);e=this._tryLoadResource(g,"i18n");c=this._tryLoadResource(g,"style");g=this._tryLoadResource(g,"template");k.push(a);k.push(e);k.push(g);k.push(c);p(k).then(f.hitch(this,function(a){var e={};e.config=a[0];e.i18n=a[1];e.template=a[2];e.style=a[3];b.resolve(e)}),function(a){b.reject(a)});return b},loadWidgetManifest:function(a){var b=
new d,c=e.getUriInfo(a.uri),c=c.isRemote?c.folderUrl+"manifest.json?f\x3djson":c.folderUrl+"manifest.json";if(a.manifest)return b.resolve(a),b;g(c,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(c){if(c.error&&c.error.code)return b.reject(c.error);c.category="widget";f.mixin(c,e.getUriInfo(a.uri));e.manifest.addI18NLabel(c).then(f.hitch(this,function(){this._processManifest(c);e.widgetJson.addManifest2WidgetJson(a,c);b.resolve(a)}))}),function(a){b.reject(a)});return b},
getWidgetMarginBox:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return{};if(a._marginBox)return a._marginBox;a.setPosition({left:-9999,top:-9999,relativeTo:a.position.relativeTo});this.openWidget(a);a._marginBox=a.getMarginBox();this.closeWidget(a);return a._marginBox},_processManifest:function(a){e.manifest.addManifestProperies(a);e.manifest.processManifestLabel(a,window.dojoConfig.locale)},createWidget:function(b,c,g){if(this.getWidgetById(b.id))return this.getWidgetById(b.id);
g.config&&g.i18n&&(g.config=e.replacePlaceHolder(g.config,g.i18n));b.rawConfig=b.config;b.config=g.config||{};this.appConfig._appData&&this._mergeAgolConfig(b);b.nls=g.i18n||{};g.template&&(b.templateString=g.template);b["class"]="jimu-widget";b.label||(b.label=b.name);this.map&&(b.map=this.map);b.appConfig=this.appConfig;g={};for(var p in b)b.hasOwnProperty(p)&&(g[p]=b[p]);g.widgetManager=this;b=new c(g);b.clazz=c;k.after(b,"startup",f.hitch(this,this._postWidgetStartup,b));k.before(b,"destroy",
f.hitch(this,this._onDestroyWidget,b));a(b.domNode,"click",f.hitch(this,this._onClickWidget,b));this.loaded.push(b);return b},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var a=l.map(this.loaded,function(a){return a.id});l.forEach(a,function(a){this.destroyWidget(a)},this);this.loaded=[]},loadWidgetSettingPage:function(a){var b=new d;a=f.clone(a);a.id+="_setting";p([this.loadWidgetSettingClass(a)]).then(f.hitch(this,function(e){var c=e[0];this.loadWidgetSettingPageResources(a).then(f.hitch(this,
function(e){var g;e={nls:e.i18n,templateString:e.template,appConfig:this.appConfig,"class":"jimu-widget-setting"};"HTML3D"===window.appInfo.appType?e.sceneView=this.sceneView:e.map=this.map;for(var p in a)a.hasOwnProperty(p)&&(e[p]=a[p]);try{g=new c(e),h.setAttr(g.domNode,"data-widget-name-setting",e.name),k.before(g,"destroy",f.hitch(this,this._onDestroyWidgetSetting,g)),b.resolve(g)}catch(E){new u({message:window.jimuNls.widgetManager.createWidgetSettingPageError+":"+a.uri}),b.reject(E)}}),function(a){console.log(a)})}),
function(a){b.reject(a)});return b},loadWidgetSettingClass:function(a){var b=new d,c;c=a.isRemote?a.folderUrl+"setting/Setting.js":a.amdFolder+"setting/Setting";require(e.getRequireConfig(),[c],f.hitch(this,function(a){b.resolve(a)}));e.checkError(a.folderUrl+"setting/Setting.js",b);return b},loadWidgetSettingPageResources:function(a){var b=new d,e,c,g=[];a=f.clone(a);e=this._tryLoadResource(a,"settingI18n");c=this._tryLoadResource(a,"settingTemplate");a=this._tryLoadResource(a,"settingStyle");g.push(e);
g.push(c);g.push(a);p(g).then(f.hitch(this,function(a){var e={};e.i18n=a[0]||{};e.template=a[1];e.style=a[2];b.resolve(e)}),function(a){console.log(a)});return b},getWidgetById:function(a){var b;l.some(this.loaded,function(e){if(e.id===a)return b=e,!0},this);return b},getWidgetByLabel:function(a){var b;l.some(this.loaded,function(e){if(e.label===a)return b=e,!0},this);return b},getWidgetsByName:function(a){var b=[];l.some(this.loaded,function(e){e.name===a&&b.push(e)},this);return b},changeWindowStateTo:function(a,
b){"normal"===b?this.normalizeWidget(a):"minimized"===b?this.minimizeWidget(a):"maximized"===b?this.maximizeWidget(a):console.log("error state: "+b)},closeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if("closed"!==a.state){this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);h.setStyle(a.domNode,"display","none");a.setState("closed");try{a.onClose()}catch(y){console.log(console.error("fail to close widget "+a.name+
". "+y.stack))}}},openWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if(!a.started)try{a.started=!0,a.startup()}catch(y){console.error("fail to startup widget "+a.name+". "+y.stack)}if("closed"===a.state){h.setStyle(a.domNode,"display","");a.setState("opened");try{a.onOpen()}catch(y){console.error("fail to open widget "+a.name+". "+y.stack)}}},activateWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"opened"===a.state&&this._activeWidget(a)},
maximizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("maximized");try{a.onMaximize()}catch(y){console.log(console.error("fail to maximize widget "+a.name+". "+y.stack))}},minimizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("minimized");try{a.onMinimize()}catch(y){console.log(console.error("fail to minimize widget "+a.name+
". "+y.stack))}},normalizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("normal");try{a.onNormalize()}catch(y){console.log(console.error("fail to normalize widget "+a.name+". "+y.stack))}},destroyWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this._removeWidget(a);try{a.destroy()}catch(y){console.log(console.error("fail to destroy widget "+a.name+". "+y.stack))}},tryLoadWidgetConfig:function(a){return this._tryLoadWidgetConfig(a).then(f.hitch(this,
function(b){return this._upgradeWidgetConfig(a,b).then(function(b){return a.config=b})}))},triggerWidgetOpen:function(a){function b(a){var b=k.after(a,"onOpen",function(){b.remove();e.resolve(a)})}var e=new d,c=this.getWidgetById(a);if(c){if("closed"!==c.state)return e.resolve(c),e;b(c)}else var g=m.subscribe("widgetCreated",f.hitch(this,function(b){b.id===a&&(g.remove(),e.resolve(b))}));m.publish("openWidget",a);return e},_tryLoadWidgetConfig:function(a){var b=new d;if(a.config&&f.isObject(a.config))return b.resolve(a.config),
b;if(a.config){if(require.cache["url:"+a.config])return b.resolve(c.parse(require.cache["url:"+a.config])),b;b=e.processUrlInAppConfig(a.config);b=b.split("/");b[b.length-1]=encodeURIComponent(b[b.length-1]);b=b.join("/");return g(b,{handleAs:"json",headers:{"X-Requested-With":null}})}return this._tryLoadResource(a,"config").then(function(b){a.isDefaultConfig=!0;return b})},_upgradeWidgetConfig:function(a,b){var c=new d,g=a.manifest.version,p=a.version,k;if(g===p)return c.resolve(b),c;if(!1===a.hasVersionManager)return a.version=
g,c.resolve(b),c;require(e.getRequireConfig(),[a.amdFolder+"VersionManager"],f.hitch(this,function(e){e=new e;var u=e.getVersionIndex(p),t=e.getVersionIndex(g);if(u>t)c.reject("Bad widget version number, "+a.name+","+p);else try{k=e.upgrade(b,p,g),a.version=g,c.resolve(k)}catch(G){console.log("Read widget ["+a.name+"] old config error,"+G.stack),c.resolve(b)}}));return c},loadWidgetStyle:function(a){var b="widget/style/"+a.uri,c=new d,b=this._replaceId(b);return h.byId(b)?(c.resolve("load"),c):e.loadStyleLink(b,
a.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(a){var b="widget/style/"+a.uri+"/setting",c=new d,b=this._replaceId(b);return h.byId(b)?(c.resolve("load"),c):e.loadStyleLink(b,a.settingStyleFile)},loadWidgetConfig:function(a){a=require(e.getRequireConfig()).toUrl(a.configFile);if(require.cache["url:"+a]){var b=new d;b.resolve(c.parse(require.cache["url:"+a]));return b}return g(a,{handleAs:"json",headers:{"X-Requested-With":null}})},loadWidgetI18n:function(a){var b=
new d;require(e.getRequireConfig(),["dojo/i18n!"+a.i18nFile],function(a){b.resolve(a)});return b},loadWidgetSettingI18n:function(a){var b=new d;require(e.getRequireConfig(),["dojo/i18n!"+a.settingI18nFile],function(a){b.resolve(a)});return b},loadWidgetTemplate:function(a){var b=new d;require(e.getRequireConfig(),["dojo/text!"+a.templateFile],function(a){b.resolve(a)});e.checkError(a.templateFile,b);return b},loadWidgetSettingTemplate:function(a){var b=new d;require(e.getRequireConfig(),["dojo/text!"+
a.settingTemplateFile],function(a){b.resolve(a)});e.checkError(a.settingTemplateFile,b);return b},removeWidgetStyle:function(a){h.destroy(this._replaceId("widget/style/"+a.uri))},removeWidgetSettingStyle:function(a){h.destroy(this._replaceId("widget/style/"+a.uri+"/setting"))},getControllerWidgets:function(){return l.filter(this.loaded,function(a){return a.isController})},getOffPanelWidgets:function(){return l.filter(this.loaded,function(a){return!a.inPanel})},getOnScreenOffPanelWidgets:function(){return l.filter(this.loaded,
function(a){return a.isOnScreen&&!a.inPanel})},closeOtherWidgetsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a.gid&&this.loaded[b].id!==a.id&&this.closeWidget(this.loaded[b])},closeAllWidgetsInGroup:function(a){for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a&&this.closeWidget(this.loaded[b])},_mergeAgolConfig:function(a){var b=this.appConfig._appData.values,c="widgets["+a.id+"]",g;for(g in b){var p=
g.replace(/\//g,"_").indexOf(c+"_config");0<=p&&e.template.setConfigValue(a,g.replace(/\//g,"_").substr(p,g.length).replace(c,"widget"),b[g])}},_onUserSignIn:function(a){l.forEach(this.loaded,function(b){b.onSignIn(a)},this)},_onUserSignOut:function(){l.forEach(this.loaded,function(a){a.onSignOut()},this)},_activeWidget:function(a){if(this.activeWidget){if(this.activeWidget.id===a.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&h.setStyle(this.activeWidget.domNode,"zIndex",
101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&h.setStyle(a.domNode,"zIndex","zIndex"in a.position?a.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=a;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&h.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),m.publish("widgetActived",a))},_onClickWidget:function(a,
b){var e=r(".jimu-widget",a.domNode);if(0<e.length)for(var c=0;c<e.length;c++)if(b.target===e[c]||h.isDescendant(b.target,e[c]))return;this._activeWidget(a)},_onMoveStart:function(a){l.forEach(this.loaded,function(b){b.domNode===a.node&&this._activeWidget(b)},this)},_onAppConfigLoaded:function(a){this.appConfig=a=f.clone(a);b.setPortalUrl(a.portalUrl)},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a},_onSceneViewLoaded:function(a){this.sceneView=a},_onSceneViewChanged:function(a){this.sceneView=
a},_onAppConfigChanged:function(a,b,e,c){var g=f.clone(a);this.appConfig=g;l.forEach(this.loaded,function(a){a&&(a.onAppConfigChanged(g,b,e,c),"widgetChange"===b&&this._onConfigChanged(e.id,e.config,c))},this)},_onConfigChanged:function(a,b){var e=this.getWidgetById(a);e&&(e.onConfigChanged(b),f.mixin(e.config,b))},_onActionTriggered:function(a){if("map"!==a.elementId&&"app"!==a.elementId){var b=this.getWidgetById(a.elementId);if(b)b.onAction(a.action,a.data);else this.missedActions.push({id:a.elementId,
action:{name:a.action,data:a.data}});l.forEach(this.getControllerWidgets(),function(b){if(b.widgetIsControlled(a.elementId))b.onAction(a.action,{widgetId:a.elementId,data:a.data})},this)}},_postWidgetStartup:function(a){a.started=!0;e.setVerticalCenter(a.domNode);k.after(a,"resize",f.hitch(this,e.setVerticalCenter,a.domNode));this.openWidget(a);var c=b.getPortalCredential(this.appConfig.portalUrl);if(c)a.onSignIn(c);else a.onSignOut();this._triggerMissedAction(a)},_triggerMissedAction:function(a){this.missedActions.forEach(function(b){if(b.id===
a.id)a.onAction(b.action.name,b.action.data)})},_remove:function(a){return l.some(this.loaded,function(b,e){if(b.id===a)return this.loaded.splice(e,1),!0},this)},_tryLoadResource:function(a,b){var e,c=new d;if("config"===b)e=a.amdFolder+"config.json",a.configFile=e,e="hasConfig";else if("style"===b)e=a.amdFolder+"css/style.css",a.styleFile=e,e="hasStyle";else if("i18n"===b)e=a.amdFolder+"nls/strings.js",a.i18nFile=a.isRemote?e:a.amdFolder+"nls/strings",e="hasLocale";else if("template"===b)e=a.amdFolder+
"Widget.html",a.templateFile=e,e="hasUIFile";else if("settingTemplate"===b)e=a.amdFolder+"setting/Setting.html",a.settingTemplateFile=e,e="hasSettingUIFile";else if("settingI18n"===b)e=a.amdFolder+"setting/nls/strings.js",a.settingI18nFile=a.isRemote?e:a.amdFolder+"setting/nls/strings",e="hasSettingLocale";else if("settingStyle"===b)e=a.amdFolder+"setting/css/style.css",a.settingStyleFile=e,e="hasSettingStyle";else return c;a[e]?function(){var e;if("config"===b)e=this.loadWidgetConfig(a);else if("style"===
b)e=this.loadWidgetStyle(a);else if("i18n"===b)e=this.loadWidgetI18n(a);else if("template"===b)e=this.loadWidgetTemplate(a);else if("settingTemplate"===b)e=this.loadWidgetSettingTemplate(a);else if("settingStyle"===b)e=this.loadWidgetSettingStyle(a);else if("settingI18n"===b)e=this.loadWidgetSettingI18n(a);else return c;e.then(function(a){c.resolve(a)},function(b){new u({message:window.jimuNls.widgetManager.loadWidgetResourceError+": "+a.uri});c.reject(b)})}.apply(this):c.resolve(null);return c},
_replaceId:function(a){return a.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(a){"closed"!==a.state&&this.closeWidget(a);this._removeWidget(a);this.emit("widget-destroyed",a.id);m.publish("widgetDestroyed",a.id);console.log("destroy widget ["+a.uri+"].")},_onDestroyWidgetSetting:function(a){this.removeWidgetSettingStyle(a)},_removeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget=null);
this._remove(a.id);0===this.getWidgetsByName(a.name).length&&this.removeWidgetStyle(a)}});v.getInstance=function(a){null===t&&(t=new v(a),window._widgetManager=t);return t};return v})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,
g,p,e,b,u){"function"!==typeof d.getAll&&(d.getAll=function(a){var b=[];(a=d(a))&&b.push(a);return b});p={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return u.isInConfigOrPreviewWindow()},isStringStartWith:function(a,b){return a.substr(0,b.length)===b},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=b.getStandardPortalUrl(a))&&(a+="/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},
isWebTierPortal:function(e){var p=new h,u=b.getStandardPortalUrl(e);e=u+"/sharing";var t=b.setHttpsProtocol(u+"/sharing/generateToken?f\x3djson"),d=b.setHttpsProtocol(e);a.get(t,{jsonp:"callback"}).then(n.hitch(this,function(a){a.token?(this.webTierPortalUrls.push(u),this.removeWabAuthCookie(),k.id.getCredential(d).then(n.hitch(this,function(e){e.token||(e.token=a.token);e=g.canUseXhr(e.server,!0);-1<e&&c.defaults.io.corsEnabledServers.splice(e,1);this._pushCorsEnabledServerInfo({host:b.getServerByUrl(u),
withCredentials:!0});p.resolve(!0)}),n.hitch(this,function(){p.resolve(!0)}))):p.resolve(!1)}),n.hitch(this,function(a){console.error(a);p.reject(a)}));return p},addAuthorizedCrossOriginDomains:function(a){if(a&&0<a.length)for(var b=0;b<a.length;b++)this.addWithCredentialDomain(a[b])},addWithCredentialDomain:function(a){if(a&&"string"===typeof a){var e=c.defaults.io.corsEnabledServers,p=b.getServerByUrl(a);(a=b.getServerWithProtocol(a))||(a="http://"+p);a=g.canUseXhr(a,!0);-1<a&&e.splice(a,1);this._pushCorsEnabledServerInfo({host:p,
withCredentials:!0})}},_pushCorsEnabledServerInfo:function(a){if(a){var b=c.defaults.io.corsEnabledServers,e="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof a&&"string"===typeof a.host){for(var g in a.host)a[g]="function"===typeof a.host[g]?function(){return a.host[g].apply(a.host,arguments)}:
a.host[g];a.length=a.host.length;f.forEach(e,function(b){"function"===typeof a.host[b]&&(a[b]=function(){return a.host[b].apply(a.host,arguments)})})}b.push(a)}},tryRegisterCredential:function(a){return this.isValidCredential(a)?f.some(k.id.credentials,n.hitch(this,function(b){return a.token===b.token}))?!1:(k.id.credentials.push(a),!0):!1},registerToken:function(a){var e=b.getSharingUrl(this.portalUrl);k.id.findCredential(e)&&f.some(k.id.credentials,n.hitch(this,function(a,b){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,
a))return k.id.credentials.splice(b,1),!0}));return this._getTokenInfo(a).then(function(a){a&&k.id.registerToken(a)})},_getTokenInfo:function(e){var c=b.getPortalSelfInfoUrl(this.portalUrl);return a.get(c+("?f\x3djson\x26token\x3d"+e),{jsonp:"callback"}).then(n.hitch(this,function(a){return a.user?{server:b.getSharingUrl(this.portalUrl),ssl:a.allSSL,token:e,userId:a.user.username}:null}),function(a){console.error(a);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(a){return a&&
"string"===typeof a&&n.trim(a)},signInPortal:function(a){var e=new h;if(this._isInvalidPortalUrl(a)){a=b.getStandardPortalUrl(a);var c=b.getSharingUrl(a),g=this.getPortalCredential(a);g?setTimeout(n.hitch(this,function(){e.resolve(g)}),0):e=k.id.getCredential(c)}else setTimeout(n.hitch(this,function(){e.reject("Invalid portalurl.")}),0);return e},_loadPortalSelfInfo:function(a){a=b.getPortalSelfInfoUrl(a);return r({url:a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"})},registerOAuthInfo:function(a,
b){if(!a||"string"!==typeof a||!b||"string"!==typeof b)return null;var c=k.id.findOAuthInfo(a);c||(c=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",c=new e({appId:b,expiration:20159,portalUrl:a,authNamespace:"/",popup:!0,popupCallbackUrl:c}),k.id.registerOAuthInfos([c]));c.appId=b;return c},signOutAll:function(){var a=b.getStandardPortalUrl(this.portalUrl),e=!!k.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():
this.removeWabAuthCookie();k.id.destroyCredentials();k.id._oAuthHash=null;e&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(n.trim(a||""))},isValidCredential:function(a){var b=!1;if(a){var b=a.token,e=a.server,c=a.scope,b=b&&"string"===typeof b&&n.trim(b),e=e&&"string"===typeof e&&n.trim(e),c="portal"===c||"server"===c,g=!0;a.expires&&(a=parseInt(a.expires,10),g=(new Date).getTime(),g=a>g);b=b&&e&&c&&g}return b},isValidPortalCredentialOfPortalUrl:function(a,
e){var c=!1;if(this.isValidCredential(e))var c="portal"===e.scope,g=b.isSameServer(a,e.server),c=c&&g;return c},getPortalCredential:function(a){var e=null;a=n.trim(a||"");if(!a)return null;a=b.getStandardPortalUrl(a);(e=this._filterPortalCredential(a,k.id.credentials))||this._tryConvertArcGIScomCrendentialToOrgCredential();return e},_tryConvertArcGIScomCrendentialToOrgCredential:function(){var a=this.portalUrl;if(a&&(a=b.getStandardPortalUrl(a),b.isOrgOnline(a)&&!this._filterPortalCredential(a,k.id.credentials))){var e=
this._filterPortalCredential("http://www.arcgis.com",k.id.credentials);e&&k.id.registerToken({token:e.token,scope:"portal",userId:e.userId,server:a+"/sharing/rest",expires:e.expires})}},saveAndRegisterCookieToCredential:function(a){a=n.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=!!a.isAdmin;this.saveWabCookie(a);var b=a.server+"/sharing/rest";a.server=b;k.id.registerToken(a);return k.id.findCredential(b,a.userId)},registerAuth2Hash:function(a){a=n.clone(a);var e=1E3*parseInt(a.expires_in,
10),e=(new Date).getTime()+e,c=b.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:c,token:a.access_token,expires:e,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");d("wab_auth",m.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");
window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,e){var c=null;a=b.getStandardPortalUrl(a);if(e&&0<e.length){var g=f.filter(e,n.hitch(this,function(b){return this.isValidPortalCredentialOfPortalUrl(a,b)}));0<g.length&&(c=g[g.length-1])}return c},_removePortalCredential:function(a){var e=n.trim(a||"");if(e){e=b.getStandardPortalUrl(e);for(a=f.filter(k.id.credentials,n.hitch(this,
function(a){return this.isValidPortalCredentialOfPortalUrl(e,a)}));0<a.length;)a[0].destroy(),a.splice(0,1);k.id.credentials=f.filter(k.id.credentials,n.hitch(this,function(a){return!this.isValidPortalCredentialOfPortalUrl(e,a)}))}},getUserIdByToken:function(a,e){var c=new h;if(a&&"string"===typeof a&&e&&"string"===typeof e){var g=b.getStandardPortalUrl(e),p=f.filter(k.id.credentials,n.hitch(this,function(e){var c=e.token===a&&e.userId;e=b.isSameServer(g,e.server);return c&&e}));if(0<p.length){var u=
p[0];setTimeout(n.hitch(this,function(){c.resolve(u.userId)}),0);return c}p=b.getCommunitySelfUrl(g);r({url:p,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(n.hitch(this,function(a){c.resolve(a&&a.username||"")}),n.hitch(this,function(a){console.error(a);c.reject("fail to get userId by token")}))}else setTimeout(n.hitch(this,function(){c.reject("invalid parameters")}),0);return c},xtGetCredentialFromCookie:function(a){var e=d("wab_auth"),c=null;if(e)try{c=m.parse(e)}catch(y){console.error(y)}if(!c||
"object"!==typeof c||!b.isSameServer(a,c.server)||window.location.host!==c.referer)return null;c.expires=parseInt(c.expires,10);e=(new Date).getTime();if(!(c.expires>e))return this.removeCookie("wab_auth"),null;a+="/sharing/rest";c.server=a;(e=k.id.findCredential(a))||k.id.registerToken(c);return e=k.id.findCredential(a)},removeCookie:function(a){var b=this.getCookiePath();u.removeCookie(a,b)},_getDomainsByServerName:function(a){var b=a.split("."),e=b.length;return f.map(b,n.hitch(this,function(a,
c){var g=b.slice(c,e),p="",k=g.length-1;f.forEach(g,n.hitch(this,function(a,b){p+=a;b!==k&&(p+=".")}));return p}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{q.publish("userSignIn",a)}catch(v){console.error(v)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{q.publish("anyUserSignIn",a)}catch(v){console.error(v)}},_publishCurrentPortalUserSignOut:function(a){try{q.publish("userSignOut",a)}catch(v){console.error(v)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,
a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(v){console.error(v)}},_bindEvents:function(){l.after(k.id,"signIn",n.hitch(this,function(a,b){console.log(b[1]);l.after(a,"callback",n.hitch(this,function(a,b){this._signInSuccess(b[0],!1)}));return a}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var b=a.esri&&a.esri.id;b&&(k.id=b,b=window.esriConfig.defaults.io,a=a.esriConfig.defaults.io,
b.corsEnabledServers=a.corsEnabledServers,b.webTierAuthServers=a.webTierAuthServers,b._processedCorsServers=a._processedCorsServers,b.corsStatus=a.corsStatus)}}this._bindEvents();this._started=!0}}};p.startup();return p})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),function(n,f,l,h,d,m){return n(m,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,
maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=l.create("div",{"class":"title"},this.domNode),this.titleLabeNode=l.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=l.create("div",{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(d(this.closeBtnNode,"click",f.hitch(this,this.close))))},_preProcessing:function(){0===
this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:h.ENTER,onClick:f.hitch(this,this.close)})},_increaseZIndex:function(){l.setStyle(this.domNode,"zIndex",501);l.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g){var p=0;return n(r,
{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();this._positioning();h.place(this.domNode,this.container);
setTimeout(f.hitch(this,function(){this._moveToMiddle()}),50);this.own(m(window,"resize",f.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):this._positioning()})));this.overlayNode=h.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();d.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===typeof this.height&&(this._fixedHeight=!0,this.autoHeight=
!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=h.create("div",{"class":"title"},this.domNode);this.titleLabeNode=h.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=h.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var e=null,e="ontouchstart"in document?a.press:"click";this.own(m(this.closeBtnNode,e,f.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();
this.contentContainerNode=h.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&h.place(this.content,this.contentContainerNode));this.buttonContainer=h.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&h.setStyle(this.buttonContainer,"display","none");for(var a=
this.buttons.length-1;-1<a;a--)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=this.enabledButtons.length;if(0!==a){var b=h.getContentBox(this.buttonContainer),c=h.getMarginExtents(this.enabledButtons[0]),g=h.getPadBorderExtents(this.enabledButtons[0]),p=0,g=8===q("ie")?g.l+g.r:0,p=(b.w-(c.l+c.r+g)*a)/a;0<p&&(l.forEach(this.enabledButtons,f.hitch(this,function(a){h.setStyle(a,"maxWidth",p+"px")})),l.forEach(this.disabledButtons,
f.hitch(this,function(a){h.setStyle(a,"maxWidth",p+"px")})))}},_moveableNode:function(a,b){this.moveable&&(this.moveable.destroy(),this.moveable=null);var e=h.getMarginBox(this.container);e.l=e.l-a+b;e.w+=2*(a-b);this.moveable=new c.boxConstrainedMoveable(this.domNode,{box:e,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(m(this.moveable,"Moving",f.hitch(this,this.onMoving)));this.own(m(this.moveable,"MoveStop",f.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===
k("#header").length?{t:0,l:0,w:0,h:0}:h.getMarginBox("header")},_getFooterBox:function(){return 0===k(".footer",this.container).length?{t:0,l:0,w:0,h:0}:h.getMarginBox(k(".footer",this.container)[0])},_calculatePosition:function(){var a=h.getContentBox(this.container),b=this._getHeaderBox(),c=this._getFooterBox(),c=a.h-b.h-c.h-40,g=0;g=this._fixedHeight?this.height:this.autoHeight?c-200:this.height=c>this.maxHeight?this.maxHeight:c;c=(c-g)/2+b.h+20;c=c<b.h?b.h:c;this.width=this.width||this.maxWidth;
h.setStyle(this.domNode,{left:(a.w-this.width)/2+"px",top:c+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(h.setStyle(this.domNode,"height","auto"),h.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&h.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(h.setStyle(this.domNode,"height",this.height+"px"),h.addClass(this.contentContainerNode,"content-absolute"),h.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&
h.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var a=h.getMarginBox(this.domNode),b=h.getContentBox(this.container),c=this._getHeaderBox(),g=this._getFooterBox(),g=b.h-c.h-g.h-40,p=0,p=a.h||g-200,a=(g-p)/2+c.h+20,a=a<c.h?c.h:a;h.setStyle(this.domNode,{left:(b.w-this.width)/2+"px",top:a+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();this._calculateHeight()},_increaseZIndex:function(){h.setStyle(this.domNode,
"zIndex",p+200+1);h.setStyle(this.overlayNode,"zIndex",p+200);p++},setTitleLabel:function(a){this.titleNode.innerHTML=g.stripHTML(a)},onMoving:function(a){h.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){h.setStyle(a.node,"opacity",1)},close:function(){if(!this.onClose||!1!==this.onClose()){var a=this.domNode.parentNode,b=f.clone(this.domNode);h.setStyle(this.domNode,"display","none");h.destroy(this.overlayNode);this.destroy();this.moveable.destroy();h.place(b,a);d.animateProperty({node:b,
properties:{opacity:0},duration:200,onEnd:function(){h.destroy(b)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(a){var b=" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(b+=a.classNames.join(" "));var e=h.create("div",{"class":"jimu-btn jimu-popup-action-btn jimu-float-trailing jimu-trailing-margin1 "+b,innerHTML:a.label,title:a.title||a.label},this.buttonContainer);this.enabledButtons.unshift(e);b=h.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+
b,title:a.title||a.label,innerHTML:a.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(b);this.own(m(e,"click",f.hitch(this,function(b){if(a.onClick)a.onClick(b);else this.close()})))},setButtonProps:function(a,b){"number"===typeof a&&isFinite(a)||(b=a,a=0);if(b&&0!==this.enabledButtons.length)for(var e in b)"title"===e?(h.setAttr(this.enabledButtons[a],"title",b[e]),h.setAttr(this.disabledButtons[a],"title",b[e])):"label"===e&&(h.setProp(this.enabledButtons[a],"innerHTML",
b[e]),h.setProp(this.disabledButtons[a],"innerHTML",b[e]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.enabledButtons.length?(h.setStyle(this.enabledButtons[a],"display","inline-block"),h.setStyle(this.disabledButtons[a],"display","none")):(l.forEach(this.enabledButtons[a],f.hitch(this,function(a){h.setStyle(a,"display","inline-block")})),l.forEach(this.disabledButtons[a],f.hitch(this,function(a){h.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a&&
isFinite(a)&&a<this.disabledButtons.length?(h.setStyle(this.disabledButtons[a],"display","inline-block"),h.setStyle(this.enabledButtons[a],"display","none")):(l.forEach(this.disabledButtons,f.hitch(this,function(a){h.setStyle(a,"display","inline-block")})),l.forEach(this.enabledButtons,f.hitch(this,function(a){h.setStyle(a,"display","none")})))},showButton:function(a){this.enableButton(a)},hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(h.setStyle(this.disabledButtons[a],
"display","none"),h.setStyle(this.enabledButtons[a],"display","none")):(l.forEach(this.disabledButtons,f.hitch(this,function(a){h.setStyle(a,"display","none")})),l.forEach(this.enabledButtons,f.hitch(this,function(a){h.setStyle(a,"display","none")})))}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(n,f,l,h,d,m){h=n("dojo.dnd.move.constrainedMoveable",m,{constraints:function(){},within:!1,constructor:function(d,
a){a||(a={});this.constraints=a.constraints;this.within=a.within},onFirstMove:function(d){var a=this.constraintBox=this.constraints.call(this,d);a.r=a.l+a.w;a.b=a.t+a.h;this.within&&(d=f.getMarginSize(d.node),a.r-=d.w,a.b-=d.h)},onMove:function(d,a){var k=this.constraintBox,c=d.node.style;this.onMoving(d,a);a.l=a.l<k.l?k.l:k.r<a.l?k.r:a.l;a.t=a.t<k.t?k.t:k.b<a.t?k.b:a.t;c.left=a.l+"px";c.top=a.t+"px";this.onMoved(d,a)}});d=n("dojo.dnd.move.boxConstrainedMoveable",h,{box:{},constructor:function(d,
a){var k=a&&a.box;this.constraints=function(){return k}}});n=n("dojo.dnd.move.parentConstrainedMoveable",h,{area:"content",constructor:function(d,a){var k=a&&a.area;this.constraints=function(){var a=this.node.parentNode,d=l.getComputedStyle(a),g=f.getMarginBox(a,d);if("margin"==k)return g;var p=f.getMarginExtents(a,d);g.l+=p.l;g.t+=p.t;g.w-=p.w;g.h-=p.h;if("border"==k)return g;p=f.getBorderExtents(a,d);g.l+=p.l;g.t+=p.t;g.w-=p.w;g.h-=p.h;if("padding"==k)return g;p=f.getPadExtents(a,d);g.l+=p.l;g.t+=
p.t;g.w-=p.w;g.h-=p.h;return g}}});return{constrainedMoveable:h,boxConstrainedMoveable:d,parentConstrainedMoveable:n}})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager","./utils"],function(n,f){function l(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(h){return h},compatible:!0},{version:"1.1",description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(h){h.widgetOnScreen&&
h.widgetOnScreen.panel&&("themes/FoldableTheme/panels/TitlePanel/Panel"===h.widgetOnScreen.panel.uri||"jimu/BaseWidgetPanel"===h.widgetOnScreen.panel.uri)&&(h.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel");return h},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",upgrader:function(h){var d=0;if(h.widgetOnScreen&&h.widgetOnScreen.widgets){for(var m=!1,d=0;d<h.widgetOnScreen.widgets.length;d++)"widgets/Splash/Widget"===h.widgetOnScreen.widgets[d].uri&&(m=!0);
m||h.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});m=!1;for(d=0;d<h.widgetOnScreen.widgets.length;d++)"widgets/TimeSlider/Widget"===h.widgetOnScreen.widgets[d].uri&&(m=!0);m||h.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",visible:!1,position:{bottom:55,left:7},version:"1.2"});m=!1;for(d=0;d<h.widgetOnScreen.widgets.length;d++)"widgets/Swipe/Widget"===h.widgetOnScreen.widgets[d].uri&&(m=!0);m||h.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",
visible:!1,position:{top:145,left:7},version:"1.2"})}return h},compatible:!0},{version:"1.3",description:"The version embedded in online3.8 \x26 online3.9.",upgrader:function(h){(function(d){f.visitElement(d,function(d){d.positionRelativeTo&&(d.position?d.position.relativeTo=d.positionRelativeTo:d.position={relativeTo:d.positionRelativeTo},d.panel&&(d.panel.position?d.panel.position.relativeTo=d.panel.positionRelativeTo:d.panel.position={relativeTo:d.panel.positionRelativeTo}))});var m=d.widgetOnScreen;
m&&m.panel&&m.panel.positionRelativeTo&&(m.panel.position?m.panel.position.relativeTo=m.panel.positionRelativeTo:m.panel.position={relativeTo:m.panel.positionRelativeTo});(m=d.widgetPool)&&m.panel&&m.panel.positionRelativeTo&&(m.panel.position?m.panel.position.relativeTo=m.panel.positionRelativeTo:m.panel.position={relativeTo:m.panel.positionRelativeTo})})(h);h.widgetOnScreen&&h.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===h.widgetOnScreen.panel.uri&&(h.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");
(function(d){if(d.widgetOnScreen&&d.widgetOnScreen.widgets&&d.theme&&"FoldableTheme"===d.theme.name){var m=null,h=null;if(m=d.widgetOnScreen.widgets[4])void 0!==m.position.top?(m={position:{left:205,top:45}},h={position:{left:255,top:45}}):(m={position:{left:205,bottom:55}},h={position:{left:255,bottom:55}}),d.widgetOnScreen.widgets.splice(7,0,m,h)}})(h);(function(){for(var d=0,m=0,f=!1,d=0;d<h.widgetOnScreen.widgets.length;d++)if("widgets/Geocoder/Widget"===h.widgetOnScreen.widgets[d].uri){f=!0;
break}for(var a=!1,m=0;m<h.widgetOnScreen.widgets.length;m++)if("widgets/Search/Widget"===h.widgetOnScreen.widgets[m].uri){a=!0;break}!a&&f&&(d=h.widgetOnScreen.widgets[d],d.uri="widgets/Search/Widget",d.name="Search")})(h);(function(d){for(var m=0,m=d.widgetOnScreen.widgets.length-1;0<=m;m--){var h=d.widgetOnScreen.widgets[m];if("widgets/Swipe/Widget"===h.uri&&!h.closeable&&(d.widgetOnScreen.widgets.splice(m,1),!1!==h.visible)){h.closeable=!0;var a;a:{for(a=a=0;a<d.widgetOnScreen.widgets.length;a++)if(!d.widgetOnScreen.widgets[a].uri)break a;
a=-1}0<=a&&(h.position=d.widgetOnScreen.widgets[a].position,d.widgetOnScreen.widgets[a]=h)}"widgets/TimeSlider/Widget"===h.uri&&(!1===h.visible?d.widgetOnScreen.widgets.splice(m,1):h.closeable=!0)}})(h);h.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",position:{top:5,left:7},version:"1.3"});h.loadingPage||(h.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return h},
compatible:!0},{version:"1.4",description:"The version embedded in online3.10.",upgrader:function(h){if(h.theme){var d=h.theme.name;if(("FoldableTheme"===d||"JewelryBoxTheme"===d)&&h.widgetOnScreen){var m=h.widgetOnScreen.widgets;if(m&&0<m.length)for(var d="themes/"+d+"/widgets/HeaderController/Widget",f=null,a=0;a<m.length;a++)(f=m[a])&&f.uri===d&&f.position&&310===f.position.paddingRight&&(f.position.paddingRight=275)}}return h},compatible:!0},{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",
upgrader:function(h){h.keepAppState=!0;return h},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(h){return h},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(h){return h},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(h){return h},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",upgrader:function(h){return h},compatible:!0},{version:"2.3",
description:"The version for Online 4.4.",upgrader:function(h){function d(a,k){if(!a||!k)return!1;for(var c in k)if(k.hasOwnProperty(c))if("object"===typeof k[c]){if(!d(a[c],k[c]))return!1}else if(a[c]!==k[c])return!1;return!0}function m(a){function k(){var c=d(a[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),p=d(a[12],{position:{top:10,right:195}});return c&&p}function c(){var c=d(a[3],{uri:"widgets/MyLocation/Widget",position:{left:15,bottom:45}}),p=d(a[12],{position:{left:15,
top:233}});return c&&p}function r(){var c=d(a[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),p=d(a[12],{position:{right:15,top:195}});return c&&p}(function(){var c=d(a[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),p=d(a[12],{position:{left:240,top:53}});return c&&p})()?a.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):k()?a.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):
c()?a.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,bottom:195},version:"2.3"}):r()&&a.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"})}function f(a){function k(){var c=d(a[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),g=d(a[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),p=d(a[4],{position:{left:7,bottom:70}});return c&&g&&p}function c(){var c=d(a[9],{uri:"widgets/MyLocation/Widget",position:{left:7,
top:110}}),g=d(a[2],{uri:"widgets/Search/Widget",position:{right:2,top:2,relativeTo:"browser"}}),p=d(a[4],{position:{left:7,bottom:70}});return c&&g&&p}(function(){var c=d(a[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),g=d(a[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),p=d(a[4],{position:{left:55,top:45}});return c&&g&&p}()||k()||c())&&a.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:148,left:7},version:"2.3"})}(function(a,k,c){a=a.theme&&a.theme.name;
if("FoldableTheme"===a)if(d(k[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}))k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:150,left:7},version:"2.3"});else if(d(k[11],{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}}))k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:203},version:"2.3"}),c&&c.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:12,top:211},version:"2.3"});else{if(d(k[11],{uri:"widgets/MyLocation/Widget",
position:{left:164,bottom:14}})){k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:203,bottom:14,height:30},version:"2.3"});for(a=0;a<k.length;a++){var r=k[a];d(r,{uri:"widgets/Scalebar/Widget",position:{left:220,bottom:5}})&&(r.position.left=288);d(r,{uri:"widgets/Coordinate/Widget",position:{left:395,bottom:5}})&&(r.position.left=463)}c&&c.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:209,left:12},version:"2.3"})}}else if("BillboardTheme"===a)m(k);else if("BoxTheme"===
a)k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:10,top:131},version:"2.3"});else if("JewelryBoxTheme"===a)f(k);else if("LaunchpadTheme"===a){if(d(k[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}})||d(k[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}}))k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:255,left:25},version:"2.3"}),c&&c.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:10,bottom:238},version:"2.3"})}else"PlateauTheme"===
a?(d(k[6],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:2.3}),d(k[6],{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}})&&k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:201},version:2.3})):"TabTheme"===a&&d(k[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},
version:"2.3"})})(h,h.widgetOnScreen.widgets,h.mobileLayout&&h.mobileLayout.widgetOnScreen&&h.mobileLayout.widgetOnScreen.widgets);return h},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",upgrader:function(h){return h},compatible:!0}];this.isCompatible=function(h,d){for(var m=this.getVersionIndex(h),f=this.getVersionIndex(d),m=m+1;m<=f;m++)if(!1===this.versions[m].compatible)return!1;return!0}}l.prototype=new n;return l.prototype.constructor=l})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=
[];this.upgrade=function(n,f,l){f=this.getVersionIndex(f);l=this.getVersionIndex(l);if(f>l)throw Error("New version should higher than old version.");for(f+=1;f<=l;f++)this.versions[f].upgrader&&(n=this.versions[f].upgrader(n));return n};this.getVersionIndex=function(n){n=this.fixVersion(n);var f,l;for(l=0;l<this.versions.length;l++)this.versions[l].version===n&&(f=l);null===n&&(f=-1);void 0===f&&(f=this.versions.length-1);return f};this.fixVersion=function(n){return n?n:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./portalUrlUtils ./AppStateManager esri/IdentityManager esri/config esri/urlUtils esri/arcgis/utils".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y){var z=null,x;x=n(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a,b){this._removeHash(a);this.urlParams=a||{};this.widgetManager=r.getInstance();f.mixin(this,b)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(f.hitch(this,function(a){var g=this.checkConfig(a);if(g)throw Error(g);this.rawAppConfig=f.clone(a);u.getInstance().setRawAppConfig(this.rawAppConfig);
a=this._upgradeAppConfig(a);this._processAfterTryLoad(a);this.appConfig=a;if(this.urlParams.id)return this.loadWidgetsManifest(a).then(f.hitch(this,function(){return this.loadAndUpgradeAllWidgetsConfig(a)})).then(f.hitch(this,function(){this._configLoaded=!0;this._setDocumentTitle(a);return this.getAppConfig()}));p.setPortalUrl(a.portalUrl);y.arcgisUrl=b.getBaseItemUrl(a.portalUrl);return this._proesssWebTierAndSignin(a).then(f.hitch(this,function(){return this.urlParams.appid?window.appInfo.isRunInPortal?
this._getAppConfigFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(f.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})):this._processNotInPortalAppProtocol(a).then(f.hitch(this,function(a){return this._getAppDataAddTemplateDataFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(f.hitch(this,function(b){b.appData.appConfig&&(a=b.appData.appConfig);a._appData=b.appData;a.templateConfig=b.templateData;a.isTemplateApp=!0;return a}))})):
this._processNotInPortalAppProtocol(a)})).then(f.hitch(this,function(a){this._processAfterTryLoad(a);this.appConfig=a;return a.map.itemId?a:(a.map["3D"]?e.getDefaultWebScene(a.portalUrl):e.getDefaultWebMap(a.portalUrl)).then(function(b){a.map.itemId=b;return a})})).then(f.hitch(this,function(a){return this.loadWidgetsManifest(a)})).then(f.hitch(this,function(a){return a._appData?a._appData.values&&a._appData.values.webmap?e.getPortal(a.portalUrl).getItemById(a._appData.values.webmap).then(f.hitch(this,
function(b){return c.template.mergeTemplateAppConfigToAppConfig(a,a._appData,b)})):c.template.mergeTemplateAppConfigToAppConfig(a,a._appData):a})).then(f.hitch(this,function(a){return this.loadAndUpgradeAllWidgetsConfig(a)})).then(f.hitch(this,function(a){this._configLoaded=!0;this._setDocumentTitle(a);return this.getAppConfig()}))}),f.hitch(this,function(a){this.showError(a);var b=new q;b.reject(a);return b}))},_setDocumentTitle:function(a){!window.isBuilder&&a&&a.title&&(document.title=c.stripHTML(a.title))},
getAppConfig:function(){var a=f.clone(this.appConfig);a.getConfigElementById=function(a){return c.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return c.getConfigElementsByName(this,a)};a.visitElement=function(a){c.visitElement(this,a)};this._addAuthorizedCrossOriginDomains(this.portalSelf,a);return a},_addAuthorizedCrossOriginDomains:function(a,b){a&&a.authorizedCrossOriginDomains&&p.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains);b&&b.authorizedCrossOriginDomains&&
p.addAuthorizedCrossOriginDomains(b.authorizedCrossOriginDomains)},checkConfig:function(a){return(a=this._getRepeatedId(a))?"repeated id:"+a:null},processProxy:function(a){v.defaults.io.alwaysUseProxy=a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.alwaysUseProxy;v.defaults.io.proxyUrl="";v.defaults.io.proxyRules=[];a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.url&&(v.defaults.io.proxyUrl=a.httpProxy.url);a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.rules&&l.forEach(a.httpProxy.rules,function(a){w.addProxyRule(a)})},
addNeedValues:function(a){this._processNoUriWidgets(a);this._addElementId(a)},showError:function(a){a&&a.message&&h.create("div",{"class":"app-error",innerHTML:a.message},document.body)},_tryLoadConfig:function(){"stemapp"===this.urlParams.id&&(this.urlParams.config=window.appInfo.appPath+"config.json",delete this.urlParams.id);if(this.urlParams.config)return this.configFile=this.urlParams.config,k(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(a){p.setPortalUrl(a.portalUrl);
a.portalUrl&&(window.portalUrl=a.portalUrl);return this.urlParams.token?p.registerToken(this.urlParams.token).then(function(){return a}):a}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var a=b.getPortalUrlFromLocation(),c=new q;p.setPortalUrl(a);window.portalUrl=a;y.arcgisUrl=b.getBaseItemUrl(a);var g;this.urlParams.token?g=p.registerToken(this.urlParams.token):(g=new q,g.resolve());g.then(f.hitch(this,function(){e.getPortal(a).loadSelfInfo().then(f.hitch(this,function(e){this.portalSelf=
e;e.allSSL&&"http:"===window.location.protocol?(console.log("redirect from http to https"),window.location.href=b.setHttpsProtocol(window.location.href),c.reject()):this._processSignIn(a).then(f.hitch(this,function(){this._getAppConfigFromAppId(a,this.urlParams.id).then(f.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})).then(function(a){c.resolve(a)},function(a){c.reject(a)})}))}))}),f.hitch(this,function(a){this.showError(a)}));return c}this.configFile=
"config.json";return k(this.configFile,{handleAs:"json"}).then(f.hitch(this,function(a){p.setPortalUrl(a.portalUrl);a.portalUrl&&(window.portalUrl=a.portalUrl);return this.urlParams.token?p.registerToken(this.urlParams.token).then(function(){return a}):a}))},_upgradeAppConfig:function(a){var b=window.wabVersion,e=a.wabVersion;a.configWabVersion=a.wabVersion;if(b===e)return a;var c=this.versionManager.getVersionIndex(e),g=this.versionManager.getVersionIndex(b);if(c>g)throw Error("Bad version number, "+
e);a=this.versionManager.upgrade(a,e,b);a.wabVersion=b;return a},loadAndUpgradeAllWidgetsConfig:function(b){var e=new q,c=[];g.visitElement(b,f.hitch(this,function(a){a.uri&&(a=this.widgetManager.tryLoadWidgetConfig(a),c.push(a))}));a(c).then(f.hitch(this,function(){e.resolve(b)}),function(a){e.reject(a)});return e},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);t.tokenValidity=10080;
return a},_tryUpdateAppConfigByLocationUrl:function(a){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var e=b.getPortalUrlFromLocation(),e=b.getStandardPortalUrl(e);b.isOnline(e)&&(e=b.updateUrlProtocolByOtherUrl(e,a.portalUrl),a.map.portalUrl&&b.isSamePortalUrl(a.portalUrl,a.map.portalUrl)&&(a.map.portalUrl=e),a.portalUrl=e,a.httpProxy&&a.httpProxy.url&&(a.httpProxy.url=b.getPortalProxyUrl(e)))}},_processWidgetJsons:function(a){g.visitElement(a,
function(a,b){b.isWidget&&a.uri&&c.widgetJson.processWidgetJson(a)})},_processNoUriWidgets:function(a){var b=0;g.visitElement(a,function(a,e){e.isWidget&&!a.uri&&(b++,a.placeholderIndex=b)})},_addElementId:function(a){var b=0,e;g.visitElement(a,function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var c=a.id.lastIndexOf("_");-1<c&&(e=a.id.substr(c+1),b=Math.max(b,e))}});g.visitElement(a,function(a){a.id||(b++,a.id=a.uri?a.uri.replace(/\//g,"_")+"_"+b:"_"+b)})},_setPortalUrl:function(a){if(a.portalUrl){var e=
b.getPortalUrlFromLocation(),c=b.isOnline(e);b.isSamePortalUrl(a.portalUrl,e)||c||(window.appInfo.isRunInPortal=!1)}else window.isXT&&m("wab_portalurl")?a.portalUrl=m("wab_portalurl"):(window.appInfo.isRunInPortal=!0,a.portalUrl=b.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(a,e){a.portalUrl=b.setProtocol(a.portalUrl,e);a.map.portalUrl&&(a.map.portalUrl=b.setProtocol(a.map.portalUrl,e));a.httpProxy&&(a.httpProxy.url=b.setProtocol(a.httpProxy.url,e),a.httpProxy&&a.httpProxy.rules&&
l.forEach(a.httpProxy.rules,f.hitch(this,function(a){a.proxyUrl=b.setProtocol(a.proxyUrl,e)})))},_processInPortalAppProtocol:function(a){var c=new q,g=e.getPortal(a.portalUrl),p=f.hitch(this,function(e){if("https:"===window.location.protocol)this._changePortalUrlProtocol(a,"https");else{if(e){console.log("redirect from http to https");window.location.href=b.setHttpsProtocol(window.location.href);c.reject();return}this._changePortalUrlProtocol(a,"http")}this._checkLocale();c.resolve(a)});g.loadSelfInfo().then(f.hitch(this,
function(b){"private"===b.access?(b=0===a.portalUrl.toLowerCase().indexOf("https://"),p(b)):p(b.allSSL)}),f.hitch(this,function(a){c.reject(a)}));return c},_processNotInPortalAppProtocol:function(a){var c=new q;a.portalUrl?e.getPortal(a.portalUrl).loadSelfInfo().then(f.hitch(this,function(e){var g="https:"===window.location.protocol;(e.allSSL||g)&&this._changePortalUrlProtocol(a,"https");0!==a.portalUrl.toLowerCase().indexOf("https://")||g||p.isInConfigOrPreviewWindow()?c.resolve(a):(console.log("redirect from http to https"),
window.location.href=b.setHttpsProtocol(window.location.href),c.reject())}),f.hitch(this,function(a){c.reject(a)})):c.resolve(a);return c},_proesssWebTierAndSignin:function(a){var b=new q,c=!1,g=a.portalUrl;this._processWebTier(a).then(f.hitch(this,function(a){c=a;return e.getPortal(g).loadSelfInfo()})).then(f.hitch(this,function(a){this.portalSelf=a;return this._processSignIn(g,c)})).then(f.hitch(this,function(){b.resolve()}),function(a){b.reject(a)});return b},_processWebTier:function(a){var e=
new q,c=a.portalUrl;a.isWebTier?(p.addAuthorizedCrossOriginDomains([c]),p.isWebTierPortal(c).then(f.hitch(this,function(){var g=p.getPortalCredential(c);g&&g.ssl&&"http:"===window.location.protocol&&!p.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=b.setHttpsProtocol(window.location.href)):e.resolve(a.isWebTier)}),f.hitch(this,function(a){e.reject(a)}))):e.resolve(!1);return e},_processSignIn:function(a,c){var g=new q,k=e.getPortal(a),u=b.getSharingUrl(a);
window.appInfo.isRunInPortal?(u=t.checkSignInStatus(u),u.promise.always(f.hitch(this,function(){g.resolve()}))):(!p.isInBuilderWindow()&&!p.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&this.rawAppConfig&&this.rawAppConfig.appId&&!c&&p.registerOAuthInfo(a,this.rawAppConfig.appId),u=t.checkSignInStatus(u),u.promise.always(f.hitch(this,function(){p.xtGetCredentialFromCookie(a);k.loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=a;this._checkLocale();g.resolve()}))})));return g},
_checkLocale:function(){if(!p.isInConfigOrPreviewWindow()){var a=this.portalSelf.user&&this.portalSelf.user.culture||d.locale,a=a.toLowerCase();!this.urlParams.locale&&c.isLocaleChanged(d.locale,a)&&(m("wab_app_locale",a),window.location.reload())}},_getAppConfigFromTemplateAppId:function(b,c){var g=e.getPortal(b);return this._getWabAppIdAndDataFromTemplateAppId(b,c).then(f.hitch(this,function(e){var c=e.appData;return a([this._getAppConfigFromAppId(b,e.appId),g.getItemData(c.source)]).then(f.hitch(this,
function(a){var b;c.appConfig?(b=c.appConfig,delete c.appConfig):b=a[0];b=this._upgradeAppConfig(b);a=a[1];b._appData=c;b.templateConfig=a;b.isTemplateApp=!0;return b}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(a,b){var c=e.getPortal(a);return c.getItemData(b).then(function(a){return c.getItemData(a.source).then(function(b){return{appData:a,templateData:b}})})},_getWabAppIdAndDataFromTemplateAppId:function(a,b){var c=new q,g=e.getPortal(a);g.getItemData(b).then(f.hitch(this,function(a){g.getItemById(a.source).then(f.hitch(this,
function(b){b=w.urlToObject(b.url);c.resolve({appId:b.query.id,appData:a})}))}),function(a){c.reject(a)});return c},_getAppConfigFromAppId:function(a,b){return e.getPortal(a).getItemData(b)},_removeHash:function(a){for(var b in a)a[b]&&(a[b]=a[b].replace("#",""))},loadWidgetsManifest:function(b){function e(a,e){return a.loadWidgetManifest(e).then(function(a){return a},function(a){console.log("Widget failed to load, it is removed.",e.name);a.stack?console.error(a.stack):console.log(a);p(b,e)})}function p(a,
b){function e(e){a[e]&&a[e].widgets&&(a[e].widgets=a[e].widgets.filter(function(a){if(b)return a.id!==b.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}));a[e]&&a[e].groups&&a[e].groups.forEach(function(a){a.widgets&&(a.widgets=a.widgets.filter(function(a){if(b)return a.id!==b.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}))})}e("widgetOnScreen");e("widgetPool")}
var k=[],u=new q;b._buildInfo&&b._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(f.hitch(this,function(e){g.visitElement(b,f.hitch(this,function(a){!a.widgets&&a.uri&&(e[a.uri]?(this._addNeedValuesForManifest(e[a.uri],a.uri),c.widgetJson.addManifest2WidgetJson(a,e[a.uri])):k.push(this.widgetManager.loadWidgetManifest(a)))}));a(k).then(function(){u.resolve(b)})})):(g.visitElement(b,f.hitch(this,function(a){!a.widgets&&a.uri&&k.push(e(this.widgetManager,a))})),a(k).then(function(){u.resolve(b)}));
setTimeout(function(){u.isResolved()||(p(b),u.resolve(b))},6E4);return u},_addNeedValuesForManifest:function(a,b){f.mixin(a,c.getUriInfo(b));c.manifest.addManifestProperies(a);c.manifest.processManifestLabel(a,d.locale)},_loadMergedWidgetManifests:function(){return k(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(a){var b=[],e;g.visitElement(a,function(a){if(0<=b.indexOf(a.id))return e=a.id,!0;b.push(a.id)});return e},_processUrlParams:function(a){var b=
this.urlParams.itemid||this.urlParams.webmap;b&&a.map.itemId!==b&&(a.map.mapOptions&&c.deleteMapOptions(a.map.mapOptions),a.map.itemId=b);this.urlParams.mode&&(a.mode=this.urlParams.mode);a.map.mapOptions||(a.map.mapOptions={});this.urlParams.scale&&(a.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)a.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});x.getInstance=function(a,b){null===z?z=new x(a,b):(z.urlParams=a,z.options=b);return z};return x})},
"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./Role ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g){var p=n([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(a){this.portalUrl=r.getStandardPortalUrl(a);this.selfUrl=r.getPortalSelfInfoUrl(a)},loadSelfInfo:function(){var b=new d,e={url:this.selfUrl,
content:{f:"json"},handleAs:"json",callbackParamName:"callback",preventCache:!0};this.isValidCredential()&&(e.content.token=this.credential.token);a(e).then(f.hitch(this,function(a){var e=a.user;delete a.user;f.mixin(this,a);a.user=e;b.resolve(a)}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||this.clearCredentialAndUser();return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},
updateCredential:function(){this._checkCredential()||(this.credential=g.getPortalCredential(this.portalUrl))},signIn:function(){var a=new d;this.updateCredential();this.isValidCredential()?setTimeout(f.hitch(this,function(){a.resolve(this.credential)}),0):a=g.signInPortal(this.portalUrl);return a},haveSignIn:function(){return g.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var a=new d;this.user&&"jimu.PortalUser"===
this.user.declaredClass?setTimeout(f.hitch(this,function(){this.user.updateCredential();a.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(f.hitch(this,function(b){this.user=b;a.resolve(this.user)}),f.hitch(this,function(b){console.error(b);a.reject(b)})):g.getUserIdByToken(this.credential.token,this.portalUrl).then(f.hitch(this,function(b){this.credential.userId=b;this._getUser(this.credential.userId).then(f.hitch(this,function(b){this.user=
b;a.resolve(this.user)}),f.hitch(this,function(b){console.error(b);a.reject(b)}))}),f.hitch(this,function(b){console.error(b);a.reject(b)})):setTimeout(f.hitch(this,function(){a.reject("credential is null.")}),0);return a},queryItems:function(b){this.updateCredential();var e=new d,c=r.getBaseSearchUrl(this.portalUrl),g={f:"json"};b&&(g=f.mixin(g,b));this.isValidCredential()&&(g.token=this.credential.token);g.sortField||g.sortOrder||(g.sortField="title",g.sortOrder="asc");a({url:c,handleAs:"json",
content:g,callbackParamName:"callback"}).then(f.hitch(this,function(a){a.results=l.map(a.results,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new u(a)}));e.resolve(a)}),f.hitch(this,function(a){console.error(a);e.reject(a)}));return e},getItemData:function(b){this.updateCredential();b={url:r.getItemDataUrl(this.portalUrl,b),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};return a(b)},_getItemById:function(b,e){var c={url:r.getItemUrl(this.portalUrl,
b),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};e&&(c.content.token=e);return a(c).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new u(a)}))},getItemById:function(a,b){this.updateCredential();return this._getItemById(a).then(f.hitch(this,function(e){return b&&e.owner&&this.isValidCredential()&&this.credential&&this.credential.userId===e.owner?this._getItemById(a,this.credential.token):e}))},getAppById:function(b){var e=
new d;this.updateCredential();this.isValidCredential()?(b=r.getAppIdUrl(this.portalUrl,b),e=a({url:b,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(f.hitch(this,function(){e.reject("token is null.")}),0);return e},queryGroups:function(e){this.updateCredential();var c=new d,g=r.getBaseGroupUrl(this.portalUrl),p={f:"json"};e&&(p=f.mixin(p,e));this.isValidCredential()&&(p.token=this.credential.token);a({url:g,handleAs:"json",content:p,callbackParamName:"callback"}).then(f.hitch(this,
function(a){a.results=l.map(a.results,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new b(a)}));c.resolve(a)}),f.hitch(this,function(a){console.error(a);c.reject(a)}));return c},registerApp:function(b,e,c){var g=new d;this.updateCredential();if(this.isValidCredential())var p=this.credential&&this.credential.token,k=r.getOAuth2Url(this.portalUrl),g=a({url:k+"/registerApp",content:{itemId:b,appType:e,redirect_uris:q.stringify(c),token:p,f:"json"},
handleAs:"json"},{usePost:!0});else setTimeout(f.hitch(this,function(){g.reject("token is null.")}),0);return g},createAndRegisterApp:function(a){var b=new d;this.updateCredential();this.isValidCredential()?this.getUser().then(f.hitch(this,function(e){e.addItem({title:"Web AppBuilder for ArcGIS",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(f.hitch(this,function(e){e.success?this.registerApp(e.id,"browser",a).then(f.hitch(this,function(a){b.resolve(a)}),
f.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject("create app failed")}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)})):setTimeout(f.hitch(this,function(){b.reject("token is null.")}),0);return b},_getUser:function(b){this.updateCredential();var c=new d;b={url:r.getUserUrl(this.portalUrl,b),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential&&
this.credential.token);a(b).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;this.user=new e(a);c.resolve(this.user)}),f.hitch(this,function(a){console.error(a);c.reject(a)}));return c}}),e=n([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&f.mixin(this,a)},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},canCreateItem:function(){var a=new k({id:this.roleId?this.roleId:this.role,role:this.role});this.privileges&&a.setPrivileges(this.privileges);return a.canCreateItem()},getGroups:function(){var a=[];this.groups&&(a=l.map(this.groups,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this.portal;return new b(a)})));
return a},getItemsByKeywords:function(a,b){return this.portal.queryItems({start:b||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();var b={url:r.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(b.content.token=this.credential.token);return a(b)},getTags:function(){this.updateCredential();var b={url:r.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",
content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential.token);return a(b)},addItem:function(b,e){this.updateCredential();var c=new d;if(this.isValidCredential()){var g={f:"json",token:this.credential.token};b&&(g=f.mixin(g,b));a({url:r.getAddItemUrl(this.portalUrl,this.username,e),handleAs:"json",callbackParamName:"callback",content:g},{usePost:!0}).then(f.hitch(this,function(a){c.resolve(a)}),f.hitch(this,function(a){console.error(a);c.reject(a)}))}else setTimeout(f.hitch(this,
function(){c.reject("token is null.")}),0);return c},deleteItem:function(b){this.updateCredential();var e=new d;this.isValidCredential()?(b=r.getDeleteItemUrl(this.portalUrl,this.username,b),e=a({url:b,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(f.hitch(this,function(){e.reject("token is null.")}),0);return e},getItemById:function(b,e){this.updateCredential();var c=new d,g={url:r.getUserItemsUrl(this.portalUrl,this.username,e)+"/"+b,handleAs:"json",content:{f:"json"},
callbackParamName:"callback"};a(g).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new u(a);c.resolve(a)}),f.hitch(this,function(a){console.error(a);c.reject(a)}));return c},shareItem:function(b,e,c){this.updateCredential();var g=new d;this.isValidCredential()?(e={url:r.shareItemUrl(this.portalUrl,this.username,e,c),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},b&&(e.content=f.mixin(e.content,b)),
a(e,{usePost:!0}).then(f.hitch(this,function(a){g.resolve(a)}),f.hitch(this,function(a){console.error(a);g.reject(a)}))):setTimeout(f.hitch(this,function(){g.reject("token is null.")}),0);return g},updateItem:function(b,e){this.updateCredential();var c=new d;this.isValidCredential()?this.portal.getItemById(b).then(f.hitch(this,function(g){var p={f:"json",token:this.credential.token};e&&(p=f.mixin(p,e));a({url:r.getUpdateItemUrl(this.portalUrl,g.owner,b,g.ownerFolder),handleAs:"json",callbackParamName:"callback",
timeout:1E5,content:p},{usePost:!0}).then(f.hitch(this,function(a){c.resolve(a)}),f.hitch(this,function(a){console.error(a);c.reject(a)}))}),f.hitch(this,function(a){console.error(a);c.reject(a)})):setTimeout(f.hitch(this,function(){c.reject("token is null.")}),0);return c},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||
"account_user"===this.role}}),b=n([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&f.mixin(this,a)},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q=
"group:"+this.id+" AND "+a.q;return this.portal.queryItems(a)}}),u=n([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(a){a&&f.mixin(this,a);this.itemUrl=r.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+=
"?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=r.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=r.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=
this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)},getItemGroups:function(){this.updateCredential();var b={url:r.getItemGroupsUrl(this.portalUrl,this.id),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential.token);return a(b)}}),t={portals:[],webMapQueryStr:" "+c.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+c.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(a){for(var b=
0;b<this.portals.length;b++){var e=this.portals[b];if(r.isSamePortalUrl(a,e.portalUrl))return e.updateCredential(),e}return null},getPortal:function(a){if(!a||"string"!==typeof a||!f.trim(a))return null;a=r.getStandardPortalUrl(a);var b=this._findPortal(a);b||(b=new p(a),b.credential=g.getPortalCredential(b.portalUrl),b.updateCredential(),this.portals.push(b));return b},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,
"basemapGalleryGroupQuery")},getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},getUnits:function(a){var b="english",e="",c=new d;this.getPortal(a).getUser().then(f.hitch(this,function(a){a&&a.units?b=a.units:(e=h.locale,b=e.startWith("en")?"english":"metric");c.resolve(b)}),f.hitch(this,function(g){console.warn(g);this.getPortalSelfInfo(a).then(f.hitch(this,function(a){var b=null;a&&a.units?b=a.units:(e=a&&a.culture||h.locale,b=e.startWith("en")?"english":"metric");
c.resolve(b)}),f.hitch(this,function(a){console.warn(a);e=h.locale;b=e.startWith("en")?"english":"metric";c.resolve(b)}))}));return c.promise},_getPortalSelfGroup:function(a,e){var c=new d,g=this.getPortal(a);g||setTimeout(f.hitch(this,function(){c.reject()}),0);this.getPortalSelfInfo(a).then(f.hitch(this,function(a){g.queryGroups({f:"json",q:a[e]}).then(f.hitch(this,function(a){0<a.results.length?(a=a.results[0],a.portalUrl=g.portalUrl,a.credential=g.credential,a.portal=g,a=new b(a),c.resolve(a)):
c.reject("Can't find portal self group.")}),f.hitch(this,function(a){console.error(a);c.reject(a)}))}),f.hitch(this,function(a){console.error(a);c.reject(a)}));return c},getWebMapsFromBasemapGalleryGroup:function(a){var b=new d;this.getBasemapGalleryGroup(a).then(f.hitch(this,function(a){a?a.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(f.hitch(this,function(a){b.resolve(a)}),f.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject()}),f.hitch(this,function(a){console.error(a);
b.reject(a)}));return b},getDefaultWebScene:function(a){var b=r.getStandardPortalUrl(a);return this._searchWABDefaultWebScene(b).then(f.hitch(this,function(a){return a?a:this._createWABDefaultWebScene(b).then(f.hitch(this,function(a){return this.getPortal(b).getUser().then(f.hitch(this,function(b){var e=!1;b&&b.privileges&&0<b.privileges.length&&(e=l.some(b.privileges,function(a){return 0<=a.indexOf("shareToPublic")}));return e?b.shareItem({everyone:!0},a).then(f.hitch(this,function(){return a}),
f.hitch(this,function(){return a})):a}),f.hitch(this,function(b){console.error(b);return a}))}))}))},_searchWABDefaultWebScene:function(a){var b=new d;a=r.getStandardPortalUrl(a);this.getPortal(a).queryItems({q:'typekeywords:"WABDefaultWebScene" access:public '+this.webSceneQueryStr}).then(f.hitch(this,function(a){a&&a.results&&0<a.results.length?b.resolve(a.results[0].id):b.resolve(null)}),f.hitch(this,function(a){console.error("_searchWABDefaultWebScene error:",a);b.reject(a)}));return b},_createWABDefaultWebScene:function(a){var b=
new d;a=r.getStandardPortalUrl(a);this.getPortal(a).getUser().then(f.hitch(this,function(a){var e={title:"Default Web Scene",type:"Web Scene",typeKeywords:"WABDefaultWebScene",tags:"default",text:q.stringify({operationalLayers:[],baseMap:{id:"151b431fe65-basemap-0",title:"Topographic",baseMapLayers:[{id:"defaultBasemap",url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer"}],elevationLayers:[{id:"globalElevation",url:"http://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",
layerType:"ArcGISTiledElevationServiceLayer"}]},version:"1.3",authoringApp:"WebSceneViewer",authoringAppVersion:"3.10.0.0",spatialReference:{wkid:102100,latestWkid:3857},viewingMode:"global",initialState:{viewpoint:{scale:4.5188197847224146E7,rotation:0,targetGeometry:{x:144770.99872895706,y:3232837.215000455,spatialReference:{wkid:102100,latestWkid:3857},z:-127.7412482528016},camera:{position:{x:144770.99767624016,y:3182557.105058348,spatialReference:{wkid:102100,latestWkid:3857},z:2.551254800000001E7},
heading:0,tilt:.0999986601088944}},environment:{lighting:{datetime:1426420488E3,displayUTCOffset:0}}},presentation:{slides:[]}}),snippet:""};a.addItem(e,"").then(f.hitch(this,function(a){a.success?b.resolve(a.id):(console.error("Can't create default web scene:",a),b.reject())}))}),f.hitch(this,function(a){console.error("Can't create default web scene");b.reject(a)}));return b},getDefaultWebMap:function(a){var b=new d;this.getPortalSelfInfo(a).then(f.hitch(this,function(e){var c=e.defaultBasemap&&
e.defaultBasemap.id;c?b.resolve(c):this._getDefaultWebMapByBasemapGallery(a,e).then(f.hitch(this,function(e){e?b.resolve(e):this._getMostNumViewsWebMap(a).then(f.hitch(this,function(a){a?b.resolve(a):b.reject()}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_getDefaultWebMapByBasemapGallery:function(a,b){var e=new d,c=this.getPortal(a),g=b.defaultBasemap&&b.defaultBasemap.title;
c.queryGroups({f:"json",q:b.basemapGalleryGroupQuery}).then(f.hitch(this,function(a){a=a.results;0<a.length?c.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+a[0].id+" AND title:"+g}).then(f.hitch(this,function(a){a=a.results;a=l.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?e.resolve(a[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),c.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+
g}).then(f.hitch(this,function(a){a=a.results;a=l.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));if(0<a.length){var b=a[0];c.getItemData(b.id).then(f.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?e.resolve(b.id):e.resolve(null)}),f.hitch(this,function(){e.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),e.resolve(null)}),f.hitch(this,function(a){console.error(a);e.reject(a)})))}),f.hitch(this,function(a){console.error(a);
e.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),e.resolve(null))}),f.hitch(this,function(a){console.error(a);e.reject(a)}));return e},_getMostNumViewsWebMap:function(a){var b=new d;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(f.hitch(this,function(a){a=a.results;a=l.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?
b.resolve(a[0].id):b.reject("Can't find most-num-views web map.")}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},comparePortalVersion:function(a,b){var e=a.split("."),c=parseInt(e[0],10),e=1<e.length?parseInt(e[1],10):0,g=b.split("."),p=parseInt(g[0],10),g=1<g.length?parseInt(g[1],10):0;return c>p?1:c<p?-1:e>g?1:e<g?-1:0}};m.subscribe("userSignOut",function(a){(a=t._findPortal(a))&&a.clearCredentialAndUser()});return t})},"jimu/Role":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/_base/array","dojo/json","esri/lang"],function(n,f,l,h,d){return n(null,{id:null,baseRole:null,name:null,description:null,privileges:[],privilegeObj:null,constructor:function(d){d=d||{};this.id=d.id;this.baseRole=d.role;this.name=d.name;this.description=d.description},_initPrivilegesObject:function(){this.privilegeObj={portal:{admin:{inviteUsers:!1,disableUsers:!1,viewUsers:!1,updateUsers:!1,deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,assignToGroups:!1,
manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,manageLicenses:!1},publisher:{publishFeatures:!1,publishTiles:!1,publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},features:{user:{edit:!1,fullEdit:!1}},opendata:{user:{openDataAdmin:!1,designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,demographics:!1,
elevation:!1}},marketplace:{admin:{manage:!1,purchase:!1,startTrial:!1}}}},_readPrivileges:function(m){d.isDefined(m)&&m instanceof Array&&l.forEach(m,f.hitch(this,function(d){this._readPrivilege(d)}))},_readPrivilege:function(d){this._applyEffectToAction(!0,d)},_applyEffectToAction:function(d,h){switch(h){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=d;break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=d;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=
d;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=d;break;case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=d;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=d;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=d;break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=d;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=
d;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=d;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=d;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=d;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=d;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=d;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=
d;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=d;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=d;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=d;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=d;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=d;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=
d;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=d;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=d;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=d;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=d;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=d;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=d;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=
d;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=d;break;case "features:user:edit":this.privilegeObj.features.user.edit=d;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=d;break;case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=d;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=d;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=d;
break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=d;break;case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=d;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=d;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=d;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=d;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=
d;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=d;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=d}},_applyToAll:function(d){this.privilegeObj.portal.admin.inviteUsers=d;this.privilegeObj.portal.admin.disableUsers=d;this.privilegeObj.portal.admin.viewUsers=d;this.privilegeObj.portal.admin.updateUsers=d;this.privilegeObj.portal.admin.deleteUsers=d;this.privilegeObj.portal.admin.changeUserRoles=d;this.privilegeObj.portal.admin.viewGroups=
d;this.privilegeObj.portal.admin.updateGroups=d;this.privilegeObj.portal.admin.deleteGroups=d;this.privilegeObj.portal.admin.reassignGroups=d;this.privilegeObj.portal.admin.assignToGroups=d;this.privilegeObj.portal.admin.manageEnterpriseGroups=d;this.privilegeObj.portal.admin.viewItems=d;this.privilegeObj.portal.admin.updateItems=d;this.privilegeObj.portal.admin.deleteItems=d;this.privilegeObj.portal.admin.reassignItems=d;this.privilegeObj.portal.admin.manageLicenses=d;this.privilegeObj.portal.publisher.publishFeatures=
d;this.privilegeObj.portal.publisher.publishTiles=d;this.privilegeObj.portal.publisher.publishScenes=d;this.privilegeObj.portal.user.createGroup=d;this.privilegeObj.portal.user.joinGroup=d;this.privilegeObj.portal.user.joinNonOrgGroup=d;this.privilegeObj.portal.user.createItem=d;this.privilegeObj.portal.user.shareToGroup=d;this.privilegeObj.portal.user.shareToOrg=d;this.privilegeObj.portal.user.shareToPublic=d;this.privilegeObj.portal.user.shareGroupToOrg=d;this.privilegeObj.portal.user.shareGroupToPublic=
d;this.privilegeObj.features.user.edit=d;this.privilegeObj.opendata.user.openDataAdmin=d;this.privilegeObj.opendata.user.designateGroup=d;this.privilegeObj.premium.user.geocode=d;this.privilegeObj.premium.user.networkanalysis=d;this.privilegeObj.premium.user.spatialanalysis=d;this.privilegeObj.premium.user.geoenrichment=d;this.privilegeObj.premium.user.demographics=d;this.privilegeObj.premium.user.elevation=d;this.privilegeObj.marketplace.admin.purchase=d;this.privilegeObj.marketplace.admin.manage=
d;this.privilegeObj.marketplace.admin.startTrial=d},_buildPrivilegesArray:function(){var d=[];!0===this.privilegeObj.portal.admin.inviteUsers&&d.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&d.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&d.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&d.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&d.push("portal:admin:deleteUsers");
!0===this.privilegeObj.portal.admin.changeUserRoles&&d.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&d.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&d.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&d.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&d.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&d.push("portal:admin:assignToGroups");
!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&d.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&d.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&d.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&d.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&d.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&d.push("portal:admin:manageLicenses");
!0===this.privilegeObj.portal.publisher.publishFeatures&&d.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&d.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&d.push("portal:publisher:publishScenes");!0===this.privilegeObj.portal.user.createGroup&&d.push("portal:user:createGroup");!0===this.privilegeObj.portal.user.joinGroup&&d.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&
d.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&d.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&d.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&d.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&d.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&d.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&
d.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&d.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&d.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&d.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&d.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&d.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&
d.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&d.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&d.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&d.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&d.push("premium:user:elevation");!0===this.privilegeObj.marketplace.admin.purchase&&d.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&
d.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&d.push("marketplace:admin:startTrial");return d},isUser:function(){return d.isDefined(this.id)&&("org_user"===this.id||"account_user"===this.id)},isPublisher:function(){return d.isDefined(this.id)&&("org_publisher"===this.id||"account_publisher"===this.id)},isAdmin:function(){return d.isDefined(this.id)&&("org_admin"===this.id||"account_admin"===this.id)},isBasedOnUser:function(){return this.isUser()||d.isDefined(this.baseRole)&&
("org_user"===this.baseRole||"account_user"===this.baseRole)},isBasedOnPublisher:function(){return this.isPublisher()||d.isDefined(this.baseRole)&&("org_publisher"===this.baseRole||"account_publisher"===this.baseRole)},isBasedOnAdmin:function(){return this.isAdmin()||d.isDefined(this.baseRole)&&("org_admin"===this.baseRole||"account_admin"===this.baseRole)},isCustom:function(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&d.isDefined(this.id)&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.disableUsers},canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},canDeleteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},
canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},canUpdateOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},
canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},canViewOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},
canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createGroup},canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},
canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishScenes},canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&
this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},canShareGroupToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&
this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},canUseGeocode:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&
this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},canUseElevation:function(){return this.privilegeObj&&this.privilegeObj.premium.user.elevation},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&
this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(h){this.privileges=h;this._initPrivilegesObject();d.isDefined(h)&&this._readPrivileges(h)},stringify:function(){return h.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return h.stringify({id:this.id,name:this.name,description:this.description})},stringifyPrivileges:function(){return h.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return h.stringify({id:this.id,
name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},null,"  ")}})})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(n,f,l,h,d,m,q,a,k){var c=null,r=n(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(a){this.rawAppConfig=a},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var c=
h.stringify(this.rawAppConfig.map);this.mapMd5=a(c)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var a=new l,c={};if(k.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return a.resolve(c),a;var e=this._getAppStateKey(),b=q.get(e);b&&b.appStateMd5===this._getAppStateMd5()?(e=b.map&&b.map.extent,b=b.map&&b.map.layers,e&&(c.extent=
new d(e.xmin,e.ymin,e.xmax,e.ymax,new m(e.spatialReference))),b&&(c.layers=b)):q.remove(e);a.resolve(c);return a},saveWabAppState:function(a,c){if(a&&!k.isInConfigOrPreviewWindow()){var e=this._getAppStateKey(),b={extent:{xmin:a.extent.xmin,xmax:a.extent.xmax,ymin:a.extent.ymin,ymax:a.extent.ymax,spatialReference:{wkid:a.extent.spatialReference.wkid,wkt:a.extent.spatialReference.wkt}},layers:{}};c&&c.traversal&&c.traversal(f.hitch(this,function(a){b.layers[a.id]={visible:a.isVisible()}}));q.set(e,
{map:b,appStateMd5:this._getAppStateMd5()})}}});r.getInstance=function(a){null===c&&(c=new r);c.urlParams=a;return c};return r})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(n,f,l,h){return n(f,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&l.set(this.domNode,{display:"none"});l.set(this.domNode,
{width:"100%",height:"100%"});var d='\x3cdiv class\x3d"loading-section"\x3e\x3cimg class\x3d"jimu-loading" src\x3d"'+require.toUrl("jimu")+'/images/loading2.gif"\x3e\x3c/div\x3e';h.place(d,this.domNode)},show:function(){this.domNode&&l.set(this.domNode,"display","block")},hide:function(){this.domNode&&l.set(this.domNode,"display","none")}})})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/dom-construct dojo/dom-geometry dojo/Deferred dojo/promise/all dojo/when require ./WidgetManager ./PanelManager ./MapManager ./utils ./OnScreenWidgetIcon ./WidgetPlaceholder ./dijit/LoadingShelter".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z){var x=null,A;A=n([d],{constructor:function(a,e){this.widgetManager=b.getInstance();this.panelManager=u.getInstance();this.own(m.subscribe("appConfigLoaded",f.hitch(this,this.onAppConfigLoaded)));this.own(m.subscribe("appConfigChanged",f.hitch(this,this.onAppConfigChanged)));this.own(m.subscribe("mapLoaded",f.hitch(this,this.onMapLoaded)));this.own(m.subscribe("mapChanged",f.hitch(this,this.onMapChanged)));this.own(m.subscribe("beforeMapDestory",
f.hitch(this,this.onBeforeMapDestory)));this.own(m.subscribe("preloadModulesLoaded",f.hitch(this,this._onPreloadModulesLoaded)));this.own(m.subscribe("builder/actionTriggered",f.hitch(this,this.onActionTriggered)));this.own(m.subscribe("openWidget",f.hitch(this,this._onOpenWidgetRequest)));this.widgetPlaceholders=[];this.preloadWidgetIcons=[];this.preloadGroupPanels=[];this.invisibleWidgetIds=[];v.isMobileUa()||this.own(q(window,"resize",f.hitch(this,this.resize)));this.id=e;this.preloadModulesLoadDef=
new r},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",hlDiv:null,animTime:500,resize:function(){l.forEach(this.widgetManager.getAllWidgets(),function(a){!1===a.inPanel&&a.resize()},this)},onAppConfigLoaded:function(a){this.appConfig=f.clone(a);this._loadMap();this.preloadModulesLoadDef.then(f.hitch(this,function(){this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))},_onPreloadModulesLoaded:function(){this.preloadModulesLoadDef.resolve()},onAppConfigChanged:function(a,
b,e){a=f.clone(a);switch(b){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,e);break;case "groupChange":this._onGroupChange(a,e);break;case "widgetPoolChange":this._onWidgetPoolChange(a,e);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,e)}this.appConfig=a},onMapLoaded:function(a){this.map=a;this.panelManager.setMap(a);
this.preloadModulesLoadDef.then(f.hitch(this,function(){this._loadPreloadWidgets(this.appConfig)}))},onMapChanged:function(a){this.map=a;this.panelManager.setMap(a);this._loadPreloadWidgets(this.appConfig)},onBeforeMapDestory:function(){this.panelManager.destroyAllPanels();this._destroyOffPanelWidgets();this._destroyWidgetPlaceholders();this._destroyPreloadWidgetIcons()},onActionTriggered:function(a){"highLight"===a.action&&(l.forEach(this.widgetPlaceholders,function(b){b.configId===a.elementId&&
this._highLight(b)},this),l.forEach(this.preloadWidgetIcons,function(b){b.configId===a.elementId&&this._highLight(b)},this),l.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(b){b.configId===a.elementId&&this._highLight(b)},this),l.forEach(this.preloadGroupPanels,function(b){b.configId===a.elementId&&this._highLight(b)},this));"removeHighLight"===a.action&&this._removeHighLight();"showLoading"===a.action&&(h.setStyle(jimuConfig.loadingId,"display","block"),h.setStyle(jimuConfig.mainPageId,
"display","none"));"showApp"===a.action&&(h.setStyle(jimuConfig.loadingId,"display","none"),h.setStyle(jimuConfig.mainPageId,"display","block"))},_highLight:function(a){if(a.domNode){this.hlDiv&&this._removeHighLight(a);var b=c.getMarginBox(a.domNode);this.hlDiv=k.create("div",{style:{position:"absolute",left:b.l+"px",top:b.t+"px",width:b.w+"px",height:b.h+"px"},"class":"icon-highlight"},a.domNode,"before")}},_removeHighLight:function(){this.hlDiv&&(k.destroy(this.hlDiv),this.hlDiv=null)},_onWidgetChange:function(a,
b){b=a.getConfigElementById(b.id);b.isController?this._reloadControllerWidget(a,b.id):(l.forEach(this.widgetPlaceholders,function(e){e.configId===b.id&&(e.destroy(),this._loadPreloadWidget(b,a))},this),this._removeDestroyed(this.widgetPlaceholders),l.forEach(this.preloadWidgetIcons,function(e){if(e.configId===b.id){var c=e.state;e.destroy();this._loadPreloadWidget(b,a).then(function(a){if(b.uri&&"opened"===c)a.onClick()})}},this),this._removeDestroyed(this.preloadWidgetIcons),l.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),
function(e){e.configId===b.id&&(e.destroy(),!1===b.visible?0>this.invisibleWidgetIds.indexOf(b.id)&&this.invisibleWidgetIds.push(b.id):this._loadPreloadWidget(b,a))},this),l.forEach(this.preloadGroupPanels,function(a){a.reloadWidget(b)},this),this._updatePlaceholder(a),l.forEach(this.invisibleWidgetIds,function(e){e===b.id&&!1!==b.visible&&(this._loadPreloadWidget(b,a),e=this.invisibleWidgetIds.indexOf(b.id),this.invisibleWidgetIds.splice(e,1))},this),b.isOnScreen||l.forEach(this.widgetManager.getControllerWidgets(),
function(e){e.widgetIsControlled(b.id)&&this._reloadControllerWidget(a,e.id)},this))},_onGroupChange:function(a,b){b=a.getConfigElementById(b.id);b.isOnScreen?(this.panelManager.destroyPanel(b.id+"_panel"),this._removeDestroyed(this.preloadGroupPanels),this._loadPreloadGroup(b,a)):(l.forEach(this.widgetManager.getControllerWidgets(),function(e){e.isControlled(b.id)&&this._reloadControllerWidget(a,e.id)},this),l.forEach(this.panelManager.panels,function(a){a.config.id===b.id&&a.updateConfig(b)},this))},
_updatePlaceholder:function(a){l.forEach(this.widgetPlaceholders,function(b){b.setIndex(a.getConfigElementById(b.configId).placeholderIndex)},this)},_onWidgetPoolChange:function(a,b){this._reloadControllerWidget(a,b.controllerId)},_reloadControllerWidget:function(a,b){var e=this.widgetManager.getWidgetById(b);if(e){var c=e.getOpenedIds(),g=e.windowState;l.forEach(e.getAllConfigs(),function(a){if(a.widgets)this.panelManager.destroyPanel(a.id+"_panel"),l.forEach(a.widgets,function(a){this.panelManager.destroyPanel(a.id+
"_panel")},this);else{var b=this.widgetManager.getWidgetById(a.id);b&&(a.inPanel?this.panelManager.destroyPanel(b.getPanel()):this.widgetManager.destroyWidget(b))}},this);this.widgetManager.destroyWidget(e);e=a.getConfigElementById(b);!1!==e.visible&&this._loadPreloadWidget(e,a).then(f.hitch(this,function(a){this.widgetManager.changeWindowStateTo(a,g);c&&a.setOpenedIds(c)}))}},_removeDestroyed:function(a){var b=[];l.forEach(a,function(a){a._destroyed&&b.push(a)});l.forEach(b,function(b){b=a.indexOf(b);
a.splice(b,1)})},_destroyPreloadWidgetIcons:function(){l.forEach(this.preloadWidgetIcons,function(a){a.destroy()},this);this.preloadWidgetIcons=[]},_destroyOffPanelWidgets:function(){l.forEach(this.widgetManager.getOffPanelWidgets(),function(a){this.widgetManager.destroyWidget(a)},this)},_destroyWidgetPlaceholders:function(){l.forEach(this.widgetPlaceholders,function(a){a.destroy()},this);this.widgetPlaceholders=[]},_destroyPreloadGroupPanels:function(){l.forEach(this.preloadGroupPanels,function(a){this.panelManager.destroyPanel(a)},
this);this.preloadGroupPanels=[]},_changeMapPosition:function(a){this.map&&(v.isEqual(this.mapManager.getMapPosition(),a.map.position)||this.mapManager.setMapPosition(a.map.position))},_onThemeChange:function(a){this._destroyPreloadWidgetIcons();this._destroyWidgetPlaceholders();this._destroyOffPanelWidgets();this._destroyPreloadGroupPanels();this.panelManager.destroyAllPanels();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();
e(["themes/"+a.theme.name+"/main"],f.hitch(this,function(){this._loadThemeCommonStyle(a.theme);this._loadThemeCurrentStyle(a.theme);this._addCustomStyle(a.theme);this._changeMapPosition(a);this._loadPreloadWidgets(a)}))},_onResetConfig:function(a){var b=this.appConfig;m.publish("appConfigChanged",a,"mapChange",a);this.appConfig=b;this._updateCommonStyle(a);this._onStyleChange(a);this._changeMapPosition(a)},_onLoadingPageChange:function(a,b){if("backgroundColor"in b)h.setStyle(jimuConfig.loadingId,
"background-color",a.loadingPage.backgroundColor);else if("backgroundImage"in b){var e=a.loadingPage.backgroundImage;e.visible&&e.uri?(h.setStyle(jimuConfig.loadingImageId,"background-image","url('"+e.uri+"')"),h.setStyle(jimuConfig.loadingImageId,"width",e.width+"px"),h.setStyle(jimuConfig.loadingImageId,"height",e.height+"px")):(h.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),h.setStyle(jimuConfig.loadingImageId,"width","0px"),h.setStyle(jimuConfig.loadingImageId,"height","0px"))}else"loadingGif"in
b&&(e=a.loadingPage.loadingGif,e.visible&&e.uri?(h.setStyle(jimuConfig.loadingGifId,"background-image","url('"+e.uri+"')"),h.setStyle(jimuConfig.loadingGifId,"width",e.width+"px"),h.setStyle(jimuConfig.loadingGifId,"height",e.height+"px")):(h.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),h.setStyle(jimuConfig.loadingGifId,"width","0px"),h.setStyle(jimuConfig.loadingGifId,"height","0px")))},_updateCommonStyle:function(a){this._removeThemeCommonStyle(this.appConfig.theme);this._loadThemeCommonStyle(a.theme)},
_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(a.theme);this._removeCustomStyle();this._addCustomStyle(a.theme)},_onLayoutChange:function(a){this._changeMapPosition(a);l.forEach(this.widgetPlaceholders,function(b){b.moveTo(a.getConfigElementById(b.configId).position)},this);l.forEach(this.preloadWidgetIcons,function(b){b.moveTo(a.getConfigElementById(b.configId).position)},this);l.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(b){if(!b.closeable){var e=
a.getConfigElementById(b.id).position;b.setPosition(e)}},this);l.forEach(this.preloadGroupPanels,function(b){var e=a.getConfigElementById(b.config.id).panel.position;b.setPosition(e)},this)},_loadTheme:function(a){e(["themes/"+a.name+"/main"],f.hitch(this,function(){this._loadThemeCommonStyle(a);this._loadThemeCurrentStyle(a);this._addCustomStyle(a)}))},_loadThemeCommonStyle:function(a){v.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css");h.addClass(this.domNode,a.name)},
_removeThemeCommonStyle:function(a){h.removeClass(this.domNode,a.name);h.destroy(this._getThemeCommonStyleId(a))},_loadThemeCurrentStyle:function(a){v.loadStyleLink(this._getThemeCurrentStyleId(a),"themes/"+a.name+"/styles/"+a.styles[0]+"/style.css");h.addClass(this.domNode,a.styles[0])},_removeThemeCurrentStyle:function(a){h.removeClass(this.domNode,a.styles[0]);h.destroy(this._getThemeCurrentStyleId(a))},_addCustomStyle:function(a){var b=f.getObject("customStyles",!1,a);if(b){var e=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";
(a=this._getFixedThemeStyles(a))&&(e+=a);e=f.replace(e,b,/\$\{([^\}]+)\}/g);b=h.create("style",{type:"text/css"});try{b.appendChild(document.createTextNode(e))}catch(C){b.styleSheet.cssText=e}b.setAttribute("source","custom");document.head.appendChild(b)}},_getFixedThemeStyles:function(a){var b=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";"PlateauTheme"===a.name?b+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===a.name?b+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation{background-color: ${mainBackgroundColor} !important;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}":"BoxTheme"===a.name?b+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate{background-color: ${mainBackgroundColor} !important;}":
"TabTheme"===a.name&&(b+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}");return b},_removeCustomStyle:function(){a('style[source\x3d"custom"]',document.head).forEach(function(a){h.destroy(a)})},_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_loadMap:function(){h.create("div",{id:this.mapId,style:f.mixin({position:"absolute",backgroundColor:"#EEEEEE",overflow:"hidden",
minWidth:"1px",minHeight:"1px"})},this.id);this.mapManager=t.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},this.mapId);this.mapManager.setMapPosition(this.appConfig.map.position);this.mapManager.showMap()},_createPreloadWidgetPlaceHolder:function(a){var b;b="map"===a.position.relativeTo?this.mapId:this.id;var e=f.clone(a);e.position.width=40;e.position.height=40;var c=v.getPositionStyle(e.position);a=new y({index:e.placeholderIndex,configId:a.id});h.setStyle(a.domNode,c);h.place(a.domNode,
b);this.widgetPlaceholders.push(a);return a},_createPreloadWidgetIcon:function(a){var b=new w({panelManager:this.panelManager,widgetManager:this.widgetManager,widgetConfig:a,configId:a.id,map:this.map});"map"===a.position.relativeTo?h.place(b.domNode,this.mapId):h.place(b.domNode,this.id);h.setStyle(b.domNode,v.getPositionStyle({top:a.position.top,left:a.position.left,right:a.position.right,bottom:a.position.bottom,width:40,height:40}));b.startup();!this.openAtStartWidget&&a.openAtStart&&(b.switchToOpen(),
this.openAtStartWidget=a.name);this.preloadWidgetIcons.push(b);return b},_loadPreloadWidgets:function(a){console.time("Load widgetOnScreen");var b=new z,e=[];b.placeAt(this.id);b.startup();l.forEach(a.widgetOnScreen.widgets,function(b){!1===b.visible?this.invisibleWidgetIds.push(b.id):e.push(this._loadPreloadWidget(b,a))},this);l.forEach(a.widgetOnScreen.groups,function(b){e.push(this._loadPreloadGroup(b,a))},this);g(e).then(f.hitch(this,function(){b&&(b.destroy(),b=null);console.timeEnd("Load widgetOnScreen");
m.publish("preloadWidgetsLoaded");this._doPostLoad()}),f.hitch(this,function(){b&&(b.destroy(),b=null);console.timeEnd("Load widgetOnScreen");m.publish("preloadWidgetsLoaded");this._doPostLoad()}))},_doPostLoad:function(){e(["dynamic-modules/postload"])},_loadPreloadWidget:function(a,b){var e=new r;if("config"===b.mode&&!a.uri){var c=this._createPreloadWidgetPlaceHolder(a);e.resolve(c);return e}if(!a.uri)return e.resolve(null),e;a.inPanel||a.closeable?(c=this._createPreloadWidgetIcon(a),e.resolve(c)):
this.widgetManager.loadWidget(a).then(f.hitch(this,function(b){try{b.setPosition(b.position),this.widgetManager.openWidget(b)}catch(H){console.log(console.error("fail to startup widget "+b.name+". "+H.stack))}b.configId=a.id;e.resolve(b)}),function(a){e.reject(a)});return e},_loadPreloadGroup:function(a,b){return b.mode||a.widgets&&0!==a.widgets.length?this.panelManager.showPanel(a).then(f.hitch(this,function(b){b.configId=a.id;this.preloadGroupPanels.push(b);return b})):p(null)},_onOpenWidgetRequest:function(a){l.forEach(this.preloadWidgetIcons,
function(b){b.configId===a&&b.switchToOpen()},this);l.forEach(this.widgetManager.getControllerWidgets(),function(b){b.widgetIsControlled(a)&&b.setOpenedIds([a])},this)}});A.getInstance=function(a,b){null===x&&(x=new A(a,b),window._layoutManager=x);return x};return A})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(n,
f,l,h,d,m,q,a,k,c,r,g,p){var e,b=null;e=n(null,{constructor:function(){this.panels=[];this.widgetManager=p.getInstance();a(window,"resize",f.hitch(this,this.onWindowResize));this.activePanel=null;k.subscribe("/dnd/move/start",f.hitch(this,this._onMoveStart));k.subscribe("widgetActived",f.hitch(this,this._onWidgetActived))},showPanel:function(b){var e=new m,c=this.getPanelById(b.id+"_panel");c?("closed"===c.state&&this.openPanel(c),e.resolve(c)):q({Panel:this._loadPanelClass(b.panel.uri),nls:this._loadThemeI18N(b.panel.uri)}).then(f.hitch(this,
function(c){var p=b.id+"_panel",k=this.getPanelById(p),d={label:b.label,config:b,uri:b.panel.uri,position:b.panel.position,map:this.map,widgetManager:this.widgetManager,panelManager:this,id:p,gid:b.gid,nls:c.nls};f.mixin(d,b.panel.options);try{k=new c.Panel(d),console.log("panel ["+p+"] created.")}catch(A){console.log("create panel error: "+A+", panelId: "+p);e.reject(A);return}k.setPosition(b.panel.position);g.setVerticalCenter(k.domNode);this.openPanel(k);this.panels.push(k);a(k.domNode,"click",
f.hitch(this,this._onPanelClick,k));e.resolve(k)}));return e},setMap:function(b){this.map=b;a(this.map,"resize",f.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a&&this.closePanel(this.panels[b])},openPanel:function(a){var b=
new m;if("string"===typeof a&&(a=this.getPanelById(a),!a))return b.reject(),b;if(!a.started)try{a.started=!0,a.startup()}catch(v){console.error("fail to startup panel "+a.id+". "+v.stack)}if("opened"===a.state)return b.resolve(a),b;a.setState("opened");return this.playOpenPanelAnimation(a).then(f.hitch(this,function(){h.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new m;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===
a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(function(){this.activePanel&&this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&h.setStyle(a.domNode,"display","none")})},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(t){console.log(console.error("fail to minimize panel "+a.id+". "+
t.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(t){console.log(console.error("fail to maximize panel "+a.id+". "+t.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(t){console.log(console.error("fail to noralize panel "+a.id+
". "+t.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&
this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(t){console.log(console.error("fail to destroy panel "+a.id+". "+t.stack))}}},destroyAllPanels:function(){var a=l.map(this.panels,function(a){return a.id});
l.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return c();var b=new m;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(h.setStyle(a.domNode,{opacity:0,display:""}),d.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return c();var b=new m;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?d.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play():b.resolve());return b},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var b=h.getMarginBox(window.jimuConfig.layoutId),e=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?
{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?b.h>b.w?{left:0,right:0,top:"auto",bottom:0,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:"auto",bottom:0,width:b.w/
2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:b.h>b.w?{left:0,right:0,top:e,bottom:0,width:"auto",height:"auto",contentHeight:b.h-e-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-e-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&
h.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),h.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=this.widgetManager.activeWidget;b&&"active"===b.state&&b.getPanel()!==a&&(b.setState("opened"),!1===b.inPanel&&h.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:
"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&h.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){l.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},
this)},_onWidgetActived:function(a){this.activePanel&&"active"===this.activePanel.state&&a.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),h.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var b=new m;r([a],function(a){b.resolve(a)});return b},_loadThemeI18N:function(a){var b=new m;a.startWith("themes")?(a=a.split("/"),
r(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){b.resolve(a)})):b.resolve({});return b}});e.getInstance=function(){null===b&&(b=new e,window._panelManager=b);return b};return e})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/topic dojo/on dojo/aspect dojo/keys dojo/i18n dojo/_base/config esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/arcgis/utils esri/geometry/Extent esri/geometry/Point require ./utils ./dijit/LoadingShelter jimu/LayerInfos/LayerInfos jimu/dijit/Message jimu/dijit/AppStatePopup ./MapUrlParamsHandler ./AppStateManager ./PopupManager ./FilterManager".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z,x,A,B,F,E,C,G){var H=null,I=n(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(a,b){this.appConfig=a.appConfig;this.urlParams=a.urlParams;this.id=this.mapDivId=b;this.appStateManager=E.getInstance(this.urlParams);this.popupManager=C.getInstance(this);this.filterManager=G.getInstance();this.nls=window.jimuNls;m.subscribe("appConfigChanged",f.hitch(this,
this.onAppConfigChanged));m.subscribe("changeMapPosition",f.hitch(this,this.onChangeMapPosition));m.subscribe("syncExtent",f.hitch(this,this.onSyncExtent));q(window,"resize",f.hitch(this,this.onWindowResize));q(window,"beforeunload",f.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(a){console.time("Load Map");this.loading=new z;this.loading.placeAt(this.mapDivId);this.loading.startup();a.map["3D"]?a.map.itemId?this._show3DWebScene(a):this._show3DLayersMap(a):
a.map.itemId?this._show2DWebMap(a):console.log("No webmap found. Please set map.itemId in config.json.")},onBeforeUnload:function(){this.appConfig.keepAppState&&this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(a){a&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&
(this._mapMobileInfoWindow.destroy(),d("div.esriMobileInfoView.esriMobilePopupInfoView").forEach(function(a){h.destroy(a)}),d("div.esriMobileNavigationBar").forEach(function(a){h.destroy(a)})),this._mapMobileInfoWindow=new p(null,h.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);y.inMobileSize()&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!y.inMobileSize()&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),
this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=!1)},onChangeMapPosition:function(a){var b=f.clone(this.mapPosition);f.mixin(b,a);this.setMapPosition(b)},setMapPosition:function(a){this.mapPosition=a;a=y.getPositionStyle(a);h.setStyle(this.mapDivId,a);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncExtent:function(a){this.map&&(a=new t(a.extent),this.map.setExtent(a))},_visitConfigMapLayers:function(a,b){l.forEach(a.map.basemaps,
function(a,e){a.isOperationalLayer=!1;b(a,e)},this);l.forEach(a.map.operationallayers,function(a,e){a.isOperationalLayer=!0;b(a,e)},this)},_show3DLayersMap:function(a){w(["esri3d/Map"],f.hitch(this,function(b){var e;e=new b(this.mapDivId,{camera:a.map.mapOptions.camera});this._visitConfigMapLayers(a,f.hitch(this,function(a){this.createLayer(e,"3D",a)}));e.usePlugin=b.usePlugin;this._publishMapEvent(e)}))},_show3DWebScene:function(a){this._getWebsceneData(a.map.itemId).then(f.hitch(this,function(b){w(["esri3d/Map"],
f.hitch(this,function(e){var c=new e(this.mapDivId,a.map.mapOptions);l.forEach(b.itemData.operationalLayers,function(a){this.createLayer(c,"3D",a)},this);l.forEach(b.itemData.baseMap.baseMapLayers,function(a){a.type="tile";this.createLayer(c,"3D",a)},this);l.forEach(b.itemData.baseMap.elevationLayers,function(a){a.type="elevation";this.createLayer(c,"3D",a)},this);c.toc=b.itemData.toc;c.bookmarks=b.itemData.bookmarks;c.tours=b.itemData.tours}))}))},_publishMapEvent:function(a){window._viewerMap=a;
F.postProcessUrlParams(this.urlParams,a);console.timeEnd("Load Map");this.map?(this.map=a,this.resetInfoWindow(!0),console.log("map changed."),m.publish("mapChanged",this.map)):(this.map=a,this.resetInfoWindow(!0),m.publish("mapLoaded",this.map))},_getWebsceneData:function(a){return b({url:"http://184.169.133.166/sharing/rest/content/items/"+a+"/data",handleAs:"json"})},_show2DWebMap:function(a){a.map.mapOptions||(a.map.mapOptions={});var b=this._processMapOptions(a.map.mapOptions)||{};b.isZoomSlider=
!1;var e=a.map.portalUrl,c=a.map.itemId,b={mapOptions:b,bingMapsKey:a.bingMapsKey,usePopupManager:!0};if(!window.isBuilder&&!a.mode&&a.map.appProxy&&a.map.appProxy.mapItemId===a.map.itemId){var g=[];l.forEach(a.map.appProxy.proxyItems,function(a){a.useProxy&&a.proxyUrl&&g.push({url:a.sourceUrl,mixin:{url:a.proxyUrl}})});0<g.length&&(b.layerMixins=g)}this._createWebMapRaw(e,c,this.mapDivId,b).then(f.hitch(this,function(b){var e=b.map;e.hideZoomSlider();e.infoWindow.resize(270,316);e.itemId=a.map.itemId;
e.itemInfo=b.itemInfo;e.webMapResponse=b;e.enableSnapping({snapKey:k.copyKey});h.setStyle(e.root,"zIndex",0);e._initialExtent=e.extent;x.getInstance(e,e.itemInfo).then(f.hitch(this,function(a){this.layerInfosObj=a;this._showUnreachableLayersTitleMessage();this._publishMapEvent(e);setTimeout(f.hitch(this,this._checkAppState),500);this.loading.hide();this._addDataLoadingOnMapUpdate(e)}))}),f.hitch(this,function(a){console.error(a);this._destroyLoadingShelter();this._showError(a);m.publish("mapCreatedFailed")}))},
_showError:function(a){a&&a.message&&h.create("div",{"class":"app-error",innerHTML:a.message},document.body)},_createWebMapRaw:function(a,b,e,g){return y.createWebMap(a,b,e,g).then(f.hitch(this,function(a){return a}),f.hitch(this,function(p){console.error(p);if(p&&p instanceof Error&&p.message){var k=f.getObject("arcgis.utils.baseLayerError",!1,c.cache["esri/nls/jsapi/"+r.locale]);if(k&&0<=p.message.indexOf(k))return new A({message:window.jimuNls.map.basemapNotAvailable+window.jimuNls.map.displayDefaultBasemap}),
u.getItem(b).then(f.hitch(this,function(b){b.itemData.spatialReference={wkid:102100,latestWkid:3857};b.itemData.baseMap={baseMapLayers:[{url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",opacity:1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,id:"defaultBasemap_0"}],title:"Topographic"};return y.createWebMap(a,b,e,g)}))}throw p;}))},_showUnreachableLayersTitleMessage:function(){var a=this.layerInfosObj.getUnreachableLayersTitle(),b="",e=window.jimuNls.map.layerLoadedError||
"The layer, ${layers} cannot be added to the map.";e&&a&&0<a.length&&(l.forEach(a,f.hitch(this,function(a){b=b+a+", "})),new A({message:e.replace("${layers}",b)}))},_addDataLoadingOnMapUpdate:function(a){var b=h.toDom('\x3cdiv class\x3d"load-container"\x3e\x3cdiv class\x3d"loader"\x3eLoading...\x3c/div\x3e\x3c/div\x3e');h.place(b,a.root);a.updating&&h.addClass(b,"loading");q(a,"update-start",f.hitch(this,function(){h.addClass(b,"loading")}));q(a,"update-end",f.hitch(this,function(){h.removeClass(b,
"loading")}));q(a,"unload",f.hitch(this,function(){h.destroy(b);b=null;this._destroyLoadingShelter()}))},_destroyLoadingShelter:function(){this.loading&&(this.loading.destroy(),this.loading=null)},_checkAppState:function(){var a="extent center marker find query scale level".split(" "),b=this.appConfig.keepAppState;b&&l.forEach(a,function(a){a in this.urlParams&&(b=!1)},this);b&&this.appStateManager.getWabAppState().then(f.hitch(this,function(a){if(a.extent||a.layers){var b=new B({nls:{title:this.nls.appState.title,
restoreMap:this.nls.appState.restoreMap}});b.placeAt("main-page");q(b,"applyAppState",f.hitch(this,function(){this._applyAppState(a,this.map)}));b.startup();b.show()}}))},_applyAppState:function(a,b){this.layerInfosObj.restoreState({layerOptions:a.layers||null});a.extent&&b.setExtent(a.extent);this._publishMapEvent(b)},_processMapOptions:function(a){if(a)return a.lods||delete a.lods,a.lods&&0===a.lods.length&&delete a.lods,a=f.clone(a),a.extent&&(a.extent=new t(a.extent)),a.center&&!f.isArrayLike(a.center)&&
(a.center=new v(a.center)),a.infoWindow&&(a.infoWindow=new g(a.infoWindow,h.create("div",{},this.mapDivId))),a},createLayer:function(b,c,g){w([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer","2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer","2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer","2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer",
"3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[c+"_"+g.type]],f.hitch(this,function(c){var p,k={};p="label url type icon infoTemplate isOperationalLayer".split(" ");for(var d in g)0>p.indexOf(d)&&(k[d]=g[d]);g.infoTemplate?(p=new e(g.infoTemplate.title,
g.infoTemplate.content),k.infoTemplate=p,c=new c(g.url,k),g.infoTemplate.width&&g.infoTemplate.height&&a.after(c,"onClick",f.hitch(this,function(){b.infoWindow.resize(g.infoTemplate.width,g.infoTemplate.height)}),!0)):c=new c(g.url,k);c.isOperationalLayer=g.isOperationalLayer;c.label=g.label;c.icon=g.icon;b.addLayer(c)}))},onAppConfigChanged:function(a,b,e){this.appConfig=a;"mapChange"===b?this._recreateMap(a):"mapOptionsChange"===b&&e.lods&&this._recreateMap(a)},_recreateMap:function(a){this.map&&
(m.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(a)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});I.getInstance=function(a,b){null===H&&(H=new I(a,b));return H};return I})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w){var y=n([v,g,p,e,t],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:w,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(a){this.inherited(arguments);c.place(this.domNode,a.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[y.ANCHOR_UPPERRIGHT,y.ANCHOR_LOWERRIGHT,y.ANCHOR_LOWERLEFT,y.ANCHOR_UPPERLEFT];
if(7>m("ie")){var a="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+r.getComputedStyle(this._sprite).backgroundImage.replace(/url\(\"/i,"").replace(/\"\)/,"")+"')",b=c.create("div",null,h.body());r.set(b,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:a});var e=setTimeout(function(){c.destroy(b);clearTimeout(e);e=b=null},100);d.query(".sprite",this.domNode).forEach(function(b){b.style.backgroundImage="none";b.style.filter=
a})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(a,b){if(a&&b){var e=r.set;e(this._topleft,{height:b+"px",marginLeft:a+"px"});e(this._topright,{width:a+"px",height:b+"px"});e(this._user,"width",a-8+"px");e(this._hide,"marginLeft",a-22+"px");e(this._title,"width",a-25+
"px");e(this._content,"height",b-37+"px");e(this._bottomleft,{marginLeft:a+"px",marginTop:b+"px"});e(this._bottomright,{width:a-5+"px",marginTop:b+"px"});this.width=a;this.height=b;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(a,b)}},_adjustPosition:function(a,b){var e=r.set;e(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"});b===y.ANCHOR_UPPERLEFT?e(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):b===y.ANCHOR_UPPERRIGHT?
e(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):b===y.ANCHOR_LOWERRIGHT?e(this._window,{left:"6px",right:null,top:"43px",bottom:null}):b===y.ANCHOR_LOWERLEFT&&e(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(a){var b=this.map;return b&&a?(a.y<b.height/2?"lower":"upper")+(a.x<b.width/2?"right":"left"):"upperright"},show:function(a,b,e){if(a){a.spatialReference?(this.mapCoords=a,a=this.coords=this.map.toScreen(a,!0)):(this.mapCoords=
null,this.coords=a);var c=this.map._getFrameWidth();if(-1!==c&&(a.x%=c,0>a.x&&(a.x+=c),this.map.width>c))for(var g=(this.map.width-c)/2;a.x<g;)a.x+=c;b&&-1!==l.indexOf(this._ANCHORS,b)||(b=this._getAnchor(a));k.remove(this._pointer,this.anchor);b=this.anchor=this.fixedAnchor||b;this._adjustPosition(a,b);k.add(this._pointer,b);u.show(this.domNode);this.isShowing=!0;if(!e)this.onShow()}},hide:function(a,b){u.hide(this.domNode);this.isShowing=!1;if(!b)this.onHide()},showTitleBar:function(){u.show(this._titlebar);
u.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){u.hide(this._titlebar);u.hide(this._border);this.isTitleBarShowing=!1},showContent:function(){u.show(this._content);u.show(this._border);this.isContentShowing=!0},hideContent:function(){u.hide(this._content);u.hide(this._border);this.isContentShowing=!1},move:function(a,b){b?a=this.coords.offset(a.x,a.y):(this.coords=a,this.mapCoords&&(this.mapCoords=this.map.toMap(a)));r.set(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+
"px"})},setFixedAnchor:function(a){a&&-1===l.indexOf(this._ANCHORS,a)||(this.fixedAnchor=a,this.isShowing&&this.show(this.mapCoords||this.coords,a),this.onAnchorChange(a))},setTitle:function(a){this.destroyDijits(this._title);this.__setValue("_title",a);return this},setContent:function(a){this.destroyDijits(this._content);this.__setValue("_content",a);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},
onResize:function(){},onAnchorChange:function(){}});f.mixin(y,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});m("extend-esri")&&f.setObject("dijit.InfoWindow",y,b);return y})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z,x){n=f([u,t],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:n.toUrl("./images/whitex.png"),dArrowIcon:n.toUrl("./images/whitedown.png"),lArrowIcon:n.toUrl("./images/whitel.png"),rArrowIcon:n.toUrl("./images/whiter.png"),constructor:function(a,b){this.initialize();l.mixin(this,a);this.domNode=c.byId(b);this._nls=l.mixin({},
x.widgets.popup);var e=this.domNode;g.add(e,"esriPopupMobile");r.set(e,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
var p=q.query(".titlePane",e)[0];this._arrowButton=q.query(".arrow",p)[0];this._pointerTop=q.query(".top",e)[0];this._pointerBottom=q.query(".bottom",e)[0];this._title=q.query(".title",p)[0];this._footer=q.query(".footer",p)[0];this._prev=q.query(".prev",p)[0];this._next=q.query(".next",p)[0];this._spinner=q.query(".spinner",p)[0];this._eventConnections=[h.connect(q.query(".close",p)[0],"onclick",this,this.hide),h.connect(this._arrowButton,"onclick",this,this._toggleView),h.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),h.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();z.hide(e);this.isShowing=!1},setMap:function(a){this.inherited(arguments);p.place(this.domNode,a.root);this.highlight&&this.enableHighlight(a)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(a,b){this.destroyDijits(this._title);this.place(a,this._title);
this.destroyDijits(this._footer);this.place(b,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(a){this.destroyDijits(this._contentPane);this.place(a,this._contentPane);this.startupDijits(this._contentPane)},show:function(a){if(a){var b=this.map;a.spatialReference?(this.location=a,a=b.toScreen(a)):this.location=b.toMap(a);this._maximized?this.restore():this._setPosition(a);this.isShowing||(z.show(this.domNode),this.isShowing=!0,this.onShow())}else z.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(z.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);d.forEach(this._eventConnections,h.disconnect);p.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");g.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var a=this.selectedIndex;this._updateUI();0<=a&&(this.setContent(this.features[a].getContent()),this.updateHighlight(this.map,this.features[a]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var a=this.map;this._handles=[h.connect(a,"onPanStart",this,this._onPanStart),h.connect(a,"onPan",this,this._onPan),h.connect(a,"onZoomStart",this,this._onZoomStart),h.connect(a,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var a=this._handles;a&&(d.forEach(a,h.disconnect),this._handles=null)},_onPanStart:function(){var a=this.domNode.style;this._panOrigin={left:a.left,top:a.top,right:a.right,
bottom:a.bottom}},_onPan:function(a,e){var c=this._panOrigin,g=e.x,p=e.y,k=c.left,d=c.top,u=c.right,c=c.bottom;k&&(k=parseFloat(k)+g+"px");d&&(d=parseFloat(d)+p+"px");u&&(u=parseFloat(u)-g+"px");c&&(c=parseFloat(c)-p+"px");b.set(this.domNode,{left:k,top:d,right:u,bottom:c})},_onZoomStart:function(){z.hide(this.domNode)},_onExtentChange:function(a,b,e){e&&(z.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(a){var c=a.x;a=a.y;var p=
e.getContentBox(this.map.container),k=p.w,p=p.h,d=0,u=a+10,r=118,t=k-18;18<c&&c<t?(d=c-130,0>d?d=0:d>k-260&&(d=k-260)):18>=c?d=c-18:c>=t&&(d=k-260+(c-t));118<c&&c<k-130?r=118:118>=c?18<c?r=c-12:18>=c&&(r=6):c>=k-130&&(c<t?r=118+c-(k-130):c>=t&&(r=118+t-(k-130)));a<=p/2?(b.set(this.domNode,{left:d+"px",top:u+"px",bottom:null}),b.set(this._pointerTop,{left:r+"px"}),g.add(this._pointerBottom,"hidden"),g.remove(this._pointerTop,"hidden")):(b.set(this.domNode,{left:d+"px",top:u-64+"px",bottom:null}),b.set(this._pointerBottom,
{left:r+"px"}),g.add(this._pointerTop,"hidden"),g.remove(this._pointerBottom,"hidden"))},_showPointer:function(a){d.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(b){b===a?q.query(".pointer."+b,this.domNode).removeClass("hidden"):q.query(".pointer."+b,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();z.show(this.popupNavigationBar.container);z.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(a){this.popupInfoView.animateTo(0);switch(a.name){case "CloseButton":z.hide(this.popupNavigationBar.container);z.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":z.hide(this.popupNavigationBar.container);z.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var a={};a.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new w(a,p.create("div",{},m.body()));h.connect(this.popupNavigationBar,"onCreate",this,function(a){this._prevFeatureButton=a[3]._node;this._nextFeatureButton=a[4]._node});h.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);h.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();z.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new v({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},p.create("div",{},m.body()));g.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();h.connect(this.popupInfoView,"onCreate",this,function(a){this._contentPane=a[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});h.connect(this.popupInfoView,"onSwipeLeft",this,function(){});h.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var a="\x26nbsp;",b="\x26nbsp;",e=this.selectedIndex,c=this.features,p=this.deferreds,k=this._prevFeatureButton.parentNode,d=this._nextFeatureButton.parentNode,u=this._spinner,r=this._nls;c&&1<=c.length?(a=c[e].getTitle(),b=e+1+" of "+c.length,g.remove(this._arrowButton,"hidden"),0===e?(g.add(k,"hidden"),g.add(this._prev,"hidden")):(g.remove(k,"hidden"),g.remove(this._prev,"hidden")),e===c.length-1?(g.add(d,"hidden"),
g.add(this._next,"hidden")):(g.remove(d,"hidden"),g.remove(this._next,"hidden"))):(g.add(this._arrowButton,"hidden"),g.add(k,"hidden"),g.add(d,"hidden"),g.add(this._prev,"hidden"),g.add(this._next,"hidden"));this.setTitle(a,b);this.popupNavigationBar.getItems()[1]._node.innerHTML=b;p&&p.length?(g.remove(u,"hidden"),this.setTitle(r.NLS_searching+"...","\x26nbsp;")):(g.add(u,"hidden"),c&&c.length||this.setTitle("No Information","\x26nbsp;"))}});a("extend-esri")&&l.setObject("dijit.PopupMobile",n,y);
return n})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g,p){n=n(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(e,b){var g;this.container=a.byId(b);this._touchBase=p(this.container,null);this._slideDiv=
c.create("div",null,this.container,"first");this.events=[];this._items=e.items;e.sections&&(this._sections=e.sections);k.add(this.container,"esriMobileInfoView");if(0===this._sections.length)c.create("div",{},this._slideDiv);else for(g=0;g<this._sections.length;g++){var d=c.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv);c.create("div",{innerHTML:this._sections[g].title},d)}for(g=0;g<this._items.length;g++){var r,d=0;this._items[g].section&&(d=this._items[g].section);switch(this._items[g].type){case "div":r=
c.create("div",{"class":"esriMobileInfoViewItem",style:this._items[g].style},this._slideDiv.childNodes[d]),r=c.create("div",{innerHTML:this._items[g].text},r)}this._items[g].className&&k.add(r,this._items[g].className);r._index=g;r._item=this._items[g];this._items[g]._node=r}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){l.forEach(this.events,h.disconnect);this._touchBase=null;d.query("img",this.container).forEach(function(a){a._index=null;
a._item=null;c.destroy(a);a=null});this._items=null;c.destroy(this._slideDiv);c.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(a){this._touchBase.setPreventDefault(a)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);this.events.push(h.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(h.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(h.connect(this._touchBase,
"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){h.disconnect(this.events.pop());h.disconnect(this.events.pop());h.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},
onClick:function(a){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(a){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=a.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},_onTouchMoveHandler:function(a){this._moveDirection||(this._moveDirection=Math.abs(a.curY)>Math.abs(a.curX)?"vertical":"horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(a.touches[0].clientY-
this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(a){this._endTime=new Date;this._deltaMovement=a.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===this._moveDirection)if("left"===a.swipeDirection)this.onSwipeLeft();else if("right"===a.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return.2<
Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var a,b;a=r.getContentBox(this.container);var c=0>this._velocity?.001:-.001;b=-(this._velocity*this._velocity)/(2*c);var g=-this._velocity/c,c=3*.6-0,p=1-c,k=0,d=0;if(a.h>this._slideDiv.scrollHeight)this.contentOffsetY=0,d=300;else if(0<this.contentOffsetY+b){a=0;for(b=Math.floor(g/20);a<b;a++)if(k=(20*p*a^3)+(20*c*a^2)+0*a+0,k=0>this._velocity?-k:k,0<this.contentOffsetY+k){d=20*a;break}0===d&&(d=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+
b)+a.h>this._slideDiv.scrollHeight)for(this.contentOffsetY=a.h-this._slideDiv.scrollHeight,a=0,b=Math.floor(g/20);a<b;a++){if(k=(20*p*a^3)+(20*c*a^2)+0*a+0,k=0>this._velocity?-k:k,Math.abs(this.contentOffsetY+k)>this._slideDiv.scrollHeight){d=20*a;break}}else d=g,this.contentOffsetY+=b;this._slideDiv.style.webkitTransition="-webkit-transform "+d+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var a=r.getContentBox(this.container);a.h>this._slideDiv.scrollHeight?
this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+a.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=a.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration="0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(a){this.contentOffsetY=a;this._slideDiv.style.webkitTransform="translate3d(0, "+a+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var a=document.defaultView.getComputedStyle(this._slideDiv,null),
a=new WebKitCSSMatrix(a.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(a.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(a,b){"ON"===b.toggleState?(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))}});m("extend-esri")&&f.setObject("dijit.InfoView",n,g);return n})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),
function(n,f,l,h,d,m){n=n(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(d,a){this.domNode=h.byId(d);this.events=[l.connect(this.domNode,"touchstart",this,this._touchStartHandler),l.connect(this.domNode,"touchmove",this,this._touchMoveHandler),l.connect(this.domNode,"touchend",this,this._touchEndHandler),l.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(d){this._preventDefault=d},disableOnClick:function(){l.disconnect(this.events.pop())},
_clickHandler:function(d){if(this._moved)d.preventDefault();else this.onclick(d)},_touchStartHandler:function(d){this._moved=!1;this.client_x=d.targetTouches[0].clientX;this.client_y=d.targetTouches[0].clientY;this.down_x=d.targetTouches[0].pageX;this.down_y=d.targetTouches[0].pageY;d.downX=this.down_x;d.downY=this.down_y;this.onTouchStart(d)},_touchMoveHandler:function(d){this._preventDefault&&d.preventDefault();this._moved=!0;this.up_x=d.targetTouches[0].pageX;this.cur_x=d.targetTouches[0].pageX-
this.down_x;this.cur_y=d.targetTouches[0].pageY-this.down_y;d.curX=this.cur_x;d.curY=this.cur_y;this.onTouchMove(d)},_touchEndHandler:function(d){this._moved?(d.curX=this.cur_x,d.curY=this.cur_y,this.down_x-this.up_x>this._swipeThreshold?d.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(d.swipeDirection="right")):(d.clientX=this.client_x,d.clientY=this.client_y);this.onTouchEnd(d)},onTouchStart:function(d){},onTouchMove:function(d){},onTouchEnd:function(d){},onclick:function(d){}});
d("extend-esri")&&f.setObject("dijit._TouchBase",n,m);return n})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g){n=n(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(g,e){var b;this.container=a.byId(e);this._touchBase=r(this.container,null);this._slideDiv=
c.create("div",{},this.container,"first");this.events=[l.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=g.items;k.add(this.container,"esriMobileNavigationBar");var p=c.create("div",{},this._slideDiv);for(b=0;b<this._items.length;b++){var d,h;switch(this._items[b].type){case "img":h=c.create("div",{"class":"esriMobileNavigationItem"},p);d=c.create("img",{src:this._items[b].src.toString(),style:{width:"100%",height:"100%"}},h);break;case "span":h=c.create("div",{"class":"esriMobileNavigationItem"},
p);d=c.create("span",{innerHTML:this._items[b].text},h);break;case "div":h=c.create("div",{"class":"esriMobileNavigationInfoPanel"},p),d=c.create("div",{innerHTML:this._items[b].text},h)}k.add(h,this._items[b].position);this._items[b].className&&k.add(d,this._items[b].className);d._index=b;d._item=this._items[b];this._items[b]._node=d}},startup:function(){this.onCreate(this._items)},destroy:function(){h.forEach(this.events,l.disconnect);this._touchBase=null;d.query("img",this.container).forEach(function(a){a._index=
null;a._item=null;c.destroy(a);a=null});this._items=null;c.destroy(this._slideDiv);c.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(a){this._markSelected(a._node,a)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},_onClickHandler:function(a){if("img"===a.target.tagName.toLowerCase()){var e=a.target,b=e._item;d.query("img",this.container).forEach(function(a){a!==e&&a._item.toggleGroup===b.toggleGroup&&this._markUnSelected(a,
a._item)},this);this._toggleNode(e,b)}},_toggleNode:function(a,e){"ON"===e.toggleState?(e.toggleState="OFF",e.src&&(a.src=e.src.toString()),this.onUnSelect(e)):(e.toggleState="ON",e.srcAlt&&(a.src=e.srcAlt),this.onSelect(e))},_markSelected:function(a,e){e.toggleState="ON";e.srcAlt&&(a.src=e.srcAlt);this.onSelect(e)},_markUnSelected:function(a,e){"ON"===e.toggleState&&(e.toggleState="OFF",e.src&&(a.src=e.src.toString()),this.onUnSelect(e))}});m("extend-esri")&&f.setObject("dijit.NavigationBar",n,g);
return n})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(n,f,l,h,d){return n([f,l],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:h,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&d.setStyle(this.domNode,
"display","none");d.setStyle(this.domNode,{width:"100%",height:"100%"});this.loadingImg.src=require.toUrl("jimu")+"/images/loading2.gif";this.showLoading||d.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(h){this.domNode&&this.hidden&&("string"===typeof h&&(this.textNode.innerHTML=h),d.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(d.setStyle(this.domNode,"display",
"none"),this.hidden=!0)}})})},"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/Evented dojo/promise/all ./LayerInfoFactory".split(" "),function(n,f,l,h,d,m,q,a,k){var c=n([q],{map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,_tableInfos:null,_finalTableInfos:null,_basemapLayers:null,_unreachableLayersTitleOfWebmap:null,constructor:function(a,e){this._unreachableLayersTitleOfWebmap=[];this._basemapLayers=
e.baseMap.baseMapLayers;this._operLayers=e.operationalLayers;this._tables=e.tables;this.map=a;this._initLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();this._clearAddedFlag(this._layerInfos);this._initFinalTableInfos();this._initFinalLayerInfos(this._layerInfos);this._markFirstOrLastNode()},getLayerInfoArrayOfWebmap:function(){var a=[];f.forEach(this.getLayerInfoArray(),function(b){for(var e=0;e<this._operLayers.length;e++)if(b.id===
this._operLayers[e].id){a.push(b);break}e===this._operLayers.length&&0<=this._removedLayerInfoIdsFromFeatureCollection.indexOf(b.id)&&a.push(b)},this);return a},getLayerInfoArray:function(){return f.filter(this._finalLayerInfos,function(a){return!a._isTemporaryLayerInfo})},getTableInfoArray:function(){return this._finalTableInfos},addFeatureCollection:function(a,e){var b=this._getUniqueTopLayerInfoId(e),c={layers:[]};f.forEach(a,function(a,e){a.id=b+"_"+e;c.layers.push({id:a.id,layerObject:a})},this);
this.map.addLayers(a);var g;try{g=k.getInstance().create({featureCollection:c,title:e||b,id:b},this.map),g.init()}catch(y){console.warn(y.message),g=null}g&&(g._extraOfWebmapLayerInfo=!0,this._layerInfos.push(g),this.update(),this._onUpdated())},addTable:function(a){var b=[];a=this._addTable(a,this._finalTableInfos);this._tableInfos.push(a);b.push(a);this._onTableChange(b,"added");return a},removeTable:function(a){var b=-1,e=!1;f.forEach(this._tableInfos,function(e,c){a.id===e.id&&(b=c)});0<=b&&(this._tableInfos.splice(b,
1),e=!0);b=-1;f.forEach(this._finalTableInfos,function(e,c){a.id===e.id&&(b=c)});0<=b&&(this._finalTableInfos.splice(b,1),e=!0);e&&this._onTableChange([a],"removed")},_addTable:function(a,e){var b;try{a.layerObject={url:a.url,featureCollectionData:a.featureCollectionData,empty:!0},a.id=this._getUniqueTableId(a.id),a.selfType="table",b=k.getInstance().create(a),b.init()}catch(v){console.warn(v.message),b=null}b&&e&&e.push(b);return b},_getUniqueTableId:function(a){var b=this._tableInfos.concat(this._finalTableInfos||
[]);return this._getUniqueLayerOrTableId(a,b)},_getUniqueTopLayerInfoId:function(a){return this._getUniqueLayerOrTableId(a,this._finalLayerInfos)},_getUniqueLayerOrTableId:function(a,e){var b=1,c;a||(a="table");for(c=a;;){for(var g=0;g<e.length&&e[g].id!==c;g++);if(g===e.length)return c;c=a+"_"+b.toString();b++}},_traversal:function(a,e){for(var b=0;b<e.length;b++)if(e[b].traversal(a))return!0;return!1},traversal:function(a){var b=this.getLayerInfoArray();return this._traversal(a,b)},traversalLayerInfosOfWebmap:function(a){var b=
this.getLayerInfoArrayOfWebmap();return this._traversal(a,b)},traversalAll:function(a){var b=this.getLayerInfoArray(),e=this.getTableInfoArray();return this._traversal(a,b.concat(e))},getLayerInfoById:function(a){return this._findLayerInfoById(a)},getTableInfoById:function(a){var b=null;f.some(this.getTableInfoArray(),function(e){if(e.id===a)return b=e,!0});return b},getLayerOrTableInfoById:function(a){var b=null;this.traversalAll(function(e){if(e.id===a)return b=e,!0});return b},getLayerInfoByTopLayerId:function(a){return this._findTopLayerInfoById(a)},
moveUpLayer:function(a,e){var b=null;e=e?e:1;var c=this._getTopLayerInfoIndexById(a.id);0<=c-e&&(b=this._finalLayerInfos[c-e].obtainLayerIndexesInMap().length,this._finalLayerInfos[c].moveLayerByIndex(this._finalLayerInfos[c-e].obtainLayerIndexesInMap()[b-1].index),b=this._finalLayerInfos[c-e],m.publish("layerInfos/layerReorder",c,e,"moveup"));return b},_reorderLayerInfosArray:function(a,e,c){"moveup"===c?(c=this._finalLayerInfos[a],this._finalLayerInfos.splice(a,1),this._finalLayerInfos.splice(a-
e,0,c)):(c=this._finalLayerInfos[a],this._finalLayerInfos.splice(a+e+1,0,c),this._finalLayerInfos.splice(a,1));this._markFirstOrLastNode()},moveDownLayer:function(a,e){var b=null;e=e?e:1;var c=this._getTopLayerInfoIndexById(a.id);c+e<=this._finalLayerInfos.length-1&&(this._finalLayerInfos[c].moveLayerByIndex(this._finalLayerInfos[c+e].obtainLayerIndexesInMap()[0].index),b=this._finalLayerInfos[c+e],m.publish("layerInfos/layerReorder",c,e,"movedown"));return b},getBasemapLayers:function(){var a=[];
f.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);"basemap"!==b._basemapGalleryLayerType&&"reference"!==b._basemapGalleryLayerType||a.push(b)},this);0===a.length&&(a=this._basemapLayers);return a},getMapNotesLayerInfoArray:function(){return f.filter(this.getLayerInfoArray(),function(a){return a.isMapNotesLayerInfo()},this)},restoreState:function(a){var b=a&&a.layerOptions?a.layerOptions:null;f.forEach(this._finalLayerInfos,function(a){a.resetLayerObjectVisibility(b)},this)},getUnreachableLayersTitle:function(){return this._unreachableLayersTitleOfWebmap},
_initLayerInfos:function(){var a;this._layerInfos=[];f.forEach(this._operLayers,function(b){try{a=k.getInstance().create(b),a.init()}catch(t){console.warn(t.message),a=null,this._unreachableLayersTitleOfWebmap.push(b.title)}a&&this._layerInfos.push(a)},this)},_extraSetLayerInfos:function(){this._removedLayerInfoIdsFromFeatureCollection=[];f.forEach(this._layerInfos,function(a,e){var b;if("esri.layers.GeoRSSLayer"===a.layerObject.declaredClass||"esri.layers.KMLLayer"===a.layerObject.declaredClass){try{b=
k.getInstance().create(a.originOperLayer),b.init()}catch(w){console.warn(w.message),b=null}b&&(a.destroyLayerInfo(),this._layerInfos[e]=b)}else if(a.originOperLayer.featureCollection){var c=[];f.forEach(a.getSubLayers(),function(a){c.push(a.id)});f.forEach(c,function(b){this.map.getLayer(b)||a.removeSubLayerById(b)},this);1===a.getSubLayers().length&&(b=a.getSubLayers()[0],this.map.getLayer(b.id).title=a.title,a.removeSubLayerById(b.id),this._removedLayerInfoIdsFromFeatureCollection.push(b.id))}},
this)},_initFinalLayerInfos:function(a){var b,e;this._finalLayerInfos=[];for(b=this.map.graphicsLayerIds.length-1;0<=b;b--)e=this.map.graphicsLayerIds[b],this._isBasemap(e)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(e,a),e,!0);for(b=this.map.layerIds.length-1;0<=b;b--)e=this.map.layerIds[b],this._isBasemap(e)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(e,a),e,!1)},_isBasemap:function(a){for(var b=!1,e=this.getBasemapLayers(),c=0;c<e.length;c++)e[c].id===
a&&(b=!0);return b},_addToFinalLayerInfos:function(a,e,c){var b;if(a)a._addedFlag||a.isGraphicLayer()!==c||(this._finalLayerInfos.push(a),a._addedFlag=!0);else{a=this.map.getLayer(e);if("esri.layers.GraphicsLayer"!==a.declaredClass&&"esri.layers.LabelLayer"!==a.declaredClass){try{var g={layerObject:a,title:this._getLayerTitle(a),id:a.id||" "};l.mixin(g,l.getObject("_wabProperties.originOperLayer",!1,a));b=k.getInstance().create(g,this.map);b.init()}catch(y){console.warn(y.message),b=null}b&&(l.getObject("_wabProperties.isTemporaryLayer",
!1,a)&&(b._isTemporaryLayerInfo=!0),this._finalLayerInfos.push(b))}("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass)&&b&&b._getLayerDefinition().then(l.hitch(this,function(a){var e=[];f.forEach(a.tables,function(a){a.url=b.getUrl()+"/"+a.id;a.id=b.id+"_"+a.id;a.title=this._getLayerTitle(a);(a=this._addTable(a,this._finalTableInfos))&&e.push(a)},this);this._onTableChange(e,"added")}))}},_getLayerTitle:function(a){if(a.title)return a.title;
if(l.getObject("_wabProperties.originalLayerName",!1,a))return a.name||a.id;var b=a.label||a.name||"";if(a.url){var e;e=a.url.indexOf("/FeatureServer");-1===e&&(e=a.url.indexOf("/MapServer"));-1===e&&(e=a.url.indexOf("/service"));-1<e&&(e=a.url.substring(0,e),e=e.substring(e.lastIndexOf("/")+1,e.length),b=b?e+" - "+b:e)}return b||a.id},_findLayerInfoByIdAndReturnTopLayer:function(a,e){var b,c=null;e||(e=this._finalLayerInfos);for(b=0;b<e.length;b++)if(c=e[b].findLayerInfoById(a)){c=e[b];break}return c},
_findLayerInfoById:function(a,e){var b,c=null;e||(e=this._finalLayerInfos);for(b=0;b<e.length&&!(c=e[b].findLayerInfoById(a));b++);return c},_findTopLayerInfoById:function(a){var b,e=null,c=this._finalLayerInfos.concat(this._finalTableInfos);for(b=0;b<c.length;b++)if(c[b].id===a){e=c[b];break}return e},_getTopLayerInfoIndexById:function(a){var b,e=-1;for(b=0;b<this._finalLayerInfos.length;b++)if(this._finalLayerInfos[b].id===a){e=b;break}return e},_clearAddedFlag:function(a){f.forEach(a,function(a){a._addedFlag=
!1})},_markFirstOrLastNode:function(){var a;if(this._finalLayerInfos.length){for(a=0;a<this._finalLayerInfos.length;a++)this._finalLayerInfos[a].isFirst=!1,this._finalLayerInfos[a].isLast=!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=!0;for(a=0;a<this._finalLayerInfos.length;a++)if(!this._finalLayerInfos[a].isGraphicLayer()){a&&(this._finalLayerInfos[a-1].isLast=!0);this._finalLayerInfos[a].isFirst=!0;break}}},_onReceiveBasemapGalleryeData:function(a,
e,c){"BasemapGallery"===a&&(this._basemapLayers.length=0,f.forEach(c,l.hitch(this,function(a){this._basemapLayers.push({layerObject:a,id:a.id})}),this),this.update(),this.emit("layerInfosChanged"))},_onBasemapChange:function(a){var b;for(b=this._basemapLayers.length=0;b<a.layers.length;b++)this._basemapLayers.push({layerObject:a.layer[b],id:a.layers[b].id})},_destroyLayerInfos:function(){f.forEach(this._finalLayerInfos,l.hitch(this,function(a){a.destroyLayerInfo()}))},_bindEvents:function(){var a,
e,c,g,p,k,r,h,f;a=d(this.map,"layer-add-result",l.hitch(this,this._onLayersChange,"added"));e=d(this.map,"layer-remove",l.hitch(this,this._onLayersChange,"removed"));r=m.subscribe("layerInfos/layerReorder",l.hitch(this,this._onLayerReorder));g=m.subscribe("layerInfos/layerInfo/isShowInMapChanged",l.hitch(this,this._onShowInMapChanged));p=m.subscribe("layerInfos/layerInfo/visibleChanged",l.hitch(this,this._onVisibleChanged));k=m.subscribe("layerInfos/layerInfo/filterChanged",l.hitch(this,this._onFilterChanged));
h=m.subscribe("layerInfos/layerInfo/rendererChanged",l.hitch(this,this._onRendererChanged));f=m.subscribe("layerInfos/layerInfo/opacityChanged",l.hitch(this,this._onOpacityChanged));c=d(this.map,"before-unload",l.hitch(this,function(){a.remove();e.remove();r.remove();g.remove();p.remove();k.remove();h.remove();c.remove();f.remove();this._destroyLayerInfos()}))},_onLayersChange:function(a,e){var b=null,c;e.error||"esri.layers.GraphicsLayer"===e.layer.declaredClass||"esri.layers.LabelLayer"===e.layer.declaredClass||
e.layer._basemapGalleryLayerType||("added"===a?(this.update(),b=this._findTopLayerInfoById(e.layer.id),c=this._findLayerInfoById(e.layer.id)):(b=this._findTopLayerInfoById(e.layer.id),c=this._findLayerInfoById(e.layer.id),c.destroyLayerInfo(),this.update()),this.emit("layerInfosChanged",b,a,c))},_onShowInMapChanged:function(a){this.emit("layerInfosIsShowInMapChanged",a)},_onVisibleChanged:function(a){this.emit("layerInfosIsVisibleChanged",a)},_onFilterChanged:function(a){this.emit("layerInfosFilterChanged",
a)},_onLayerReorder:function(a,e,c){this._reorderLayerInfosArray(a,e,c);this.emit("layerInfosReorder")},_onRendererChanged:function(a){this.emit("layerInfosRendererChanged",a)},_onOpacityChanged:function(a){this.emit("layerInfosOpacityChanged",a)},_initTablesInfos:function(){this._tableInfos=[];f.forEach(this._tables&&this._tables.reverse(),function(a){this._addTable(a,this._tableInfos)},this)},_initFinalTableInfos:function(){this._finalTableInfos=[];f.forEach(this._tableInfos,function(a){this._finalTableInfos.push(a)},
this)},_onTableChange:function(a,e){this.emit("tableInfosChanged",a,e)},_onUpdated:function(){this.emit("updated")}});c.getLayerInfoArrayByType=function(b,e){var g=new h,p=[],d=[];c.getInstance(b,b.iteminfo).then(function(b){b.traversal(function(a){var b=a.getLayerType();b.layerInfo=a;p.push(b)});a(p).then(function(a){f.forEach(a,function(a,b){e===a&&d.push(p[b].layerInfo)});g.resolve(d)})});return g};var r=!0,g=null,p=null,e=new h;c.getInstance=function(a,d){g&&g!==a&&(r=!0,p=g=null,e=new h);p?e.resolve(p):
r&&(r=!1,k.getInstance(a).init().then(l.hitch(this,function(){var b=new c(a,d.itemData);g=a;p=b;e.resolve(b)})));return e};c.getInstanceSync=function(){return p};return c})},"jimu/LayerInfos/LayerInfoFactory":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred"],function(n,f,l){var h=null,d=n(null,{constructor:function(){},init:function(){var d=new l;require("jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForGroup jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream".split(" "),
f.hitch(this,function(h,a,k,c,r,g,p,e,b,u,f,m,l){this.LayerInfoForCollection=h;this.LayerInfoForMapService=a;this.LayerInfoForKML=k;this.LayerInfoForGeoRSS=c;this.LayerInfoForDefault=r;this.LayerInfoForWMS=g;this.LayerInfoForGroup=p;this.LayerInfoForDefaultDynamic=e;this.LayerInfoForDefaultTile=b;this.LayerInfoForDefaultWMS=u;this.LayerInfoForDefaultTable=f;this.LayerInfoForDefaultImage=m;this.LayerInfoForDefaultStream=l;d.resolve()}));return d},create:function(d){if(d.featureCollection)return new this.LayerInfoForCollection(d,
this.map);if("esri.layers.KMLLayer"===d.layerObject.declaredClass)return new this.LayerInfoForKML(d,this.map);if("esri.layers.GeoRSSLayer"===d.layerObject.declaredClass)return new this.LayerInfoForGeoRSS(d,this.map);if("esri.layers.WMSLayer"!==d.layerObject.declaredClass||d.selfType){if("esri.layers.ArcGISDynamicMapServiceLayer"===d.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===d.layerObject.declaredClass)return new this.LayerInfoForMapService(d,this.map);if("esri.layers.ArcGISImageServiceLayer"===
d.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===d.layerObject.declaredClass)return new this.LayerInfoForDefaultImage(d,this.map);if("esri.layers.StreamLayer"===d.layerObject.declaredClass)return new this.LayerInfoForDefaultStream(d,this.map);"Table"===d.layerObject.type&&(d.selfType="table");switch(d.selfType){case "mapservice_dynamic_group":return new this.LayerInfoForGroup(d,this.map);case "mapservice_tiled_group":return new this.LayerInfoForGroup(d,this.map,!0);case "mapservice_dynamic":return new this.LayerInfoForDefaultDynamic(d,
this.map);case "mapservice_tiled":return new this.LayerInfoForDefaultTile(d,this.map);case "wms":return new this.LayerInfoForDefaultWMS(d,this.map);case "table":return new this.LayerInfoForDefaultTable(d,this.map);default:return new this.LayerInfoForDefault(d,this.map)}}else return new this.LayerInfoForWMS(d,this.map)}});d.getInstance=function(f){null===h&&(h=new d);f&&(h.map=f);return h};return d})},"jimu/dijit/AppStatePopup":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/mouse dojo/_base/fx dojo/Evented".split(" "),
function(n,f,l,h,d,m,q,a){var k=1E3,c=1E4;return n([f,a],{baseClass:"jimu-appstate-popup",declaredClass:"jimu.dijit.AppStatePopup",currentState:0,timeoutHandler:void 0,constructor:function(a){this.inherited(arguments);"animationDuration"in a&&(k=a.animationDuration);"autoCloseInterval"in a&&(c=a.autoCloseInterval)},postCreate:function(){window.appInfo.isRunInMobile&&h.addClass(this.domNode,"mobile");var a=h.create("div",{"class":"appstate-header"});h.create("div",{"class":"appstate-title",innerHTML:this.nls.title},
a);var g=h.create("div",{"class":"appstate-close"},a);h.place(a,this.domNode);a=h.create("div",{"class":"appstate-tips",innerHTML:this.nls.restoreMap});h.place(a,this.domNode);this.own(d(a,"click",l.hitch(this,function(){this.emit("applyAppState");this.hide()})));this.own(d(g,"click",l.hitch(this,function(){this.hide()})));this.own(d(this.domNode,m.enter,l.hitch(this,function(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)})));this.own(d(this.domNode,m.leave,
l.hitch(this,function(){1!==this.currentState||this.timeoutHandler||(this.timeoutHandler=setTimeout(l.hitch(this,this.hide),c))})))},show:function(){q.animateProperty({node:this.domNode,duration:k,properties:window.appInfo.isRunInMobile?{top:{start:-120,end:0}}:{bottom:{start:-100,end:10}},onEnd:l.hitch(this,function(){this.currentState=1})}).play();this.timeoutHandler=setTimeout(l.hitch(this,this.hide),c)},hide:function(){0!==this.currentState&&q.animateProperty({node:this.domNode,duration:k,properties:window.appInfo.isRunInMobile?
{top:{start:0,end:-120}}:{bottom:{start:10,end:-100}},onEnd:l.hitch(this,function(){this.currentState=0;h.setStyle(this.domNode,"display","none")})}).play()}})})},"jimu/MapUrlParamsHandler":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/topic dojo/promise/all esri/geometry/Point esri/geometry/Extent esri/geometry/scaleUtils esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/graphic esri/layers/GraphicsLayer esri/InfoTemplate esri/tasks/query ./utils ./LayerInfos/LayerInfos ./shareUtils".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y){function z(a,b){var e=a.center.split(";");1===e.length&&(e=a.center.split(","));if(2===e.length||3===e.length){var c=parseFloat(e[0]),g=parseFloat(e[1]);if(isNaN(c)||isNaN(g))c=parseFloat(e[0]),g=parseFloat(e[1]);if(!isNaN(c)&&!isNaN(g)){var d=4326;3!==e.length||isNaN(e[2])||(d=parseInt(e[2],10));e=new m(c,g,new k(d));Q(e.spatialReference,b.spatialReference)?b.centerAt(e):K(e,b.spatialReference,function(a){b.centerAt(a[0])},function(){console.error("Project center point error.")})}}}
function x(a,b){var e=a.extent.split(";");1===e.length&&(e=a.extent.split(","));if(4===e.length||5===e.length){var c=parseFloat(e[0]),g=parseFloat(e[1]),d=parseFloat(e[2]),p=parseFloat(e[3]);if(isNaN(c)||isNaN(c)||isNaN(c)||isNaN(c))c=parseFloat(e[0]),g=parseFloat(e[1]),d=parseFloat(e[2]),p=parseFloat(e[3]);if(isNaN(c)||isNaN(g)||isNaN(d)||isNaN(p))console.error("Wrong extent parameters.");else{var r=4326;5!==e.length||isNaN(e[4])||(r=parseInt(e[4],10));e=new q(c,g,d,p,new k({wkid:r}));Q(b.spatialReference,
e.spatialReference)?b.setExtent(e):K(e,b.spatialReference,function(a){b.setExtent(a[0])},function(){console.error("Project extent error.")})}}else console.error("Wrong extent parameters.")}function A(a,b){var e=null;if(a.markertemplate){e={title:"",content:"",isIncludeShareUrl:!1};try{var c=JSON.parse(decodeURIComponent(a.markertemplate));n.mixin(e,c)}catch(T){console.error("urlParams: \x26markertemplate JSON.parse error."+T.stack)}}c=a.marker.split(";");1===c.length&&(c=a.marker.split(","));if(2<=
c.length&&6>=c.length&&c[0].length&&!isNaN(c[0])&&c[1].length&&!isNaN(c[1])){var g=parseFloat(c[0]),d=parseFloat(c[1]),r=4326;3<=c.length&&c[2].length&&!isNaN(c[2])&&(r=parseInt(c[2],10));var u="";4<=c.length&&(u=c[3]);var h=null;5<=c.length&&0===c[4].indexOf("http")&&(h=c[4]);var f=null;6===c.length&&(f=c[5]);var t=p.fromJson({type:"esriPMS",url:h,contentType:"image/png"}),q=null;f&&(q=p.fromJson({color:[0,0,0,255],type:"esriTS",verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,xoffset:0,
yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:f}));F(t).then(function(){var a=new m(g,d,new k({wkid:r}));Q(a.spatialReference,b.spatialReference)?B(a,t,q,u,e,b):K(a,b.spatialReference,function(a){B(a[0],t,q,u,e,b)},function(){console.error("Project center point error.")})})}}function B(a,c,g,d,p,k){d=new u("",d);if(p){var r=p.content;p.isIncludeShareUrl&&(p={title:p.title},n.mixin(p,a),p=y.getShareUrl(k,p,r,!0),p=y.getShareUrlContent(p),r+=p);d.setContent(r)}r=
new b({id:"marker-feature-action-layer"});k.addLayer(r);d=new e(a,c,null,d);r.add(d);g&&(g.xoffset=c.width/2,g.yoffset=c.height/2+c.yoffset,c=new e(new m(a.toJson()),g),r.add(c),d._textSymbol=c);k.centerAt(a)}function F(a){var b=new l;a.url?v.getImagesSize(a.url).then(function(e){a.width=e[0];a.height=e[1];b.resolve(a)},function(){a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png";a.width=26;a.height=26;a.setOffset(0,a.height/2);b.resolve(a)}):(a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png",
a.width=26,a.height=26,a.setOffset(0,a.height/2),b.resolve(a));return b}function E(a,b){var e=a.query.split(";");1===e.length&&(e=a.query.split(","));if(2!==e.length&&3!==e.length)console.error("query URL parameter is not correct.");else{var c=e[0];I("name",c,b).then(function(a){null===a?I("id",c,b).then(function(a){null===a?console.error("Invalid layer name or id."):C(b,a,e)}):C(b,a,e)})}}function C(b,e,c){var g=new t,d="";g.outSpatialReference=b.spatialReference;if(2===c.length)g.where=c[1];else if(3===
c.length&&(e.layerObject.url&&v.isHostedService(e.layerObject.url)&&v.containsNonLatinCharacter(c[2])&&(d="N"),f.forEach(e.layerObject.fields,function(a){if(a.alias.toLowerCase()===c[1].toLowerCase()||a.name.toLowerCase()===c[1].toLowerCase())-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeOID"].indexOf(a.type)?g.where=a.name+"\x3d"+c[2]:-1<["esriFieldTypeString"].indexOf(a.type)&&(g.where=c[1]+"\x3d"+d+"'"+c[2].replace(/\'/g,"''")+
"'")},this),!g.where)){console.error("Invalid field name or type in query URL parameter.");return}e.layerObject.selectFeatures(g).then(function(c){if(0===c.length)console.log("No result from query URL parameter.");else{if("esriGeometryPoint"===e.layerObject.geometryType&&1===c.length)b.setExtent(a.getExtentForScale(b,1E3)),b.centerAt(c[0].geometry);else{var g=v.graphicsExtent(c);b.setExtent(g)}G(b,e,c)}},function(a){console.error(a)})}function G(a,b,e){function c(a){f.forEach(e,function(b){b.setInfoTemplate(a)})}
function g(){a.infoWindow.setFeatures(e);a.infoWindow.show(H(e[0]))}if(a.getLayer(b.layerInfo.id))g();else{var d=b.layerInfo.getInfoTemplate();d?(c(d),g()):b.layerInfo.loadInfoTemplate().then(function(a){c(a);g()})}}function H(a){a=a.geometry;if("point"!==a.type)if("multipoint"===a.type)a=a.getPoint(0);else if("polyline"===a.type)a=a.getExtent().getCenter();else if("polygon"===a.type)a=a.getExtent().getCenter();else if("extent"===a.type)a=a.getCenter();else return console.error("Can not get layer geometry type, unknow error."),
null;return a}function I(a,b,e){var c=new l,g=[];w.getInstance(e,e.itemInfo).then(function(e){e.traversal(function(e){if(c.isResolved())return!0;("id"===a&&e.id.toLowerCase()===b.toLowerCase()||"name"===a&&e.title.toLowerCase()===b.toLowerCase())&&g.push(d({layerType:e.getLayerType(),layerObject:e.getLayerObject()}).then(function(a){"FeatureLayer"===a.layerType&&c.resolve({layerInfo:e,layerObject:a.layerObject})},function(a){console.error("Find layer error from query URL parameter",a);c.resolve(null)}))});
d(g).then(function(){c.isResolved()||c.resolve(null)})});return c}function K(a,b,e,d){var p=[102113,102100,3857],k;4326===a.spatialReference.wkid&&O(p,b.wkid)?(a.ymin=Math.max(a.ymin,-89.99),a.ymax=Math.min(a.ymax,89.99),a=g.geographicToWebMercator(a),(d=a.spatialReference._getInfo())&&a.xmin>a.xmax&&(p=d.valid[1]-a.xmin,k=a.xmax-d.valid[0],p>k?a.xmax=d.valid[1]+k:a.xmin=d.valid[0]-p),a.spatialReference.wkid=b.wkid,e([a],null)):O(p,a.spatialReference.wkid)&&4326===b.wkid?(a=g.webMercatorToGeographic(a),
(d=a.spatialReference._getInfo())&&a.xmin>a.xmax&&(p=d.valid[1]-a.xmin,k=a.xmax-d.valid[0],p>k?a.xmax=d.valid[1]+k:a.xmin=d.valid[0]-p),e([a],null)):(p=new c,p.geometries=[a],p.outSR=b,r.defaults.geometryService.project(p,function(a){!(a&&0<a.length&&a[0]&&"extent"===a[0].type)||isNaN(a[0].xmin)||isNaN(a[0].ymin)||isNaN(a[0].xmax)||isNaN(a[0].ymax)?a&&0<a.length&&a[0]&&"point"===a[0].type&&!isNaN(a[0].x)&&!isNaN(a[0].y)&&e(a,null):e(a,null)},d))}function Q(a,b){var e=[102113,102100,3857];return a&&
b&&a.wkt===b.wkt&&(a.wkid===b.wkid||a.latestWkid&&a.latestWkid===b.wkid||b.latestWkid&&a.wkid===b.latestWkid||a.latestWkid&&a.latestWkid===b.latestWkid)||a&&b&&a.wkid&&b.wkid&&O(e,a.wkid)&&O(e,b.wkid)?!0:!1}function O(a,b){for(var e=a.length;e--;)if(a[e]===b)return!0;return!1}return{postProcessUrlParams:function(a,b){if("extent"in a)return x(a,b);if("center"in a)return z(a,b);if("marker"in a)return A(a,b);if("find"in a)h.publish("publishData","framework","framework",{searchString:a.find},!0);else if("query"in
a)return E(a,b)}}})},"jimu/shareUtils":function(){define("dojo/_base/lang esri/request dojo/promise/all jimu/shared/basePortalUrlUtils dojo/Deferred esri/lang jimu/portalUtils jimu/Role jimu/utils esri/urlUtils".split(" "),function(n,f,l,h,d,m,q,a,k,c){var r={getBaseHrefUrl:function(a){var c="HTML3D"===window.appInfo.appType?"webappviewer3d":"webappviewer",e="";window.isXT?e=window.location.protocol+"//"+window.location.host+window.appInfo.appPath:(e=k.urlToObject(window.location.href).query||{},
e=e.appid?a+"apps/"+c+"/index.html?appid\x3d"+e.appid:e.id?a+"apps/"+c+"/index.html?id\x3d"+e.id:k.getAppHref());return e},addQueryParamToUrl:function(a,d,e,b){a=c.urlToObject(a);a.query||(a.query={});a.query[d]=e;d=a.path;for(var g in a.query)e=a.query[g],!0===b&&(e=encodeURIComponent(e)),d=d===a.path?d+"?"+g+"\x3d"+e:d+"\x26"+g+"\x3d"+e;return d},removeQueryParamFromUrl:function(a,d,e){a=c.urlToObject(a);a.query&&delete a.query[d];d=a.path;for(var b in a.query){var g=a.query[b];!0===e&&(g=encodeURIComponent(g));
d=d===a.path?d+"?"+b+"\x3d"+g:d+"\x26"+b+"\x3d"+g}return d},getShareUrlContent:function(a){return"\x3cdiv class\x3d'marker-feature-action-popup'\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title jimu-float-leading'\x3e"+window.jimuNls.common.url+"\x3c/span\x3e\x3cinput type\x3d'text' class\x3d'jimu-float-leading' readonly\x3d'readonly' value\x3d"+a+"/\x3e\x3c/div\x3e\x3c/div\x3e"},getShareUrl:function(a,c,e,b){var g=r.getBaseHrefUrl(window.portalUrl),d="";c&&(c.x&&c.y&&c.spatialReference&&
c.spatialReference.wkid?d=c.x+","+c.y+","+c.spatialReference.wkid:c.longitude&&c.latitude&&(d=c.longitude+","+c.latitude+","));g=r.addQueryParamToUrl(g,"marker",d,!0);g=r.addQueryParamToUrl(g+",,,","markertemplate",encodeURIComponent(JSON.stringify({title:c.title,content:e,isIncludeShareUrl:b})));c=a.getLevel();return g="number"===typeof c&&-1!==c?r.addQueryParamToUrl(g,"level",a.getLevel(),!0):r.addQueryParamToUrl(g,"scale",a.getScale(),!0)},getXyContent:function(a){var c="\x3cdiv class\x3d'marker-feature-action-popup'\x3e";
a.longitude&&a.latitude?c+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+window.jimuNls.common.longitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+parseFloat(a.longitude).toFixed(4)+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+window.jimuNls.common.latitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+parseFloat(a.latitude).toFixed(4)+"\x3c/span\x3e\x3c/div\x3e":a.x&&a.y&&(c+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3ex\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+
parseFloat(a.x).toFixed(4)+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title'\x3ey\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+parseFloat(a.y).toFixed(4)+"\x3c/span\x3e\x3c/div\x3e");return c+"\x3c/div\x3e"},_isUserOwnTheApp:function(a){return a&&a.username&&a.username===window.appInfo.appOwner?!0:!1},getItemByUserAndItemId:function(a,c,e,b){var g=new d;b=h.getStandardPortalUrl(b);b=b+"/sharing/rest/content/users/"+(c?c.username?c.username:c.email:e.email);if(m.isDefined(a.folderId)&&
"/"!==a.folderId||m.isDefined(a.ownerFolder)&&"/"!==a.ownerFolder)b+="/"+(a.folderId||a.ownerFolder);b+="/items/"+a.id;f({url:b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(n.hitch(this,function(a){g.resolve(a)}),n.hitch(this,function(a){console.error(a);g.reject(a)}));return g},_getProfile:function(a,c){var e=new d,b=h.getUserUrl(c,a.owner);f({url:b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(n.hitch(this,function(a){e.resolve(a)}),n.hitch(this,
function(a){console.error(a);e.reject(a)}));return e},_unshareItemById:function(a,c,e){var b=new d;e=h.getStandardPortalUrl(e);e+="/sharing/rest/content/items/"+c+"/unshare";c={f:"json"};c=n.mixin(c,a);f({url:e,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(n.hitch(this,function(a){b.resolve(a)}),n.hitch(this,function(a){console.error(a);b.reject(a)}));return b},canSharePublic:function(a){return!a.selfUrl||!0!==a.canSharePublic&&!1!==a.canSharePublic?!0:a.canSharePublic},
unshareItemsByUser:function(a,c,e){var b=new d;e=h.getStandardPortalUrl(e);e+="/sharing/rest/content/users/"+a+"/unshareItems";a={f:"json"};a=n.mixin(a,c);f({url:e,handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(n.hitch(this,function(a){b.resolve(a)}),n.hitch(this,function(a){console.error(a);b.reject(a)}));return b},unshareItems:function(a,c,e){var b=new d;e=h.getStandardPortalUrl(e);e+="/sharing/rest/content/users/"+(c.owner||a.email)+"/unshareItems";a={f:"json"};a=n.mixin(a,
c);f({url:e,handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(n.hitch(this,function(a){b.resolve(a)}),n.hitch(this,function(a){console.error(a);b.reject(a)}));return b},shareItemsByUser:function(a,c,e){var b=new d;e=h.getStandardPortalUrl(e);e+="/sharing/rest/content/users/"+a+"/shareItems";a={f:"json"};a=n.mixin(a,c);f({url:e,handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(n.hitch(this,function(a){b.resolve(a)}),n.hitch(this,function(a){console.error(a);
b.reject(a)}));return b},shareItems:function(a,c,e){var b=new d;e=h.getStandardPortalUrl(e);e+="/sharing/rest/content/users/"+(c.owner||a.email)+"/shareItems";a={f:"json"};a=n.mixin(a,c);f({url:e,handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(n.hitch(this,function(a){b.resolve(a)}),n.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getItemsGroups:function(a,c){var e=new d,b=h.getStandardPortalUrl(c),b=b+("/sharing/rest/content/items/"+a.id+"/groups");f({url:b,
handleAs:"json",content:{f:"json"},callbackParamName:"callback"},{usePost:!0}).then(n.hitch(this,function(a){e.resolve(a)}),n.hitch(this,function(a){console.error(a);e.reject(a)}));return e},isSharedToPublic:function(a){return window.isXT?!1:null===a?!0:"undefined"!==typeof a&&"undefined"!==typeof a.item&&"undefined"!==typeof a.item.access&&"public"===a.item.access?!0:!1},isShowSocialMediaLinks:function(a){return window.isXT?!0:null===a?!0:"undefined"!==typeof a&&"undefined"!==typeof a.item&&"undefined"!==
typeof a.item.access&&"private"===a.item.access?!1:!0},getItemShareInfo:function(a){var c=new d,e="";if(window.isXT)return c.resolve(null);e=k.urlToObject(k.getAppHref()).query||{};e=e.id||e.appid;if("undefined"===typeof e||""===e)return c.resolve(null);q.getPortal(a).getItemById(e).then(n.hitch(this,function(a){var b={};b.item=a;b.item&&"undefined"===typeof b.item.sharing&&b.item.access&&(b.item.sharing={access:b.item.access});c.resolve(b)}),n.hitch(this,function(a){console.log(a);c.resolve(null)}));
return c},getShareInfo:function(a){var c=q.getPortal(a),e=new d,b="";if(window.isXT)return e.resolve(null);b=k.urlToObject(k.getAppHref()).query||{};b=b.id||b.appid;if("undefined"===typeof b||""===b)return e.resolve(null);l({getUser:c.getUser(),loadSelfInfo:c.loadSelfInfo(),getItem:c.getItemById(b)}).then(n.hitch(this,function(b){var c={};c.item=b.getItem;c.item&&c.item.ownerFolder&&c.item.ownerFolder.length&&"/"!==c.item.ownerFolder&&(c.item.folderId=c.item.ownerFolder);"undefined"===typeof c.item.sharing&&
c.item.access&&(c.item.sharing={access:c.item.access});c.user=b.getUser;r._setUserRole(b.loadSelfInfo,c);c.currentUser=c.user;c.isAdmin=!1;c.userRole&&(c.userRole.isAdmin()||c.userRole.isCustom()&&c.userRole.canUpdateOrgItems())?(c.isAdmin=!0,c.item.owner!==c.currentUser.name?r._getProfile(c.item,a).then(n.hitch(this,function(a){c.itemUser=a;c.itemUser.orgId!==c.currentUser.orgId&&(c.isAdmin=!1);e.resolve(c)})):(c.itemUser=c.currentUser,e.resolve(c))):(c.currentUser&&(c.itemUser=c.currentUser),e.resolve(c))}),
n.hitch(this,function(a){console.log(a);e.resolve(null)}));return e},_setUserRole:function(c,d){d.userPortalUrl=c.urlKey?c.urlKey+"."+c.customBaseUrl:this.portalUrl;!c||c.code||c.message||(d.organization=c);if(c&&c.user)d.userRole=new a({id:c.user.roleId?c.user.roleId:c.user.role,role:c.user.role}),d._isCustomRole=d.userRole.isCustom(),d._roleCanShareToGroup=d._isCustomRole&&d.userRole.canShareItemToGroup(),d._roleCanShareToOrg=d._isCustomRole&&d.userRole.canShareItemToOrg(),d._roleCanSharePublic=
d._isCustomRole&&d.userRole.canShareItemToPublic(),d._roleCanShare=d._roleCanShareToGroup||d._roleCanShareToOrg||d._roleCanShareToPublic,d._roleCanUpdateItems=d._isCustomRole&&d.userRole.canUpdateOrgItems(),d._roleCanShareOthersItemsToGroup=d._isCustomRole&&d.userRole.canShareOthersItemsToGroup(),d._roleCanShareOthersItemsToOrg=d._isCustomRole&&d.userRole.canShareOthersItemsToOrg(),d._roleCanShareOthersItemsToPublic=d._isCustomRole&&d.userRole.canShareOthersItemsToPublic(),d._roleCanShareOthersItems=
d._isCustomRole&&(d.userRole.canShareOthersItemsToGroup()||d.userRole.canShareOthersItemsToOrg()||d._roleCanShareOthersItemsToPublic),d._orgUserCanSharePublicOrOverride=d.organization&&(!0===d.organization.canSharePublic&&(!d._isCustomRole||d._roleCanSharePublic||d._roleCanShareOthersItemsToPublic)||d.userRole.isAdmin());else return!1},getItemById:function(a,c){var e=new d,b=h.getStandardPortalUrl(c),b=b+("/sharing/rest/content/items/"+a.id);f({url:b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(n.hitch(this,
function(a){e.resolve(a)}),n.hitch(this,function(a){console.error(a);e.reject(a)}));return e}};return r})},"jimu/PopupManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/topic dojo/on dojo/query ./FeatureActionManager ./utils ./dijit/FeatureActionPopupMenu ./RelatedRecordsPopupProjector".split(" "),function(n,f,l,h,d,m,q,a,k,c){var r=null,g=n(null,{mapManager:null,popupUnion:null,_relatedRecordsPopupProjector:null,constructor:function(a){f.mixin(this,a);this.popupMenu=
k.getInstance();this.isInited=!1;this.featureActionManager=q.getInstance();h.subscribe("mapLoaded",f.hitch(this,this.onMapLoadedOrChanged));h.subscribe("mapChanged",f.hitch(this,this.onMapLoadedOrChanged));h.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged));h.subscribe("widgetsActionsRegistered",f.hitch(this,this._onWidgetsActionsRegistered))},init:function(){this.popupUnion=this.mapManager.getMapInfoWindow();this.popupUnion.bigScreen&&this.popupUnion.mobile&&this.popupUnion.bigScreen.domNode&&
this.popupUnion.mobile.domNode&&!this.isInited&&(this._createPopupMenuButton(),this._bindSelectionChangeEvent(),this.isInited=!0)},_createPopupMenuButton:function(){this.popupMenuButtonDesktop&&l.destroy(this.popupMenuButtonDesktop);this.popupMenuButtonMobile&&l.destroy(this.popupMenuButtonMobile);this.popupMenuButtonDesktop=l.create("span",{"class":"popup-menu-button"},m(".actionList",this.popupUnion.bigScreen.domNode)[0]);var a=m("div.esriMobileInfoView.esriMobilePopupInfoView .esriMobileInfoViewItem").parent()[0],
a=l.create("div",{"class":"esriMobileInfoViewItem"},a);this.popupMenuButtonMobile=l.create("span",{"class":"popup-menu-button"},a);d(this.popupMenuButtonMobile,"click",f.hitch(this,this._onPopupMenuButtonClick));d(this.popupMenuButtonDesktop,"click",f.hitch(this,this._onPopupMenuButtonClick))},_onPopupMenuButtonClick:function(a){a=l.position(a.target);this.popupMenu.show(a)},_bindSelectionChangeEvent:function(){d(this.popupUnion.bigScreen,"selection-change",f.hitch(this,this._onSelectionChange));
d(this.popupUnion.mobile,"selection-change",f.hitch(this,this._onSelectionChange))},_onSelectionChange:function(a){(this.selectedFeature=a.target.getSelectedFeature())?(this.initPopupMenu([this.selectedFeature]),a=this.selectedFeature.getLayer(),(this.selectedFeature.infoTempalte||a&&a.infoTemplate)&&this._createRelatedRecordsPopupProjector(this.selectedFeature)):this._disablePopupMenu()},_disablePopupMenu:function(){l.addClass(this.popupMenuButtonDesktop,"disabled");l.addClass(this.popupMenuButtonMobile,
"disabled")},_enablePopupMenu:function(){l.removeClass(this.popupMenuButtonDesktop,"disabled");l.removeClass(this.popupMenuButtonMobile,"disabled")},initPopupMenu:function(c){if(c){var e=a.toFeatureSet(c);this.featureActionManager.getSupportedActions(e).then(f.hitch(this,function(a){var b="ZoomTo ShowPopup Flash ExportToCSV ExportToFeatureCollection ExportToGeoJSON ShowRelatedRecords SaveToMyContent".split(" ");a=a.filter(f.hitch(this,function(a){return 0>b.indexOf(a.name)}));0===a.length?this._disablePopupMenu():
this._enablePopupMenu();a=a.map(f.hitch(this,function(a){a.data=e;return a}));this.popupMenu.setActions(a)}))}else this._disablePopupMenu(),this.popupMenu.setActions([])},onMapLoadedOrChanged:function(){this.isInited=!1;this.init()},_onAppConfigChanged:function(){this.popupUnion&&(this.popupUnion.bigScreen&&this.popupUnion.bigScreen.hide&&(this.popupUnion.bigScreen.hide(),this.popupMenu.hide()),this.popupUnion.mobile&&this.popupUnion.mobile.hide&&(this.popupUnion.mobile.hide(),this.popupMenu.hide()))},
_onWidgetsActionsRegistered:function(){this.init()},_createRelatedRecordsPopupProjector:function(a){try{this._relatedRecordsPopupProjector&&this._relatedRecordsPopupProjector.domNode&&(this._relatedRecordsPopupProjector.destroy(),this._relatedRecordsPopupProjector=null),this._relatedRecordsPopupProjector=new c({originalFeature:a,popup:this.mapManager.map.infoWindow,popupManager:this})}catch(e){console.warn(e.message)}}});g.getInstance=function(a){null===r&&(r=new g({mapManager:a}));return r};return g})},
"jimu/FeatureActionManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Deferred dojo/promise/all ./featureActions/main ./utils".split(" "),function(n,f,l,h,d,m,q,a){var k=null,c=n(null,{constructor:function(){this._actions=[];window.isBuilder?(h.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),h.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(h.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),h.subscribe("mapChanged",f.hitch(this,
this._onMapChanged)));window.isBuilder?(h.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),h.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(h.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),h.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));this._registerFrameworkActions()},getAllActions:function(){return this._actions},getSupportedActions:function(a){a=this._getFeatureSet(a);var c=[];l.forEach(this._actions,
function(g){var e=this.testActionSupportFeature(g,a);e.action=g;c.push(e)},this);return m(c).then(f.hitch(this,function(a){return a.map(f.hitch(this,function(a,b){return{result:a,action:this._actions[b]}})).filter(function(a){return a.result}).map(function(a){return a.action})}))},testActionSupportFeature:function(a,c){c=this._getFeatureSet(c);var g;c.features&&0<c.features.length&&(g=c.features[0].getLayer());g=a.isFeatureSupported(c,g);var e=new d;g&&"function"===typeof g.then?g.then(function(a){e.resolve(a)},
function(a){console.error(a);e.resolve(!1)}):e.resolve(g);return e},registerAction:function(a){var c=new d;require([a.uri],f.hitch(this,function(g){var e=new g({map:this.map,appConfig:this.appConfig,label:a.label,name:a.name,widgetId:a.widgetId});l.some(this._actions,function(a){return e.name===a.name&&e.widgetId===a.widgetId})?(console.warn("Feature/FeatureSet action has been registered.",e.name),c.reject("Feature/FeatureSet action has been registered.",e.name)):(this._actions.push(e),c.resolve(e))}));
return c},removeActionsByWidgetId:function(a){this._actions=l.filter(this._actions,function(c){return c.widgetId!==a},this)},getActionsByWidgetId:function(a){return l.filter(this._actions,function(c){return c.widgetId===a},this)},getActionsByActionName:function(a){return l.filter(this._actions,function(c){return c.name===a},this)},registerWidgetFeatureActions:function(a){var c=new d;if(!a.featureActions||!a.uri)return c.resolve(),c;var k=[];l.forEach(a.featureActions,function(e){k.push(this.registerAction({uri:a.isRemote?
a.amdFolder+e.uri+".js":a.amdFolder+e.uri,widgetId:a.id,name:e.name,label:a.manifest["i18nLabels_featureAction_"+e.name][window.dojoConfig.locale]||a.manifest["i18nLabels_featureAction_"+e.name].defaultLabel}))},this);return m(k)},registerAllWidgetFeatureActions:function(a){var c=[];a.visitElement(f.hitch(this,function(a){a.uri&&a.visible&&c.push(this.registerWidgetFeatureActions(a))}));return m(c).then(function(){h.publish("widgetsActionsRegistered")})},_reRegisterWidgetActions:function(a){var c=
[];l.forEach(this.getAllActions(),function(c){var e=a.getConfigElementById(c.widgetId);"framework"===c.widgetId||e&&e.uri&&!1!==e.visible||this.removeActionsByWidgetId(c.widgetId)},this);a.visitElement(f.hitch(this,function(a){a.uri&&a.visible&&0===this.getActionsByWidgetId(a.id).length&&c.push(this.registerWidgetFeatureActions(a))}));0<c.length&&m(c).then(function(){h.publish("widgetsActionsRegistered")})},_registerFrameworkActions:function(){l.forEach(q,function(a){this.registerAction({uri:a.uri,
widgetId:"framework",label:window.jimuNls.featureActions[a.name],name:a.name})},this)},_getFeatureSet:function(c){return"[object Object]"===Object.prototype.toString.call(c)?c.features?c:a.toFeatureSet([c]):a.toFeatureSet(c)},_onAppConfigLoaded:function(a){this.appConfig=a=f.clone(a);this._setActionsAppConfig(a);this.registerAllWidgetFeatureActions(this.appConfig)},_onAppConfigChanged:function(a){this.appConfig=a=f.clone(a);this._reRegisterWidgetActions(this.appConfig);this._setActionsAppConfig(a)},
_onMapLoaded:function(a){this.map=a;this._setActionsMap(a)},_onMapChanged:function(a){this.map=a;this._setActionsMap(a)},_setActionsMap:function(a){l.forEach(this._actions,function(c){c.setMap(a)},this)},_setActionsAppConfig:function(a){l.forEach(this._actions,function(c){c.setAppConfig(a)},this)}});c.getInstance=function(){null===k&&(k=new c,window._featureActionManager=k);return k};return c})},"jimu/featureActions/main":function(){define("./ZoomTo ./PanTo ./Flash ./ShowPopup ./ExportToCSV ./ExportToFeatureCollection ./ExportToGeoJSON ./ShowStatistics ./CreateLayer ./AddMarker ./RemoveMarker ./SaveToMyContent".split(" "),
function(){return[{name:"ZoomTo",uri:"jimu/featureActions/ZoomTo"},{name:"PanTo",uri:"jimu/featureActions/PanTo"},{name:"Flash",uri:"jimu/featureActions/Flash"},{name:"ShowPopup",uri:"jimu/featureActions/ShowPopup"},{name:"ExportToCSV",uri:"jimu/featureActions/ExportToCSV"},{name:"ExportToFeatureCollection",uri:"jimu/featureActions/ExportToFeatureCollection"},{name:"ExportToGeoJSON",uri:"jimu/featureActions/ExportToGeoJSON"},{name:"ShowStatistics",uri:"jimu/featureActions/ShowStatistics"},{name:"CreateLayer",
uri:"jimu/featureActions/CreateLayer"},{name:"AddMarker",uri:"jimu/featureActions/AddMarker"},{name:"RemoveMarker",uri:"jimu/featureActions/RemoveMarker"},{name:"SaveToMyContent",uri:"jimu/featureActions/SaveToMyContent"}]})},"jimu/featureActions/ZoomTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(n,f,l){return n(f,{name:"ZoomTo",iconClass:"icon-zoomto",isFeatureSupported:function(h){return 0<h.features.length&&h.features[0].geometry},onExecute:function(h){l.featureAction.zoomTo(this.map,
h.features)}})})},"jimu/BaseFeatureAction":function(){define(["dojo/_base/declare","dojo/_base/lang"],function(n,f){return n(null,{name:void 0,label:void 0,iconFormat:"svg",iconClass:"",map:null,appConfig:{},widgetId:null,constructor:function(l){f.mixin(this,l)},isFeatureSupported:function(f,h){return!0},onExecute:function(f,h){},setMap:function(f){this.map=f},setAppConfig:function(f){this.appConfig=f},getIcon:function(f){return"framework"===this.widgetId?require.toUrl("jimu")+"/images/feature_actions/"+
this.name+"_"+f+"."+this.iconFormat:this.appConfig.getConfigElementById(this.widgetId).folderUrl+"images/"+this.name+"_"+f+"."+this.iconFormat}})})},"jimu/featureActions/PanTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(n,f,l){return n(f,{name:"PanTo",iconClass:"icon-panto",isFeatureSupported:function(h){return 0<h.features.length&&h.geometryType},onExecute:function(h){l.featureAction.panTo(this.map,h.features)}})})},"jimu/featureActions/Flash":function(){define(["dojo/_base/declare",
"dojo/_base/lang","../BaseFeatureAction","jimu/utils"],function(n,f,l,h){return n([l],{name:"Flash",iconClass:"icon-flash",isFeatureSupported:function(d,h){if(1>d.features.length||!h)return!1;var m=d.features[0],a=f.getObject("renderer.symbol",!1,h);return m&&m.geometry&&(m.symbol||a)&&this.map.getLayer(h.id)},onExecute:function(d,f){h.featureAction.flash(d&&d.features,f)}})})},"jimu/featureActions/ShowPopup":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(n,
f,l){return n([f],{name:"ShowPopup",iconClass:"icon-show-popup",isFeatureSupported:function(h,d){return h&&h.features&&1===h.features.length&&d&&d.infoTemplate},onExecute:function(h){l.featureAction.showPopup(this.map,h.features)}})})},"jimu/featureActions/ExportToCSV":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(n,f,l){return n(f,{name:"ExportToCSV",iconClass:"icon-export",isFeatureSupported:function(h){return 0<h.features.length},onExecute:function(h){h=
l.createDataSource({type:l.TYPE_FEATURESET,filename:"features",data:h});h.setFormat(l.FORMAT_CSV);h.download()}})})},"jimu/exportUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/graphic esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils jimu/LayerInfos/LayerInfos ./utils ./jsonConverters".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,
u){function t(a,e){var c="",g=e.length,d=a.length,k="",p="",r;try{l.forEach(a,function(a){c="string"===typeof a?c+k+a:c+k+(a.alias||a.name);k=","});for(var c=c+"\r\n",h=0;h<g;h++){k="";r=e[h];for(var f=0;f<d;f++){var u=a[f];(p=r["string"===typeof u?u:u.name])||"number"===typeof p||(p="");p&&("esriFieldTypeDate"===u.type?p=b.localizeDateByFieldInfo(p,u.fieldInfo):!u.fieldInfo||"esriFieldTypeDouble"!==u.type&&"esriFieldTypeSingle"!==u.type&&"esriFieldTypeInteger"!==u.type&&"esriFieldTypeSmallInteger"!==
u.type||(p=b.localizeNumberByFieldInfo(p,u.fieldInfo)));p&&/[",\r\n]/g.test(p)&&(p='"'+p.replace(/(")/g,'""')+'"');c=c+k+p;k=","}c+="\r\n"}return c}catch(O){return""}}var v={createDataSource:function(a){return a.type===v.TYPE_TABLE?new z(a):a.type===v.TYPE_FEATURESET?new y(a):null},TYPE_TABLE:"table",TYPE_FEATURESET:"FeatureSet",FORMAT_CSV:"CSV",FORMAT_FEATURESET:"FeatureSet",FORMAT_GEOJSON:"GeoJSON"},w=n(null,{filename:void 0,suffix:".txt",format:void 0,nls:void 0,constructor:function(){this.nls=
window.jimuNls.exportTo},getExportString:function(){},getSupportExportFormats:function(){},setFormat:function(a){this.format=a},download:function(){this.getExportString().then(f.hitch(this,function(a){var b=this.filename+this.suffix;10>dojo.isIE?saveTextAs(a,b,"utf-8"):(a=new Blob([a],{type:"text/plain;charset\x3dutf-8"}),saveAs(a,b))}))},exportToPortal:function(a,b){}}),y=n(w,{featureSet:null,constructor:function(a){this.inherited(arguments);this.featureSet=a.data;this.url=a.url;this.filename=a.filename},
getExportString:function(){if(this.format===v.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();if(this.format===v.FORMAT_FEATURESET)return this.suffix=".json",this._getAsFeatureSetString();if(this.format===v.FORMAT_GEOJSON)return this.suffix=".geojson",this._getAsGeoJsonString();var a=new d;a.resolve("");return a},getSupportExportFormats:function(){return[{value:v.FORMAT_CSV,label:this.nls.toCSV},{value:v.FORMAT_FEATURESET,label:this.nls.toFeatureCollection},{value:v.FORMAT_GEOJSON,label:this.nls.toGeoJSON}]},
_getFeatureSet:function(){var a=new d;if(this.featureSet)a.resolve(this.featureSet);else if(this.url){var b=new m;b.returnGeometry=!0;b.outFields=["*"];this.queryTask=new q(this.url);this.queryTask.execute(b,f.hitch(this,function(b){a.resolve(b)}),f.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getSpatialReference:function(a){if(a.spatialReference)return a.spatialReference;var b;l.some(a.features,function(a){if(a.geometry&&a.geometry.spatialReference)return b=a.geometry.spatialReference,
!0});return b},_projectToWGS84:function(e){var h=new d,f=this._getSpatialReference(e);if(f)if(4326===parseInt(f.wkid,10))h.resolve(e);else if(f.isWebMercator()){var f=new a,u=[];l.forEach(e.features,function(a){var b=new k;b.attributes=a.attribues;b.geometry=p.webMercatorToGeographic(a.geometry);u.push(b)});f.features=u;h.resolve(f)}else{f=new r;f.geometries=l.map(e.features,function(a){return a.geometry});f.outSR=new c(4326);var m=g&&g.defaults&&g.defaults.geometryService;m&&"esri.tasks.GeometryService"===
m.declaredClass||(m=b.getArcGISDefaultGeometryService());m.project(f).then(function(b){var c=new a,g=[];l.forEach(e.features,function(a,e){var c=new k;c.attributes=a.attribues;c.geometry=b[e];g.push(c)});c.features=g;h.resolve(c)},function(a){console.error(a);h.resolve([])})}else h.resolve([]);return h},_getAsFeatureSetString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){var b="";a&&(a=a.toJson())&&(b=h.stringify(a));return b}))},_getAsGeoJsonString:function(){return this._getFeatureSet().then(f.hitch(this,
function(a){return this._projectToWGS84(a)})).then(f.hitch(this,function(a){var b="";a&&(a=(new u.esriConverter).toGeoJson(a))&&(b=h.stringify(a));return b}))},_getAsCSVString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){var b="";a&&(b=this._createCSVFromFeatureSet(a));return b}))},_createCSVFromFeatureSet:function(a){var b=this._generateFields(a);a=l.map(a.features,function(a){return a.attributes});return t(b,a)},_generateFields:function(a){var b=a.features[0],c,g,d;b._layer&&
(c=b._layer.fields,d=b._layer.id);c=c||a.fields;if(d=e.getInstanceSync().getLayerInfoById(d)){var k=d.getPopupInfo();l.forEach(c,f.hitch(this,function(a){a.fieldInfo=this._findFieldInfo(k,a.name)}))}if(a.fieldAliases)for(g in a.fieldAliases)a.fieldAliases.hasOwnProperty(g)&&c.push({name:g,alias:a.fieldAliases[g]});if(!c||0===c.length)for(g in c=[],a=b.attributes,a)a.hasOwnProperty(g)&&c.push({name:g});return c},_findFieldInfo:function(a,b){if(!a)return null;var e;l.some(a.fieldInfos,function(a){if(a.fieldName===
b)return e=a,!0});return e}}),z=n(w,{table:null,constructor:function(a){this.inherited(arguments);this.table=a.data;this.url=a.url;this.filename=a.filename},getExportString:function(){if(this.format===v.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();var a=new d;a.resolve("");return a},getSupportExportFormats:function(){return[{value:v.FORMAT_CSV,label:this.nls.toCSV}]},_getTableData:function(){var a=new d;if(this.table)a.resolve(this.table);else if(this.url){var b=new m;b.outFields=["*"];
this.queryTask=new q(this.url);this.queryTask.execute(b,f.hitch(this,function(b){var e={};e.fields=b.fields;e.datas=l.map(b.features,function(a){return a.attributes});a.resolve(e)}),f.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getAsCSVString:function(){return this._getTableData().then(f.hitch(this,function(a){var b="";a&&(b="\ufeff"+t(a.fields,a.datas));return b}))}});return v})},"jimu/jsonConverters":function(){(function(){function n(d){var h=0,a=0,k=d.length,c=d[a],
r;for(a;a<k-1;a++)r=d[a+1],h+=(r[0]-c[0])*(r[1]+c[1]),c=r;return 0<=h}function f(){function d(a){var d,c,r;if(a){if((a.x&&"NaN"!==a.x||0===a.x)&&(a.y&&"NaN"!==a.y||0===a.y))r="Point",c=[a.x,a.y];else if(a.points&&a.points.length)r="MultiPoint",c=a.points;else if(a.paths&&a.paths.length)a=a.paths,1===a.length?(r="LineString",c=a[0]):(r="MultiLineString",c=a);else if(a.rings&&a.rings.length){r=[];a=a.rings;for(d=0;d<a.length;d++)c=a[d],n(c)?r.push([c]):0<r.length&&r[r.length-1].push(c);1<r.length?(c=
r,r="MultiPolygon"):(c=r.pop(),r="Polygon")}d=c&&r?{type:r,coordinates:c}:null}return d}function h(a){var k=null,c,r;if(a&&(k={type:"Feature"},a.geometry&&(k.geometry=d(a.geometry)),a.attributes)){r={};for(c in a.attributes)r[c]=a.attributes[c];k.properties=r}return k}return{toGeoJson:function(a){var k,c,r;if(a)if(a.features)for(k={type:"FeatureCollection",features:[]},c=a.features,a=0;a<c.length;a++)(r=h(c[a]))&&k.features.push(r);else k=a.geometry?h(a):d(a);return k}}}function l(){function d(a){var c,
g;if("Point"===a)c="esriGeometryPoint";else if("MultiPoint"===a)c="esriGeometryMultipoint",g="points";else if("LineString"===a||"MultiLineString"===a)c="esriGeometryPolyline",g="paths";else if("Polygon"===a||"MultiPolygon"===a)c="esriGeometryPolygon",g="rings";return{type:c,geomHolder:g}}function h(a){var c,g,d=[],e;c=0;for(g=a.length;c<g;c++)e=a[c],0===c!==n(e)&&(e=e.reverse()),d.push(e);return d}function a(a){var c,g,k,e,b;if("GeometryCollection"===a.type)for(g=[a.geometries.shift()],c=d(g[0].type),
k=0;k<a.geometries.length;k++){e=c.type;b=a.geometries[k].type;var f=!1;"esriGeometryPoint"!==e&&"esriGeometryMultipoint"!==e||"Point"!==b&&"MultiPoint"!==b?"esriGeometryPolyline"!==e||"LineString"!==b&&"MultiLineString"!==b?"esriGeometryPolygon"!==e||"Polygon"!==b&&"MultiPolygon"!==b||(f=!0):f=!0:f=!0;f&&g.push(a.geometries[k])}else c=d(a.type),g=[a];"esriGeometryPoint"===c.type&&1<g.length&&(c=d("MultiPoint"));a={spatialReference:{wkid:4326}};if("esriGeometryPoint"===c.type)0===g[0].coordinates.length?
(a.x=null,a.y=null):(a.x=g[0].coordinates[0],a.y=g[0].coordinates[1]);else for(a[c.geomHolder]=[],k=0;k<g.length;k++){e=g[k];var m=f=b=void 0;if("MultiPoint"===e.type||"MultiLineString"===e.type)m=e.coordinates;else if("Point"===e.type||"LineString"===e.type)m=[e.coordinates];else if("Polygon"===e.type)m=h(e.coordinates);else if("MultiPolygon"===e.type)for(m=[],b=0,f=e.coordinates.length;b<f;b++)m.push(h(e.coordinates[b])[0]);b=m;for(e=0;e<b.length;e++)a[c.geomHolder].push(b[e])}return a}function k(c){var d,
g,k;if(c&&(d={},c.geometry&&(d.geometry=a(c.geometry)),c.properties)){k={};for(g in c.properties)k[g]=c.properties[g];d.attributes=k}return d}return{toEsri:function(c){var d,g,p;if(c)if("FeatureCollection"===c.type)for(d={features:[]},g=c.features,c=0;c<g.length;c++)(p=k(g[c]))&&d.features.push(p);else d="Feature"===c.type?k(c):a(c);return d}}}var h;h="undefined"!==typeof exports&&null!==exports?exports:this;if("function"===typeof define){var d={esriConverter:f,geoJsonConverter:l};define([],function(){return d})}else h.esriConverter=
f,h.geoJsonConverter=l}).call(this)},"jimu/featureActions/ExportToFeatureCollection":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(n,f,l){return n(f,{name:"ExportToFeatureCollection",iconClass:"icon-export",isFeatureSupported:function(h){return 0<h.features.length&&h.features[0].geometry},onExecute:function(h){h=l.createDataSource({type:l.TYPE_FEATURESET,filename:"features",data:h});h.setFormat(l.FORMAT_FEATURESET);h.download()}})})},"jimu/featureActions/ExportToGeoJSON":function(){define(["dojo/_base/declare",
"../BaseFeatureAction","../exportUtils"],function(n,f,l){return n(f,{name:"ExportToGeoJSON",iconClass:"icon-export",isFeatureSupported:function(h){return 0<h.features.length&&h.features[0].geometry},onExecute:function(h){h=l.createDataSource({type:l.TYPE_FEATURESET,filename:"features",data:h});h.setFormat(l.FORMAT_GEOJSON);h.download()}})})},"jimu/featureActions/ShowStatistics":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/dijit/FieldStatistics"],function(n,f,l){return n(f,
{iconClass:"icon-statistics",isFeatureSupported:function(h,d){return 1<h.features.length&&d&&"esri.layers.GraphicsLayer"!==d.declaredClass&&0<this.getNumbericFields(d).length},onExecute:function(h,d){var f=new l,q={featureSet:h,layer:d,fieldNames:this.getNumbericFields(d).map(function(a){return a.name})};f.showContentAsPopup(q)},getNumbericFields:function(h){return h.fields.filter(function(d){return-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(d.type)})}})})},
"jimu/dijit/FieldStatistics":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/NodeList-manipulate dojo/when dijit/form/Select esri/lang jimu/dijit/Popup jimu/dijit/LoadingIndicator jimu/utils jimu/statisticsUtils".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b){return n([f],{statInfo:null,postMixInProperties:function(){this.nls=window.jimuNls.fieldStatistics;l.mixin(this.nls,window.jimuNls.common)},showContent:function(a){this.statInfo=
a;0!==this.statInfo.fieldNames.length&&(a=h.create("div",{className:"stat-container"},this.domNode),this._createFieldDom(a),1===this.statInfo.fieldNames.length&&(this.statInfo.fieldName=this.statInfo.fieldNames[0],this._showOneFieldStatContent(this.statInfo,a)))},showContentAsPopup:function(a){this.statInfo=a;this._statisticsPopup&&this._statisticsPopup.domNode&&this._statisticsPopup.close();this._statisticsPopup=null;this._statisticsPopup=new g({titleLabel:this.nls.statistics,content:this.domNode,
width:270,height:265,buttons:[{label:this.nls.ok}]});this.showContent(a)},_showOneFieldStatContent:function(a,e){var c;b.isStatFromServer(this.statInfo)&&(c=new p,c.placeAt(e),c.show());b.getStatisticsResult(this.statInfo).then(l.hitch(this,function(a){c&&c.destroy();q(".esriAGOTableStatistics",e).remove();a=this._createStatContent(a);h.place(a,e)}))},_getFieldAliaseFromStatInfo:function(a){if(this.statInfo.layer){var b=d.filter(this.statInfo.layer.fields,function(b){return b.name===a});return b[0]?
b[0].alias:""}return this.statInfo.featureSet.fieldAliases?this.statInfo.featureSet.fieldAliases[a]:a},_createFieldDom:function(a){var b;if(1<this.statInfo.fieldNames.length){b=h.create("div",{className:"header"},a);h.create("span",{innerHTML:this.nls.field+": "},b);var e=new c({options:this.statInfo.fieldNames.map(l.hitch(this,function(a){return{value:a,label:this._getFieldAliaseFromStatInfo(a)}})),style:{width:"150px"}});this.own(m(e,"change",l.hitch(this,function(b){this.statInfo.fieldName=b;this._showOneFieldStatContent(this.statInfo,
a)})));e.placeAt(b);this.statInfo.fieldName=this.statInfo.fieldNames[0];this._showOneFieldStatContent(this.statInfo,a)}else b=h.create("div",{className:"header",innerHTML:"\x3cspan\x3e"+this.nls.field+"\x3c/span\x3e: "+this._getFieldAliaseFromStatInfo(this.statInfo.fieldNames[0])},a);return b},_createStatContent:function(a){var b={},e="count sum min max ave stddev".split(" "),c,g,k,p,r,f,u,m;c=h.create("div",{className:"esriAGOTableStatistics",innerHTML:""});h.create("div",{className:"hzLine",innerHTML:""},
c);g=h.create("table",{className:"attrTable",innerHTML:"",style:{cellpadding:0,cellspacing:0}},c);for(r in a)a.hasOwnProperty(r)&&(b[r.toLowerCase()]=a[r]);r=b.countfield;m=b.sumfield||"";u=b.minfield||"";f=b.maxfield||"";a=b.avgfield||"";b=b.stddevfield||"";k=h.create("tbody",{},g);var q=this;d.forEach([r,m,u,f,a,b],function(a,b){""!==a&&(p=h.create("tr",{valign:"top"},k),h.create("td",{"class":"attrName",innerHTML:q.nls[e[b]]},p),h.create("td",{"class":"attrValue",innerHTML:a},p))});h.create("div",
{className:"break",innerHTML:""},c);return c}})})},"dojo/NodeList-manipulate":function(){define("./query ./_base/lang ./_base/array ./dom-construct ./dom-attr ./NodeList-dom".split(" "),function(n,f,l,h,d){function m(a){for(;a.childNodes[0]&&1==a.childNodes[0].nodeType;)a=a.childNodes[0];return a}function q(a,c){"string"==typeof a?(a=h.toDom(a,c&&c.ownerDocument),11==a.nodeType&&(a=a.childNodes[0])):1==a.nodeType&&a.parentNode&&(a=a.cloneNode(!1));return a}var a=n.NodeList;f.extend(a,{_placeMultiple:function(a,
c){for(var d="string"==typeof a||a.nodeType?n(a):a,g=[],k=0;k<d.length;k++)for(var e=d[k],b=this.length,f=b-1,m;m=this[f];f--)0<k&&(m=this._cloneNode(m),g.unshift(m)),f==b-1?h.place(m,e,c):e.parentNode.insertBefore(m,e),e=m;g.length&&(g.unshift(0),g.unshift(this.length-1),Array.prototype.splice.apply(this,g));return this},innerHTML:function(a){return arguments.length?this.addContent(a,"only"):this[0].innerHTML},text:function(a){if(arguments.length){for(var c=0,k;k=this[c];c++)1==k.nodeType&&d.set(k,
"textContent",a);return this}for(var g="",c=0;k=this[c];c++)g+=d.get(k,"textContent");return g},val:function(a){if(arguments.length){for(var c=f.isArray(a),d=0,g;g=this[d];d++){var k=g.nodeName.toUpperCase(),e=g.type,b=c?a[d]:a;if("SELECT"==k)for(k=g.options,e=0;e<k.length;e++){var h=k[e];h.selected=g.multiple?-1!=l.indexOf(a,h.value):h.value==b}else"checkbox"==e||"radio"==e?g.checked=g.value==b:g.value=b}return this}if((g=this[0])&&1==g.nodeType){a=g.value||"";if("SELECT"==g.nodeName.toUpperCase()&&
g.multiple){a=[];k=g.options;for(e=0;e<k.length;e++)h=k[e],h.selected&&a.push(h.value);a.length||(a=null)}return a}},append:function(a){return this.addContent(a,"last")},appendTo:function(a){return this._placeMultiple(a,"last")},prepend:function(a){return this.addContent(a,"first")},prependTo:function(a){return this._placeMultiple(a,"first")},after:function(a){return this.addContent(a,"after")},insertAfter:function(a){return this._placeMultiple(a,"after")},before:function(a){return this.addContent(a,
"before")},insertBefore:function(a){return this._placeMultiple(a,"before")},remove:a.prototype.orphan,wrap:function(a){if(this[0]){a=q(a,this[0]);for(var c=0,d;d=this[c];c++){var g=this._cloneNode(a);d.parentNode&&d.parentNode.replaceChild(g,d);m(g).appendChild(d)}}return this},wrapAll:function(a){if(this[0]){a=q(a,this[0]);this[0].parentNode.replaceChild(a,this[0]);a=m(a);for(var c=0,d;d=this[c];c++)a.appendChild(d)}return this},wrapInner:function(a){if(this[0]){a=q(a,this[0]);for(var c=0;c<this.length;c++){var d=
this._cloneNode(a);this._wrap(f._toArray(this[c].childNodes),null,this._NodeListCtor).wrapAll(d)}}return this},replaceWith:function(a){a=this._normalize(a,this[0]);for(var c=0,d;d=this[c];c++)this._place(a,d,"before",0<c),d.parentNode.removeChild(d);return this},replaceAll:function(a){a=n(a);for(var c=this._normalize(this,this[0]),d=0,g;g=a[d];d++)this._place(c,g,"before",0<d),g.parentNode.removeChild(g);return this},clone:function(){for(var a=[],c=0;c<this.length;c++)a.push(this._cloneNode(this[c]));
return this._wrap(a,this,this._NodeListCtor)}});a.prototype.html||(a.prototype.html=a.prototype.innerHTML);return a})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),function(n,f,l,
h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w){function y(b){return function(e){this._isLoaded?this.inherited(b,arguments):this.loadDropDown(a.hitch(this,b,e))}}var z=f("dijit.form._SelectMenu",p,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(k(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var b=!1,e=this.parentWidget.value;a.isArray(e)&&(e=
e[e.length-1]);e&&n.forEach(this.parentWidget._getChildren(),function(a){a.option&&e===a.option.value&&(b=!0,this.focusChild(a,!1))},this);b||this.inherited(arguments)}});d=f("dijit.form.Select"+(c("dojo-bidi")?"_NoBidi":""),[r,g,t],{baseClass:"dijitSelect dijitValidationTextBox",templateString:w,_buttonInputDisabled:c("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=a?a:0].value)}this.dropDown=new z({id:this.id+"_menu",parentWidget:this});h.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(c){if(c.value||c.label){var g=a.hitch(this,"_setValueAttr",c);c=new e({option:c,label:("text"===this.labelType?(c.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):c.label)||this.emptyLabel,
onClick:g,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:c.disabled||!1});c.focusNode.setAttribute("role","option");return c}return new b({ownerDocument:this.ownerDocument})},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(x){}},focusChild:function(a){a&&this.set("value",
a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=v.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,e,c){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{n.forEach(this._getChildren(),function(a){a.destroyRecursive()});
var b=new e({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(b)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);l.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?u.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):u.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);u.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=m.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(k(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[q.LEFT_ARROW];delete a[q.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);
h.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);u.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){u.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
c("dojo-bidi")&&(d=f("dijit.form.Select",d,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));d._Menu=z;d.prototype._onContainerKeydown=y("_onContainerKeydown");d.prototype._onContainerKeypress=y("_onContainerKeypress");return d})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p){return d("dijit.form._FormSelectWidget",p,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(k.isArrayLike(a))return n.map(a,"return this.getOptions(item);",this);k.isString(a)&&(a={value:a});k.isObject(a)&&(n.some(b,function(b,e){for(var c in a)if(!(c in b)||b[c]!=a[c])return!1;a=e;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){n.forEach(k.isArrayLike(a)?a:[a],function(a){a&&k.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(k.isArrayLike(a)?
a:[a]);n.forEach(a,function(a){a&&(this.options=n.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){n.forEach(k.isArrayLike(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),e;if(b)for(e in a)b[e]=a[e]},this);this._loadChildren()},setStore:function(e,b,c){a.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(e,b,c)},_deprecatedSetStore:function(a,b,c){var e=this.store;c=c||{};if(e!==a){for(var d;d=this._notifyConnections.pop();)d.remove();a.get||(k.mixin(a,{_oldAPI:!0,get:function(a){var b=new f;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,b){var e=new f(function(){c.abort&&c.abort()});e.total=new f;var c=this.fetch(k.mixin({query:a,onBegin:function(a){e.total.resolve(a)},
onComplete:function(a){e.resolve(a)},onError:function(a){e.reject(a)}},b));return new g(e)}}),a.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[l.after(a,"onNew",k.hitch(this,"_onNewItem"),!0),l.after(a,"onDelete",k.hitch(this,"_onDeleteItem"),!0),l.after(a,"onSet",k.hitch(this,"_onSetItem"),!0)]));this._set("store",a)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);c.query&&this._set("query",c.query);c.queryOptions&&this._set("queryOptions",c.queryOptions);a&&a.query&&(this._loadingStore=!0,this.onLoadDeferred=new f,this._queryRes=a.query(this.query,this.queryOptions),r(this._queryRes,k.hitch(this,function(e){if(this.sortByLabel&&!c.sort&&e.length)if(a.getValue)e.sort(h.createSortFunction([{attribute:a.getLabelAttributes(e[0])[0]}],a));else{var g=this.labelAttr;e.sort(function(a,b){return a[g]>b[g]?1:b[g]>
a[g]?-1:0})}c.onFetch&&(e=c.onFetch.call(this,e,c));n.forEach(e,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(k.hitch(this,function(a,b,e){b==e?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=e&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:b);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(e):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),k.hitch(this,function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)})));return e},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=k.isArrayLike(a)?n.map(a,function(a){return k.isObject(a)?a:{value:a}}):k.isObject(a)?[a]:[{value:a}];a=n.filter(this.getOptions(a),function(a){return a&&a.value});var e=this.getOptions()||[];this.multiple||a[0]&&a[0].value||!e.length||(a[0]=
e[0]);n.forEach(e,function(b){b.selected=n.some(a,function(a){return a.value===b.value})});e=n.map(a,function(a){return a.value});if("undefined"!=typeof e&&"undefined"!=typeof e[0]){var c=n.map(a,function(a){return a.label});this._setDisplay(this.multiple?c:c[0]);this.inherited(arguments,[this.multiple?e:e[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=n.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(n.forEach(this._getChildren(),function(a){a.destroyRecursive()}),n.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;n.forEach(this._getChildren(),function(e){var c=n.some(a,function(a){return e.option&&
a===e.option.value});c&&!b.multiple&&(b.focusedChild=e);q.toggle(e.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),c);e.domNode.setAttribute("aria-selected",c?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=n.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?n.map(n.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){b&&b.parent||this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,e=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:e?b.getIdentity(a):null,label:e,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);m.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?c("\x3e *",this.srcNodeRef).map(function(e){return"separator"===e.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:e.getAttribute("data-"+a._scopeName+"-value")||e.getAttribute("value"),
label:String(e.innerHTML),selected:e.getAttribute("selected")||!1,disabled:e.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);l.after(this,"onChange",k.hitch(this,"_updateSelection"));var a=this.store;a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(n){var f={};n.setObject("dojo.data.util.sorter",f);f.basicComparator=function(f,h){var d=-1;null===f&&(f=void 0);null===h&&(h=void 0);if(f==h)d=0;else if(f>h||null==f)d=1;return d};f.createSortFunction=function(l,h){function d(a,e,b,c){return function(g,d){var k=c.getValue(g,a),p=c.getValue(d,
a);return e*b(k,p)}}for(var m=[],q,a=h.comparatorMap,k=f.basicComparator,c=0;c<l.length;c++){q=l[c];var r=q.attribute;if(r){q=q.descending?-1:1;var g=k;a&&("string"!==typeof r&&"toString"in r&&(r=r.toString()),g=a[r]||k);m.push(d(r,q,g,h))}}return function(a,e){for(var b=0;b<m.length;){var c=m[b++](a,e);if(0!==c)return c}return 0}};return f})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(n,f,l){var h=function(d){function m(a){d[a]=
function(){var k=arguments,c=l(d,function(c){Array.prototype.unshift.call(k,c);return h(n[a].apply(n,k))});if("forEach"!==a||q)return c}}if(!d)return d;var q=!!d.then;q&&(d=f.delegate(d));m("forEach");m("filter");m("map");null==d.total&&(d.total=l(d,function(a){return a.length}));return d};f.setObject("dojo.store.util.QueryResults",h);return h})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(n,f,l,h){return n("dijit.DropDownMenu",
h,{templateString:l,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(d){this._moveToPopup(d);d.stopPropagation();d.preventDefault()},_onLeftArrow:function(d){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else d.stopPropagation(),d.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b){return f("dijit._MenuBase",[g,b,e,p],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){d.toggle(this.domNode,"dijitMenuActive",a);d.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(a){var b=r.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},postCreate:function(){var b=this,e="string"==typeof this.childSelector?this.childSelector:m.hitch(this,"childSelector");this.own(a(this.containerNode,a.selector(e,q.enter),function(){b.onItemHover(r.byNode(this))}),a(this.containerNode,a.selector(e,q.leave),function(){b.onItemUnhover(r.byNode(this))}),a(this.containerNode,a.selector(e,c),function(a){b.onItemClick(r.byNode(this),a);a.stopPropagation()}),
a(this.containerNode,a.selector(e,"focusin"),function(){b._onItemFocus(r.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,e,c){this.inherited(arguments);if(a&&(-1==c||a.popup&&1==c))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;if(a.popup){this.set("selected",a);this.set("activated",!0);var c=/^key/.test(b._origType||
b.type)||0==b.clientX&&0==b.clientY;this._openItemPopup(a,c)}else this.onExecute(),a._onClick?a._onClick(b):a.onClick(b)},_openItemPopup:function(b,c){if(b!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var e=b.popup;e.parentMenu=this;this.own(this._mouseoverHandle=a.once(e.domNode,"mouseover",m.hitch(this,"_onPopupHover")));var g=this;b._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){c&&
g.focusChild(b);g._cleanUp()},onExecute:m.hitch(this,"_cleanUp",!0),onClose:function(){g._mouseoverHandle&&(g._mouseoverHandle.remove(),delete g._mouseoverHandle)}},c);this.currentPopupItem=b}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(h.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(n,f,l,h,d,m,q,a,k,c){return f("dijit._KeyNavContainer",[k,c,a],{connectKeyNavHandlers:function(a,c){var g=this._keyNavCodes={},e=m.hitch(this,"focusPrev"),b=m.hitch(this,"focusNext");n.forEach(a,function(a){g[a]=e});n.forEach(c,function(a){g[a]=b});g[d.HOME]=m.hitch(this,"focusFirstChild");g[d.END]=m.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){h.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);n.forEach(this.getChildren(),
m.hitch(this,"_startupChild"))},addChild:function(a,c){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=
q.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(n,f,l,h,d,m,q,a){return f("dijit._KeyNavMixin",a,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);l.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var a=this._keyNavCodes={};a[h.HOME]=d.hitch(this,"focusFirstChild");a[h.END]=d.hitch(this,
"focusLastChild");a[this.isLeftToRight()?h.LEFT_ARROW:h.RIGHT_ARROW]=d.hitch(this,"_onLeftArrow");a[this.isLeftToRight()?h.RIGHT_ARROW:h.LEFT_ARROW]=d.hitch(this,"_onRightArrow");a[h.UP_ARROW]=d.hitch(this,"_onUpArrow");a[h.DOWN_ARROW]=d.hitch(this,"_onDownArrow")}var c=this,a="string"==typeof this.childSelector?this.childSelector:d.hitch(this,"childSelector");this.own(m(this.domNode,"keypress",d.hitch(this,"_onContainerKeypress")),m(this.domNode,"keydown",d.hitch(this,"_onContainerKeydown")),m(this.domNode,
"focus",d.hitch(this,"_onContainerFocus")),m(this.containerNode,m.selector(a,"focusin"),function(a){c._onChildFocus(q.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(a,c){a&&(this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild),a.set("tabIndex",this.tabIndex),a.focus(c?"end":"start"))},_onContainerFocus:function(a){a.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){l.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(a){l.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(a){a&&a!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),a.set("tabIndex",this.tabIndex),this.lastFocused=a,this._set("focusedChild",a))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(a,c,d,g){a&&this.focusChild(a)},_keyboardSearchCompare:function(a,c){var d=a.domNode,d=(a.label||(d.focusNode?
d.focusNode.label:"")||d.innerText||d.textContent||"").replace(/^\s+/,"").substr(0,c.length).toLowerCase();return c.length&&d==c?-1:0},_isFormElement:function(a){return"INPUT"===a.tagName||"TEXTAREA"===a.tagName||"SELECT"===a.tagName||"BUTTON"===a.tagName},_onContainerKeydown:function(a){if(!this._isFormElement(document.activeElement)){var c=this._keyNavCodes[a.keyCode];c?(c(a,this.focusedChild),a.stopPropagation(),a.preventDefault(),this._searchString=""):a.keyCode!=h.SPACE||!this._searchTimer||
a.ctrlKey||a.altKey||a.metaKey||(a.stopImmediatePropagation(),a.preventDefault(),this._keyboardSearch(a," "))}},_onContainerKeypress:function(a){this._isFormElement(document.activeElement)||a.charCode<=h.SPACE||a.ctrlKey||a.altKey||a.metaKey||(a.preventDefault(),a.stopPropagation(),this._keyboardSearch(a,String.fromCharCode(a.charCode).toLowerCase()))},_keyboardSearch:function(a,c){var k=null,g,p=0;d.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=c;var a=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;g=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var b=this.focusedChild||null;if(1==a||!b)if(b=this._getNextFocusableChild(b,1),!b)return;a=b;do{var d=this._keyboardSearchCompare(b,g);d&&0==p++&&(k=b);if(-1==d){p=-1;break}b=this._getNextFocusableChild(b,1)}while(b&&b!=a)})();this.onKeyboardSearch(k,a,g,p)},_onChildBlur:function(){},_getNextFocusableChild:function(a,c){var d=
a;do{if(a)a=this._getNext(a,c);else if(a=this[0<c?"_getFirst":"_getLast"](),!a)break;if(null!=a&&a!=d&&a.isFocusable())return a}while(a!=d);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(a,c){if(a)for(a=a.domNode;a;)if((a=a[0>c?"previousSibling":"nextSibling"])&&"getAttribute"in a){var d=q.byNode(a);if(d)return d}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g){q=n("dijit.MenuItem"+(m("dojo-bidi")?"_NoBidi":""),[a,k,c,r],{templateString:g,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var c="",b;b=a.search(/{\S}/);if(0<=b){var c=a.charAt(b+1),g=a.substr(0,b);a=a.substr(b+3);b=g+c+a;a=g+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+c+"\x3c/span\x3e"+a}else b=a;this.domNode.setAttribute("aria-label",b+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",c)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){!a||"label"in this.params||this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);l.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&l.set(this.accelKeyNode,"id",this.id+"_accel");f.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==m("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(p){}},_setSelected:function(a){h.toggle(this.domNode,
"dijitMenuItemSelected",a)},setLabel:function(a){d.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){d.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=
a?"":"none",this.accelKeyNode.innerHTML=a,l.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});m("dojo-bidi")&&(q=n("dijit.MenuItem",q,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return q})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(n,f){return n("dijit._Contained",null,{_getSibling:function(f){var h=this.getParent();return h&&h._getSiblingOfChild&&h._getSiblingOfChild(this,
"previous"==f?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var f=this.getParent();return f&&f.getIndexOfChild?f.getIndexOfChild(this):-1}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(n,f,l,h,d,m){return n("dijit.MenuSeparator",[l,h,d],{templateString:m,
buildRendering:function(){this.inherited(arguments);f.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"jimu/statisticsUtils":function(){define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),function(n,f,l,h,d,m,q,a,k){function c(a){var c;c=new d;c.outFields=[a.fieldName];c.outStatistics=[];c.geometry=a.geometry;var e=g(a);n.forEach(e,function(b){var e=new l;e.statisticType=
b;e.displayFeildName=a.fieldName;e.onStatisticField=a.fieldName;e.outStatisticFieldName=t[b];c.outStatistics.push(e)});c.where=a.filterExpression?a.filterExpression:a.layer.getDefinitionExpression()?a.layer.getDefinitionExpression():"1\x3d1";a.geometry&&(c.geometry=a.geometry);return(new h(a.layer.url)).execute(c).then(function(c){return c&&c.features&&0<c.features.length?(c=c.features[0].attributes,b(a,c),c):[]})}function r(a){var c={countField:0,sumField:0},e=g(a),d=0,k=0;a.featureSet.features.forEach(function(b){var g=
b.attributes[a.fieldName];null!==g&&"undefined"!==typeof g&&e.forEach(function(a){switch(a){case "count":c.countField++;break;case "sum":c.sumField+=g;break;case "min":c.minField="undefined"===typeof c.minField?g:Math.min(c.minField,g);break;case "max":c.maxField="undefined"===typeof c.maxField?g:Math.max(c.maxField,g);break;case "avg":d++,k+=g}})});if(0===d)return f({countField:0});c.avgField=0===d?"":k/d;var r=a.featureSet.features.filter(function(b){b=b.attributes[a.fieldName];return null===b||
"undefined"===typeof b?!1:!0}).map(function(b){return b.attributes[a.fieldName]});c.stddevField=p(r);b(a,c);return f(c)}function g(a){return a.statisticTypes&&0<a.statisticTypes.length?u.filter(function(b){return-1<a.statisticTypes.indexOf(b)}):u}function p(a){var b=a.length;if(1>=b)return 0;var c=0;a.forEach(function(a){c+=a});var e=c/b,g=0;a.forEach(function(a){g+=Math.pow(a-e,2)});return Math.sqrt(1/(b-1)*g)}function e(b){var c=a.getInstanceSync();return b.layer?c.getLayerOrTableInfoById(b.layer.id).loadInfoTemplate().then(function(a){var b=
{};a.info&&a.info.fieldInfos&&a.info.fieldInfos.forEach(function(a){b[a.fieldName]=a});return b}):f({})}function b(a,b){if(a.fieldInfos[a.fieldName])for(var c in b)"countField"!==c&&m.isDefined(b[c])&&(b[c]=null===b[c]||"undefined"===typeof b[c]?"":q.localizeNumberByFieldInfo(b[c],a.fieldInfos[a.fieldName]))}var u="count sum min max avg stddev".split(" "),t={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};k.getStatisticsResult=function(a){return e(a).then(function(b){a.fieldInfos=
b;if(a.featureSet)return r(a);if(a.layer){if(a.layer.url)return c(a);a.featureSet=q.toFeatureSet(a.layer.graphics);return r(a)}})};k.isStatFromServer=function(a){return a.layer&&a.layer.url};k.getStddevVal=p})},"jimu/featureActions/CreateLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/json dojo/on esri/layers/FeatureLayer esri/renderers/jsonUtils esri/symbols/jsonUtils ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/Search jimu/LayerInfos/LayerInfos jimu/utils".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p){return n(k,{name:"CreateLayer",iconClass:"icon-create-layer",isFeatureSupported:function(a){return 1<a.features.length&&a.features[0].geometry},onExecute:function(c,b){var e,g;e={layerDefinition:{geometryType:b.geometryType,fields:f.clone(b.fields),objectIdField:b.objectIdField},featureSet:c.toJson()};e=new m(e);(g=b._json?h.parse(b._json):null)&&g.drawingInfo&&g.drawingInfo.renderer?(g=g.drawingInfo.renderer,g=q.fromJson(g)):g=q.fromJson(b.renderer.toJson());e.setRenderer(g);
(g=b.getSelectionSymbol())&&e.setSelectionSymbol(a.fromJson(g.toJson()));this._popupAddLayer(e)},_popupAddLayer:function(a){var b,e=l.create("div",{style:"padding: 0 10px 0 10px;"}),g=(new r({placeholder:window.jimuNls.layerInfosMenu.labelLayer})).placeAt(e);l.setStyle(g.searchBtn,"display","none");var k=new c({content:e,titleLabel:window.jimuNls.featureActions.CreateLayer,width:525,height:180,buttons:[{label:window.jimuNls.common.ok,onClick:f.hitch(this,function(){a.name=p.stripHTML(g.getValue());
this._addLayerToMap(a);k.close();b&&b.remove&&b.remove()})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:f.hitch(this,function(){k.close();b&&b.remove&&b.remove()})}]});g.inputSearch.focus();k.disableButton(0);b=d(g.inputSearch,"keyup",function(){g.getValue()?k.enableButton(0):k.disableButton(0)})},_addLayerToMap:function(a){var b=g.getInstanceSync(),c=d(b,"layerInfosChanged",f.hitch(this,function(b){a.id===b.id&&(b.enablePopup(),c.remove())}));this.map.addLayer(a)}})})},
"jimu/dijit/Search":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/string","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(n,f,l,h,d){return n([h,d],{baseClass:"jimu-search",declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',
placeholder:"",onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&f.setAttr(this.inputSearch,"placeholder",this.placeholder)},getValue:function(){return l.trim(this.inputSearch.value)},doSearch:function(){if(this.onSearch)this.onSearch(this.getValue())},_onKeyDown:function(d){13===(void 0!==d.keyCode?d.keyCode:d.which)&&this.doSearch();d.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()}})})},
"jimu/featureActions/AddMarker":function(){define("dojo/_base/declare ../BaseFeatureAction esri/graphic esri/layers/GraphicsLayer esri/symbols/PictureMarkerSymbol esri/InfoTemplate jimu/shareUtils".split(" "),function(n,f,l,h,d,m,q){return n(f,{name:"AddMarker",iconClass:"icon-add",_markerLayer:null,isFeatureSupported:function(a){this._getMarkerLayer();return this._isSupportType(a)&&0<a.features.length&&a.features[0]&&a.features[0].geometry&&!1===this._isFeatureInMarkerFeatureActionLayer(a,this._markerLayer)},
onExecute:function(a,d){this._addMarker(a,d)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new h({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var a=this.map.snappingManager.layerInfos;a.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(a)}},_addMarker:function(a,k){var c=a.features[0].geometry,r={},
g=k.displayField||a.displayFieldName||k.objectIdField;r.title="";a.features[0].attributes&&g&&(r.title=a.features[0].attributes[g],r.title||(r.title=""));g={};if("point"===c.type)g=c;else if("polygon"===c.type||"polyline"===c.type||"multipoint"===c.type)g=c.getExtent().getCenter();g.getLongitude()&&g.getLatitude()?(r.longitude=g.getLongitude(),r.latitude=g.getLatitude()):g.x&&g.y&&(r.x=g.x,r.y=g.y);var p="";c&&c.spatialReference&&c.spatialReference.wkid&&(p=c.spatialReference.wkid);r.spatialReference=
{wkid:p};c=q.getXyContent(r);r=q.getShareUrl(this.map,r,c,!0);r=q.getShareUrlContent(r);r=c+r;c=new d(require.toUrl("jimu")+"/images/EsriBluePinCircle26.png");c.width=26;c.height=26;c.setOffset(0,c.height/2);g=new l(g,c,null,null);g._markerFeatureactionGraphic=a.features[0];g.infoTemplate=this._setInfoTemplate(r);this._markerLayer.add(g);this._closePopupWindow()},_setInfoTemplate:function(a){var d=new m;d.setContent(a);return d},_closePopupWindow:function(){this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},
_isFeatureInMarkerFeatureActionLayer:function(a,d){if(a.features[0]&&a.features[0]._graphicsLayer&&a.features[0]._graphicsLayer.id&&"marker-feature-action-layer"===a.features[0]._graphicsLayer.id)return!0;for(var c=0,k=a.features.length;c<k;c++){var g=a.features[c];if(d&&"undefined"!==typeof d.graphics)for(var p=0,e=d.graphics.length;p<e;p++){var b=d.graphics[p];if(b._markerFeatureactionGraphic&&(g===b||g===b._markerFeatureactionGraphic))return!0}}return!1},_isSupportType:function(a){return a&&a.geometryType?
(a=a.geometryType,"point"===a||"polygon"===a||"polyline"===a||"multipoint"===a):!1}})})},"jimu/featureActions/RemoveMarker":function(){define(["dojo/_base/declare","../BaseFeatureAction","esri/layers/GraphicsLayer"],function(n,f,l){return n(f,{name:"RemoveMarker",iconClass:"icon-close",_markerLayer:null,isFeatureSupported:function(f){this._getMarkerLayer();return 0<f.features.length&&f.geometryType&&f.features[0]&&f.features[0].geometry&&!0===this._isFeatureInMarkerFeatureActionLayer(f)},onExecute:function(f){this._removeMarker(f)},
_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new l({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var f=this.map.snappingManager.layerInfos;f.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(f)}},_removeMarker:function(f){f=f.features[0];f._textSymbol&&this._markerLayer.remove(f._textSymbol);this._markerLayer.remove(f);
this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(f){return f.features[0]&&f.features[0]._graphicsLayer&&f.features[0]._graphicsLayer.id?"marker-feature-action-layer"===f.features[0]._graphicsLayer.id:!1}})})},"jimu/featureActions/SaveToMyContent":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/graphicsUtils jimu/portalUtils jimu/portalUrlUtils jimu/Role jimu/dijit/Message ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/AddItemForm".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p){return n(r,{name:"SaveToMyContent",iconClass:"icon-save",isFeatureSupported:function(a){return 0>=a.features.length||!a.features[0].geometry?!1:this.checkPrivilege()},onExecute:function(a,b){var c=new p({appConfig:this.appConfig}),e=new g({content:c,titleLabel:window.jimuNls.featureActions.SaveToMyContent,width:525,height:220,buttons:[{label:window.jimuNls.common.ok,onClick:f.hitch(this,function(){c.showBusy();e.disableButton(0);c.validate().then(f.hitch(this,function(g){g.valid?
this._addItem(a,b,c):(c.hideBusy(),e.enableButton(0))}))})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:f.hitch(this,function(){e.close()})}]})},checkPrivilege:function(){var c=a.getStandardPortalUrl(this.appConfig.portalUrl);if((c=q.getPortal(c))&&c.haveSignIn())return this._hasPrivilege(c);c=new d;c.resolve(!1);return c},_hasPrivilege:function(a){return a.loadSelfInfo().then(f.hitch(this,function(a){if(a&&a.user){var b=new k({id:a.user.roleId?a.user.roleId:a.user.role,
role:a.user.role});a.user.privileges&&b.setPrivileges(a.user.privileges);return b.canCreateItem()&&b.canPublishFeatures()}return!1}),function(){return!1})},_addItem:function(a,b,g){var e=g.getName(),d=g.getFolderId(),k=g.popup;b=b||{};var p={name:b.name,type:b.type||"Feature Layer",displayField:b.displayField,description:b.description,copyrightText:b.copyright,geometryType:b.geometryType||a.geometryType,fields:b.fields||a.fields,objectIdField:b.objectIdField};a.features[0].geometry&&(b=m.graphicsExtent(a.features),
p.initialExtent=b,p.fullExtent=b);!p.objectIdField&&p.fields&&l.some(p.fields,function(a){if("esriFieldTypeOID"===a.type)return p.objectIdField=a.name,!0});a={layers:[{layerDefinition:p,featureSet:a.toJson()}]};g.addItem({name:e,title:e,type:"Feature Collection",typeKeywords:"WAB_created",text:h.stringify(a)},d).then(f.hitch(this,function(a){!0===a.success?k.close():(g.hideBusy(),k.enableButton(0),new c({message:a.error?a.error.message:""}))}),function(a){g.hideBusy();k.enableButton(0);new c({message:a.message})})}})})},
"jimu/dijit/AddItemForm":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/AddItemForm.html jimu/portalUtils jimu/portalUrlUtils dojo/data/ItemFileWriteStore dijit/form/ValidationTextBox dijit/form/FilteringSelect jimu/dijit/LoadingShelter".split(" "),function(n,f,l,h,d,m,q,a,k,c,r){return n([d,m,q],{baseClass:"jimu-item-form",templateString:a,appConfig:null,folderStore:null,
portalUser:null,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);var a=c.getStandardPortalUrl(this.appConfig.portalUrl);k.getPortal(a).getUser().then(f.hitch(this,function(a){this.portalUser=a;return a.getContent()})).then(f.hitch(this,function(a){this.folderStore=this._createFolderStore(a.folders,this.portalUser.username);this.itemFolder.set("store",this.folderStore);this.itemFolder.set("required",!0);this.itemFolder.set("searchAttr",
"name");this.itemFolder.set("displayedValue",this.portalUser.username)}))},getName:function(){return this.itemName.get("value")},getFolderId:function(){return this.itemFolder.item?this.folderStore.getValue(this.itemFolder.item,"id"):""},showBusy:function(){this.shelter.show()},hideBusy:function(){this.shelter.hide()},validate:function(){var a=new h;this.itemForm.validate()?a.resolve({valid:!0}):a.resolve({valid:!1,message:"param requried"});return a},addItem:function(a,c){if(this.portalUser)return this.portalUser.addItem(a,
c);var e=new h;e.resolve({error:{message:"portalUser is null"}});return e},_createFolderStore:function(a,c){var e=new r({data:{identifier:"id",label:"name",items:[]}});e.newItem({name:c,id:""});l.forEach(a,function(a){e.newItem({name:a.title,id:a.id})});return e}})})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),function(n,f,l,h,d,m,q){return f("dojo.data.ItemFileWriteStore",
m,{constructor:function(a){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=function(a){return q.toISOString(a,{zulu:!0})});a&&!1===a.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(a){if(!a)throw Error("assertion failed in ItemFileWriteStore");},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},
newItem:function(a,d){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=typeof a&&"undefined"!=typeof a)throw Error("newItem() was passed something other than an object");var c=null,k=this._getIdentifierAttribute();if(k===Number)c=this._arrayOfAllItems.length;else{c=a[k];if("undefined"===typeof c)throw Error("newItem() was not passed an identity for the new item");if(n.isArray(c))throw Error("newItem() was not passed an single-valued identity");}this._itemsByIdentity&&
this._assert("undefined"===typeof this._itemsByIdentity[c]);this._assert("undefined"===typeof this._pending._newItems[c]);this._assert("undefined"===typeof this._pending._deletedItems[c]);var g={};g[this._storeRefPropName]=this;g[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[c]=g,g[k]=[c]);this._arrayOfAllItems.push(g);k=null;if(d&&d.parent&&d.attribute){var k={item:d.parent,attribute:d.attribute,oldValue:void 0},p=this.getValues(d.parent,d.attribute);
if(p&&0<p.length){var e=p.slice(0,p.length);k.oldValue=1===p.length?p[0]:p.slice(0,p.length);e.push(g);this._setValueOrValues(d.parent,d.attribute,e,!1);k.newValue=this.getValues(d.parent,d.attribute)}else this._setValueOrValues(d.parent,d.attribute,g,!1),k.newValue=g}else g[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(g);this._pending._newItems[c]=g;for(var b in a){if(b===this._storeRefPropName||b===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");
c=a[b];n.isArray(c)||(c=[c]);g[b]=c;if(this.referenceIntegrity)for(p=0;p<c.length;p++)e=c[p],this.isItem(e)&&this._addReferenceToMap(e,g,b)}this.onNew(g,k);return g},_removeArrayElement:function(a,d){var c=l.indexOf(a,d);return-1!=c?(a.splice(c,1),!0):!1},deleteItem:function(a){this._assert(!this._saveInProgress);this._assertIsItem(a);var d=a[this._itemNumPropName],c=this.getIdentity(a);if(this.referenceIntegrity){var f=this.getAttributes(a);a[this._reverseRefMap]&&(a["backup_"+this._reverseRefMap]=
n.clone(a[this._reverseRefMap]));l.forEach(f,function(b){l.forEach(this.getValues(a,b),function(c){this.isItem(c)&&(a["backupRefs_"+this._reverseRefMap]||(a["backupRefs_"+this._reverseRefMap]=[]),a["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(c),attr:b}),this._removeReferenceFromMap(c,a,b))},this)},this);if(f=a[this._reverseRefMap])for(var g in f){var p=null;if(p=this._itemsByIdentity?this._itemsByIdentity[g]:this._arrayOfAllItems[g])for(var e in f[g]){var b=this.getValues(p,e)||[],
h=l.filter(b,function(a){return!(this.isItem(a)&&this.getIdentity(a)==c)},this);this._removeReferenceFromMap(a,p,e);h.length<b.length&&this._setValueOrValues(p,e,h,!0)}}}this._arrayOfAllItems[d]=null;a[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[c];this._pending._deletedItems[c]=a;a[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,a);this.onDelete(a);return!0},setValue:function(a,d,c){return this._setValueOrValues(a,d,c,!0)},setValues:function(a,
d,c){return this._setValueOrValues(a,d,c,!0)},unsetAttribute:function(a,d){return this._setValueOrValues(a,d,[],!0)},_setValueOrValues:function(a,d,c,f){this._assert(!this._saveInProgress);this._assertIsItem(a);this._assert(n.isString(d));this._assert("undefined"!==typeof c);var g=this._getIdentifierAttribute();if(d==g)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var g=this._getValueOrValues(a,d),k=this.getIdentity(a);if(!this._pending._modifiedItems[k]){var e=
{},b;for(b in a)e[b]=b===this._storeRefPropName||b===this._itemNumPropName||b===this._rootItemPropName?a[b]:b===this._reverseRefMap?n.clone(a[b]):a[b].slice(0,a[b].length);this._pending._modifiedItems[k]=e}k=!1;if(n.isArray(c)&&0===c.length){if(k=delete a[d],c=void 0,this.referenceIntegrity&&g){b=g;n.isArray(b)||(b=[b]);for(var r=0;r<b.length;r++)e=b[r],this.isItem(e)&&this._removeReferenceFromMap(e,a,d)}}else{k=n.isArray(c)?c.slice(0,c.length):[c];if(this.referenceIntegrity)if(g){b=g;n.isArray(b)||
(b=[b]);var h={};l.forEach(b,function(a){this.isItem(a)&&(a=this.getIdentity(a),h[a.toString()]=!0)},this);l.forEach(k,function(b){if(this.isItem(b)){var c=this.getIdentity(b);h[c.toString()]?delete h[c.toString()]:this._addReferenceToMap(b,a,d)}},this);for(r in h)this._removeReferenceFromMap(this._itemsByIdentity?this._itemsByIdentity[r]:this._arrayOfAllItems[r],a,d)}else for(r=0;r<k.length;r++)e=k[r],this.isItem(e)&&this._addReferenceToMap(e,a,d);a[d]=k;k=!0}if(f)this.onSet(a,d,g,c);return k},_addReferenceToMap:function(a,
d,c){d=this.getIdentity(d);var k=a[this._reverseRefMap];k||(k=a[this._reverseRefMap]={});(a=k[d])||(a=k[d]={});a[c]=!0},_removeReferenceFromMap:function(a,d,c){d=this.getIdentity(d);var k=a[this._reverseRefMap],g;if(k){for(g in k)g==d&&(delete k[g][c],this._isEmpty(k[g])&&delete k[g]);this._isEmpty(k)&&delete a[this._reverseRefMap]}},_dumpReferenceMap:function(){var a;for(a=0;a<this._arrayOfAllItems.length;a++){var d=this._arrayOfAllItems[a];d&&d[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(d)+
"] is referenced by: "+h.toJson(d[this._reverseRefMap]))}},_getValueOrValues:function(a,d){var c=void 0;this.hasAttribute(a,d)&&(c=this.getValues(a,d),c=1==c.length?c[0]:c);return c},_flatten:function(a){if(this.isItem(a))return{_reference:this.getIdentity(a)};if("object"===typeof a)for(var d in this._datatypeMap){var c=this._datatypeMap[d];if(n.isObject(c)&&!n.isFunction(c)){if(a instanceof c.type){if(!c.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+d+"]");
return{_type:d,_value:c.serialize(a)}}}else if(a instanceof c)return{_type:d,_value:a.toString()}}return a},_getNewFileContentString:function(){var a={},d=this._getIdentifierAttribute();d!==Number&&(a.identifier=d);this._labelAttr&&(a.label=this._labelAttr);a.items=[];for(d=0;d<this._arrayOfAllItems.length;++d){var c=this._arrayOfAllItems[d];if(null!==c){var f={},g;for(g in c)if(g!==this._storeRefPropName&&g!==this._itemNumPropName&&g!==this._reverseRefMap&&g!==this._rootItemPropName){var p=this.getValues(c,
g);if(1==p.length)f[g]=this._flatten(p[0]);else for(var e=[],b=0;b<p.length;++b)e.push(this._flatten(p[b])),f[g]=e}a.items.push(f)}}return h.toJson(a,!0)},_isEmpty:function(a){var d=!0;if(n.isObject(a))for(var c in a){d=!1;break}else n.isArray(a)&&0<a.length&&(d=!1);return d},save:function(a){this._assert(!this._saveInProgress);this._saveInProgress=!0;var k=this,c=function(){k._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};k._saveInProgress=!1;a&&a.onComplete&&a.onComplete.call(a.scope||
d.global)},f=function(c){k._saveInProgress=!1;a&&a.onError&&a.onError.call(a.scope||d.global,c)};if(this._saveEverything){var g=this._getNewFileContentString();this._saveEverything(c,f,g)}this._saveCustom&&this._saveCustom(c,f);this._saveEverything||this._saveCustom||c()},revert:function(){this._assert(!this._saveInProgress);for(var a in this._pending._modifiedItems){var d=this._pending._modifiedItems[a],c=null,c=this._itemsByIdentity?this._itemsByIdentity[a]:this._arrayOfAllItems[a];d[this._storeRefPropName]=
this;for(var f in c)delete c[f];n.mixin(c,d)}var g;for(a in this._pending._deletedItems)g=this._pending._deletedItems[a],g[this._storeRefPropName]=this,d=g[this._itemNumPropName],g["backup_"+this._reverseRefMap]&&(g[this._reverseRefMap]=g["backup_"+this._reverseRefMap],delete g["backup_"+this._reverseRefMap]),this._arrayOfAllItems[d]=g,this._itemsByIdentity&&(this._itemsByIdentity[a]=g),g[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(g);for(a in this._pending._deletedItems)g=this._pending._deletedItems[a],
g["backupRefs_"+this._reverseRefMap]&&(l.forEach(g["backupRefs_"+this._reverseRefMap],function(a){this._addReferenceToMap(this._itemsByIdentity?this._itemsByIdentity[a.id]:this._arrayOfAllItems[a.id],g,a.attr)},this),delete g["backupRefs_"+this._reverseRefMap]);for(a in this._pending._newItems)d=this._pending._newItems[a],d[this._storeRefPropName]=null,this._arrayOfAllItems[d[this._itemNumPropName]]=null,d[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,d),this._itemsByIdentity&&
delete this._itemsByIdentity[a];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(a){return a?(a=this.getIdentity(a),(new Boolean(this._pending._newItems[a]||this._pending._modifiedItems[a]||this._pending._deletedItems[a])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},onSet:function(a,d,c,f){},onNew:function(a,d){},onDelete:function(a){},close:function(a){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");
this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),function(n,f,l,h,d,m,q,a,k){l=l("dojo.data.ItemFileReadStore",[m],{constructor:function(a){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=a.url;this._jsonData=a.data;this.data=null;this._datatypeMap=a.typeMap||
{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(a){return k.fromISOString(a)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==a.urlPreventCache&&(this.urlPreventCache=a.urlPreventCache?!0:!1);void 0!==a.hierarchical&&(this.hierarchical=a.hierarchical?
!0:!1);a.clearOnClose&&(this.clearOnClose=!0);"failOk"in a&&(this.failOk=a.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(a){if(!this.isItem(a))throw Error(this.declaredClass+": Invalid item argument.");},_assertIsAttribute:function(a){if("string"!==typeof a)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(a,d,g){a=this.getValues(a,d);return 0<a.length?a[0]:g},getValues:function(a,
d){this._assertIsItem(a);this._assertIsAttribute(d);return(a[d]||[]).slice(0)},getAttributes:function(a){this._assertIsItem(a);var c=[],d;for(d in a)d!==this._storeRefPropName&&d!==this._itemNumPropName&&d!==this._rootItemPropName&&d!==this._reverseRefMap&&c.push(d);return c},hasAttribute:function(a,d){this._assertIsItem(a);this._assertIsAttribute(d);return d in a},containsValue:function(a,d,g){var c=void 0;"string"===typeof g&&(c=q.patternToRegExp(g,!1));return this._containsValue(a,d,g,c)},_containsValue:function(a,
d,g,k){return h.some(this.getValues(a,d),function(a){if(null!==a&&!f.isObject(a)&&k){if(a.toString().match(k))return!0}else if(g===a)return!0})},isItem:function(a){return a&&a[this._storeRefPropName]===this&&this._arrayOfAllItems[a[this._itemNumPropName]]===a?!0:!1},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(a){this._assertIsItem(a.item)},getFeatures:function(){return this._features},getLabel:function(a){if(this._labelAttr&&this.isItem(a))return this.getValue(a,this._labelAttr)},
getLabelAttributes:function(a){return this._labelAttr?[this._labelAttr]:null},filter:function(a,d,g){var c=[],e,b;if(a.query){var k;e=a.queryOptions?a.queryOptions.ignoreCase:!1;var f={};for(b in a.query)k=a.query[b],"string"===typeof k?f[b]=q.patternToRegExp(k,e):k instanceof RegExp&&(f[b]=k);for(e=0;e<d.length;++e){var h=!0,r=d[e];if(null===r)h=!1;else for(b in a.query)k=a.query[b],this._containsValue(r,b,k,f[b])||(h=!1);h&&c.push(r)}}else for(e=0;e<d.length;++e)b=d[e],null!==b&&c.push(b);g(c,a)},
_fetchItems:function(a,k,g){var c=this;if(this._loadFinished)this.filter(a,this._getItemsArray(a.queryOptions),k);else if(this._jsonFileUrl!==this._ccUrl?(n.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:a,
filter:f.hitch(c,"filter"),findCallback:f.hitch(c,k)});else{this._loadInProgress=!0;var e=d.get({url:c._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});e.addCallback(function(b){try{c._getItemsFromLoadedData(b),c._loadFinished=!0,c._loadInProgress=!1,c.filter(a,c._getItemsArray(a.queryOptions),k),c._handleQueuedFetches()}catch(t){c._loadFinished=!0,c._loadInProgress=!1,g(t,a)}});e.addErrback(function(b){c._loadInProgress=!1;g(b,a)});var b=null;a.abort&&
(b=a.abort);a.abort=function(){var c=e;c&&-1===c.fired&&(c.cancel(),c=null);b&&b.call(a)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,c.filter(a,this._getItemsArray(a.queryOptions),k)}catch(u){g(u,a)}else g(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),a)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var a=0;a<this._queuedFetches.length;a++){var d=
this._queuedFetches[a],g=d.args,k=d.filter,d=d.findCallback;k?k(g,this._getItemsArray(g.queryOptions),d):this.fetchItemByIdentity(g)}this._queuedFetches=[]}},_getItemsArray:function(a){return a&&a.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(a){this.clearOnClose&&this._loadFinished&&!this._loadInProgress&&(""!=this._jsonFileUrl&&null!=this._jsonFileUrl||""!=this.url&&null!=this.url||null!=this.data||console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),
this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(a){function c(a){return null!==a&&"object"===typeof a&&(!f.isArray(a)||k)&&!f.isFunction(a)&&(a.constructor==Object||f.isArray(a))&&"undefined"===typeof a._reference&&"undefined"===typeof a._type&&"undefined"===typeof a._value&&e.hierarchical}function d(a){e._arrayOfAllItems.push(a);for(var b in a){var g=a[b];if(g)if(f.isArray(g))for(var k=
0;k<g.length;++k){var p=g[k];c(p)&&d(p)}else c(g)&&d(g)}}var k=!1,e=this;this._labelAttr=a.label;var b,h;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=a.items;for(b=0;b<this._arrayOfTopLevelItems.length;++b)h=this._arrayOfTopLevelItems[b],f.isArray(h)&&(k=!0),d(h),h[this._rootItemPropName]=!0;var m={},q;for(b=0;b<this._arrayOfAllItems.length;++b)for(q in h=this._arrayOfAllItems[b],h){if(q!==this._rootItemPropName){var l=h[q];null!==l?f.isArray(l)||(h[q]=[l]):h[q]=[null]}m[q]=q}for(;m[this._storeRefPropName];)this._storeRefPropName+=
"_";for(;m[this._itemNumPropName];)this._itemNumPropName+="_";for(;m[this._reverseRefMap];)this._reverseRefMap+="_";if(m=a.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=m,b=0;b<this._arrayOfAllItems.length;++b)if(h=this._arrayOfAllItems[b],a=h[m],a=a[0],Object.hasOwnProperty.call(this._itemsByIdentity,a)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+
m+"].  Value collided: ["+a+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+m+"].  Value collided: ["+a+"]");}else this._itemsByIdentity[a]=h;else this._features["dojo.data.api.Identity"]=Number;for(b=0;b<this._arrayOfAllItems.length;++b)h=this._arrayOfAllItems[b],h[this._storeRefPropName]=this,h[this._itemNumPropName]=b;for(b=0;b<this._arrayOfAllItems.length;++b)for(q in h=this._arrayOfAllItems[b],
h)for(a=h[q],m=0;m<a.length;++m)if(l=a[m],null!==l&&"object"==typeof l){if("_type"in l&&"_value"in l){var y=l._type,z=this._datatypeMap[y];if(z)if(f.isFunction(z))a[m]=new z(l._value);else if(f.isFunction(z.deserialize))a[m]=z.deserialize(l._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+
y+"'");}if(l._reference){l=l._reference;if(f.isObject(l))for(y=0;y<this._arrayOfAllItems.length;++y){var z=this._arrayOfAllItems[y],x=!0,n;for(n in l)z[n]!=l[n]&&(x=!1);x&&(a[m]=z)}else a[m]=this._getItemByIdentity(l);this.referenceIntegrity&&(l=a[m],this.isItem(l)&&this._addReferenceToMap(l,h,q))}else this.isItem(l)&&this.referenceIntegrity&&this._addReferenceToMap(l,h,q)}},_addReferenceToMap:function(a,d,g){},getIdentity:function(a){var c=this._features["dojo.data.api.Identity"];return c===Number?
a[this._itemNumPropName]:(a=a[c])?a[0]:null},fetchItemByIdentity:function(a){var c,g;if(this._loadFinished)c=this._getItemByIdentity(a.identity),a.onItem&&(g=a.scope?a.scope:n.global,a.onItem.call(g,c));else{var k=this;this._jsonFileUrl!==this._ccUrl?(n.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=
this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:a}):(this._loadInProgress=!0,g=d.get({url:k._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),g.addCallback(function(e){var b=a.scope?a.scope:n.global;try{k._getItemsFromLoadedData(e),k._loadFinished=!0,k._loadInProgress=!1,c=k._getItemByIdentity(a.identity),a.onItem&&a.onItem.call(b,c),k._handleQueuedFetches()}catch(u){k._loadInProgress=
!1,a.onError&&a.onError.call(b,u)}}),g.addErrback(function(c){k._loadInProgress=!1;a.onError&&a.onError.call(a.scope?a.scope:n.global,c)})):this._jsonData&&(k._getItemsFromLoadedData(k._jsonData),k._jsonData=null,k._loadFinished=!0,c=k._getItemByIdentity(a.identity),a.onItem&&(g=a.scope?a.scope:n.global,a.onItem.call(g,c)))}},_getItemByIdentity:function(a){var c=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,a)&&(c=this._itemsByIdentity[a]):Object.hasOwnProperty.call(this._arrayOfAllItems,
a)&&(c=this._arrayOfAllItems[a]);void 0===c&&(c=null);return c},getIdentityAttributes:function(a){a=this._features["dojo.data.api.Identity"];return a===Number?null:[a]},_forceLoad:function(){var a=this;this._jsonFileUrl!==this._ccUrl?(n.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=
this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var k=d.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});k.addCallback(function(c){try{if(!0!==a._loadInProgress&&!a._loadFinished)a._getItemsFromLoadedData(c),a._loadFinished=!0;else if(a._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(p){throw console.log(p),p;}});k.addErrback(function(a){throw a;
})}else this._jsonData&&(a._getItemsFromLoadedData(a._jsonData),a._jsonData=null,a._loadFinished=!0)}});f.extend(l,a);return l})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(n){var f={};n.setObject("dojo.data.util.filter",f);f.patternToRegExp=function(f,h){for(var d="^",m=null,q=0;q<f.length;q++)switch(m=f.charAt(q),m){case "\\":d+=m;q++;d+=f.charAt(q);break;case "*":d+=".*";break;case "?":d+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":d+=
"\\";default:d+=m}d+="$";return h?new RegExp(d,"mi"):new RegExp(d,"m")};return f})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(n,f,l){var h={};n.setObject("dojo.data.util.simpleFetch",h);h.errorHandler=function(d,h){h.onError&&h.onError.call(h.scope||f.global,d,h)};h.fetchHandler=function(d,h){var m=h.abort||null,a=!1,k=h.start?h.start:0,c=h.count&&Infinity!==h.count?k+h.count:d.length;h.abort=function(){a=!0;m&&m.call(h)};var r=h.scope||
f.global;h.store||(h.store=this);h.onBegin&&h.onBegin.call(r,d.length,h);h.sort&&d.sort(l.createSortFunction(h.sort,this));if(h.onItem)for(var g=k;g<d.length&&g<c;++g){var p=d[g];a||h.onItem.call(r,p,h)}h.onComplete&&!a&&(g=null,h.onItem||(g=d.slice(k,c)),h.onComplete.call(r,g,h))};h.fetch=function(d){d=d||{};d.store||(d.store=this);this._fetchItems(d,n.hitch(this,"fetchHandler"),n.hitch(this,"errorHandler"));return d};return h})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],function(n,f,l,h,d){return n("dijit.form.FilteringSelect",[h,d],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(d,f,a,k){f&&f[this.searchAttr]!==this._lastQuery||!f&&d.length&&this.store.getIdentity(d[0])!=this._lastQuery||
(d.length?this.set("item",d[0],k):this.set("value","",k||void 0===k&&!this.focused,this.textbox.value,null))},_openResultList:function(d,f,a){f[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(d,h,a,k){this._onChangeActive||(h=null);if(void 0===k){if(null===d||""===d)if(d="",!f.isString(a)){this._setDisplayedValueAttr(a||"",h);
return}var c=this;this._lastQuery=d;l(this.store.get(d),function(a){c._callbackSetLabel(a?[a]:[],void 0,void 0,h)})}else this.valueNode.value=d,this.inherited(arguments,[d,h,a,k])},_setItemAttr:function(d,f,a){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(d){return d.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(d,h){null==d&&(d="");if(!this._created){if(!("displayedValue"in this.params))return;h=!1}if(this.store){this.closeDropDown();
var a=f.clone(this.query),k=this._getDisplayQueryString(d),c;this.store._oldAPI?c=k:(c=this._patternToRegExp(k),c.toString=function(){return k});this._lastQuery=a[this.searchAttr]=c;this._lastDisplayedValue=this.textbox.value=d;this._set("displayedValue",d);var r=this,g={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};f.mixin(g,this.fetchProperties);this._fetchHandle=this.store.query(a,g);l(this._fetchHandle,function(c){r._fetchHandle=null;r._callbackSetLabel(c||[],a,g,h)},function(a){r._fetchHandle=
null;r._cancelingQuery||console.error("dijit.form.FilteringSelect: "+a.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(n,f,l,h){return n("dijit.form.MappedTextBox",h,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(d){return d.toString?d.toString():
""},toString:function(){var d=this.filter(this.get("value"));return null!=d?"string"==typeof d?d:this.serialize(d,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=l.place("\x3cinput type\x3d'hidden'"+(this.name&&!f("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},
"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(n,f,l,h,d,m,q,a,k){return n("dijit.form.ComboBoxMixin",[a,m],{dropDownClass:q,hasDownArrow:!0,templateString:k,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(a){this._set("hasDownArrow",
a);this._buttonNode.style.display=a?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(a){a.get||h.mixin(a,{_oldAPI:!0,get:function(a){var c=new f;this.fetchItemByIdentity({identity:a,onItem:function(a){c.resolve(a)},onError:function(a){c.reject(a)}});return c.promise},query:function(a,c){var g=new f(function(){e.abort&&e.abort()});g.total=new f;var e=this.fetch(h.mixin({query:a,onBegin:function(a){g.total.resolve(a)},onComplete:function(a){g.resolve(a)},
onError:function(a){g.reject(a)}},c));return d(g)}});this._set("store",a)},postMixInProperties:function(){var a=this.params.store||this.store;a&&this._setStoreAttr(a);this.inherited(arguments);if(!this.params.store&&this.store&&!this.store._oldAPI){var d=this.declaredClass;h.mixin(this.store,{getValue:function(a,c){l.deprecated(d+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return a[c]},getLabel:function(a){l.deprecated(d+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly",
"","2.0");return a.name},fetch:function(a){l.deprecated(d+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],h.hitch(this,function(c){(new c({objectStore:this})).fetch(a)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r){f=f("dijit.form._AutoCompleterMixin",r,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(c){var d=0;if("number"==typeof c.selectionStart)d=c.selectionStart;else if(a("ie")){var e=c.ownerDocument.selection.createRange().duplicate();c=c.createTextRange();e.move("character",0);c.move("character",0);try{c.setEndPoint("EndToEnd",e),d=String(c.text).replace(/\r/g,"").length}catch(b){}}return d},
_setCaretPos:function(a,d){d=parseInt(d);c.selectInputText(a,d,d)},_setDisabledAttr:function(a){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",a?"true":"false")},_onKey:function(a){if(!(32<=a.charCode)){var c=a.charCode||a.keyCode;if(c!=h.ALT&&c!=h.CTRL&&c!=h.META&&c!=h.SHIFT){var e=this.dropDown,b=null;this._abortQuery();this.inherited(arguments);if(!(a.altKey||a.ctrlKey||a.metaKey))switch(this._opened&&(b=e.getHighlightedOption()),c){case h.PAGE_DOWN:case h.DOWN_ARROW:case h.PAGE_UP:case h.UP_ARROW:this._opened&&
this._announceOption(b);a.stopPropagation();a.preventDefault();break;case h.ENTER:if(b){if(b==e.nextButton){this._nextSearch(1);a.stopPropagation();a.preventDefault();break}else if(b==e.previousButton){this._nextSearch(-1);a.stopPropagation();a.preventDefault();break}a.stopPropagation();a.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case h.TAB:c=this.get("displayedValue");if(e&&(c==e._messages.previousMessage||c==e._messages.nextMessage))break;
b&&this._selectOption(b);case h.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},_autoCompleteText:function(a){var d=this.focusNode;c.selectInputText(d,d.value.length);var e=this.ignoreCase?"toLowerCase":"substr";0==a[e](0).indexOf(this.focusNode.value[e](0))?(e=this.autoComplete?this._getCaretPos(d):d.value.length,e+1>d.value.length&&(d.value=a,c.selectInputText(d,e))):(d.value=a,c.selectInputText(d))},_openResultList:function(a,c,e){var b=this.dropDown.getHighlightedOption();
this.dropDown.clearResultList();a.length||0!=e.start?(this._nextSearch=this.dropDown.onPage=d.hitch(this,function(b){a.nextPage(-1!==b);this.focus()}),this.dropDown.createOptions(a,e,d.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in e?(e.direction?this.dropDown.highlightFirstOption():e.direction||this.dropDown.highlightLastOption(),b&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(c[this.searchAttr].toString())||
this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),c=this.dropDown;
!c||a!=c._messages.previousMessage&&a!=c._messages.nextMessage?"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",a)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,c,e){var b="";a&&(e||(e=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),b=this._getValueField()!=this.searchAttr?
this.store.getIdentity(a):e);this.set("value",b,c,e,a)},_announceOption:function(a){if(a){var c;if(a==this.dropDown.nextButton||a==this.dropDown.previousButton)c=a.innerHTML,this.item=void 0,this.value="";else{var e=this.dropDown.items[a.getAttribute("item")];c=(this.store._oldAPI?this.store.getValue(e,this.searchAttr):e[this.searchAttr]).toString();this.set("item",e,!1,c)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",
l.get(a,"id"));this._autoCompleteText(c)}},_selectOption:function(a){this.closeDropDown();a&&this._announceOption(a);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var c=this.id+"_popup";this.dropDown=new (d.isString(this.dropDownClass)?
d.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:d.hitch(this,this._selectOption),id:c,dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new k({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var c=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,
c):a[c]}}},postCreate:function(){var a=m('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",a[0].id));this.inherited(arguments);n.after(this,"onSearch",d.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var c=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(a=this.doHighlight(a,this._lastInput),c="html");return{html:"html"==c,label:a}},doHighlight:function(a,
c){var e=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),b=this.queryExpr.indexOf("${0}");c=q.escapeString(c);return this._escapeHtml(a.replace(new RegExp((0==b?"^":"")+"("+c+")"+(b==this.queryExpr.length-4?"$":""),e),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},
reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(a,c){return(c._oldAPI?c.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(a,c,e,b){this._set("item",b||null);null==a&&(a="");this.inherited(arguments)}});a("dojo-bidi")&&f.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return f})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),
function(n,f,l,h,d,m){function q(a){return{id:a.value,value:a.value,name:l.trim(a.innerText||a.textContent||"")}}return n("dijit.form.DataList",d,{constructor:function(a,d){this.domNode=f.byId(d);l.mixin(this,a);this.id&&m.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:h("option",this.domNode).map(q)}])},destroy:function(){m.remove(this.id)},fetchSelectedItem:function(){var a=h("\x3e option[selected]",this.domNode)[0]||h("\x3e option",this.domNode)[0];return a&&q(a)}})})},
"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(n,f,l){return n("dojo.store.Memory",null,{constructor:function(f){for(var d in f)this[d]=f[d];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:l,get:function(f){return this.data[this.index[f]]},getIdentity:function(f){return f[this.idProperty]},put:function(f,d){var h=this.data,q=this.index,a=this.idProperty,a=f[a]=d&&"id"in d?d.id:a in f?f[a]:Math.random();
if(a in q){if(d&&!1===d.overwrite)throw Error("Object already exists");h[q[a]]=f}else q[a]=h.push(f)-1;return a},add:function(f,d){(d=d||{}).overwrite=!1;return this.put(f,d)},remove:function(f){var d=this.index,h=this.data;if(f in d)return h.splice(d[f],1),this.setData(h),!0},query:function(h,d){return f(this.queryEngine(h,d)(this.data))},setData:function(f){f.items?(this.idProperty=f.identifier||this.idProperty,f=this.data=f.items):this.data=f;this.index={};for(var d=0,h=f.length;d<h;d++)this.index[f[d][this.idProperty]]=
d}})})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(n){return function(f,l){function h(d){d=n.filter(d,f);var h=l&&l.sort;h&&d.sort("function"==typeof h?h:function(a,c){for(var d,g=0;d=h[g];g++){var k=a[d.attribute],e=c[d.attribute],k=null!=k?k.valueOf():k,e=null!=e?e.valueOf():e;if(k!=e)return!!d.descending==(null==k||k>e)?-1:1}return 0});if(l&&(l.start||l.count)){var a=d.length;d=d.slice(l.start||0,(l.start||0)+(l.count||Infinity));d.total=a}return d}switch(typeof f){default:throw Error("Can not query with a "+
typeof f);case "object":case "undefined":var d=f;f=function(f){for(var h in d){var a=d[h];if(a&&a.test){if(!a.test(f[h],f))return!1}else if(a!=f[h])return!1}return!0};break;case "string":if(!this[f])throw Error("No filter function "+f+" was found in store");f=this[f];case "function":}h.matches=f;return h}})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(n,f,l,h,d,m,q){return n("dijit.form._SearchMixin",
null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(a){this._set("list",a)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(a){return new RegExp("^"+a.replace(/(\\.)|(\*)|(\?)|\W/g,function(a,c,d,g){return d?".*":g?".":c?c:"\\"+a})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());
this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(a){if(!this.disabled&&!this.readOnly){a=a.charOrCode;this._prev_key_backspace=!1;if(a==f.DELETE||a==f.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",
1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(a){this._abortQuery();var k=this,c=l.clone(this.query),f={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},g=d.substitute(this.queryExpr,[a.replace(/([\\\*\?])/g,"\\$1")]),p,e=function(){var a=k._fetchHandle=k.store.query(c,f);k.disabled||k.readOnly||p!==k._lastQuery||m(a,function(b){k._fetchHandle=null;k.disabled||k.readOnly||
p!==k._lastQuery||m(a.total,function(a){b.total=a;var d=k.pageSize;if(isNaN(d)||d>b.total)d=b.total;b.nextPage=function(a){f.direction=a=!1!==a;f.count=d;a?(f.start+=b.length,f.start>=b.total&&(f.count=0)):(f.start-=d,0>f.start&&(f.count=Math.max(d+f.start,0),f.start=0));0>=f.count?(b.length=0,k.onSearch(b,c,f)):e()};k.onSearch(b,c,f)})},function(a){k._fetchHandle=null;k._cancelingQuery||console.error(k.declaredClass+" "+a.toString())})};l.mixin(f,this.fetchProperties);this.store._oldAPI?p=g:(p=this._patternToRegExp(g),
p.toString=function(){return g});this._lastQuery=c[this.searchAttr]=p;this._queryDeferHandle=this.defer(e,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var a=this.list;a&&(this.store=q.byId(a))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(n,
f,l,h,d,m,q,a){return n("dijit.form._ComboBoxMenu",[d,m,a,q],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",baseClass:"dijitComboBoxMenu",
postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(f.add(this.previousButton,"dijitMenuItemRtl"),f.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var a=this.ownerDocument.createElement("div");a.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");a.setAttribute("role","option");return a},onHover:function(a){f.add(a,"dijitMenuItemHover")},onUnhover:function(a){f.remove(a,"dijitMenuItemHover")},
onSelect:function(a){f.add(a,"dijitMenuItemSelected")},onDeselect:function(a){f.remove(a,"dijitMenuItemSelected")},_page:function(a){var c=0,d=this.domNode.scrollTop,g=l.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();c<g;){var k=this.getHighlightedOption();if(a){if(!k.previousSibling||"none"==k.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!k.nextSibling||"none"==k.nextSibling.style.display)break;this.selectNextNode()}k=this.domNode.scrollTop;
c+=(k-d)*(a?-1:1);d=k}},handleKey:function(a){switch(a.keyCode){case h.DOWN_ARROW:return this.selectNextNode(),!1;case h.PAGE_DOWN:return this._page(!1),!1;case h.UP_ARROW:return this.selectPreviousNode(),!1;case h.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(n,f,l,h,d){var m=f("dijit.form._ComboBoxMenuMixin"+(h("dojo-bidi")?
"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=d.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(d){this._set("value",d);this.onChange(d)},onClick:function(d){if(d==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(d==this.nextButton)this._setSelectedAttr(null),
this.onPage(1);else this.onChange(d)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(d,a){var k=this._createMenuItem(),c=a(d);c.html?k.innerHTML=c.label:k.appendChild(k.ownerDocument.createTextNode(c.label));""==k.innerHTML&&(k.innerHTML="\x26#160;");return k},createOptions:function(d,a,k){this.items=d;this.previousButton.style.display=0==a.start?"none":"";l.set(this.previousButton,"id",this.id+"_prev");n.forEach(d,function(a,c){var d=
this._createOption(a,k);d.setAttribute("item",c);l.set(d,"id",this.id+c);this.nextButton.parentNode.insertBefore(d,this.nextButton)},this);var c=!1;d.total&&!d.total.then&&-1!=d.total?a.start+a.count<d.total?c=!0:a.start+a.count>d.total&&a.count==d.length&&(c=!0):a.count==d.length&&(c=!0);this.nextButton.style.display=c?"":"none";l.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var d=this.containerNode;2<d.childNodes.length;)d.removeChild(d.childNodes[d.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});h("dojo-bidi")&&(m=f("dijit.form._ComboBoxMenuMixin",
m,{_createOption:function(){var d=this.inherited(arguments);this.applyTextDir(d);return d}}));return m})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(n,f,l,h){return n("dijit.form._ListMouseMixin",h,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(d,f){this._setSelectedAttr(f,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(f)})},_onMouseDown:function(d,f){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(f,!1)},_onMouseUp:function(d,f){this._isDragging=!1;var h=this.selected,a=this._hoveredNode;h&&f==h?this.defer(function(){this._onClick(d,
h)}):a&&this.defer(function(){this._onClick(d,a)})},_onMouseOut:function(d,f){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(d,f){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=f;this.onHover(f);this._isDragging&&this._setSelectedAttr(f,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(n,f,l){return n("dijit.form._ListBase",null,{selected:null,_listConnect:function(h,d){var m=this;return m.own(f(m.containerNode,f.selector(function(d,a,k){return d.parentNode==k},h),function(f){m[d](f,this)}))},selectFirstNode:function(){for(var f=this.containerNode.firstChild;f&&"none"==f.style.display;)f=f.nextSibling;this._setSelectedAttr(f,!0)},selectLastNode:function(){for(var f=this.containerNode.lastChild;f&&"none"==f.style.display;)f=f.previousSibling;this._setSelectedAttr(f,
!0)},selectNextNode:function(){var f=this.selected;if(f){for(f=f.nextSibling;f&&"none"==f.style.display;)f=f.nextSibling;f?this._setSelectedAttr(f,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var f=this.selected;if(f){for(f=f.previousSibling;f&&"none"==f.style.display;)f=f.previousSibling;f?this._setSelectedAttr(f,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(f,d){if(this.selected!=f){var h=this.selected;if(h)this.onDeselect(h);
f&&(d&&l.scrollIntoView(f),this.onSelect(f));this._set("selected",f)}else if(f)this.onSelect(f)}})})},"jimu/dijit/FeatureActionPopupMenu":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin jimu/FeatureActionManager ./FeatureActionPopupMenuItem".split(" "),function(n,f,l,h,d,m,q,a,k,c){var r=null,g=n([q,a],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);this.hide();this.menuItems=[];this.own(d(this.domNode,"click",l.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||f.isDescendant(a,this.menuNode)||this.hide()})));this.own(d(this.closeBtn,"click",l.hitch(this,this.hide)))},setActions:function(a){this.clearActions();h.forEach(a,l.hitch(this,this._addMenuItem))},appendAction:function(a){this._addMenuItem(a)},clearActions:function(){this.menuItems=[];f.empty(this.menuContent)},_addMenuItem:function(a){a=
new c({action:a});f.place(a.domNode,this.menuContent);a.startup();this.menuItems.push(a);this.own(d(a,"click",l.hitch(this,this.hide)))},prepareActions:function(a,c){return k.getInstance().getSupportedActions(a).then(l.hitch(this,function(b){!1===c&&(b=h.filter(b,function(a){return 0!==a.name.indexOf("Export")&&"SaveToMyContent"!==a.name}));h.forEach(b,function(b){b.data=a},this);this.setActions(b)}))},hide:function(){f.setStyle(this.domNode,"display","none")},show:function(a,c){if(0===this.menuItems.length)f.setStyle(this.domNode,
"display","none");else{"string"===typeof c&&""!==c?(this.labelNode.innerHTML=c,f.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",f.setStyle(this.titleNode,"display","none"));var b,e=a.y+a.h,d;b=window.isRTL?a.x:a.x+a.w;f.setStyle(this.domNode,"display","");f.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});d=m.getMarginSize(this.menuNode);f.setStyle(this.menuNode,{left:(window.isRTL?b+d.w>window.innerWidth?window.innerWidth-d.w:0>b?0:b:0>b-d.w?0:b>window.innerWidth?
window.innerWidth-d.w:b-d.w)+"px",top:(d.h>window.innerHeight?0:e+d.h>window.innerHeight?window.innerHeight-d.h:e+d.h+5<window.innerHeight?e+5:e)+"px"})}}});g.getInstance=function(){null===r&&(r=new g,f.place(r.domNode,document.body),r.startup());r.setActions([]);return r};return g})},"jimu/dijit/FeatureActionPopupMenuItem":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/event dojo/on dojo/mouse dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),function(n,
f,l,h,d,m,q,a,k){return n([a,k,q],{baseClass:"popup-menu-item",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"icon jimu-float-leading"\x3e\x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"label" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3c/div\x3e',action:null,postCreate:function(){this.inherited(arguments);this.action&&(this.labelNode.innerHTML=this.action.label,this.action.iconClass?f.addClass(this.iconNode,this.action.iconClass):
f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")"),this.own(d(this.domNode,m.enter,l.hitch(this,this._useHoverIcon))),this.own(d(this.domNode,m.leave,l.hitch(this,this._useNormalIcon))));this.own(d(this.domNode,"click",l.hitch(this,this._clickHandler)))},_useNormalIcon:function(){this.action.iconClass?f.removeClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")")},_useHoverIcon:function(){this.action.iconClass?
f.addClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("hover")+")")},_clickHandler:function(a){h.stop(a);if(this.action){var c;this.action.data.features&&0<this.action.data.features.length&&(c=this.action.data.features[0].getLayer());this.action.onExecute(this.action.data,c)}this.emit("click")}})})},"jimu/RelatedRecordsPopupProjector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/query dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin esri/undoManager esri/OperationBase esri/tasks/RelationshipQuery esri/dijit/Popup esri/dijit/PopupMobile esri/graphicsUtils jimu/utils jimu/ConfigManager jimu/dijit/DropdownMenu jimu/LayerInfos/LayerInfos".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w){var y=n([a,k],{baseClass:"related-records-popup-projector",templateString:"\x3cdiv\x3e\x3cdiv class\x3d'operation-box' data-dojo-attach-point\x3d'operationBox' style\x3d'display: none'\x3e\x3cdiv class\x3d'previos-btn feature-action' data-dojo-attach-point\x3d'previouBtn'data-dojo-attach-event\x3d'click:_onPreviouBtnClick'\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-title' data-dojo-attach-point\x3d'operationTitle'\x3eabc\x3c/div\x3e\x3cdiv class\x3d'add-new-btn' data-dojo-attach-point\x3d'addNewBtn'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'content-box' data-dojo-attach-point\x3d'contentBox'\x3e\x3c/div\x3e\x3c/div\x3e",
popup:null,popupManager:null,undoManager:null,originalFeature:null,originalJimuLayerInfo:null,_temporaryData:null,postCreate:function(){this.undoManager=new c;this.layerInfosObj=w.getInstanceSync();this.originalJimuLayerInfo=this.layerInfosObj.getLayerInfoById(this.originalFeature.getLayer().id);this._temporaryData={eventHandles:[],dijits:[]};window.isRTL?h.addClass(this.previouBtn,"icon-arrow-forward"):h.addClass(this.previouBtn,"icon-arrow-back");var a=this._createOperation({feature:this.originalFeature,
oriJimuLayerInfo:this.originalJimuLayerInfo});this.showRelatedTables(a);this.popupUIController="esri.dijit.Popup"===this.popup.declaredClass?new y.PopupUIController(this):new y.PopupMobileUIController(this);this.popupUIController.addDomNode(this.domNode)},destroy:function(){this._clearPage();this.undoManager.destroy();this.popupUIController.destroy();this.inherited(arguments)},_getRelatedTableInfoArray:function(a){a=a.data.oriJimuLayerInfo;var b=new q;a.getRelatedTableInfoArray().then(f.hitch(this,
function(a){b.resolve(a)}));return b},_getOriRelationshipByDestLayer:function(a){var b=null;l.some(a.oriJimuLayerInfo.layerObject.relationships,function(c){if(c.relatedTableId===a.destJimuLayerInfo.layerObject.layerId)return b=c,!0},this);return b},_getRelatedRecordsByRelatedQuery:function(a){var b=new q,c=new g,e=this._getOriRelationshipByDestLayer(a);c.outFields=["*"];c.returnGeometry=!0;c.outSpatialReference=this.popupManager.mapManager.map.spatialReference;c.relationshipId=e.id;var d=a.feature.attributes[a.oriJimuLayerInfo.layerObject.objectIdField];
c.objectIds=[d];a.oriJimuLayerInfo.layerObject.queryRelatedFeatures(c,f.hitch(this,function(a){(a=a[d]&&a[d].features)?b.resolve(a):b.resolve([])}),f.hitch(this,function(){b.resolve([])}));return b},_ignoreCaseToGetFieldObject:function(a,b){var c=null;b&&a&&a.fields&&l.some(a.fields,function(a){if(a.name.toLowerCase()===b.toLowerCase())return c=a,!0});return c},getLocaleDateTime:function(a){return u.localizeDate(new Date(a),{fullYear:!0,formatLength:"medium"})},_getDisplayTitleOfRelatedRecord:function(a,
b,c){var e=this._ignoreCaseToGetFieldObject(a.layerObject,c);a=a.getInfoTemplate();(b="popupTitle"===c&&a?"function"===typeof a.title?a.title(b):a.title:e&&b.attributes[c])?e&&e.type&&"esriFieldTypeDate"===e.type&&(b=this.getLocaleDateTime(b)):b="";return b},_canShowRelatedData:function(a){var b=!0;(a=a.getPopupInfo())&&a.relatedRecordsInfo&&(b=!1!==a.relatedRecordsInfo.showRelatedRecords);return b},setPopupContent:function(a){this._clearPage();a.data.destJimuLayerInfo?a.data.relatedFeature||this.showRelatedRecords(a):
this.showFeature(a);this.undoManager.peekUndo()?this.popupUIController.changeRefDomNode():this.popupUIController.revertRefDomNode()},showFeature:function(a){var b=a.data,c=b.oriJimuLayerInfo.layerObject,e=f.getObject("_wabProperties.originalLayerName",!1,c)||b.oriJimuLayerInfo.title,c=f.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,c),d=this._getDisplayTitleOfRelatedRecord(b.oriJimuLayerInfo,b.feature,c);"popupTitle"!==c&&(d=e+": "+d);this._setOperationTitle(d);f.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",
null,b.oriJimuLayerInfo.layerObject);b.oriJimuLayerInfo.loadInfoTemplate().then(f.hitch(this,function(c){b.oriJimuLayerInfo.layerObject.infoTemplate||a.data.feature.setInfoTemplate(c);this.popupUIController.setFeature(a.data.feature);b.oriJimuLayerInfo.layerObject.infoTemplate||a.data.feature.setInfoTemplate(null)}));this.showRelatedTables(a);this.popupManager.initPopupMenu([a.data.feature]);this.popupUIController.updateZoomToBtn([a.data.feature])},showRelatedRecords:function(a){var b=a.data,c=f.getObject("_wabProperties.originalLayerName",
!1,b.destJimuLayerInfo.layerObject)||b.destJimuLayerInfo.title;this._setOperationTitle(c);this._clearPage();f.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",b,b.destJimuLayerInfo.layerObject);f.setObject("_wabProperties.popupInfo.originalFeature",this.originalFeature,b.destJimuLayerInfo.layerObject);f.setObject("_wabProperties.popupInfo.layerForActionWithEmptyFeatures",b.destJimuLayerInfo.layerObject,this.popup);this._getRelatedRecordsByRelatedQuery(b).then(f.hitch(this,function(c){0<
c.length?this._setTitle(window.jimuNls.popup.relatedRecords):this._setTitle(window.jimuNls.popup.noRelatedRecotds,"font-normal");var e=this._showFieldSelector(b.destJimuLayerInfo);l.forEach(c,function(c,g){c._layer=b.destJimuLayerInfo.layerObject;var k=this._getDisplayTitleOfRelatedRecord(b.destJimuLayerInfo,c,e),k=h.create("div",{"class":"item record-item "+(0===g%2?"oddLine":"evenLine"),innerHTML:k},this.contentBox);k.relatedRecord=c;k=d(k,"click",f.hitch(this,function(){this._addOperation(a);var e=
this._createOperation({feature:c,oriJimuLayerInfo:b.destJimuLayerInfo});this.setPopupContent(e)}));this._temporaryData.eventHandles.push(k)},this);this.popupManager.initPopupMenu(c);this.popupUIController.updateZoomToBtn(c)}));this.popupUIController.setContent(this.domNode)},showRelatedTables:function(a){this._canShowRelatedData(a.data.oriJimuLayerInfo)&&this._getRelatedTableInfoArray(a).then(f.hitch(this,function(b){0<b.length&&this._setTitle(window.jimuNls.popup.relatedTables);l.forEach(b,function(b,
c){var e=h.create("div",{"class":"item table-item "+(0===c%2?"oddLine":"evenLine"),innerHTML:b.title},this.contentBox),e=d(e,"click",f.hitch(this,function(){b.getLayerObject().then(f.hitch(this,function(){this._addOperation(a);var c=this._createOperation({feature:a.data.feature,oriJimuLayerInfo:a.data.oriJimuLayerInfo,destJimuLayerInfo:b});this.setPopupContent(c)}))}));this._temporaryData.eventHandles.push(e)},this)}))},_createOperation:function(a){return new y.Operation({feature:a.feature||null,
oriJimuLayerInfo:a.oriJimuLayerInfo||null,destJimuLayerInfo:a.destJimuLayerInfo||null,relatedFeature:a.relatedFeature||null},this)},_addOperation:function(a){this.undoManager.add(a)},_onPreviouBtnClick:function(){this.undoManager.undo()},_clearPage:function(){h.empty(this.contentBox);l.forEach(this._temporaryData.eventHandles,function(a){a&&a.remove&&a.remove()},this);this._temporaryData.eventHandles=[];l.forEach(this._temporaryData.dijits,function(a){a&&a.destroy&&a.destroy()},this);this._temporaryData.dijits=
[]},_setTitle:function(a,b){a&&h.create("div",{"class":"title-box "+(b?b:""),innerHTML:a},this.contentBox)},_setOperationTitle:function(a){h.setAttr(this.operationTitle,"innerHTML",a);h.setAttr(this.operationTitle,"title",a)},_showFieldSelector:function(a){var b="objecid",c=m(".title-box",this.contentBox)[0],e=a.layerObject,g=[];if(!c||!a)return b;var k=a.getPopupInfo();k&&k.title&&g.push({label:window.jimuNls.popup.saveAsPopupTitle,value:"popupTitle"});l.forEach(e.fields,function(a){"globalid"!==
a.name.toLowerCase()&&"shape"!==a.name.toLowerCase()&&g.push({label:a.alias||a.name,value:a.name})});c=(new v({items:g})).placeAt(c);c.domNode.title=window.jimuNls.popup.chooseFieldTip;var p=f.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,e),h=this._ignoreCaseToGetFieldObject(a.layerObject,a.layerObject.displayField||a.layerObject.objectIdField),r=t.getInstance().getAppConfig();p?b=p:"2.3"===r.configWabVersion&&h&&h.name?b=h.name:k&&k.title?b="popupTitle":h&&h.name?b=h.name:
0<g.length&&(b=g[0].value);b&&(c.setHighlightValue(b),f.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",b,e));this._temporaryData.dijits.push(c);a=d(c,"click-item",f.hitch(this,function(a,b){m(".item.record-item",this.contentBox).forEach(f.hitch(this,function(c){f.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",b,e);var d=this._getDisplayTitleOfRelatedRecord(a,c.relatedRecord,b);c.innerHTML=d}))},a));this._temporaryData.eventHandles.push(a);return b}});y.Operation=
n([r],{constructor:function(a,b){this.data=a;this.relatedRecordsPopupProjector=b},performUndo:function(){this.relatedRecordsPopupProjector.setPopupContent(this)}});y.PopupUIController=n([],{constructor:function(a){this.rrPopupProjector=a;this.popup=a.popup;this.initTempPopup();this._initZoomToBtn()},initTempPopup:function(){this._tempPopup=new p({},h.create("div"))},destroy:function(){this._tempPopup.destroy();this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove();
this._zoomToBtnANode&&h.destroy(this._zoomToBtnANode)},addDomNode:function(a){setTimeout(f.hitch(this,function(){h.place(a,this._getRefDomNode(),"after")}),1)},setFeature:function(a){this._tempPopup.setFeatures([a]);if(a=m(".esriViewPopup",this._tempPopup.domNode)[0])this.setContent(a),h.place(this.rrPopupProjector.domNode,a,"after")},setContent:function(a){var b=m(".related-records-popup-projector").parent()[0];b&&b.removeChild(this.rrPopupProjector.domNode);this.popup.setContent(a)},_getRefDomNode:function(){return this._getViewPopupDomNode()},
_getViewPopupDomNode:function(){return m(".esriViewPopup",this.popup.domNode)[0]},_setPopupTitleInBody:function(){this.rrPopupProjector.undoManager.peekUndo()?this._tempPopup.set("titleInBody",!1):this._tempPopup.set("titleInBody",!0)},_initZoomToBtn:function(){var a=m(".actionList",this.popup.domNode)[0];this._oldZoomToBtnANdoe=m(".action",a)[0];this._zoomToBtnANode=h.create("a",{"class":"action",style:"display: none",href:"javascript:void(0)"},a);this._zoomToBtn=h.create("span",{innerHTML:window.jimuNls.common.zoomTo},
this._zoomToBtnANode);this._showOldZoomToBtn()},_hideZoomToBtn:function(){this._zoomToBtnANode&&h.setStyle(this._zoomToBtnANode,"display","none")},_showZoomToBtn:function(){this._zoomToBtnANode&&h.setStyle(this._zoomToBtnANode,"display","inline-block")},_hideOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&h.setStyle(this._oldZoomToBtnANdoe,"display","none")},_showOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&h.setStyle(this._oldZoomToBtnANdoe,"display","inline-block")},updateZoomToBtn:function(a){this._hideOldZoomToBtn();
!a||1>a.length||!a[0].geometry?this._hideZoomToBtn():(this._showZoomToBtn(),this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove(),this._zoomToBtnClickHandle=d(this._zoomToBtn,"click",f.hitch(this,function(){var c=null;try{c=b.graphicsExtent(a)}catch(A){console.error(A)}c&&(this.rrPopupProjector.popupManager.mapManager.map.setExtent(c),this.popup.hide())})))},changeRefDomNode:function(){h.setStyle(this.rrPopupProjector.operationBox,"display","block");h.addClass(this.rrPopupProjector.domNode,
"second-page-mode");var a=this._getViewPopupDomNode();a&&h.addClass(a,"second-page-mode")},revertRefDomNode:function(){h.setStyle(this.rrPopupProjector.operationBox,"display","none");h.removeClass(this.rrPopupProjector.domNode,"second-page-mode");this._hideZoomToBtn();this._showOldZoomToBtn()}});y.PopupMobileUIController=n([y.PopupUIController],{initTempPopup:function(){this._tempPopup=new e({},h.create("div"))},setFeature:function(a){this._tempPopup.setFeatures([a]);a=m(".esriMobileInfoView.esriMobilePopupInfoView",
this._tempPopup.domNode)[0];if(a=m(".esriViewPopup",a)[0])this.setContent(a),h.place(this.rrPopupProjector.domNode,a,"after")},updateZoomToBtn:function(){},_initZoomToBtn:function(){},_getRefDomNode:function(){return m(".esriMobilePopupInfoView .esriMobileInfoViewItem")[1]},_getViewPopupDomNode:function(){var a=m(".esriMobileInfoView.esriMobilePopupInfoView")[0];return m(".esriViewPopup",a)[0]}});return y})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented dojo/has!extend-esri?./OperationBase".split(" "),
function(n,f,l,h,d,m){n=n([m],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(d){d=d||{};d.maxOperations&&(this.maxOperations=d.maxOperations);this._historyStack=[]},add:function(d){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,
0,d);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var d=this.peekUndo();this.position--;d?(d=d.performUndo(),this.onUndo(),this._checkAvailability(),h(d).then(f.hitch(this,this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var d=this.peekRedo();this.position++;d?(d=d.performRedo(),this.onRedo(),this._checkAvailability(),h(d).then(f.hitch(this,
this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,
this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},get:function(d){return this._historyStack[d]},remove:function(d){0<this._historyStack.length&&(this._historyStack.splice(d,1),0<this.position&&d<this.position&&this.position--,
this._checkAvailability())},destroy:function(){this._historyStack=null}});l("extend-esri")&&(d.UndoManager=n);return n})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(n,f,l){n=n(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(f){f=f||{};f.label&&(this.label=f.label)},performUndo:function(){console.log("performUndo has not been implemented")},performRedo:function(){console.log("performRedo has not been implemented")}});
f("extend-esri")&&(l.OperationBase=n);return n})},"jimu/dijit/DropdownMenu":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/query dojo/Evented".split(" "),function(n,f,l,h,d,m,q,a,k){return n([f,l,k],{baseClass:"jimu-dijit-dropdownmenu",declaredClass:"jimu.dijit.DropdownMenu",templateString:"\x3cdiv\x3e\x3c/div\x3e",itemHeight:24,iconSize:16,offsetY:5,shelter:null,paddingOffsetY:8,dropdownMenuItemClass:"dropdown-menu-item",
items:null,highlightValue:"",highlightSelectedItemAfterClick:!0,menuLeadingIcon:!0,maxDisplayItems:10,postCreate:function(){this.inherited(arguments);this.items||(this.items=[]);this.shelter=m.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-shelter"\x3e\x3c/div\x3e');this.itemsContainer=m.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-items-container"\x3e\x3c/div\x3e');0>=this.maxDisplayItems&&(this.maxDisplayItems=20);this.itemsContainer.style.maxHeight=this.itemHeight*this.maxDisplayItems+2*
this.paddingOffsetY+"px";d.forEach(this.items,h.hitch(this,function(a){var c=m.toDom('\x3cdiv class\x3d"'+this.dropdownMenuItemClass+' jimu-ellipsis"\x3e'+a.label+"\x3c/div\x3e");c.itemInfo=a;c.title=a.label;m.place(c,this.itemsContainer)}));this.own(q(this.domNode,"click",h.hitch(this,this._onIconClick)));this.own(q(this.shelter,"click",h.hitch(this,this._onShelterClick)));this.own(q(this.itemsContainer,"click",h.hitch(this,this._onItemsContainerClick)));this.highlightValue&&this.setHighlightValue(this.highlightValue)},
_onIconClick:function(a){a.stopPropagation();this.isShowing()?this.hideMenu():(a=m.position(a.target||a.srcElement),this.showMenu(a))},_onShelterClick:function(){this.hideMenu()},_onItemsContainerClick:function(a){a.stopPropagation();a=a.target||a.srcElement;m.hasClass(a,this.dropdownMenuItemClass)&&(a=a.itemInfo.value,this.highlightSelectedItemAfterClick&&this.setHighlightValue(a),this.emit("click-item",a));this.hideMenu()},clearHighlightValue:function(){a("."+this.dropdownMenuItemClass,this.itemsContainer).removeClass("selected")},
setHighlightValue:function(c){this.clearHighlightValue();a("."+this.dropdownMenuItemClass,this.itemsContainer).some(h.hitch(this,function(a){return a.itemInfo.value===c?(m.addClass(a,"selected"),!0):!1}))},getHighlightValue:function(){var c=a("."+this.dropdownMenuItemClass+".selected",this.itemsContainer)[0];return c?c.itemInfo.value:null},isShowing:function(){return m.hasClass(this.domNode,"showing")},showMenu:function(a){this.itemsContainer.style.top=a.y+this.iconSize+this.offsetY+"px";this.menuLeadingIcon===
window.isRTL?(this.itemsContainer.style.left=a.x+"px",this.itemsContainer.style.right="auto"):(this.itemsContainer.style.right=window.innerWidth-(a.x+this.iconSize)+"px",this.itemsContainer.style.left="auto");m.place(this.shelter,document.body);m.place(this.itemsContainer,document.body);m.addClass(this.domNode,"showing")},hideMenu:function(){this.itemsContainer.parentNode&&this.itemsContainer.parentNode.removeChild(this.itemsContainer);this.shelter.parentNode&&this.shelter.parentNode.removeChild(this.shelter);
m.removeClass(this.domNode,"showing")},destroy:function(){this.hideMenu();m.destroy(this.itemsContainer);m.destroy(this.shelter);this.inherited(arguments)}})})},"jimu/FilterManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","esri/lang","./LayerInfos/LayerInfos"],function(n,f,l,h,d){var m=null,q=n(null,{_filters:null,layerInfos:null,constructor:function(){this._filters={};window.isBuilder?(l.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),l.subscribe("app/mapChanged",
f.hitch(this,this._onMapChanged))):(l.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),l.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));l.subscribe("widgetDestroyed",f.hitch(this,this._onWidgetDestroyed))},getWidgetFilter:function(a,d){return f.getObject(a+".filterExprs."+d,!1,this._filters)},applyWidgetFilter:function(a,d,c,f,g){this._setFilterExp(a,d,c,f,g);d=this.layerInfos.getLayerInfoById(a)||this.layerInfos.getTableInfoById(a);a=this._getFilterExp(a);null!==a&&d&&d.setFilter(a)},
_onMapLoaded:function(){this.layerInfos=d.getInstanceSync();this._traversalFilter()},_onMapChanged:function(){this.layerInfos=d.getInstanceSync();this._traversalFilter()},_onWidgetDestroyed:function(a){for(var d in this._filters)if(this._filters[d]){var c=this._filters[d];if(c){var f=c.filterExprs,c=c.mapFilterControls;f&&delete f[a];c&&delete c[a]}}},_traversalFilter:function(){this.layerInfos.traversalAll(f.hitch(this,function(a){this._filters[a.id]||(this._filters[a.id]={definitionExpression:a.getFilter(),
filterExprs:{},mapFilterControls:{}})}))},_getPriorityOfMapFilter:function(a){a=f.getObject(a+".mapFilterControls",!1,this._filters);var d=0,c;for(c in a){var h=a[c];h.priority>d&&(d=h.priority)}return d},_getMapFilterControl:function(a){a=f.getObject(a+".mapFilterControls",!1,this._filters);var d=0,c=null,h;for(h in a){var g=a[h];g.priority>d&&(d=g.priority,c=g)}return c},_setFilterExp:function(a,d,c,r,g){var k=a+".filterExprs."+d,e=a+".mapFilterControls."+d;c?(f.setObject(k,c,this._filters),h.isDefined(r)&&
(a=this._getPriorityOfMapFilter(a),f.setObject(e,{enable:r,useAND:g,priority:a+1},this._filters))):(f.getObject(k,!1,this._filters)&&delete this._filters[a].filterExprs[d],f.getObject(e,!1,this._filters)&&delete this._filters[a].mapFilterControls[d])},_getFilterExp:function(a){if(!this._filters[a])return null;var d=[],c=this._filters[a].definitionExpression,f=this._filters[a].filterExprs;a=this._getMapFilterControl(a);for(var g in f){var p=f[g];p&&d.push("("+p+")")}d=d.join(" AND ");return c&&a&&
a.enable||c&&null===a?d?a&&!1===a.useAND?"("+c+") OR "+d:"("+c+") AND "+d:c:d}});q.getInstance=function(){if(null===m)m=new q,window._filterManager=m;else return m};return q})},"jimu/OnScreenWidgetIcon":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dijit/_WidgetBase ./utils".split(" "),function(n,f,l,h,d,m,q){return n(m,{"class":"jimu-widget-onscreen-icon",postCreate:function(){this.inherited(arguments);this.iconNode=h.create("img",{src:this.widgetConfig.icon},
this.domNode);h.setAttr(this.domNode,"title",this.widgetConfig.label);h.setAttr(this.domNode,"data-widget-name",this.widgetConfig.name);this.own(d(this.domNode,"click",f.hitch(this,function(){this.onClick()})));this.position=f.clone(this.widgetConfig.position);"map"===this.widgetConfig.position.relativeTo&&this.own(d(this.map,"resize",f.hitch(this,function(){var a=f.clone(this.position);delete a.width;delete a.height;this.panel&&this.panel.setPosition(a)})));this.state="closed"},startup:function(){this.inherited(arguments)},
onClick:function(){"closed"===this.state?this.switchToOpen():this.switchToClose()},moveTo:function(a){var d={left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},d=f.mixin(d,q.getPositionStyle(a));delete d.width;delete d.height;h.setStyle(this.domNode,d);this.position=f.clone(a);this.widgetConfig&&this.widgetConfig.panel&&(this.widgetConfig.panel.position=f.clone(a),this.widgetConfig.position=f.clone(a));this.panel&&this.panel.setPosition(f.clone(a));this.widget&&this.widget.setPosition(this.getOffPanelWidgetPosition(this.widget))},
destroy:function(){this.panel?this.panelManager.destroyPanel(this.panel):this.widget&&this.widgetManager.destroyWidget(this.widget);this.inherited(arguments)},switchToOpen:function(){this.state="opened";this.panelManager.closeAllPanelsInGroup(this.widgetConfig.gid);l.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(a){a.closeable&&this.widgetManager.closeWidget(a)},this);h.addClass(this.domNode,"jimu-state-selected");this._showLoading();!1===this.widgetConfig.inPanel?this.widgetManager.loadWidget(this.widgetConfig).then(f.hitch(this,
function(a){this.widget=a;a.setPosition(this.getOffPanelWidgetPosition(a));this.widgetManager.openWidget(a);this.own(d(a,"close",f.hitch(this,function(){this.switchToClose()})));this._hideLoading()})):this.panelManager.showPanel(f.clone(this.widgetConfig)).then(f.hitch(this,function(a){this.panel=a;this.own(d(a,"close",f.hitch(this,function(){this.switchToClose()})));this._hideLoading()}))},switchToClose:function(){this.state="closed";h.removeClass(this.domNode,"jimu-state-selected");!1===this.widgetConfig.inPanel?
this.widgetManager.closeWidget(this.widget):this.panelManager.closePanel(this.panel)},getOffPanelWidgetPosition:function(a){var d={relativeTo:a.position.relativeTo},c=h.getMarginBox(this.domNode);a=this.widgetManager.getWidgetMarginBox(a);var f=h.getMarginBox("map"===d.relativeTo?this.map.id:jimuConfig.layoutId),g=c.t+c.h+1;g+a.h>f.h?d.bottom=f.h-c.t+1:d.top=g;window.isRTL?d.right=0>c.l+c.w-a.w?0:c.l+c.w-a.w:c.l+a.w>f.w?d.right=0:d.left=c.l;return d},_showLoading:function(){h.setAttr(this.iconNode,
"src",require.toUrl("jimu")+"/images/loading_circle.gif")},_hideLoading:function(){h.setAttr(this.iconNode,"src",this.widgetConfig.icon)}})})},"jimu/WidgetPlaceholder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase","./utils"],function(n,f,l,h,d){return n(h,{"class":"jimu-widget-placeholder",postCreate:function(){this.inherited(arguments);this.indexNode=l.create("div",{"class":"inner",innerHTML:this.index},this.domNode);l.setAttr(this.domNode,"title",
window.jimuNls.widgetPlaceholderTooltip)},moveTo:function(h){var m={left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},m=f.mixin(m,d.getPositionStyle(h));delete m.width;delete m.height;l.setStyle(this.domNode,m)},setIndex:function(d){this.index=d;this.indexNode.innerHTML=d}})})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic"],function(n,f,l){var h=null,d;d=n(null,{constructor:function(d){l.subscribe("publishData",f.hitch(this,this.onDataPublished));
l.subscribe("fetchData",f.hitch(this,this.onFetchData));l.subscribe("clearAllData",f.hitch(this,this.onClearAllData));l.subscribe("removeData",f.hitch(this,this.onRemoveData));l.subscribe("clearDataHistory",f.hitch(this,this.onClearDataHistory));this.widgetManager=d},_dataStore:{},onDataPublished:function(d,f,a,k){"undefined"===typeof k&&(k=!1);this._dataStore[f]?(this._dataStore[f].current=a,k&&(this._dataStore[f].history?this._dataStore[f].history.push(a):this._dataStore[f].history=[a])):(this._dataStore[f]=
{current:a},k&&(this._dataStore[f].history=[a]))},onFetchData:function(d){var f;if(d)"framework"===d?this._dataStore[d]?l.publish("dataFetched","framework","framework",this._dataStore[d].current,this._dataStore[d].history):l.publish("noData","framework","framework"):(f=this.widgetManager.getWidgetById(d))?this._dataStore[d]?l.publish("dataFetched",f.name,d,this._dataStore[d].current,this._dataStore[d].history):l.publish("noData",f.name,d):l.publish("noData",void 0,d);else{for(var a in this._dataStore)(f=
this.widgetManager.getWidgetById(a))&&l.publish("dataFetched",f.name,a,this._dataStore[a].current,this._dataStore[a].history);f||l.publish("noData",void 0,void 0)}},onClearAllData:function(){this._dataStore={};l.publish("allDataCleared")},onRemoveData:function(d){delete this._dataStore[d];l.publish("dataRemoved",d)},onClearDataHistory:function(d){this._dataStore[d]&&(this._dataStore[d].history=[]);l.publish("dataHistoryCleared",d)}});d.getInstance=function(f){null===h&&(h=new d(f));return h};return d})},
"jimu/SelectionManager":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/topic esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/graphic esri/Color esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g,p){var e=null,b=n(null,{constructor:function(){window.isBuilder?(d.subscribe("app/mapLoaded",l.hitch(this,this._onMapLoaded)),d.subscribe("app/mapChanged",
l.hitch(this,this._onMapChanged))):(d.subscribe("mapLoaded",l.hitch(this,this._onMapLoaded)),d.subscribe("mapChanged",l.hitch(this,this._onMapChanged)))},_displayLayers:{},setSelectionSymbol:function(a){var b=a.geometryType,e=new r(r.STYLE_CIRCLE,16,null,c.fromArray([0,255,255])),d=new g(g.STYLE_SOLID,c.fromArray([0,255,255]),2),k=new p(p.STYLE_SOLID,d,c.fromArray([0,255,255,.3]));"esriGeometryPoint"===b?a.setSelectionSymbol(e):"esriGeometryPolyline"===b?a.setSelectionSymbol(d):"esriGeometryPolygon"===
b&&a.setSelectionSymbol(k)},updateSelectionByFeatures:function(a,b,c){0<b.length&&(b=h.map(b,l.hitch(this,function(b){var c=null,c=0<=a.graphics.indexOf(b)?new k(b.toJson()):b;c.wabIsTemp=!0;return c})));a.getSelectionSymbol()||this.setSelectionSymbol(a);var e=new f;a._selectHandler({features:b},c,null,null,e);this._isLayerNeedDisplayLayer(a)&&(this._displayLayers[a.id]||(this._displayLayers[a.id]=this._createDisplayLayer(a)),this._updateDisplayLayer(a));return e},getDisplayLayer:function(a){return this._displayLayers[a]},
setSelection:function(a,b){return this.updateSelectionByFeatures(a,b,m.SELECTION_NEW)},addFeaturesToSelection:function(a,b){return this.updateSelectionByFeatures(a,b,m.SELECTION_ADD)},removeFeaturesFromSelection:function(a,b){return this.updateSelectionByFeatures(a,b,m.SELECTION_SUBTRACT)},clearSelection:function(a){this.clearDisplayLayer(a);return this.updateSelectionByFeatures(a,[],m.SELECTION_NEW)},clearDisplayLayer:function(a){(a=this._displayLayers[a.id])&&a.clear()},getClientFeaturesByGeometry:function(b,
c,e){return h.filter(b.graphics,l.hitch(this,function(b){return e?a.contains(c,b.geometry):a.intersects(c,b.geometry)}))},getUnionGeometryBySelectedFeatures:function(b){var c=null;b=b.getSelectedFeatures();0<b.length&&(c=h.map(b,l.hitch(this,function(a){return a.geometry})),c=a.union(c));return c},_createDisplayLayer:function(a){var b=new q;b.id="displayLayer_of_"+a.id;this.map.addLayer(b);return b},_updateDisplayLayer:function(a){var b=a.getSelectedFeatures(),c=this._displayLayers[a.id];this.clearDisplayLayer(a);
var e=a.getSelectionSymbol();h.forEach(b,l.hitch(this,function(a){a.setSymbol(null);a=new k(a.toJson());a.setSymbol(e);c.add(a)}))},_isLayerNeedDisplayLayer:function(a){return!a.getMap()},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a}});b.getInstance=function(){e||(e=new b,window._selectionManager=e);return e};return b})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),
function(n,f,l,h,d,m,q,a,k){return n([m,q],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(d.subscribe("publishData",f.hitch(this,this._onReceiveData)));this.own(d.subscribe("dataFetched",f.hitch(this,
this._onReceiveData)));this.own(d.subscribe("noData",f.hitch(this,this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(a){},onSignOut:function(){},onPositionChange:function(a){this.setPosition(a)},setPosition:function(c,d){this.position=c;var g=a.getPositionStyle(this.position);g.position="absolute";
d||(d="map"===c.relativeTo?this.map.id:window.jimuConfig.layoutId);h.place(this.domNode,d);h.setStyle(this.domNode,g);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return h.getMarginBox(this.domNode)},setMap:function(a){this.map=a},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){},onConfigChanged:function(a){},onAppConfigChanged:function(a,d,g){},onAction:function(a,d){},getPanel:function(){if(!1===
this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return k.getInstance().getPanelById(this.id+"_panel");var a=k.getInstance().getPanelById(this.gid+"_panel");return a?a:k.getInstance().getPanelById(this.id+"_panel")},publishData:function(a,k){"undefined"===typeof k&&(k=!1);d.publish("publishData",this.name,this.id,a,k)},fetchData:function(a){a?d.publish("fetchData",a):0!==this.listenWidgetIds.length?l.forEach(this.listenWidgetIds,function(a){d.publish("fetchData",a)},
this):d.publish("fetchData")},fetchDataByName:function(a){a=this.widgetManager.getWidgetsByName(a);l.forEach(a,function(a){this.fetchData(a.id)},this)},openWidgetById:function(a){return this.widgetManager.triggerWidgetOpen(a)},_onReceiveData:function(a,d,g,k){if(d!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(d)))this.onReceiveData(a,d,g,k)},onReceiveData:function(a,d,g,k){},_onNoData:function(a,d){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(d)))this.onNoData(a,
d)},onNoData:function(a,d){}})})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(n,f,l,h){return n([h],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==
this.widget.state&&f.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(d){this.loading=d;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(d){this.widget=d;this.loading&&this.loading.destroy();l.place(d.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(d){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+d.stack)}this.loading&&
this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(n,f,l,h,d,m,q,a,k){return n([d,m],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);
this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var a=this.getAllWidgetConfigs(),a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];l.forEach(a,function(a){var c,d;!1!==a.visible&&(d=new q,c=this.createFrame(a),this.addChild(c),c.setLoading(d),this.widgetManager.loadWidget(a).then(f.hitch(this,function(a){c.setWidget(a);a.startup()})))},this)},getAllWidgetConfigs:function(){var a=[];return a=Array.isArray(this.config.widgets)?this.config.widgets:
[this.config]},getWidgetById:function(a){for(var c=this.getChildren(),d=0;d<c.length;d++)if(c[d].getWidget()&&c[d].getWidget().id===a)return c[d].getWidget()},createFrame:function(c){return new a},setPosition:function(a,d){this.position=a;var c=k.getPositionStyle(this.position);c.position="absolute";d||(d="map"===a.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(c.display="none");h.place(this.domNode,d);h.setStyle(this.domNode,c)},getPosition:function(){return this.position},
setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){this.getChildren().forEach(function(a){a.resize()})},onPositionChange:function(a){this.setPosition(a)},onOpen:function(){l.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.openWidget(a.getWidget())},this)},onClose:function(){l.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.closeWidget(a.getWidget())},this)},onMaximize:function(){l.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.maximizeWidget(a.getWidget())},this)},onMinimize:function(){l.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.minimizeWidget(a.getWidget())},this)},onNormalize:function(){l.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.normalizeWidget(a.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(a){this._updateConfig(a)},reloadWidget:function(a){this.isWidgetInPanel(a)&&(this._updateConfig(a),
this.getChildren().forEach(function(c){c.getWidget()&&c.getWidget().id===a.id&&(c.getWidget().destroy(),c.setLoading(new q),this.widgetManager.loadWidget(a).then(f.hitch(this,function(a){c.setWidget(a);a.startup();"closed"===this.state&&this.widgetManager.closeWidget(a)})))},this))},isWidgetInPanel:function(a){return l.some(this.getAllWidgetConfigs(),function(c){if(a.id===c.id)return!0})?!0:!1},_updateConfig:function(a){if(Array.isArray(this.config.widgets)){for(var c=-1,d=0;d<this.config.widgets.length;d++)this.config.widgets[d].id===
a.id&&(c=d);0<c&&(this.config.widgets[c]=a)}else this.config=a},destroy:function(){this.getChildren().forEach(function(a){try{a.domNode&&a.destroy()}catch(r){console.error("destroy widget frame error."+r.stack)}});this.inherited(arguments)}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(n,f,l,h,d){return n([h,d],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(l(window,
"resize",f.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define("require dojo/_base/lang dojo/_base/html dojox/gfx esri/symbols/jsonUtils esri/symbols/PictureMarkerSymbol".split(" "),function(n,f,l,h,d,m){return{cloneSymbol:function(f){if(!f)return null;var a=null;try{var k=f.toJson(),a=d.fromJson(k)}catch(c){console.error(c)}return a},getDefaultMarkerSymbol:function(){return d.fromJson({style:"esriSMSCircle",
color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return d.fromJson({tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return d.fromJson({tags:["opaque"],title:"Blue",style:"esriSFSSolid",color:[79,129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return d.fromJson({color:[255,
255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return d.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return d.fromJson({color:[255,255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},getGreyPinMarkerSymbol:function(){var d=
n.toUrl("jimu/css/images/grey_pin.png"),d=new m(d,16,16);d.setOffset(0,8);return d},createSymbolNode:function(m,a){var k=32,c=32,r=l.create("div",{},document.body);l.setStyle(r,"display","inline-block");if(a)k=a.width,c=a.height;else if(k=80,c=30,this.isSimpleMarkerSymbol(m))c=k=Math.min(m.size+12,125);else if(this.isPictureMarkerSymbol(m)){if(!m.url||"http://"===m.url||-1===m.url.indexOf("http://")&&-1===m.url.indexOf("https://")&&-1===m.url.indexOf("data:"))return;c=k=Math.min(Math.max(m.width,
m.height),125)}else if(this.isSimpleLineSymbol(m)||this.isCartographicLineSymbol(m))k=190,c=20;var g=h.createSurface(r,k,c);if("vml"===h.renderer){var p=g.getEventSource();l.setStyle(p,"position","relative");l.setStyle(p.parentNode,"position","relative")}var p=null,p=a?d.getShapeDescriptors(m):this.isSimpleLineSymbol(m)||this.isCartographicLineSymbol(m)?this._getLineShapeDesc(m):d.getShapeDescriptors(m),e;try{e=g.createShape(p.defaultShape),p.fill&&e.setFill(p.fill),p.stroke&&e.setStroke(p.stroke)}catch(u){g.clear();
g.destroy();return}var g=g.getDimensions(),g={dx:g.width/2,dy:g.height/2},b=e.getBoundingBox(),p=b.width,b=b.height;if(p>k||b>c)k=((k<c?k:c)-5)/(p>b?p:b),f.mixin(g,{xx:k,yy:k});e.applyTransform(g);r&&l.addClass(r,"symbol");return r},_getLineShapeDesc:function(d){var a=null;if(this.isSimpleLineSymbol(d)||this.isCartographicLineSymbol(d))a={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:d.getStroke()};return a},isSimpleMarkerSymbol:function(d){return d&&"esri.symbol.SimpleMarkerSymbol"===
d.declaredClass},isPictureMarkerSymbol:function(d){return d&&"esri.symbol.PictureMarkerSymbol"===d.declaredClass},isSimpleLineSymbol:function(d){return d&&"esri.symbol.SimpleLineSymbol"===d.declaredClass},isCartographicLineSymbol:function(d){return d&&"esri.symbol.CartographicLineSymbol"===d.declaredClass},isSimpleFillSymbol:function(d){return d&&"esri.symbol.SimpleFillSymbol"===d.declaredClass},isPictureFillSymbol:function(d){return d&&"esri.symbol.PictureFillSymbol"===d.declaredClass},isTextSymbol:function(d){return d&&
"esri.symbol.TextSymbol"===d.declaredClass}}})},"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale esri/lang dojo/data/ItemFileWriteStore jimu/utils".split(" "),function(n,f,l,h,d,m,q){return n([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:86399E3,fieldsStore:null,
isHosted:!1,constructor:function(){String.prototype.startsWith=function(a){return 0===this.indexOf(a)};String.prototype.endsWith=function(a){return this.substring(this.length-a.length)===a};String.prototype.count=function(a){return this.split(a).length-1};String.prototype.trim||(String.prototype.trim=f.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes)},
OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",stringOperatorContains:"stringOperatorContains",stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",
numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",
dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",dateOperatorMonths:"dateOperatorMonths",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast"},prepare:function(a,d){this.isHosted=q.isHostedService(a);this.setFieldsStoreByFieldInfos(d)},isPartsObjHasError:function(a){var d=
!1;a&&(d=a.parts&&0<=a.parts.length?l.every(a.parts,f.hitch(this,function(a){return a.parts?0<a.parts.length?l.every(a.parts,f.hitch(this,function(a){return!a.error})):!1:!a.error})):!1);return!d},isAskForValues:function(a){var d=!1;return d=l.some(a.parts,f.hitch(this,function(a){return a.parts?l.some(a.parts,f.hitch(this,function(a){return!!a.interactiveObj})):!!a.interactiveObj}))},setFieldsStoreByFieldInfos:function(a){a=l.filter(a,f.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)}));
a=l.map(a,function(a,c){var d;switch(a.type){case "esriFieldTypeString":d="string";break;case "esriFieldTypeDate":d="date";break;default:d="number"}return{id:c,label:a.name,shortType:d,alias:a.alias,editable:a.editable,name:a.name,nullable:a.nullable,type:a.type}},this);this.fieldsStore=new m({data:{identifier:"id",label:"label",items:a}});return a.length},_validatePartsObj:function(a){return a&&"object"===typeof a},_isObject:function(a){return a&&"object"===typeof a},_isString:function(a){return a&&
"string"===typeof a},containsNonLatinCharacter:function(a){for(var d=0;d<a.length;d++)if(255<a.charCodeAt(d))return!0;return!1},getExprByFilterObj:function(a){if(!l.every(a.parts,function(a){return!!a}))return null;if(!this.isPartsObjReadyToBuild(a))return a.expr="",a.expr;var k="";if(0===a.parts.length)k="1\x3d1";else if(1===a.parts.length)k=this.builtFilterString(a.parts[0]);else for(var c="",f=0;f<a.parts.length;f++){var g=this.builtFilterString(a.parts[f]);if(!d.isDefined(g))return null;k+=c+
"("+g+")";c=c||" "+a.logicalOperator+" "}return a.expr=k},isPartsObjReadyToBuild:function(a){return l.every(a.parts,f.hitch(this,function(a){return a.parts?l.every(a.parts,f.hitch(this,function(a){return this._isPartReadyToBuild(a)})):this._isPartReadyToBuild(a)}))},_isPartReadyToBuild:function(a){var d=a.fieldObj.shortType,c=a.operator,f=a.valueObj;a=f.type||"value";var g=f.value,p=f.value1,f=f.value2;if("value"===a){if("string"===d)return c===this.OPERATORS.stringOperatorIsBlank||c===this.OPERATORS.stringOperatorIsNotBlank?
!0:q.isNotEmptyString(g);if("number"===d)return c===this.OPERATORS.numberOperatorIsBlank||c===this.OPERATORS.numberOperatorIsNotBlank?!0:c===this.OPERATORS.numberOperatorIsBetween||c===this.OPERATORS.numberOperatorIsNotBetween?q.isValidNumber(p)&&q.isValidNumber(f):q.isValidNumber(g);if("date"===d)return c===this.OPERATORS.dateOperatorIsBlank||c===this.OPERATORS.dateOperatorIsNotBlank?!0:c===this.OPERATORS.dateOperatorIsBetween||c===this.OPERATORS.dateOperatorIsNotBetween?q.isNotEmptyString(p)&&q.isNotEmptyString(f):
q.isNotEmptyString(g)}else{if("field"===a)return q.isNotEmptyString(g);if("unique"===a){if("string"===d)return q.isNotEmptyString(g);if("number"===d)return q.isValidNumber(g)}}return!1},builtFilterString:function(a){var k="";if(a.parts)for(var c="",f=0;f<a.parts.length;f++){var g=a.parts[f],p=this.builtSingleFilterString(g);g.expr=p.whereClause;if(!d.isDefined(p.whereClause))return null;k+=c+p.whereClause;c=" "+a.logicalOperator+" "}else k=this.builtSingleFilterString(a).whereClause;return a.expr=
k},_preBuiltSingleFilterString:function(a){if("string"===a.fieldObj.shortType&&"\x3cNull\x3e"===a.valueObj.value){if(a.operator===this.OPERATORS.stringOperatorIs)return{whereClause:a.fieldObj.name+" IS NULL"};if(a.operator===this.OPERATORS.stringOperatorIsNot)return{whereClause:a.fieldObj.name+" IS NOT NULL"}}if("number"===a.fieldObj.shortType&&"\x3cNull\x3e"===a.valueObj.value){if(a.operator===this.OPERATORS.numberOperatorIs)return{whereClause:a.fieldObj.name+" IS NULL"};if(a.operator===this.OPERATORS.numberOperatorIsNot)return{whereClause:a.fieldObj.name+
" IS NOT NULL"}}return null},builtSingleFilterString:function(a,k){this.isHosted&&(a.caseSensitive=!1);if(d.isDefined(a.valueObj.isValid)&&!a.valueObj.isValid)return{whereClause:null};var c=this._preBuiltSingleFilterString(a);if(c)return c;var c=a.valueObj.value,f=a.valueObj.value1,g=a.valueObj.value2,p=!1;a.interactiveObj&&d.isDefined(k)&&(p=!0,d.isDefined(a.valueObj.value)&&(c="{"+k+"}"),d.isDefined(a.valueObj.value1)&&(f="{"+k+"}"),d.isDefined(a.valueObj.value2)&&(g="{"+(k+1)+"}"));var e="";if("string"===
a.fieldObj.shortType)switch(f="",p&&this.isHosted?f="N":c&&"field"!==a.valueObj.type&&this.isHosted&&this.containsNonLatinCharacter(c)&&(f="N"),a.operator){case this.OPERATORS.stringOperatorIs:e="field"===a.valueObj.type?a.fieldObj.name+" \x3d "+c:a.fieldObj.name+" \x3d "+f+"'"+c.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorIsNot:e="field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+c:a.fieldObj.name+" \x3c\x3e "+f+"'"+c.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorStartsWith:e=
a.caseSensitive?a.fieldObj.name+" LIKE "+f+"'"+c.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+f+"'"+c.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorEndsWith:e=a.caseSensitive?a.fieldObj.name+" LIKE "+f+"'%"+c.replace(/\'/g,"''")+"'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+f+"'%"+c.replace(/\'/g,"''")+"')";break;case this.OPERATORS.stringOperatorContains:e=a.caseSensitive?a.fieldObj.name+" LIKE "+f+"'%"+c.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+
f+"'%"+c.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorDoesNotContain:e=a.caseSensitive?a.fieldObj.name+" NOT LIKE "+f+"'%"+c.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") NOT LIKE UPPER("+f+"'%"+c.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorIsBlank:e=a.fieldObj.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:e=a.fieldObj.name+" IS NOT NULL"}else if("number"===a.fieldObj.shortType)switch(a.operator){case this.OPERATORS.numberOperatorIs:e=
a.fieldObj.name+" \x3d "+c;break;case this.OPERATORS.numberOperatorIsNot:e=a.fieldObj.name+" \x3c\x3e "+c;break;case this.OPERATORS.numberOperatorIsAtLeast:e=a.fieldObj.name+" \x3e\x3d "+c;break;case this.OPERATORS.numberOperatorIsLessThan:e=a.fieldObj.name+" \x3c "+c;break;case this.OPERATORS.numberOperatorIsAtMost:e=a.fieldObj.name+" \x3c\x3d "+c;break;case this.OPERATORS.numberOperatorIsGreaterThan:e=a.fieldObj.name+" \x3e "+c;break;case this.OPERATORS.numberOperatorIsBetween:e=a.fieldObj.name+
" BETWEEN "+f+" AND "+g;break;case this.OPERATORS.numberOperatorIsNotBetween:e=a.fieldObj.name+" NOT BETWEEN "+f+" AND "+g;break;case this.OPERATORS.numberOperatorIsBlank:e=a.fieldObj.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:e=a.fieldObj.name+" IS NOT NULL"}else switch(d.isDefined(c)&&"field"!==a.valueObj.type&&"string"===typeof c&&(c=new Date(c)),"field"!==a.valueObj.type&&(c&&(c=new Date(c)),f&&(f=new Date(f)),g&&(g=new Date(g))),a.operator){case this.OPERATORS.dateOperatorIsOn:e=
"field"===a.valueObj.type?a.fieldObj.name+" \x3d "+c:p?a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+k+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(k+1)+"}'":a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(c)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(c))+"'";break;case this.OPERATORS.dateOperatorIsNotOn:e="field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+c:p?a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":
"timestamp ")+"'{"+k+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(k+1)+"}'":a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(c)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(c))+"'";break;case this.OPERATORS.dateOperatorIsBefore:e="field"===a.valueObj.type?a.fieldObj.name+" \x3c "+c:a.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(c)+"'";break;case this.OPERATORS.dateOperatorIsAfter:e="field"===a.valueObj.type?
a.fieldObj.name+" \x3e "+c:a.fieldObj.name+" \x3e "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(c))+"'";break;case this.OPERATORS.dateOperatorIsBetween:e=p?a.fieldObj.name+" BETWEEN '"+f+"' AND '"+g+"'":a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(g))+"'";break;case this.OPERATORS.dateOperatorIsNotBetween:e=p?a.fieldObj.name+" NOT BETWEEN '"+f+"' AND '"+g+"'":a.fieldObj.name+
" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(g))+"'";break;case this.OPERATORS.dateOperatorIsBlank:e=a.fieldObj.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:e=a.fieldObj.name+" IS NOT NULL"}return{whereClause:e}},formatDate:function(a){var d=h.format(a,{datePattern:"yyyy-MM-dd",selector:"date"});a=h.format(a,{selector:"time",timePattern:"HH:mm:ss"});return d+" "+a},addDay:function(a){return new Date(a.getTime()+
this.dayInMS)},getFilterObjByExpr:function(a){if(a&&this.fieldsStore){var d=this.replaceStrings(a);a=d.defExpr;var c=this.findParts(a,"AND");1===c.parts.length&&(c=this.findParts(a,"OR"),1===c.parts.length&&(c.logicalOperator="AND"));l.forEach(c.parts,function(a){a.expr=a.expr.trim();if(a.expr.startsWith("(")&&-1<a.expr.search(/\)$/)){var c=a.expr.substring(1,a.expr.length-1),d=c.indexOf("("),e=c.indexOf(")");if(-1===d&&-1===e||d<e)a.expr=c}c=this.findParts(a.expr,"AND");1===c.parts.length&&(c=this.findParts(a.expr,
"OR"));1<c.parts.length&&(a.parts=c.parts,a.logicalOperator=c.logicalOperator)},this);this.parseExpr(c);this.reReplaceStrings(d,c,f.hitch(this,function(){c&&c.parts&&l.forEach(c.parts,f.hitch(this,function(a){a&&(a.parts?l.forEach(a.parts,f.hitch(this,function(a){this._handleParsedValuesForSinglePart(a);this._addDefalutValueTypeForSinglePart(a)})):(this._handleParsedValuesForSinglePart(a),this._addDefalutValueTypeForSinglePart(a)))}))}));this.isPartsObjHasError(c)&&(c=null);return c}},_handleParsedValuesForSinglePart:function(a){a&&
a.fieldObj&&"number"===a.fieldObj.shortType&&a.valueObj&&(a.valueObj.hasOwnProperty("value")&&(a.valueObj.value=parseFloat(a.valueObj.value)),a.valueObj.hasOwnProperty("value1")&&(a.valueObj.value1=parseFloat(a.valueObj.value1)),a.valueObj.hasOwnProperty("value2")&&(a.valueObj.value2=parseFloat(a.valueObj.value2)))},_addDefalutValueTypeForSinglePart:function(a){a&&a.valueObj&&!a.valueObj.type&&(a.valueObj.type="value")},replaceStrings:function(a){for(var d=a,c=function(a,b,e){var d=-1,d=a.indexOf("'",
e+1);return d===e+1?(d=a.indexOf("'",d+1),c(a,b,d)):e},f=[],g=a.indexOf("'");-1<g;){var p=g,g=a.indexOf("'",g+1),e=0,g=c(a,p,g);"%"===a[p+1]&&p++;"%"===a[g-1]&&(--g,e++);var b=a.substring(p+1,g);"N"===a[p-1]&&(a=a.substring(0,p-1)+a.substring(p),--p,--g);this.isDateString(b)||-1!==b.indexOf("{")?g=a.indexOf("'",g+1+e):(f.push(b),a=a.substring(0,p+1)+"#"+(f.length-1)+"#"+a.substring(g),g=a.indexOf("'",a.lastIndexOf("#")+2+e))}return{origDefExpr:d,defExpr:a,savedStrings:f}},reReplaceStrings:function(a,
k,c){var h=a.savedStrings;if(!h.length)c&&"function"===typeof c&&c();else if(h.length){var g=function(a,b){if(void 0===a.valueObj||null===a.valueObj||void 0===a.valueObj.value||null===a.valueObj.value||"string"!==a.fieldObj.shortType)return!1;var c=a.valueObj.value.indexOf("#"),e=a.valueObj.value.lastIndexOf("#");return d.isDefined(a.valueObj.value)&&-1<c?(a.valueObj.value=b[parseInt(a.valueObj.value.substring(c+1,e),10)].replace(/\'\'/g,"'"),this.builtSingleFilterString(a),!0):!1},g=f.hitch(this,
g),p=!1;l.forEach(k.parts,function(a){if(a.parts){var b=!1;l.forEach(a.parts,function(a){b=g(a,h)||b});b&&(p=b,a.expr=this.builtFilterString(a))}else(p=g(a,h)||p)&&this.builtFilterString(a)},this);c&&"function"===typeof c&&c();p&&(k.expr=null,this.getExprByFilterObj(k))}},isDateString:function(a){return 19===a.length&&"-"===a.charAt(4)&&"-"===a.charAt(7)&&" "===a.charAt(10)&&":"===a.charAt(13)&&":"===a.charAt(16)?!0:!1},findParts:function(a,d){for(var c=a.toLowerCase(),k=" "+d.toLowerCase()+" ",g=
[],f=0,e=c.indexOf(k);0<e;){var b=a.substring(f,e),h=b.toLowerCase(),m=b.count("("),q=b.count(")"),l=b.count("'");m!==q||1===l%2?e=c.indexOf(k,e+1):-1<h.indexOf(" between ")&&-1===h.indexOf(" and ")?e=c.indexOf(k,e+1):(g.push({expr:b}),f=e+k.length,e=c.indexOf(k,f))}g.push({expr:a.substring(f)});for(c=g.length-1;0<=c;c--)!this.hasOperator(g[c].expr)&&0<c&&(g[c-1].expr+=" "+d+" "+g[c].expr,g.splice(c,1));return{expr:a,parts:g,logicalOperator:d}},hasOperator:function(a){a=a.toLowerCase();return-1<a.indexOf("{")&&
-1<a.indexOf("}")||-1<a.indexOf(" \x3d ")||-1<a.indexOf(" \x3c ")||-1<a.indexOf(" \x3e ")||-1<a.indexOf(" \x3c\x3e ")||-1<a.indexOf(" \x3c\x3d ")||-1<a.indexOf(" \x3e\x3d ")||-1<a.indexOf(" like ")||-1<a.indexOf(" between ")||-1<a.indexOf(" date")||-1<a.indexOf(" is null")||-1<a.indexOf(" is not null")?!0:!1},parseExpr:function(a){l.forEach(a.parts,function(a){a.parts?this.parseExpr(a):this.parseSingleExpr(a)},this)},_preParseSingleExpr:function(a){var d=null;try{if(d=f.clone(a),d.expr=d.expr.trim(),
/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(d.expr)){var c=a="",h=d.expr.match(/^UPPER\((.*)\)\s+/i);if(h&&2<=h.length)a=h[1];else return null;var g=d.expr.match(/UPPER\(N?'(.*)'\)$/i);if(g&&2<=g.length)c="'"+g[1]+"'";else return null;d.expr=d.expr.replace(/^UPPER\((.*)\)\s+/i,a+" ");d.expr=d.expr.replace(/UPPER\(N?'(.*)'\)$/i,c);d.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(d.expr)&&(d.caseSensitive=!0)}catch(p){return console.log(p),null}d&&this.isHosted&&
(d.caseSensitive=!1);return d},_removeOperator:function(a,d,c){d=d.substring(c).trim();"date"===a&&!this.isHosted&&d.toLowerCase().startsWith("timestamp ")&&(d=d.substring(10).trim());return d},parseSingleExpr:function(a){var k=this._preParseSingleExpr(a);k&&(a=f.mixin(a,k));var k=a.expr.trim(),c=k.indexOf(" "),h=k.substring(0,c);a.fieldObj={name:h};a.valueObj={};this.getFieldItemByName({name:h},function(c){a.fieldObj.shortType=c.shortType[0];a.fieldObj.label=c.label[0]},function(){a.error={msg:"unknown field name ("+
h+")",code:1}});k=k.substring(c+1).trim();c=k.toLowerCase();c.startsWith("\x3d ")?(k=this._removeOperator(a.fieldObj.shortType,k,2),this.storeValue(k,a),a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsOn:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):c.startsWith("\x3c ")?(k=this._removeOperator(a.fieldObj.shortType,k,2),this.storeValue(k,a),"date"===a.fieldObj.shortType?a.operator=this.OPERATORS.dateOperatorIsBefore:"number"===
a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsLessThan:a.error={msg:"operator ("+c+") not supported for string",code:3}):c.startsWith("\x3e ")?(k=this._removeOperator(a.fieldObj.shortType,k,2),this.storeValue(k,a),"date"===a.fieldObj.shortType?a.operator=this.OPERATORS.dateOperatorIsAfter:"number"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsGreaterThan:a.error={msg:"operator ("+c+") not supported for string",code:3}):c.startsWith("\x3c\x3e ")?(k=this._removeOperator(a.fieldObj.shortType,
k,3),this.storeValue(k,a),a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):c.startsWith("\x3c\x3d ")?(this.storeValue(k.substring(3).trim(),a),a.operator=this.OPERATORS.numberOperatorIsAtMost):c.startsWith("\x3e\x3d ")?(this.storeValue(k.substring(3).trim(),a),a.operator=this.OPERATORS.numberOperatorIsAtLeast):c.startsWith("like ")?(k=k.substring(5).trim(),k.startsWith("N'")&&
(k=k.substring(1,k.length)),k.startsWith("'%")&&k.endsWith("%'")?(this.storeValue(k.substring(2,k.length-2),a),a.operator=this.OPERATORS.stringOperatorContains):k.startsWith("'%")&&k.endsWith("'")?(this.storeValue(k.substring(2,k.length-1),a),a.operator=this.OPERATORS.stringOperatorEndsWith):k.startsWith("'")&&k.endsWith("%'")?(this.storeValue(k.substring(1,k.length-2),a),a.operator=this.OPERATORS.stringOperatorStartsWith):a.error={msg:"value ("+c+") not supported for LIKE",code:3}):c.startsWith("not like ")?
(k=k.substring(9).trim(),k.startsWith("N'")&&(k=k.substring(1,k.length)),k.startsWith("'%")&&k.endsWith("%'")?(this.storeValue(k.substring(2,k.length-2),a),a.operator=this.OPERATORS.stringOperatorDoesNotContain):a.error={msg:"value ("+c+") not supported for NOT LIKE",code:3}):c.startsWith("between ")?(k=this._removeOperator(a.fieldObj.shortType,k,8),c=k.toLowerCase().indexOf(" and "),-1<c?(this.storeValue1(k.substring(0,c).trim(),a),"date"!==a.fieldObj.shortType||this.isHosted?this.storeValue2(k.substring(c+
5).trim(),a):this.storeValue2(k.substring(c+15).trim(),a)):a.error={msg:"missing AND operator for BETWEEN",code:3},"date"===a.fieldObj.shortType?"string"===typeof a.valueObj.value1?a.operator=this.OPERATORS.dateOperatorIsBetween:1E3>Math.abs(this.subtractDay(a.valueObj.value2).getTime()-a.valueObj.value1.getTime())?(a.valueObj.value=a.valueObj.value1,delete a.valueObj.value1,delete a.valueObj.value2,a.operator=this.OPERATORS.dateOperatorIsOn):a.operator=this.OPERATORS.dateOperatorIsBetween:"number"===
a.fieldObj.shortType||"oid"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsBetween:a.error={msg:"string field not supported for BETWEEN",code:3}):c.startsWith("not between ")?(k=this._removeOperator(a.fieldObj.shortType,k,12),c=k.toLowerCase().indexOf(" and "),-1<c?(this.storeValue1(k.substring(0,c).trim(),a),"date"!==a.fieldObj.shortType||this.isHosted?this.storeValue2(k.substring(c+5).trim(),a):this.storeValue2(k.substring(c+15).trim(),a)):a.error={msg:"missing AND operator for NOT BETWEEN",
code:3},"date"===a.fieldObj.shortType?"string"===typeof a.valueObj.value1?a.operator=this.OPERATORS.dateOperatorIsNotBetween:1E3>Math.abs(this.subtractDay(a.valueObj.value2).getTime()-a.valueObj.value1.getTime())?(a.valueObj.value=a.valueObj.value1,delete a.valueObj.value1,delete a.valueObj.value2,a.operator=this.OPERATORS.dateOperatorIsNotOn):a.operator=this.OPERATORS.dateOperatorIsNotBetween:"number"===a.fieldObj.shortType||"oid"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsNotBetween:
a.error={msg:"string field not supported for NOT BETWEEN",code:3}):"is null"===c?(a.valueObj.value=null,a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):"is not null"===c?(a.valueObj.value=null,a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:this.OPERATORS.numberOperatorIsNotBlank):
a.error={msg:"unknown operator ("+c+")",code:2};if(d.isDefined(a.valueObj.value)&&"string"===typeof a.valueObj.value&&a.valueObj.value.startsWith("{")&&a.valueObj.value.endsWith("}")||d.isDefined(a.valueObj.value1)&&"string"===typeof a.valueObj.value1&&a.valueObj.value1.startsWith("{")&&a.valueObj.value1.endsWith("}"))a.isInteractive=!0},getFieldItemByName:function(a,d,c){this.fieldsStore.fetch({query:a,onComplete:f.hitch(this,function(a){a&&a.length?d(a[0]):c()})})},subtractDay:function(a){return new Date(a.getTime()-
this.dayInMS)},storeValue:function(a,d){if(a.startsWith("{")&&a.endsWith("}"))d.valueObj.value=a;else if(a.startsWith("'{")&&a.endsWith("}'"))d.valueObj.value=a.substring(1,a.length-1);else if("date"===d.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var c=a.substring(1,a.length-1);d.valueObj.value=this.parseDate(c)}else d.valueObj.value=a,d.valueObj.type="field";else"string"===d.fieldObj.shortType?(a.startsWith("#")||a.startsWith("%#"))&&(a.endsWith("#")||a.endsWith("#%"))?d.valueObj.value=
a:a.startsWith("'")&&a.endsWith("'")?d.valueObj.value=a.substring(1,a.length-1).replace(/\'\'/g,"'"):(d.valueObj.value=a,d.valueObj.type="field",this.getFieldItemByName({name:a},function(a){d.valueObj.label=a.label[0]},function(){d.error={msg:"unknown field name ("+a+")",code:1}})):(d.valueObj.value=a,isNaN(a)&&(d.valueObj.type="field",this.getFieldItemByName({name:a},function(a){d.valueObj.label=a.label[0]},function(){d.error={msg:"unknown field name ("+a+")",code:1}})))},storeValue1:function(a,
d){if(a.startsWith("{")&&a.endsWith("}"))d.valueObj.value1=a;else if(a.startsWith("'{")&&a.endsWith("}'"))d.valueObj.value1=a.substring(1,a.length-1);else if("date"===d.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var c=a.substring(1,a.length-1);d.valueObj.value1=this.parseDate(c)}else d.valueObj.value1=a,d.valueObj.type="field";else d.valueObj.value1=a,isNaN(a)&&(d.valueObj.type="field")},storeValue2:function(a,d){if(a.startsWith("{")&&a.endsWith("}"))d.valueObj.value2=a;else if(a.startsWith("'{")&&
a.endsWith("}'"))d.valueObj.value2=a.substring(1,a.length-1);else if("date"===d.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var c=a.substring(1,a.length-1);d.valueObj.value2=this.parseDate(c)}else d.valueObj.value2=a,d.valueObj.type="field";else d.valueObj.value2=a,isNaN(a)&&(d.valueObj.type="field")},parseDate:function(a){var d=h.parse(a,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});d||(d=h.parse(a.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(d=h.parse(a.replace(" ",
" - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return d}})})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(n,f,l){return n(null,{constructor:function(){this.panelManager=l.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(f){},getConfigById:function(f){for(var d=this.getAllConfigs(),
h=0;h<d.length;h++)if(d[h].id===f)return d[h]},getAllConfigs:function(){var h=[],h=h.concat(this.getWidgetConfigs(),this.getGroupConfigs()),h=f.filter(h,function(d){return d.visible});return h.sort(function(d,f){return d.index-f.index})},getAllConfigsIncludeInvisible:function(){var f=[],f=f.concat(this.getWidgetConfigs(),this.getGroupConfigs());return f.sort(function(d,f){return d.index-f.index})},isControlled:function(h){return f.some(this.getAllConfigsIncludeInvisible(),function(d){return d.id===
h})},widgetIsControlled:function(h){return f.some(this.getAllConfigsIncludeInvisible(),function(d){return d.id===h?!0:f.some(d.widgets,function(d){return d.id===h})})},getGroupConfigs:function(){var h=[];if(!this.appConfig.widgetPool)return h;this.appConfig.widgetPool.groups&&f.forEach(this.appConfig.widgetPool.groups,function(d){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(d.id)&&h.push(d):"all"===this.controlledGroups&&h.push(d))},this);return h},
getWidgetConfigs:function(){var h=[];if(!this.appConfig.widgetPool)return h;this.appConfig.widgetPool.widgets&&f.forEach(this.appConfig.widgetPool.widgets,function(d){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(d.id)&&h.push(d):"all"===this.controlledWidgets&&h.push(d))},this);return h}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),
function(n,f,l,h,d,m,q,a){var k=null,c=null,r=!1;n=n(null,function(){});var g=require.toUrl("jimu"),p=m(g+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),e=m(g+"/SpatialReference/transform.json",{handleAs:"json"});n.loadResource=function(){var a=new h;if(k&&c)return a.resolve(),a;d([p,e]).then(function(b){k=b[0];c=b[1];r=!0;a.resolve()},function(b){console.error(b);r=!1;a.reject(b)});return a};n.getAllCSUnits=function(){if(r){var a=[];l.forEach(k.wkids,f.hitch(this,function(b){b=this.getCSUnit(b);
-1===l.indexOf(a,b)&&a.push(b)}));return a}};n.convertUnit=function(b,c,e){if(r)return a.convertUnit(b,c,e)};n.getUnitRate=function(b,c){if(r)return a.getUnitRate(b,c)};n.isProjectUnit=function(b){if(r)return a.isProjectUnit(b)};n.isGeographicUnit=function(b){if(r)return a.isGeographicUnit(b)};n.getGeographicUnits=function(){if(r)return a.getGeographicUnits()};n.getProjectUnits=function(){if(r)return a.getProjectUnits()};n.getCSUnit=function(a){if(r){a=this.getCSStr(a);var b=0,c=0,b=a.lastIndexOf("UNIT"),
c=a.indexOf(",",b);return a.slice(b+6,c-1)}};n.isSameSR=function(a,c){if(r){var b=this.indexOfWkid(a),e=this.indexOfWkid(c);return k.labels[b]===k.labels[e]}};n.isValidWkid=function(a){if(r)return-1<this.indexOfWkid(a)};n.getSRLabel=function(a){if(r&&this.isValidWkid(a))return a=this.indexOfWkid(a),k.labels[a]};n.indexOfWkid=function(a){if(r)return l.indexOf(k.wkids,a)};n.isWebMercator=function(a){return q.prototype._isWebMercator?q.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new q(parseInt(a,
10))).isWebMercator()};n.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};n.isValidTfWkid=function(a){if(r)return-1<this.indexOfTfWkid(a)};n.getTransformationLabel=function(a){if(r)return this.isValidTfWkid(a)?(a=this.indexOfTfWkid(a),c.labels[a]):""};n.indexOfTfWkid=function(a){if(r)return l.indexOf(c.tfWkids,a)};n.isGeographicCS=function(a){if(r)return this.isValidWkid(a)?k.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};n.isProjectedCS=function(a){if(r)return this.isValidWkid(a)?
k.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};n.getGeoCSByProj=function(a){if(r&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=l.indexOf(k.details,a),k.wkids[a]};n.getSpheroidStr=function(a){if(r){if(this.isGeographicCS(a))return k.details[this.indexOfWkid(a)];if(this.isProjectedCS(a)){a=k.details[this.indexOfWkid(a)];var b=a.indexOf("GEOGCS"),c=a.indexOf("PROJECTION")-1;return a.slice(b,c)}return null}};n.getCSStr=function(a){if(r)return k.details[this.indexOfWkid(a)]};n.isSameSpheroid=
function(a,c){if(r){var b=this.getSpheroidStr(a),e=this.getSpheroidStr(c);return b&&e&&b===e?!0:!1}};return n})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(n,f){var l="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
h="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),d={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,
YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897},m=n(null,function(){});m.convertUnit=function(f,a,k){return d[f.toUpperCase()]/d[a.toUpperCase()]*k};m.getUnitRate=function(f,a){return d[f.toUpperCase()]/d[a.toUpperCase()]};m.isProjectUnit=function(d){return-1<f.indexOf(l,d.toUpperCase())};m.isGeographicUnit=function(d){return-1<
f.indexOf(h,d.toUpperCase())};m.getGeographicUnits=function(){return h};m.getProjectUnits=function(){return l};return m})},"jimu/dijit-all":function(){define([],1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),function(n,f,l,h,d,m,q,a){return n(f,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,constructor:function(){},postCreate:function(){q.create("div",
{"class":"jimu-radio-inner"},this.domNode);this.checked&&m.add(this.domNode,"jimu-radio-checked");this.own(d(this.domNode,"click",l.hitch(this,function(){this.checked||this.check()})))},check:function(a){void 0===a&&(a=!0);this.checked=!0;m.add(this.domNode,"jimu-radio-checked");a&&this._changeOthersState(!1);this.onStateChange()},uncheck:function(a){void 0===a&&(a=!0);this.checked=!1;m.remove(this.domNode,"jimu-radio-checked");a&&this._changeOthersState(!1);this.onStateChange()},_changeOthersState:function(d){null!==
this.group&&h.forEach(a.toArray(),function(a){a.id!==this.id&&a["class"]===this["class"]&&a.group===this.group&&(d?a.check(!1):a.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/Evented".split(" "),function(n,f,l,h,d,m,q){return n([f,q],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",checked:!1,status:!0,label:"",postCreate:function(){this.checkNode=
h.create("div",{"class":"checkbox jimu-float-leading"},this.domNode);this.labelNode=h.create("div",{"class":"label jimu-float-leading",innerHTML:this.label||""},this.domNode);this.checked&&h.addClass(this.checkNode,"checked");this.status||h.addClass(this.domNode,"jimu-state-disabled");this.own(m(this.checkNode,"click",l.hitch(this,function(){this.status&&(this.checked?this.uncheck():this.check())})));this.own(m(this.labelNode,"click",l.hitch(this,function(){this.checked&&this.status?this.uncheck():
this.status&&this.check()})));this._udpateLabelClass()},setLabel:function(a){this.label=a;this.labelNode.innerHTML=this.label;this._udpateLabelClass()},_udpateLabelClass:function(){this.labelNode&&(this.labelNode.innerHTML?h.removeClass(this.labelNode,"not-visible"):h.addClass(this.labelNode,"not-visible"))},setValue:function(a){this.status&&(!0===a?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(a){a=!!a;var k=this.status!==a;(this.status=a)?d.remove(this.domNode,
"jimu-state-disabled"):d.add(this.domNode,"jimu-state-disabled");k&&this.emit("status-change",a)},getStatus:function(){return this.status},check:function(){this.status&&(this.checked=!0,h.addClass(this.checkNode,"checked"),this.onStateChange())},uncheck:function(a){if(this.status&&(this.checked=!1,h.removeClass(this.checkNode,"checked"),!a))this.onStateChange()},onStateChange:function(){if(this.onChange&&l.isFunction(this.onChange))this.onChange(this.checked);this.emit("change",this.checked)}})})},
"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr jimu/utils jimu/symbolUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font jimu/dijit/ImageChooser jimu/dijit/ColorPicker jimu/dijit/_Transparency dijit/form/Select dijit/form/NumberSpinner".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z,x,A){return n([f,l,h,m],{templateString:d,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,_customPictureMarkerSymbol:null,symbol:null,type:null,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser},postCreate:function(){this.inherited(arguments);this._initImageChooser();this.own(c(document.body,
"click",q.hitch(this,this._onBodyClicked)));(this._isIE8=8===r("ie"))&&a.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(a){this.reset();var b=a&&a.declaredClass;b&&"string"===typeof b&&0<=b.indexOf("esri.symbol")&&(this.symbol=this._cloneSymbol(a),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",
this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(a){this.reset();if("marker"===a||"line"===a||"fill"===a||"text"===a)this.type=a,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===
this.type&&this._initTextSection()},getSymbol:function(){var a=null;"marker"===this.type?a=this._getPointSymbolBySetting():"line"===this.type?a=this._getLineSymbolBySetting():"fill"===this.type?a=this._getFillSymbolBySetting():"text"===this.type&&(a=this._getTextSymbolBySetting());var b=null;a&&(b=this._cloneSymbol(a));return b},hideColorPicker:function(){for(var a="pointColor pointOutlineColor lineColor fillColor fillOutlineColor textColor".split(" "),b=0,c=a.length;b<c;b++){var e=a[b];this[e]&&
this[e].hideTooltipDialog()}},_onBodyClicked:function(a){a=a.target||a.srcElement;this._tryHideDropDownOfSelectDijit(a,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(a,this.lineStylesSelect)},_tryHideDropDownOfSelectDijit:function(b,c){var e=c.domNode,d=c.dropDown.domNode,e=b===e||a.isDescendant(b,e),d=b===d||a.isDescendant(b,d);if(!e&&!d)c.dropDown.onCancel()},_onChange:function(a){a=this._cloneSymbol(a);this.emit("change",a)},_hideAllSections:function(){g(".symbol-section",this.domNode).style("display",
"none")},_showSection:function(a){this._hideAllSections();g("."+a+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(a,b,c){return e.getAncestorDom(a,b,c)},_getAbsoluteUrl:function(a){return window.location.protocol+"//"+window.location.host+require.toUrl(a)},_cloneSymbol:function(a){if(!a)return null;var b=a;try{var c=a.toJson(),b=u.fromJson(c)}catch(C){console.error(C)}return b},_createSymbolIconTable:function(b,c,e){var d=this.type+"-icon-table";b=a.toDom('\x3ctable class\x3d"'+
("icon-table "+d+" "+(d+"-"+b))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');for(var d=g("tbody",b)[0],f=Math.ceil(c.length/8),p=0;p<f;p++)a.create("tr",{},d);var h=g("tr",b);k.forEach(c,q.hitch(this,function(b,c){var d=q.clone(b),g=u.fromJson(b),k=a.create("td",{},h[Math.floor(c/8)]);a.addClass(k,"symbol-td-item");g=this._createSymbolNode(g);a.addClass(g,"symbol-div-item");var f=g.firstChild;a.addClass(f,"svg-node");if(this._isIE8&&"point"===e)if(window.isRTL){if("Cross"===b.name||"X"===b.name)a.setStyle(f,
"right","-20px"),a.setStyle(g,"marginTop","20px")}else"Cross"!==b.name&&"X"!==b.name||a.setStyle(g,"marginTop","20px");g.symbol=d;a.place(g,k)}));return b},_updatePreview:function(c){var e=this._cloneSymbol(this.symbol);a.empty(c);(e=b.createSymbolNode(e))||(e=a.create("div"));a.place(e,c)},_createSymbolNode:function(c){(c=b.createSymbolNode(c,{width:36,height:36}))||(c=a.create("div"));a.setStyle(c,{width:"36px",height:"36px"});return c},_getLineShapeDesc:function(a){var b=null;if(this.isSimpleLineSymbol(a)||
this.isCartographicLineSymbol(a))b={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:a.getStroke()};return b},_initPointSection:function(){this._showSection("point");this._pointEventsBinded||(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showBuildInPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new t({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,
0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(c(this.pointIconTables,".symbol-div-item:click",q.hitch(this,this._onPointSymIconItemClick)));this.own(c(this.pointSymClassSelect,"change",q.hitch(this,this._onPointSymClassSelectChange)));this.own(c(this.pointSize,"change",q.hitch(this,this._onPointSymbolChange)));this.own(c(this.pointColor,"change",q.hitch(this,
this._onPointSymbolChange)));this.own(c(this.pointAlpha,"change",q.hitch(this,this._onPointSymbolChange)));this.own(c(this.pointOutlineColor,"change",q.hitch(this,this._onPointSymbolChange)));this.own(c(this.pointOutlineWidth,"change",q.hitch(this,this._onPointSymbolChange)))},_onPointSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(),this._onChange(this.symbol))},_initPointSettings:function(a){if(a){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(a)){if(this.pointSize.set("value",
a.size),this.pointColor.setColor(a.color),this.pointAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a=a.outline)this.pointOutlineColor.setColor(a.color),this.pointOutlineWidth.set("value",parseFloat(a.width.toFixed(0)))}else this.isPictureMarkerSymbol(a)&&this.pointSize.set("value",a.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(a){return a&&"esri.symbol.SimpleMarkerSymbol"===a.declaredClass},isPictureMarkerSymbol:function(a){return a&&"esri.symbol.PictureMarkerSymbol"===
a.declaredClass},_isCustomImageOptionSelected:function(){return"custom"===this.pointSymClassSelect.get("value")},_onPointSymClassSelectChange:function(){if(this._isCustomImageOptionSelected())this._showCustomPictureMarkerSymSettings(),this._customPictureMarkerSymbol&&(this.symbol=this._customPictureMarkerSymbol,this._onPointSymbolChange());else{this._showSimpleMarkerSymSettings();this._showSelectedPointSymIconTable();var a=this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+a]||this._requestPointSymJson(a);
a=this.pointSymClassSelect.getOptions(a);this.pointSymClassSelect.domNode.title=a?a.label:""}},_hideAllPointSymIconTable:function(){g(".marker-icon-table",this.pointIconTables).style("display","none")},_showSelectedPointSymIconTable:function(){this._hideAllPointSymIconTable();var a=this.pointSymClassSelect.get("value"),a=g(".marker-icon-table-"+a,this.pointIconTables);0<a.length&&a.style("display","table")},_requestPointSymJson:function(b){var c="def"+b,e=this.pointSymClassSelect[c];e||(e=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+
b+".json"),e=p(e,{handleAs:"json"}),this.pointSymClassSelect[c]=e,e.then(q.hitch(this,function(c){this.domNode&&(c=this._createSymbolIconTable(b,c,"point"),a.place(c,this.pointIconTables),this._showSelectedPointSymIconTable())}),q.hitch(this,function(a){console.error("get point symbol failed",a)})))},_onPointSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(b){return a.hasClass(b,"symbol-div-item")},5))if(g(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),
a.addClass(b,"selected-symbol-div-item"),b=b.symbol){this.symbol=u.fromJson(b);b=a.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():this._showBuildInPictureMarkerSymSettings();this._onPointSymbolChange();var c=a.getStyle(this.pointColorTr,"display");b!==c&&this.emit("resize")}},_showSimpleMarkerSymSettings:function(){a.addClass(this.pointCustomImageTr,"hidden");a.removeClass(this.pointIconTablesTr,"hidden");a.removeClass(this.pointColorTr,
"hidden");a.removeClass(this.pointOpacityTr,"hidden");a.removeClass(this.pointOutlineColorTr,"hidden");a.removeClass(this.pointOulineWidthTr,"hidden")},_showBuildInPictureMarkerSymSettings:function(){a.addClass(this.pointCustomImageTr,"hidden");a.removeClass(this.pointIconTablesTr,"hidden");a.addClass(this.pointColorTr,"hidden");a.addClass(this.pointOpacityTr,"hidden");a.addClass(this.pointOutlineColorTr,"hidden");a.addClass(this.pointOulineWidthTr,"hidden")},_showCustomPictureMarkerSymSettings:function(){a.removeClass(this.pointCustomImageTr,
"hidden");a.addClass(this.pointIconTablesTr,"hidden");a.addClass(this.pointColorTr,"hidden");a.addClass(this.pointOpacityTr,"hidden");a.addClass(this.pointOutlineColorTr,"hidden");a.addClass(this.pointOulineWidthTr,"hidden")},_getPointSymbolBySetting:function(){if(!this.symbol)return null;var a=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){this.symbol.setSize(a);var a=this.pointColor.getColor(),b=this.pointAlpha.getAlpha();a.a=b;this.symbol.setColor(a);var a=this.pointOutlineColor.getColor(),
b=parseFloat(this.pointOutlineWidth.get("value")),c=new w;c.setStyle(w.STYLE_SOLID);c.setColor(a);c.setWidth(b);this.symbol.setOutline(c)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(a),this.symbol.setHeight(a));this._updatePreview(this.pointSymPreview);return this.symbol},_initImageChooser:function(){this.imageChooser=new A({cropImage:!1,showSelfImg:!1,goldenWidth:16,goldenHeight:16,format:["image/gif","image/png","image/jpeg"],label:this.nls.chooseFile});a.addClass(this.imageChooser.domNode,
"custom-image-chooser");this.own(c(this.imageChooser,"change",q.hitch(this,this._onImageChange)));this.imageChooser.placeAt(this.customImageTd,"first")},_onImageChange:function(a,b){this.imageNameNode.innerHTML=b.fileName;a=a.replace(/^data:image\/.*;base64,/,"");var c=parseFloat(this.pointSize.get("value"));this._customPictureMarkerSymbol=this.symbol=new v({type:"esriPMS",url:null,imageData:a,contentType:"image/png",color:null,width:c,height:c,angle:0,xoffset:0,yoffset:0});this._onPointSymbolChange()},
_initLineSection:function(){this._showSection("line");this._lineEventBinded||(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(c(this.lineIconTables,".symbol-div-item:click",q.hitch(this,this._onLineSymIconItemClick)));this.own(c(this.lineColor,"change",q.hitch(this,this._onLineSymbolChange)));this.own(c(this.lineStylesSelect,"change",q.hitch(this,this._onLineSymbolChange)));
this.own(c(this.lineAlpha,"change",q.hitch(this,this._onLineSymbolChange)));this.own(c(this.lineWidth,"change",q.hitch(this,this._onLineSymbolChange)))},_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.lineColor.setColor(a.color),this.lineAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(a.width.toFixed(0))),this.lineStylesSelect.set("value",
a.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(a){return a&&"esri.symbol.SimpleLineSymbol"===a.declaredClass},isCartographicLineSymbol:function(a){return a&&"esri.symbol.CartographicLineSymbol"===a.declaredClass},_requestLineSymJson:function(b){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");p(c,{handleAs:"json"}).then(q.hitch(this,function(c){this.domNode&&(c=this._createSymbolIconTable(b,c,"line"),a.place(c,this.lineIconTables))}),q.hitch(this,function(a){console.error("get line symbol failed",
a)}))},_onLineSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(b){return a.hasClass(b,"symbol-div-item")},5))if(g(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),a.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=u.fromJson(b),this._initLineSettings(b),this._onLineSymbolChange()},_getLineSymbolBySetting:function(){this.symbol=new w;var a=this.lineColor.getColor(),b=this.lineStylesSelect.get("value");a.a=
this.lineAlpha.getAlpha();var c=parseFloat(this.lineWidth.get("value"));this.symbol.setStyle(b);this.symbol.setColor(a);this.symbol.setWidth(c);this._updatePreview(this.lineSymPreview);return this.symbol},_initFillSection:function(){this._showSection("fill");this._fillEventBinded||(this._fillEventBinded=!0,this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(c(this.fillIconTables,".symbol-div-item:click",
q.hitch(this,this._onFillSymIconItemClick)));this.own(c(this.fillColor,"change",q.hitch(this,this._onFillSymbolChange)));this.own(c(this.fillAlpha,"change",q.hitch(this,this._onFillSymbolChange)));this.own(c(this.fillOutlineColor,"change",q.hitch(this,this._onFillSymbolChange)));this.own(c(this.fillOutlineWidth,"change",q.hitch(this,this._onFillSymbolChange)))},_onFillSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getFillSymbolBySetting(),this._onChange(this.symbol))},_initFillSettings:function(a){a&&
(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(a.color),this.fillAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a.outline&&(this.fillOutlineColor.setColor(a.outline.color),this.fillOutlineWidth.set("value",parseInt(a.outline.width,10))),this._invokeSymbolChangeEvent=!0)},_isSimpleFillSymbol:function(a){return a&&"esri.symbol.SimpleFillSymbol"===a.declaredClass},_requestFillSymJson:function(b){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");p(c,{handleAs:"json"}).then(q.hitch(this,
function(c){this.domNode&&(c=this._createSymbolIconTable(b,c,"fill"),a.place(c,this.fillIconTables))}),q.hitch(this,function(a){console.error("get fill symbol failed",a)}))},_onFillSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(b){return a.hasClass(b,"symbol-div-item")},5))if(g(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),a.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=u.fromJson(b),this._initFillSettings(b),
this._onFillSymbolChange()},_getFillSymbolBySetting:function(){this.symbol=new y;var a=this.fillColor.getColor();a.a=this.fillAlpha.getAlpha();var b=this.fillOutlineColor.getColor(),c=parseInt(this.fillOutlineWidth.get("value"),10);this.symbol.setColor(a);this.symbol.setStyle(y.STYLE_SOLID);a=new w;a.setStyle(w.STYLE_SOLID);a.setColor(b);a.setWidth(c);this.symbol.setOutline(a);this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||
(this._textEventBinded=!0,this._bindTextEvents());this._initTextSettings();this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(c(this.inputText,"change",q.hitch(this,this._onTextSymbolChange)));this.own(c(this.textColor,"change",q.hitch(this,this._onTextSymbolChange)));this.own(c(this.textFontSize,"change",q.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(a){a&&
(this._invokeSymbolChangeEvent=!1,this.inputText.value=a.text,this.textColor.setColor(a.color),a=parseInt(a.font.size,10),this.textFontSize.set("value",a),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(a){return a&&"esri.symbol.TextSymbol"===a.declaredClass},_updateTextPreview:function(){var b=this.textColor.getColor().toHex(),c=parseInt(this.textFontSize.get("value"),10)+"px";a.setStyle(this.textPreview,{color:b,fontSize:c});this.textPreview.innerHTML=this.inputText.value},_getTextSymbolBySetting:function(){this.symbol=
new z;var a=this.inputText.value,b=this.textColor.getColor(),c=parseInt(this.textFontSize.get("value"),10),e=new x;e.setSize(c);this.symbol.setText(a);this.symbol.setColor(b);this.symbol.setFont(e);this._updateTextPreview();return this.symbol}})})},"jimu/dijit/ImageChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/text!./templates/ImageChooser.html dojo/sniff dojo/request esri/lang ../utils ./_CropImage jimu/dijit/Popup jimu/dijit/Message jimu/dijit/LoadingShelter".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u){var t=0;n=f([l,h,n],{templateString:a,declaredClass:"jimu.dijit.ImageChooser",cropImage:!0,displayImg:null,defaultSelfSrc:null,showSelfImg:!1,label:null,showTip:!0,goldenWidth:400,goldenHeight:400,maxSize:1024,format:null,imageData:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.imageChooser;this.nls.common=window.jimuNls.common;this.nls.readError=this.nls.readError||"Failed to read the file."},postCreate:function(){this._initial();
g.file.supportHTML5()||k("safari")||!g.file.isEnabledFlash()||g.file.loadFileAPI().then(d.hitch(this,function(){m.setStyle(this.mask,"zIndex",1)}))},setImageSize:function(a){this.goldenWidth=a.width;this.goldenHeight=a.height},disableChooseImage:function(){m.setStyle(this.fileForm,"display","none");this.label&&"string"===typeof this.label&&m.addClass(this.displayText,"disable-label");m.removeAttr(this.domNode,"title")},enableChooseImage:function(){m.setStyle(this.fileForm,"display","block");this.label&&
"string"===typeof this.label&&m.removeClass(this.displayText,"disable-label");this._addTip()},setDefaultSelfSrc:function(a){this.defaultSelfSrc=a;this.imageData=this.selfImg.src=a},getImageData:function(){return this.imageData},_initial:function(){this._processProperties();this._porcessMaskClick();this._setupFileInput();this._addTip()},_processProperties:function(){this.fileProperty={};this.label&&"string"===typeof this.label&&(this.displayText.innerHTML=this.label,m.setStyle(this.hintText,"display",
"block"));this.showSelfImg&&m.setStyle(this.hintImage,"display","block");this.defaultSelfSrc&&(this.imageData=this.selfImg.src=this.defaultSelfSrc);if(this.format){var a="image/*";"string"===typeof this.format&&/^image\/./.test(this.format)?a=this.format:"[object Array]"===Object.prototype.toString.call(this.format)&&0<this.format.length&&(a=this.format.join(","));m.setAttr(this.fileInput,"accept",a)}g.file.supportHTML5()||k("safari")||!g.file.isEnabledFlash()||m.setStyle(this.fileInput,{width:"100%",
height:"100%",position:"absolute",left:0,top:0,opacity:0,zIndex:9})},_porcessMaskClick:function(){m.setAttr(this.fileInput,"id","imageChooser_"+t);m.setAttr(this.mask,"for","imageChooser_"+t);t++;this.maskHandle=q(this.mask,"click",d.hitch(this,function(a){a.stopPropagation();if(k("safari")&&7>k("safari"))new b({message:this.nls.unsupportReaderAPI}),a.preventDefault();else{if(!g.file.supportHTML5()){if(!g.file.isEnabledFlash()){var c=m.create("a",{href:"http://helpx.adobe.com/flash-player.html",innerHTML:this.nls.enableFlash,
target:"_blank"});new b({message:c});a.preventDefault();return}if(!g.file.supportFileAPI()){new b({message:this.nls.unsupportReaderAPI});a.preventDefault();return}}m.setStyle(this.fileInput,"display","none");setTimeout(d.hitch(this,function(){m.setStyle(this.fileInput,"display","block")}),200)}}))},_addTip:function(){if(this.showTip){var a=r.substitute({width:this.goldenWidth||40,height:this.goldenHeight||40},this.nls.toolTip);m.setAttr(this.domNode,"title",a)}else m.setAttr(this.domNode,"title",
"")},_setupFileInput:function(){if(9>=k("ie"))this.own(q(this.fileInput,"change",d.hitch(this,this._onFileInputChange)));else q.once(this.fileInput,"change",d.hitch(this,this._onFileInputChange))},_onFileInputChange:function(a){var c=a.target.files&&a.target.files[0]||a.files&&a.files[0];if(this.format&&-1===this.format.indexOf(c.type))new b({message:this.nls.invalidType}),(!k("ie")||9<k("ie"))&&this._recreateFileForm();else{var e=9>k("ie")?23552:1024*this.maxSize;g.file.readFile(a,"image/*",e,d.hitch(this,
function(a,d,g){a?(d=this.nls[a.errCode],"exceed"===a.errCode&&(d=d.replace("1024",e/1024)),new b({message:d})):(this.fileProperty.fileName=d,window.isXT&&this.cropImage&&"image/gif"!==c.type?this._cropImageByUser(g):this._readFileData(g));(!k("ie")||9<k("ie"))&&this._recreateFileForm()}))}},_recreateFileForm:function(){var a=d.clone(this.mask),b=d.clone(this.fileInput);m.destroy(this.mask);m.destroy(this.fileInput);var c=d.clone(this.fileForm);m.place(a,c);m.place(b,c);m.place(c,this.fileForm,"replace");
this.maskHandle.remove();this.mask=a;this.fileInput=b;m.destroy(this.fileForm);this.fileForm=c;this._porcessMaskClick();this._setupFileInput()},_readFileData:function(a){this.onImageChange(a,this.fileProperty);this.displayImg&&m.setAttr(this.displayImg,"src",a);this.showSelfImg&&(this.selfImg?m.setAttr(this.selfImg,"src",a):this.selfImg.src=a)},_cropImageByUser:function(a){var g=new p({imageSrc:a,nls:d.clone(this.nls),realWidth:this.goldenWidth,realHeight:this.goldenHeight}),k=new u({hidden:!0}),
f=new e({titleLabel:this.nls.cropImage,content:g,width:500,height:480,buttons:[{label:this.nls.common.ok,onClick:d.hitch(this,function(){var e=g.getImageSize(),p=g.getCropSize();k.show();c("/webappbuilder/rest/cropimage",{data:{imageData:a,imageDisplaySize:e.w+","+e.h,cropRectangle:p.w+","+p.h+","+p.t+","+p.l},method:"POST",handleAs:"json",headers:{"X-Requested-With":null}}).then(d.hitch(this,function(a){a.success?(this._readFileData(a.imageData),f.close()):(new b({message:this.nls.unknowError}),
k.hide())}),d.hitch(this,function(a){console.error(a);new b({message:this.nls.unknowError});k.hide()}))})}]});k.placeAt(f.domNode);g.startup();m.addClass(f.domNode,"image-chooser-crop-popup")},onImageChange:function(a){this.imageData=a;this.emit("imageChange",this.imageData,this.fileProperty);this.emit("change",this.imageData,this.fileProperty)}});n.GIF="image/gif";n.JPEG="image/jpeg";n.PNG="image/png";return n})},"jimu/dijit/_CropImage":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_CropImage.html jimu/dijit/Message esri/lang dojo/NodeList-dom".split(" "),
function(n,f,l,h,d,m,q,a,k,c){return n([m,q],{templateString:a,inDrag:!1,inSlider:!1,realWidth:30,realHeight:30,ratio:null,imageSrc:null,_currentX:null,_currentY:null,_currentTop:0,_currentLeft:0,postCreate:function(){this._dragingHandlers=[];this.setImageSrc(this.imageSrc);this.own(h(this.ownerDocument,"mousemove",l.hitch(this,"_onMouseMove")));this.own(h(this.ownerDocument,"mouseup",l.hitch(this,"_onMouseUp")));this.loadingImg.src=require.toUrl("jimu")+"/images/loading.gif";this.own(h(this.baseImage,
"load",l.hitch(this,function(){this._init();f.setStyle(this.loadingImg,"display","none")})))},setImageSrc:function(a){f.setAttr(this.viewerImage,"src",a);f.setAttr(this.baseImage,"src",a)},getImageSize:function(){return{w:this._currentImageWidth,h:this._currentImageHeight}},getCropSize:function(){return{l:-this._currentLeft,t:-this._currentTop,w:this.idealWidth,h:this.idealHeight}},_init:function(){var a=this._getComputedStyle(this.cropSection),g=f.getContentBox(this.cropSection),p=this._getComputedStyle(this.baseImage),
e=parseFloat(p.width)||this.baseImage.offsetWidth,p=parseFloat(p.height)||this.baseImage.offsetHeight,b=e/p;this._maxImageWidth=e;this._maxImageHeight=p;if(p<this.realHeight&&e<this.realWidth)a=c.substitute({width:this.realWidth,height:this.realHeight},this.nls.cropWaining),setTimeout(l.hitch(this,function(){this.popup.close()}),50),new k({message:a});else{this.idealWidth=this.realWidth;this.idealHeight=this.realHeight;var h=this.ratio=this.ratio?this.ratio:this.realWidth/this.realHeight;1<=this.ratio?
g.h*this.ratio<=g.w?(this.idealHeight=g.h,this.idealWidth=g.h*this.ratio):(this.idealHeight=this._findProperlyValue(0,g.h,g.w-5,function(a){return a*h}),this.idealWidth=this.idealHeight*this.ratio):g.w/this.ratio<=g.h?(this.idealWidth=g.w,this.idealHeight=g.w/this.ratio):(this.idealWidth=this._findProperlyValue(0,g.w,g.h-5,function(a){return a/h}),this.idealHeight=this.idealWidth/this.ratio);f.setStyle(this.viewerBox,{width:this.idealWidth+"px",height:this.idealHeight+"px"});a=Math.abs((parseFloat(a.height)-
this.idealHeight)/2);f.setStyle(this.cropSection,{paddingTop:a+"px",paddingBottom:a+"px"});1<=b?this.idealHeight*b>=this.idealWidth?(f.setStyle(this.viewerImage,"height",this.idealHeight+"px"),f.setStyle(this.baseImage,"height",this.idealHeight+"px")):(a=this._findProperlyValue(0,this.idealWidth,this.idealWidth,function(a){return a*b}),f.setStyle(this.viewerImage,"height",a+"px"),f.setStyle(this.baseImage,"height",a+"px")):this.idealWidth/b>=this.idealHeight?(f.setStyle(this.viewerImage,"width",this.idealWidth+
"px"),f.setStyle(this.baseImage,"width",this.idealWidth+"px")):(a=this._findProperlyValue(0,this.idealHeight,this.idealHeight,function(a){return a/b}),f.setStyle(this.viewerImage,"width",a+"px"),f.setStyle(this.baseImage,"width",a+"px"));d(".hide-status",this.domNode).removeClass("hide-status");p=this._getComputedStyle(this.baseImage);e=parseFloat(p.width)||this.baseImage.offsetWidth;p=parseFloat(p.height)||this.baseImage.offsetHeight;this._minImageWidth=e;this._minImageHeight=p;this._currentImageWidth=
e;this._currentImageHeight=p;this._currentTop=-(p-this.idealHeight)/2;this._currentLeft=-(e-this.idealWidth)/2;f.setStyle(this.baseImage,{top:this._currentTop+"px",left:this._currentLeft+"px"});f.setStyle(this.viewerImage,{top:this._currentTop+"px",left:this._currentLeft+"px"});this._zoomRatio=this._maxImageWidth/this._minImageWidth;1>=this._zoomRatio&&f.addClass(this.zoomInBtn,"disable-zoom");f.addClass(this.zoomOutBtn,"disable-zoom");this._latestPercentage=window.isRTL?100:0}},_findProperlyValue:function(a,
c,d,e,b){b=isFinite(b)?parseFloat(b):1;d=0>d-b||0>d+b?b:d;var g=(a+c)/2,k=e(g);if(k<=d+b&&k>=d-b)return g;if(k>d)return this._findProperlyValue(a,g,d,e);if(k<d)return this._findProperlyValue(g,c,d,e)},_getComputedStyle:function(a){a=f.getMarginBox(a);return{width:a.w,height:a.h,left:a.l,top:a.t}},_onViewerMouseDown:function(a){var c=this._getComputedStyle(this.baseImage),d=this._getComputedStyle(this.viewerContent);this._maxOffsetLeft=parseFloat(d.width)-parseFloat(c.width);this._maxOffsetTop=parseFloat(d.height)-
parseFloat(c.height);this._maxOffsetLeft=0<this._maxOffsetLeft?0:this._maxOffsetLeft;this._maxOffsetTop=0<this._maxOffsetTop?0:this._maxOffsetTop;this.inDrag=!0;this._currentX=a.clientX;this._currentY=a.clientY;this._stopSelect()},_stopSelect:function(){this._dragingHandlers=this._dragingHandlers.concat([h(this.ownerDocument,"dragstart",function(a){a.stopPropagation();a.preventDefault()}),h(this.ownerDocumentBody,"selectstart",function(a){a.stopPropagation();a.preventDefault()})])},_removeStopSelect:function(){for(var a=
this._dragingHandlers.pop();a;)a.remove(),a=this._dragingHandlers.pop()},_onViewerMouseUp:function(a){this.inDrag&&(this.inDrag=!1,this._resetImagePosition(a.clientX,a.clientY),this._removeStopSelect(),a.stopPropagation())},_onSliderMouseDown:function(a){if(!(1>=this._zoomRatio)){this.inSlider=!0;this._currentX=a.clientX;this._currentY=a.clientY;var c=f.position(this.sliderNode);this._startSliderLeft=c.x;this._sliderWidth=c.w;this._stopSelect();a.stopPropagation()}},_onSliderMouseUp:function(a){if(!(1>=
this._zoomRatio)&&this.inSlider){this.inSlider=!1;this._resetSliderButtonPosition(a.clientX);var c=this._getComputedStyle(this.baseImage);this._currentLeft=parseFloat(c.left);this._currentTop=parseFloat(c.top);this._latestPercentage=(a.clientX-this._startSliderLeft)/this._sliderWidth*100;this._latestPercentage=this._normalizePercentage(this._latestPercentage);this._removeStopSelect();a.stopPropagation()}},_onMouseMove:function(a){this.inDrag&&this._resetImagePosition(a.clientX,a.clientY);!this.inSlider||
1>=this._zoomRatio||this._resetSliderButtonPosition(a.clientX,a.clientY)},_onMouseUp:function(a){this.inDrag&&this._onViewerMouseUp(a);this.inSlider&&this._onSliderMouseUp(a)},_onZoomOutClick:function(){1>=this._zoomRatio||this._zoomImage("out")},_onZoomInClick:function(){1>=this._zoomRatio||this._zoomImage("in")},_zoomImage:function(a){var c=0;this._latestPercentage=this._normalizePercentage(this._latestPercentage);"in"===a?c=window.isRTL?this._latestPercentage-20:this._latestPercentage+20:"out"===
a&&(c=window.isRTL?this._latestPercentage+20:this._latestPercentage-20);a=this._normalizePercentage(c);this._moveSliderButton(a,this._latestPercentage);this._latestPercentage=a;a=this._getComputedStyle(this.baseImage);this._currentLeft=parseFloat(a.left);this._currentTop=parseFloat(a.top)},_resetImagePosition:function(a,c){var d=a-this._currentX,e=c-this._currentY;0<=this._currentTop+e?(f.setStyle(this.baseImage,"top",0),f.setStyle(this.viewerImage,"top",0),this._currentY=c,this._currentTop=0):this._currentTop+
e<=this._maxOffsetTop?(f.setStyle(this.baseImage,"top",this._maxOffsetTop+"px"),f.setStyle(this.viewerImage,"top",this._maxOffsetTop+"px"),this._currentY=c,this._currentTop=this._maxOffsetTop):(f.setStyle(this.baseImage,"top",this._currentTop+e+"px"),f.setStyle(this.viewerImage,"top",this._currentTop+e+"px"),this._currentY=c,this._currentTop+=e);0<=this._currentLeft+d?(f.setStyle(this.baseImage,"left",0),f.setStyle(this.viewerImage,"left",0),this._currentX=a,this._currentLeft=0):this._currentLeft+
d<=this._maxOffsetLeft?(f.setStyle(this.baseImage,"left",this._maxOffsetLeft+"px"),f.setStyle(this.viewerImage,"left",this._maxOffsetLeft+"px"),this._currentX=a,this._currentLeft=this._maxOffsetLeft):(f.setStyle(this.baseImage,"left",this._currentLeft+d+"px"),f.setStyle(this.viewerImage,"left",this._currentLeft+d+"px"),this._currentX=a,this._currentLeft+=d)},_normalizePercentage:function(a){a=0>a?0:a;return 100<a?100:a},_resetSliderButtonPosition:function(a){a=(a-this._startSliderLeft)/this._sliderWidth*
100;a=this._normalizePercentage(a);this._moveSliderButton(a,this._latestPercentage)},_moveSliderButton:function(a,c){0>=a?f.addClass(this.zoomOutBtn,"disable-zoom"):f.removeClass(this.zoomOutBtn,"disable-zoom");100<=a?f.addClass(this.zoomInBtn,"disable-zoom"):f.removeClass(this.zoomInBtn,"disable-zoom");f.setStyle(this.sliderButton,"left",a+"%");window.isRTL&&(a=100-a,c=100-c);var d=this._minImageWidth*(this._zoomRatio-1)*a/100,e=this._minImageHeight*(this._zoomRatio-1)*a/100,b=this._getComputedStyle(this.baseImage);
this._currentLeft=parseFloat(b.left);this._currentTop=parseFloat(b.top);var b=(Math.abs(this._currentLeft)+this.idealWidth/2)*((this._minImageWidth+d)/this._currentImageWidth-1),g=(Math.abs(this._currentTop)+this.idealHeight/2)*((this._minImageWidth+d)/this._currentImageWidth-1);f.setStyle(this.baseImage,{width:this._minImageWidth+d+"px",height:this._minImageHeight+e+"px"});f.setStyle(this.viewerImage,{width:this._minImageWidth+d+"px",height:this._minImageHeight+e+"px"});this._currentImageWidth=this._minImageWidth+
d;this._currentImageHeight=this._minImageHeight+e;if(0<=a-c)f.setStyle(this.baseImage,{top:this._currentTop-g+"px",left:this._currentLeft-b+"px"}),f.setStyle(this.viewerImage,{top:this._currentTop-g+"px",left:this._currentLeft-b+"px"});else{var k=0,h=0,k=0<=this._currentTop-g?0:this._currentTop-g+this._minImageHeight+e<=this.idealHeight?this.idealHeight-this._minImageHeight-e:this._currentTop-g,h=0<=this._currentLeft-b?0:this._currentLeft-b+this._minImageWidth+d<=this.idealWidth?this.idealWidth-this._minImageWidth-
d:this._currentLeft-b;f.setStyle(this.baseImage,{top:k+"px",left:h+"px"});f.setStyle(this.viewerImage,{top:k+"px",left:h+"px"})}this._latestPercentage=a}})})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dijit/TooltipDialog dijit/popup dojox/widget/ColorPicker jimu/utils".split(" "),function(n,f,l,h,d,m,q,a,k,c,r){return n([f,l],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",
templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof q||(this.color=new q(this.color)):this.color=new q("#ccc");d.setStyle(this.domNode,"backgroundColor",this.color.toHex());this.showLabel&&this._changeLabel(this.color);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},
destroy:function(){k.close(this.tooltipDialog);this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(a){var c=this.tooltipDialog.domNode;return a===c||d.isDescendant(a,c)},hideTooltipDialog:function(){this._hideTooltipDialog()},_showTooltipDialog:function(){k.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=!0},_hideTooltipDialog:function(){k.close(this.tooltipDialog);this._isTooltipDialogOpened=
!1},_createTooltipDialog:function(){var g=d.create("div");this.tooltipDialog=new a({content:g});d.addClass(this.tooltipDialog.domNode,"jimu-color-picker-dialog");var k=new c({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:h.hitch(this,function(a){this.ensureMode||(a=new q(a),this.setColor(a))})});k.placeAt(g);k.startup();if(this.ensureMode){var e=d.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-trailing",title:this.nls.cancel,innerHTML:this.nls.cancel},
g);this.own(m(e,"click",h.hitch(this,function(){this._hideTooltipDialog()})));"undefined"===typeof this.showOk&&(e=d.create("div",{"class":"jimu-btn jimu-float-trailing ok",title:this.nls.ok,innerHTML:this.nls.ok},g),this.own(m(e,"click",h.hitch(this,function(){var a=this.picker.get("value");this.setColor(new q(a));this._hideTooltipDialog()}))));g=d.create("div",{"class":"jimu-btn jimu-float-trailing",title:this.nls.apply,innerHTML:this.nls.apply},g);this.own(m(g,"click",h.hitch(this,function(){var a=
this.picker.get("value");this.setColor(new q(a))})))}this.own(m(this.domNode,"click",h.hitch(this,function(a){a.stopPropagation();a.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(m(document.body,"click",h.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=k},setColor:function(a,c){if(a instanceof q){var e=this.color,b="";e&&(b=e.toHex());e=a.toHex();this.color=a;d.setStyle(this.domNode,
"backgroundColor",e);if(b!==e&&(this.picker.set("value",e),!1!==c))this.onChange(new q(e))}},getColor:function(){return this.color},_changeLabel:function(a){d.empty(this.domNode);d.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:r.invertColor(a.toHex())}},this.domNode)},onChange:function(a){this.showLabel&&this._changeLabel(a)},getPopup:function(){return this.tooltipDialog||null},setLabel:function(a){d.empty(this.domNode);d.create("span",{innerHTML:a||"",className:"text-label"},
this.domNode)}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),function(n,f,l,h,
d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z,x,A){n.experimental("dojox.widget.ColorPicker");return f("dojox.widget.ColorPicker",t,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:A,postMixInProperties:function(){r.contains(a.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=b.getUniqueId(this.id);l.mixin(this,y.getLocalization("dojox.widget","ColorPicker"));l.mixin(this,y.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>q("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new e.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new e.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(m.subscribe("/dnd/move/stop",l.hitch(this,"_clearTimer"))),this._subs.push(m.subscribe("/dnd/move/start",
l.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:g.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,l.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:g.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,l.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:g.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,l.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:g.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,l.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:g.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,l.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:g.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,l.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(a,b){this._started&&this.setColor(a,b)},setColor:function(a,b){a=w.fromString(a);this._updatePickerLocations(a);this._updateColorInputs(a);this._updateValue(a,b)},_setTimer:function(a){if(a.node==this.cursorNode||a.node==this.hueCursorNode)u.focus(a.node),c.setSelectable(this.domNode,!1),this._timer=setInterval(l.hitch(this,"_updateColor"),45)},_clearTimer:function(a){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),c.setSelectable(this.domNode,!0))},_setHue:function(a){d.style(this.colorUnderlay,"backgroundColor",w.fromHsv(a,100,100).toHex())},_updateHueCursorNode:function(a,b,c){if(-1!==a){a=d.style(this.hueCursorNode,"top");b=this.PICKER_HUE_SELECTOR_H/2;a+=b;var e=!1;c.charOrCode==g.UP_ARROW?0<a&&(--a,e=!0):c.charOrCode==g.DOWN_ARROW&&a<this.PICKER_HUE_H&&(a+=1,e=!0);e&&d.style(this.hueCursorNode,"top",a-b+"px")}else this._updateColor(!0)},_updateCursorNode:function(a,
b,c){b=this.PICKER_SAT_SELECTOR_H/2;var e=this.PICKER_SAT_SELECTOR_W/2;if(-1!==a){a=d.style(this.cursorNode,"top");var k=d.style(this.cursorNode,"left");a+=b;var k=k+e,f=!1;c.charOrCode==g.UP_ARROW?0<a&&(--a,f=!0):c.charOrCode==g.DOWN_ARROW?a<this.PICKER_SAT_VAL_H&&(a+=1,f=!0):c.charOrCode==g.LEFT_ARROW?0<k&&(--k,f=!0):c.charOrCode==g.RIGHT_ARROW&&k<this.PICKER_SAT_VAL_W&&(k+=1,f=!0);f&&(k-=e,d.style(this.cursorNode,"top",a-b+"px"),d.style(this.cursorNode,"left",k+"px"))}else this._updateColor(!0)},
_updateColor:function(a){var b=this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_W/2,b=d.style(this.hueCursorNode,"top")+b,c=d.style(this.cursorNode,"top")+c,e=d.style(this.cursorNode,"left")+e,b=Math.round(360-b/this.PICKER_HUE_H*360),e=w.fromHsv(b,e/this.PICKER_SAT_VAL_W*100,100-c/this.PICKER_SAT_VAL_H*100);this._updateColorInputs(e);this._updateValue(e,a);b!=this._hue&&this._setHue(b)},_colorInputChange:function(a){var b,c=!1;switch(a.target){case this.hexCode:b=
w.fromString(a.target.value);c=!0;break;case this.Rval:case this.Gval:case this.Bval:b=w.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);c=!0;break;case this.Hval:case this.Sval:case this.Vval:b=w.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),c=!0}c&&(this._updatePickerLocations(b),this._updateColorInputs(b),this._updateValue(b,!0))},_updateValue:function(a,b){var c=a.toHex();this.value=this.valueNode.value=c;if(b&&(!this._timer||this.liveUpdate))this.onChange(c)},_updatePickerLocations:function(a){var b=
this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_W/2;a=a.toHsv();b=Math.round(this.PICKER_HUE_H-a.h/360*this.PICKER_HUE_H)-b;e=Math.round(a.s/100*this.PICKER_SAT_VAL_W)-e;c=Math.round(this.PICKER_SAT_VAL_H-a.v/100*this.PICKER_SAT_VAL_H)-c;this.animatePoint?(p.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:b,left:0}).play(),p.slideTo({node:this.cursorNode,duration:this.slideDuration,top:c,left:e}).play()):(d.style(this.hueCursorNode,"top",b+"px"),
d.style(this.cursorNode,{left:e+"px",top:c+"px"}));a.h!=this._hue&&this._setHue(a.h)},_updateColorInputs:function(a){var b=a.toHex();this.showRgb&&(this.Rval.value=a.r,this.Gval.value=a.g,this.Bval.value=a.b);this.showHsv&&(a=a.toHsv(),this.Hval.value=Math.round(a.h),this.Sval.value=Math.round(a.s),this.Vval.value=Math.round(a.v));this.showHex&&(this.hexCode.value=b);this.previewNode.style.backgroundColor=b;this.webSafe&&(this.safePreviewNode.style.backgroundColor=b)},_setHuePoint:function(a){a=a.layerY-
this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?p.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:a,left:0,onEnd:l.hitch(this,function(){this._updateColor(!1);u.focus(this.hueCursorNode)})}).play():(d.style(this.hueCursorNode,"top",a+"px"),this._updateColor(!1))},_setPoint:function(a){var b=a.layerY-this.PICKER_SAT_SELECTOR_H/2,c=a.layerX-this.PICKER_SAT_SELECTOR_W/2;a&&u.focus(a.target);this.animatePoint?p.slideTo({node:this.cursorNode,duration:this.slideDuration,top:b,left:c,onEnd:l.hitch(this,
function(){this._updateColor(!0);u.focus(this.cursorNode)})}).play():(d.style(this.cursorNode,{left:c+"px",top:b+"px"}),this._updateColor(!1))},_handleKey:function(a){},focus:function(){this.focused||u.focus(this.focusNode)},_stopDrag:function(a){k.stop(a)},destroy:function(){this.inherited(arguments);h.forEach(this._subs,function(a){m.unsubscribe(a)});delete this._subs}})})},"dojox/color":function(){define(["./color/_base"],function(n){return n})},"dojox/color/_base":function(){define(["../main",
"dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(n,f,l,h){n=f.getObject("color",!0,n);n.Color=l;n.blend=l.blendColors;n.fromRgb=l.fromRgb;n.fromHex=l.fromHex;n.fromArray=l.fromArray;n.fromString=l.fromString;n.greyscale=h.makeGrey;f.mixin(n,{fromCmy:function(d,h,q){f.isArray(d)?(h=d[1],q=d[2],d=d[0]):f.isObject(d)&&(h=d.m,q=d.y,d=d.c);return new l({r:Math.round(255*(1-d/100)),g:Math.round(255*(1-h/100)),b:Math.round(255*(1-q/100))})},fromCmyk:function(d,h,q,a){f.isArray(d)?(h=d[1],q=d[2],
a=d[3],d=d[0]):f.isObject(d)&&(h=d.m,q=d.y,a=d.b,d=d.c);a/=100;return new l({r:Math.round(255*(1-Math.min(1,d/100*(1-a)+a))),g:Math.round(255*(1-Math.min(1,h/100*(1-a)+a))),b:Math.round(255*(1-Math.min(1,q/100*(1-a)+a)))})},fromHsl:function(d,h,q){f.isArray(d)?(h=d[1],q=d[2],d=d[0]):f.isObject(d)&&(h=d.s,q=d.l,d=d.h);h/=100;for(q/=100;0>d;)d+=360;for(;360<=d;)d-=360;var a,k;120>d?(a=(120-d)/60,k=d/60,d=0):240>d?(a=0,k=(240-d)/60,d=(d-120)/60):(a=(d-240)/60,k=0,d=(360-d)/60);a=2*h*Math.min(a,1)+(1-
h);k=2*h*Math.min(k,1)+(1-h);d=2*h*Math.min(d,1)+(1-h);.5>q?(a*=q,k*=q,d*=q):(a=(1-q)*a+2*q-1,k=(1-q)*k+2*q-1,d=(1-q)*d+2*q-1);return new l({r:Math.round(255*a),g:Math.round(255*k),b:Math.round(255*d)})}});n.fromHsv=function(d,h,q){f.isArray(d)?(h=d[1],q=d[2],d=d[0]):f.isObject(d)&&(h=d.s,q=d.v,d=d.h);360==d&&(d=0);h/=100;q/=100;var a,k,c;if(0==h)k=c=a=q;else{var m=d/60;d=Math.floor(m);var g=m-d,m=q*(1-h),p=q*(1-h*g);h=q*(1-h*(1-g));switch(d){case 0:a=q;k=h;c=m;break;case 1:a=p;k=q;c=m;break;case 2:a=
m;k=q;c=h;break;case 3:a=m;k=p;c=q;break;case 4:a=h;k=m;c=q;break;case 5:a=q,k=m,c=p}}return new l({r:Math.round(255*a),g:Math.round(255*k),b:Math.round(255*c)})};f.extend(l,{toCmy:function(){return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*(1-this.g/255)),y:Math.round(100*(1-this.b/255))}},toCmyk:function(){var d,f=this.r/255,h=this.g/255,a=this.b/255;d=Math.min(1-f,1-h,1-a);return{c:Math.round((1-f-d)/(1-d)*100),m:Math.round((1-h-d)/(1-d)*100),y:Math.round((1-a-d)/(1-d)*100),b:Math.round(100*
d)}},toHsl:function(){var d=this.r/255,f=this.g/255,h=this.b/255,a=Math.min(d,h,f),k=Math.max(d,f,h),c=k-a,l=0,g=0,a=(a+k)/2;0<a&&1>a&&(g=c/(.5>a?2*a:2-2*a));0<c&&(k==d&&k!=f&&(l+=(f-h)/c),k==f&&k!=h&&(l+=2+(h-d)/c),k==h&&k!=d&&(l+=4+(d-f)/c),l*=60);return{h:l,s:Math.round(100*g),l:Math.round(100*a)}},toHsv:function(){var d=this.r/255,f=this.g/255,h=this.b/255,a=Math.max(d,f,h),k=a-Math.min(d,h,f),c=null,l=0==a?0:k/a;0==l?c=0:(c=d==a?60*(f-h)/k:f==a?120+60*(h-d)/k:240+60*(d-f)/k,0>c&&(c+=360));return{h:c,
s:Math.round(100*l),v:Math.round(100*a)}}});return n})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(n,f,l,h){var d={};f.setObject("dojo.colors",d);var m=function(a,d,c){0>c&&++c;1<c&&--c;var k=6*c;return 1>k?a+(d-a)*k:1>2*c?d:2>3*c?a+(d-a)*(2/3-c)*6:a};n.colorFromRgb=l.fromRgb=function(a,d){var c=a.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(c){var f=c[2].split(/\s*,\s*/),g=f.length,c=c[1];if("rgb"==c&&3==g||"rgba"==c&&
4==g)return c=f[0],"%"==c.charAt(c.length-1)?(c=h.map(f,function(a){return 2.56*parseFloat(a)}),4==g&&(c[3]=f[3]),l.fromArray(c,d)):l.fromArray(f,d);if("hsl"==c&&3==g||"hsla"==c&&4==g){var c=(parseFloat(f[0])%360+360)%360/360,k=parseFloat(f[1])/100,e=parseFloat(f[2])/100,k=.5>=e?e*(k+1):e+k-e*k,e=2*e-k,c=[256*m(e,k,c+1/3),256*m(e,k,c),256*m(e,k,c-1/3),1];4==g&&(c[3]=f[3]);return l.fromArray(c,d)}}return null};var q=function(a,d,c){a=Number(a);return isNaN(a)?c:a<d?d:a>c?c:a};l.prototype.sanitize=
function(){this.r=Math.round(q(this.r,0,255));this.g=Math.round(q(this.g,0,255));this.b=Math.round(q(this.b,0,255));this.a=q(this.a,0,1);return this};d.makeGrey=l.makeGrey=function(a,d){return l.fromArray([a,a,a,d])};f.mixin(l.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,
255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,
79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],
khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,
255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,
165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,
90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return l})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g){return n([f,l,h,d],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:m,nls:null,alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency},postCreate:function(){this.inherited(arguments);"number"===typeof this.alpha&&this.setAlpha(this.alpha)},setAlpha:function(a){this.opacitySlider.set("value",Math.round(100-100*a))},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var a=
this.getAlpha();this.emit("change",a)}})})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z){var x=f("dijit.form._SliderMover",
r,{onMouseMove:function(b){var c=this.widget,e=c._abspos;e||(e=c._abspos=d.position(c.sliderBarContainer,!0),c._setPixelValue_=a.hitch(c,"_setPixelValue"),c._isReversed_=c._isReversed());b=b[c._mousePixelCoord]-e[c._startingPixelCoord];c._setPixelValue_(c._isReversed_?e[c._pixelCount]-b:b,e[c._pixelCount],!1)},destroy:function(a){r.prototype.destroy.apply(this,arguments);var b=this.widget;b._abspos=null;b._setValueAttr(b.value,!0)}});l=f("dijit.form.HorizontalSlider",[w,y],{templateString:z,value:0,
showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:b.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",_onKeyUp:function(a){this.disabled||this.readOnly||a.altKey||
a.ctrlKey||a.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey)){switch(a.keyCode){case q.HOME:this._setValueAttr(this.minimum,!1);break;case q.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?q.RIGHT_ARROW:q.LEFT_ARROW:case !1===this._descending?q.DOWN_ARROW:q.UP_ARROW:case !1===this._descending?q.PAGE_DOWN:q.PAGE_UP:this.increment(a);break;case this._descending||this.isLeftToRight()?
q.LEFT_ARROW:q.RIGHT_ARROW:case !1===this._descending?q.UP_ARROW:q.DOWN_ARROW:case !1===this._descending?q.PAGE_UP:q.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){this.disabled||this.readOnly||(k("ie")||u.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&this.clickSelect){u.focus(this.sliderHandle);a.stopPropagation();
a.preventDefault();var b=d.position(this.sliderBarContainer,!0),c=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-c:c,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var e=this.discreteValues;if(1>=e||Infinity==e)e=b;e--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(a/(b/e))/e+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(a,
b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var c=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,e=!1===this._descending?this.remainingBar:this.progressBar,d=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&e.style[this._progressPixelSize]){var g=this,f={},k=parseFloat(e.style[this._progressPixelSize]),
p=this.slideDuration*(c-k/100);0!=p&&(0>p&&(p=0-p),f[this._progressPixelSize]={start:k,end:100*c,units:"%"},this._inProgressAnim=h.animateProperty({node:e,duration:p,onAnimate:function(a){d.style[g._progressPixelSize]=100-parseFloat(a[g._progressPixelSize])+"%"},onEnd:function(){delete g._inProgressAnim},properties:f}),this._inProgressAnim.play())}else e.style[this._progressPixelSize]=100*c+"%",d.style[this._progressPixelSize]=100*(1-c)+"%"},_bumpValue:function(a,b){if(!(this.disabled||this.readOnly||
this.maximum<=this.minimum)){var c=m.getComputedStyle(this.sliderBarContainer),e=d.getContentBox(this.sliderBarContainer,c),c=this.discreteValues;if(1>=c||Infinity==c)c=e[this._pixelCount];c--;e=Math.round((this.value-this.minimum)*c/(this.maximum-this.minimum))+a;0>e&&(e=0);e>c&&(e=c);e=e*(this.maximum-this.minimum)/c+this.minimum;this._setValueAttr(e,b)}},_onClkBumper:function(a){this.disabled||this.readOnly||!this.clickSelect||this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===
this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==q.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==q.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},startup:function(){this._started||(n.forEach(this.getChildren(),function(a){this[a.container]!=
this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display="");var a=g('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+
"_label"),this.focusNode.setAttribute("aria-labelledby",a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(t.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),t.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(e(this.domNode,p.wheel,a.hitch(this,"_mouseWheeled")));var b=f(x,{widget:this});this._movable=
new c(this.sliderHandle,{mover:b});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});l._Mover=x;return l})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(n,f,l,h,d,m){n=n("dijit.form.HorizontalRuleLabels",m,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',
labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(d){return d},_genHTML:function(d,a){var f=this.labels[a];return this._positionPrefix+this._calcPosition(d)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(f)+this._labelPrefix+
f+this._suffix},_genDirectionHTML:function(d){return""},getLabels:function(){var d=this.labels;!d.length&&this.srcNodeRef&&(d=h("\x3e li",this.srcNodeRef).map(function(a){return String(a.innerHTML)}));if(!d.length&&1<this.count)for(var d=[],a=this.minimum,f=(this.maximum-a)/(this.count-1),c=0;c<this.count;c++)d.push(c<this.numericMargin||c>=this.count-this.numericMargin?"":l.format(a,this.constraints)),a+=f;return d},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();
this.count=this.labels.length}});f("dojo-bidi")&&n.extend({_setTextDirAttr:function(f){this.textDir!=f&&(this._set("textDir",f),h(".dijitRuleLabelContainer",this.domNode).forEach(d.hitch(this,function(a){a.style.direction=this.getTextDir(a.innerText||a.textContent||"")})))},_genDirectionHTML:function(d){return this.textDir?"direction:"+this.getTextDir(d)+";":""}});return n})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(n,f,l){return n("dijit.form.HorizontalRule",
[f,l],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(f){return this._positionPrefix+f+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var f;if(1==this.count)f=this._genHTML(50,0);else{var d,
m=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){f=this._genHTML(0,0);for(d=1;d<this.count-1;d++)f+=this._genHTML(m*d,d);f+=this._genHTML(100,this.count-1)}else{f=this._genHTML(100,0);for(d=1;d<this.count-1;d++)f+=this._genHTML(100-m*d,d);f+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=f}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(n,f,l,h){return n("dijit.form.NumberSpinner",[l,h.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",
adjust:function(d,f){var h=this.constraints,a=isNaN(d),k=!isNaN(h.max),c=!isNaN(h.min);a&&0!=f&&(d=0<f?c?h.min:k?h.max:0:k?this.constraints.max:c?h.min:0);var m=d+f;if(a||isNaN(m))return d;k&&m>h.max&&(m=h.max);c&&m<h.min&&(m=h.min);return m},_onKeyDown:function(d){if(!(this.disabled||this.readOnly||d.keyCode!=f.HOME&&d.keyCode!=f.END||d.ctrlKey||d.altKey||d.metaKey||"undefined"==typeof this.get("value"))){var h=this.constraints[d.keyCode==f.HOME?"min":"max"];"number"==typeof h&&this._setValueAttr(h,
!1);d.stopPropagation();d.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),function(n,f,l,h,d,m,q,a,k,c){return n("dijit.form._Spinner",a,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:k,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",
downArrowNode:"dijitDownArrowButton"},adjust:function(a){return a},_arrowPressed:function(a,d,f){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),d*f),!1),c.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(a,c,d){var e=this.smallDelta;c==this.textbox&&(c=d.keyCode,e=c==f.PAGE_UP||c==f.PAGE_DOWN?this.largeDelta:this.smallDelta,c=c==f.UP_ARROW||c==f.PAGE_UP?this.upArrowNode:this.downArrowNode);
-1==a?this._arrowReleased(c):this._arrowPressed(c,c==this.upArrowNode?1:-1,e)},_wheelTimer:null,_mouseWheeled:function(a){if(this.focused){a.stopPropagation();a.preventDefault();var c=a.wheelDelta/120;Math.floor(c)!=c&&(c=0<a.wheelDelta?1:-1);a=a.detail?-1*a.detail:c;if(0!==a){var d=this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(d,a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(d)},50)}}},_setConstraintsAttr:function(a){this.inherited(arguments);
this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,c){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(m(this.domNode,d.wheel,l.hitch(this,
"_mouseWheeled")),q.addListener(this.upArrowNode,this.textbox,{keyCode:f.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),q.addListener(this.downArrowNode,this.textbox,{keyCode:f.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),q.addListener(this.upArrowNode,this.textbox,{keyCode:f.PAGE_UP,ctrlKey:!1,altKey:!1,
shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),q.addListener(this.downArrowNode,this.textbox,{keyCode:f.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(n,f,l){return n("dijit.form.RangeBoundTextBox",
l,{rangeMessage:"",rangeCheck:function(f,d){return("min"in d?0<=this.compare(f,d.min):!0)&&("max"in d?0>=this.compare(f,d.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var f=this.get("value");if(null==f)return!1;var d=!1;"min"in this.constraints&&(d=this.constraints.min,d=0>this.compare(f,"number"==typeof d&&0<=d&&0!=f?0:d));!d&&"max"in this.constraints&&(d=this.constraints.max,d=0<this.compare(f,"number"!=typeof d||0<
d?d:0));return d},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(f){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(f))},getErrorMessage:function(f){var d=this.get("value");return null==d||""===d||"number"==typeof d&&isNaN(d)||this.isInRange(f)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=f.getLocalization("dijit.form",
"validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(n,f,l,h,d,m){var q=function(a){a=a||{};var c=l.getLocalization("dojo.cldr","number",l.normalizeLocale(a.locale)),d=a.pattern?a.pattern:c[(a.type||"decimal")+"Format"];a="number"==typeof a.places?a.places:"string"===typeof a.places&&0<a.places.length?a.places.replace(/.*,/,
""):-1!=d.indexOf(".")?d.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:c.decimal,places:a}},a=n("dijit.form.NumberTextBoxMixin",null,{pattern:function(a){return"("+(this.focused&&this.editOptions?this._regExpGenerator(f.delegate(a,this.editOptions))+"|":"")+this._regExpGenerator(a)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:d.format,_regExpGenerator:d.regexp,_decimalInfo:q(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(a){var c=
"number"==typeof a.places?a.places:0;c&&c++;"number"!=typeof a.max&&(a.max=9*Math.pow(10,15-c));"number"!=typeof a.min&&(a.min=-9*Math.pow(10,15-c));this.inherited(arguments,[a]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=q(a)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var a=this.get("value");"number"!=typeof a||isNaN(a)||(a=this.format(a,this.constraints),void 0!==a&&(this.textbox.value=a));this.inherited(arguments)}},format:function(a,
c){var d=String(a);if("number"!=typeof a)return d;if(isNaN(a))return"";if(!("rangeCheck"in this&&this.rangeCheck(a,c))&&!1!==c.exponent&&/\de[-+]?\d/i.test(d))return d;this.editOptions&&this.focused&&(c=f.mixin({},c,this.editOptions));return this._formatter(a,c)},_parser:d.parse,parse:function(a,c){var d=f.mixin({},c,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=d.places){var g=d.places,g="number"===typeof g?g:Number(g.split(",").pop());d.places="0,"+g}d=this._parser(a,
d);this.editOptions&&this.focused&&isNaN(d)&&(d=this._parser(a,c));return d},_getDisplayedValueAttr:function(){var a=this.inherited(arguments);return isNaN(a)?this.textbox.value:a},filter:function(a){if(null==a||"string"==typeof a&&""==a)return NaN;"number"!=typeof a||isNaN(a)||0==a||(a=d.round(a,this._decimalInfo.places));return this.inherited(arguments,[a])},serialize:function(a,c){return"number"!=typeof a||isNaN(a)?"":this.inherited(arguments)},_setBlurValue:function(){var a=f.hitch(f.delegate(this,
{focused:!0}),"get")("value");this._setValueAttr(a,!0)},_setValueAttr:function(a,c,d){if(void 0!==a&&void 0===d)if(d=String(a),"number"==typeof a)if(isNaN(a))d="";else{if("rangeCheck"in this&&this.rangeCheck(a,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(d))d=void 0}else a?a=void 0:(d="",a=NaN);this.inherited(arguments,[a,c,d])},_getValueAttr:function(){var a=this.inherited(arguments);if(isNaN(a)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&
(new RegExp("^"+d._realNumberRegexp(f.delegate(this.constraints))+"$")).test(this.textbox.value))return a=Number(this.textbox.value),isNaN(a)?void 0:a}else return a},isValid:function(a){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var c=this.get("value");return!isNaN(c)&&this.rangeCheck(c,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var a="number"==typeof this.constraints.min,
c="number"==typeof this.constraints.max,d=this.get("value");if(isNaN(d)||!a&&!c)return this.inherited(arguments);var g=d|0,f=0>d,e=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),b=(this.maxLength||20)-this.textbox.value.length,m=e?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",g=e?g+"."+m:g+"",b=h.rep("9",b),e=d;f?e=Number(g+b):d=Number(g+b);return!(a&&d<this.constraints.min||c&&e>this.constraints.max)}});n=n("dijit.form.NumberTextBox",[m,a],{baseClass:"dijitTextBox dijitNumberTextBox"});
n.Mixin=a;return n})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),function(n,f,l,h,d,m,q,a){return n([a],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=f.create("div",{"class":"jimu-service-validating"},
this.domNode);this._validNode=f.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=f.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},this.domNode);f.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(h(this,"Change",l.hitch(this,"_onServiceUrlChange")))},setProcessFunction:function(a,c){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof a&&(this._fetchHandle=m.after(this,"onFetch",a),this.own(this._fetchHandle));
"function"===typeof c&&(this._fetchErrHandle=m.after(this,"onFetchError",c),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),this._fetchErrHandle=null)},onFetch:function(a){return a},onFetchError:function(a){},getStatus:function(){return this._status},_onServiceUrlChange:function(a){var c=new d;c.then(l.hitch(this,
function(){this._valid()}),l.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();a?q({url:l.trim(a||""),handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(l.hitch(this,function(a){this.onFetch({url:this.getValue(),data:a})?c.resolve("success"):c.reject("error")}),l.hitch(this,function(a){c.reject(a)})):c.reject("error")},_validating:function(){this._status="validating";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");f.removeClass(this.domNode,
"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.addClass(this.domNode,"jimu-serviceurl-input-valid")},_inValid:function(){this._status="invalid";f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},
"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dijit/registry jimu/utils jimu/dijit/CheckBox".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g){return n([f,l,h],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"headTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;" data-dojo-attach-point\x3d"tableInHeadSection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"headColgroup"\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"  data-dojo-attach-point\x3d"thead"\x3e\x3c/thead\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"bodyTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;"data-dojo-attach-point\x3d"tableInBodySection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"bodyColgroup"\x3e\x3c/colgroup\x3e\x3ctbody class\x3d"simple-table-tbody" data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",_classVerticalScroll:"vertical-scroll",autoHeight:!0,selectable:!1,fields:null,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);
this._initSelf()},startup:function(){this.inherited(arguments);this.updateUI()},_initSelf:function(){this.own(r.bindClickAndDblclickEvents(this.tableInBodySection,d.hitch(this,function(a){if(a=r.getAncestorDom(a.target||a.srcElement,function(a){return m.hasClass(a,"simple-table-row")&&m.hasClass(a,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),d.hitch(this,function(a){if(a=r.getAncestorDom(a.target||a.srcElement,function(a){return m.hasClass(a,"simple-table-row")&&m.hasClass(a,
"not-empty")},this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var c=Math.random().toString();this._name="jimu_table_"+c.slice(2,c.length);if(this.fields&&0<this.fields.length){var e=m.create("tr",{},this.thead);q.forEach(this.fields,d.hitch(this,function(b){var c="auto";"actions"===b.type&&(b.name="actions");b.hidden?c=1:void 0!==b.width&&null!==b.width?c=b.width:"actions"!==b.type||b.name||(b.width=this._calculateActionsWidth(b)+20,c=b.width);m.create("col",{width:c},this.headColgroup);
m.create("col",{width:c},this.bodyColgroup);c=m.create("th",{innerHTML:b.title,title:b.title},e);if("checkbox"===b.type){c.innerHTML="";var f=new g({label:b.title}),p=k(".checkbox",f.domNode)[0];p&&(p.style.marginTop="10px");this.own(a(f.domNode,"click",d.hitch(this,function(){f.getValue()?this._checkAllTdCheckBoxes(b.name):this._uncheckAllTdCheckBoxes(b.name)})));f.placeAt(c)}m.addClass(c,"simple-table-field");b.hidden&&m.addClass(c,"hidden-column");b["class"]&&m.addClass(c,b["class"]);m.addClass(c,
b.name)}))}else this.fields=null},_getThCheckBox:function(a){var e=null;a=k(".simple-table-field."+a+" .jimu-checkbox",this.thead)[0];return e=c.byNode(a)},_getAllEnabledTdCheckBoxes:function(a){a=k(".simple-table-cell."+a+" .jimu-checkbox",this.tbody);a=q.map(a,function(a){return c.byNode(a)});return a=q.filter(a,function(a){return a.getStatus()})},_checkAllTdCheckBoxes:function(a){a=this._getAllEnabledTdCheckBoxes(a);q.forEach(a,function(a){a.getValue()||a.setValue(!0)})},_uncheckAllTdCheckBoxes:function(a){a=
this._getAllEnabledTdCheckBoxes(a);q.forEach(a,function(a){a.getValue()&&a.setValue(!1)})},_delaySyncThCheckBoxStatusWithAllTdCheckBoxes:function(a){setTimeout(d.hitch(this,function(){this._syncThCheckBoxStatusWithAllTdCheckBoxes(a)}),100)},_syncThCheckBoxStatusWithAllTdCheckBoxes:function(a){var c=this._getAllEnabledTdCheckBoxes(a),c=q.filter(c,d.hitch(this,function(a){return a.getStatus()}));0!==c.length&&(a=this._getThCheckBox(a),q.every(c,function(a){return a.getValue()})?a.getValue()||a.setValue(!0):
a.getValue()&&a.setValue(!1))},clear:function(){var a=this._getNotEmptyRows(),c=q.map(a,d.hitch(this,function(a){return this.getRowData(a)}));m.empty(this.tbody);q.forEach(a,d.hitch(this,function(a,e){this._onDeleteRow(a,c[e])}));this.updateUI();this._rowIndex=0;this._onClearRows(a)},addRows:function(a){var c=[];this.fields&&a&&0<a.length&&q.forEach(a,d.hitch(this,function(a){c.push(this.addRow(a,-1,!0))}));this.updateUI();return c},addRow:function(a,c,b){this._rowIndex++;var e={success:!1,tr:null,
errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof a)return e;var g=q.filter(this.fields,d.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),g=q.filter(g,d.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,a[b.name]).length}));if(0<g.length)return e.errorCode=this.REPEATING_ERROR,e.errorMessage="repeating data",e.repeatFields=g,e;var f=m.create("tr",{"class":"simple-table-row not-empty"},this.tbody);m.setAttr(f,"rowId","row"+this._rowIndex);
q.forEach(this.fields,d.hitch(this,function(b){var c=a[b.name],e=b.type,d=null;"actions"===e?d=this._createActionsTd(f,b):("text"===e?d=this._createTextTd(f,b,c):"radio"===e?d=this._createRadioTd(f,b,c):"checkbox"===e?d=this._createCheckboxTd(f,b,c):"empty"===e?d=this._createEmptyTd(f,b):"extension"===e&&(d=this._createExtensionTd(f,b,c)),b.hidden&&m.addClass(d,"hidden-column"))}));b||(this.updateUI(),b=this.getRows(),"number"===typeof c&&0<=c&&c<b.length&&m.place(f,b[c],"before"));e.success=!0;e.tr=
f;e.errorMessage=null;this._onAddRow(f);return e},deleteRow:function(a){if(a){var c=this.getRowData(a);m.destroy(a);this.updateUI();this._onDeleteRow(a,c)}},selectRow:function(a){this.selectable&&(k(".simple-table-row",this.tbody).removeClass("jimu-state-active"),m.addClass(a,"jimu-state-active"),this._onSelectRow(a))},updateUI:function(){this._updateRowClassName();this._updateHeight();m.removeClass(this.domNode,this._classVerticalScroll);0<this.bodyDiv.clientHeight&&this.bodyDiv.clientHeight<this.bodyDiv.scrollHeight&&
m.addClass(this.domNode,this._classVerticalScroll);q.forEach(this.fields,d.hitch(this,function(a){"checkbox"===a.type&&this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(a.name)}))},_updateHeadTableWidth:function(){if(this.domNode){var a=m.getContentBox(this.tableInBodySection).w,c="100%";"number"===typeof a&&0<a&&(c=a+"px");m.setStyle(this.tableInHeadSection,"width",c)}},_updateHeight:function(){if(this.autoHeight){var a=this.getRows();m.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*
(0<a.length?a.length:1)+1+"px")}},_updateRowClassName:function(){var a=k("."+this._classFirstSimpleTableRow,this.tbody)[0];a&&(a=k("."+this._classRowUpDiv,a)[0])&&m.removeClass(a,this._classJimuStateDisabled);(a=k("."+this._classLastSimpleTableRow,this.tbody)[0])&&(a=k("."+this._classRowDownDiv,a)[0])&&m.removeClass(a,this._classJimuStateDisabled);a=k("."+this._classSimpleTableRow,this.tbody);a.removeClass("odd");a.removeClass("even");a.removeClass(this._classFirstSimpleTableRow);a.removeClass(this._classLastSimpleTableRow);
q.forEach(a,d.hitch(this,function(a,c){0===c%2?m.addClass(a,"odd"):m.addClass(a,"even")}));if(0<a.length){var c=a[0];m.addClass(c,this._classFirstSimpleTableRow);(c=k("."+this._classRowUpDiv,c)[0])&&m.addClass(c,this._classJimuStateDisabled);a=a[a.length-1];m.addClass(a,this._classLastSimpleTableRow);(a=k("."+this._classRowDownDiv,a)[0])&&m.addClass(a,this._classJimuStateDisabled)}},_createTextTd:function(a,c,b){var e=null;return e=c.editable?this._createEditableTextTd(a,c,b):this._createNormalTextTd(a,
c,b)},_createNormalTextTd:function(a,c,b){var e=m.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');m.addClass(e,c.name);var d=k("div",e)[0];d.innerHTML=b||"";d.title=b||"";c["class"]&&m.addClass(e,c["class"]);m.place(e,a);return e},_createEditableTextTd:function(c,e,b){var g=m.toDom('\x3ctd class\x3d"editable-text-td '+e.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');
m.addClass(g,"simple-table-cell");m.place(g,c);e["class"]&&m.addClass(g,e["class"]);var f=k("div",g)[0],h=k("input",g)[0];f.innerHTML=b||"";""!==f.innerHTML&&(f.title=f.innerText||f.innerHTML);h.value=f.innerHTML;this.own(a(f,"dblclick",d.hitch(this,function(a){a.stopPropagation();h.value=f.innerText||f.innerHTML;m.setStyle(f,"display","none");m.setStyle(h,"display","inline");h.focus()})));this.own(a(h,"blur",d.hitch(this,function(){h.value=d.trim(h.value);var a=f.innerText||f.innerHTML,b=h.value;
""!==b?e.unique?0<this.getRowDataArrayByFieldValue(e.name,b,c).length?h.value=a:f.innerHTML=b:f.innerHTML=b:h.value=a;m.setStyle(h,"display","none");m.setStyle(f,"display","block")})));return g},_createRadioTd:function(a,c,b){var e=m.toDom('\x3ctd class\x3d"radio-td '+c.name+'"\x3e\x3cinput type\x3d"radio" /\x3e\x3c/td\x3e');m.addClass(e,"simple-table-cell");m.place(e,a);c["class"]&&m.addClass(e,c["class"]);a=k("input",e)[0];a.name=c.radio&&"row"===c.radio?this._name+this._rowIndex:this._name+c.name;
a.checked=!0===b;return e},_createCheckboxTd:function(c,e,b){var f=m.toDom('\x3ctd class\x3d"checkbox-td '+e.name+'"\x3e\x3c/td\x3e');m.addClass(f,"simple-table-cell");m.place(f,c);e["class"]&&m.addClass(f,e["class"]);var k=new g({onChange:d.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(e.name);"function"===typeof e.onChange&&setTimeout(d.hitch(this,function(){e.onChange(c,k)}),200)})});this.own(a(k,"status-change",d.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(e.name)})));
this._setValueForCheckBox(k,b);k.placeAt(f);return f},_createActionsTd:function(c,e){var b=m.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');m.addClass(b,"simple-table-cell");var g=k(".action-item-parent",b)[0];m.place(b,c);e["class"]&&m.addClass(b,e["class"]);q.forEach(e.actions,d.hitch(this,function(b){"up"===b?(b=m.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},g),b.title=this.nls.moveUp,
this.own(a(b,"click",d.hitch(this,function(a){a.stopPropagation();if(this.onBeforeRowUp(c)){a=k(".simple-table-row",this.tbody);var b=q.indexOf(a,c);0<b&&(a=a[b-1])&&(m.place(c,a,"before"),this.updateUI(),this.emit("row-up",c))}})))):"down"===b?(b=m.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},g),b.title=this.nls.moveDown,this.own(a(b,"click",d.hitch(this,function(a){a.stopPropagation();if(this.onBeforeRowDown(c)){a=k(".simple-table-row",this.tbody);
var b=q.indexOf(a,c);b<a.length-1&&(a=a[b+1])&&(m.place(c,a,"after"),this.updateUI(),this.emit("row-down",c))}})))):"edit"===b?(b=m.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},g),b.title=this.nls.edit,this.own(a(b,"click",d.hitch(this,function(a){a.stopPropagation();this.onBeforeRowEdit(c)&&this._onActionsEdit(c)})))):"delete"===b&&(b=m.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},g),b.title=this.nls.deleteRow,
this.own(a(b,"click",d.hitch(this,function(a){a.stopPropagation();this.onBeforeRowDelete(c)&&this.deleteRow(c)}))))}));var f=this._calculateActionsWidth(e)+"px";m.setStyle(g,"width",f);return b},_calculateActionsWidth:function(a){return 20*q.map(a.actions,function(a){return"up"===a||"down"===a||"edit"===a||"delete"===a}).length},_createEmptyTd:function(a,c){var b=m.create("td",{"class":c.name},a);m.addClass(b,"simple-table-cell");m.addClass(b,"empty-text-td");c["class"]&&m.addClass(b,c["class"]);
return b},_createExtensionTd:function(a,c,b){a=m.create("td",{"class":c.name},a);m.addClass(a,"simple-table-cell");m.addClass(a,"extension-td");c["class"]&&m.addClass(a,c["class"]);c.create&&"function"===typeof c.create&&c.create(a);c.setValue&&"function"===typeof c.setValue&&c.setValue(a,b);return a},editRow:function(a,c){var b={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof c||!m.isDescendant(a,this.tbody))return b;var e=d.mixin([],this.fields),
e=q.filter(e,d.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),e=q.filter(e,d.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,c[b.name],a).length}));if(0<e.length)return b.errorCode=this.REPEATING_ERROR,b.errorMessage="repeating data",b.repeatFields=e,b;var g=k(".simple-table-cell",a);q.forEach(this.fields,d.hitch(this,function(a,b){if(c.hasOwnProperty(a.name)){var e=g[b],d=c[a.name],f=a.type;"text"===f?a.editable?this._editEditableText(e,a,d):this._editNormalText(e,
a,d):"radio"===f?this._editRadio(e,a,d):"checkbox"===f?this._editCheckbox(e,a,d):"extension"===f&&this._editExtension(e,a,d)}}));b.success=!0;b.tr=a;b.errorMessage=null;this._onEditRow(a);return b},_editNormalText:function(a,c,b){a=k("div",a)[0];a.innerHTML=b||"";a.title=a.innerHTML},_editEditableText:function(a,c,b){c=k("div",a)[0];c.innerHTML=b||"";k("input",a)[0].value=c.innerHTML},_editRadio:function(a,c,b){k("input",a)[0].checked=!0===b},_editCheckbox:function(a,e,b){a=k(".jimu-checkbox",a)[0];
a=c.byNode(a);this._setValueForCheckBox(a,b)},_setValueForCheckBox:function(a,c){null===c?a.setStatus(!1):(a.setStatus(!0),c!==a.getValue()&&a.setValue(c))},_editExtension:function(a,c,b){c.setValue&&"function"===typeof c.setValue&&c.setValue(a,b)},_getAllRows:function(){return k(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var a=this._getAllRows();return q.filter(a,d.hitch(this,function(a){return!m.hasClass(a,"empty")}))},_getEmptyRows:function(){var a=this._getAllRows();return q.filter(a,
d.hitch(this,function(a){return m.hasClass(a,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var a=null,c=k(".simple-table-row",this.tbody),c=q.filter(c,d.hitch(this,function(a){return!m.hasClass(a,"empty")&&m.hasClass(a,"jimu-state-active")}));0<c.length&&(a=c[0]);return a},getSelectedRowData:function(){var a=null,c=this.getSelectedRow();c&&(a=this._getRowDataByTr(c));return a},getData:function(a){var c=this._getNotEmptyRows();a&&(c=q.filter(c,d.hitch(this,
function(b){return b!==a})));return q.map(c,d.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(a){return this._getRowDataByTr(a)},_getRowDataByTr:function(a){var e=null;if(a)e={};else return null;q.forEach(this.fields,d.hitch(this,function(b){var d=b.type;if("actions"!==d){var g=b.name;e[g]=null;var f=k(".simple-table-cell."+g,a)[0];f&&("text"===d?(b=k("div",f)[0],e[g]=b.innerText||b.innerHTML):"radio"===d?(b=k("input",f)[0],e[g]=b.checked):"checkbox"===d?(b=k(".jimu-checkbox",
f)[0],b=c.byNode(b),b.getStatus()?e[g]=b.getValue():e[g]=null):"extension"===d&&b.getValue&&"function"===typeof b.getValue&&(e[g]=b.getValue(f,b)))}}));return e},getRowDataArrayByFieldValue:function(a,c,b){var e=[];if(!this.fields||!q.some(this.fields,d.hitch(this,function(b){return b.name===a})))return[];b=this.getData(b);return e=q.filter(b,d.hitch(this,function(b){return b[a]==c}))},moveToTop:function(a){a&&a.parentNode===this.tbody&&m.place(a,this.tbody,"first")},_onClickRow:function(a){this.emit("row-click",
a)},_onDblClickRow:function(a){this.emit("row-dblclick",a)},_onSelectRow:function(a){this.emit("row-select",a)},_onAddRow:function(a){this.emit("row-add",a)},_onEditRow:function(a){this.emit("row-edit",a)},_onDeleteRow:function(a,c){this.emit("row-delete",a,c)},_onEnterRow:function(a){this.emit("row-enter",a)},_onClearRows:function(a){this.emit("rows-clear",a)},_onActionsEdit:function(a){this.emit("actions-edit",a)},onBeforeRowUp:function(a){return!0},onBeforeRowDown:function(a){return!0},onBeforeRowEdit:function(a){return!0},
onBeforeRowDelete:function(a){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(n,f,l,h,d,m,q,a,k,c){return n([q,a,m],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new k(null,this.containerNode);var a=1/this.tabs.length*100;this.isNested&&h.addClass(this.domNode,"nested");l.forEach(this.tabs,function(c){this._createTab(c,a)},this)}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);c.setVerticalCenter(this.domNode)},_createTab:function(a,c){var g;g=h.create("div",{innerHTML:a.title,"class":"tab jimu-vcenter-text",
style:{width:this.isNested?"auto":c+"%"},label:a.title},this.controlNode);this.viewStack.viewType=a.content.domNode?"dijit":"dom";a.content.label=a.title;this.viewStack.addView(a.content);this.own(d(g,"click",f.hitch(this,this.onSelect,a.title)));g.label=a.title;this.controlNodes.push(g)},onSelect:function(a){this.selectTab(a)},selectTab:function(a){this._selectControl(a);this.viewStack.switchView(a);this.emit("tabChanged",a)},_selectControl:function(a){l.forEach(this.controlNodes,function(c){h.removeClass(c,
"jimu-state-selected");c.label===a&&h.addClass(c,"jimu-state-selected")})}})})},"jimu/dijit/ViewStack":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dijit/_WidgetBase"],function(n,f,l,h,d){return n(d,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);this.views||(this.views=[]);h.forEach(this.views,f.hitch(this,function(d){1===d.nodeType?(l.place(d,this.domNode),l.addClass(d,
"view"),l.setStyle(d,"display","none")):d.domNode&&(l.place(d.domNode,this.domNode),l.addClass(d.domNode,"view"),l.setStyle(d.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var d="",f=this.getSelectedView();f&&(d=f.label);return d},getViewByLabel:function(d){for(var f=0;f<this.views.length;f++)if(d===this.views[f].label)return this.views[f];return null},
addView:function(d){this.views.push(d);1===d.nodeType?(l.place(d,this.domNode),l.addClass(d,"view")):d.domNode&&(l.place(d.domNode,this.domNode),l.addClass(d.domNode,"view"))},removeView:function(d){var f=this.views.length;this.views=h.filter(this.views,function(a){return d!==a});f!==this.views.length&&(1===d.nodeType?l.destroy(d):d.domNode&&d.destroyRecursive())},switchView:function(d){var h,a;h="number"===typeof d?this.views[d]:"string"===typeof d?this.getViewByLabel(d):d;this.views.forEach(f.hitch(this,
function(d){d&&(1===d.nodeType?a=d:d.domNode&&(a=d.domNode),d===h?(l.setStyle(a,"display","block"),d.domNode&&!d._started&&(d.startup(),d._started=!0)):l.setStyle(a,"display","none"))}));this._currentView=h;this.onViewSwitch(h)},onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r){return n([a,k,m],{templateString:c,selected:"",tabs:null,average:!1,baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,postCreate:function(){this.inherited(arguments);this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(a){var c=q("td",this.tabTr);l.forEach(c,f.hitch(this,function(c,b){h.removeClass(c,"jimu-state-active");c.label===a&&(h.addClass(c,"jimu-state-active"),
this._currentIndex=b)}));this.controlNode.removeChild(this.controlTable);h.place(this.controlTable,this.controlNode);this.viewStack.switchView(a);this.emit("tabChanged",a)},addTab:function(a){if(!this.average){var c=q("td:last-child",this.tabTr);0<c.length&&h.destroy(c[0])}0<l.filter(this.tabs,function(c){return c.title===a.title}).length?console.error("tab title conflict: "+a.title):(this.tabs.push(a),this._createTab(a),this.average||(c=h.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e'),
h.place(c,this.tabTr)))},removeTab:function(a){var c=-1;if(l.some(this.tabs,function(b,e){if(b.title===a)return c=e,!0})){var e=this.tabs.splice(c,1)[0],b=q("td",this.tabTr),d;l.some(b,function(b){if(b.label===a)return d=b,!0})&&h.destroy(d);this.viewStack.removeView(e.content)}},showShelter:function(){h.setStyle(this.shelter,"display","block")},hideShelter:function(){h.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},
_initSelf:function(){this.viewStack=new r(null,this.containerNode);l.forEach(this.tabs,function(a){this._createTab(a)},this);if(this.average)this.controlTable.style.tableLayout="fixed";else{var a=h.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');h.place(a,this.tabTr)}},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(a){var c=h.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');
c.label=a.title||"";h.place(c,this.tabTr);var e=q(".tab-item-div",c)[0];e.innerHTML=c.label;e.label=c.label;a.content.label=c.label;this.viewStack.addView(a.content);this.own(d(c,"click",f.hitch(this,this._onSelect,a.title)))},_onSelect:function(a){this.selectTab(a)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(n,f,l,h){return n([h],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",
constructor:function(){this.items=[];this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(f.hitch(this,function(d){this._placeItem(d)}));this.resize()},_placeItem:function(d){d.domNode?l.place(d.domNode,this.domNode):l.place(d,this.domNode)},addItem:function(d){this.items.push(d);this._placeItem(d);this.resize()},addItems:function(d){this.items=this.items.concat(d);this.items.forEach(f.hitch(this,function(d){this._placeItem(d)}));this.resize()},removeItem:function(d){var f;
for(f=0;f<this.items.length;f++)if(this.items[f].label===d){this.items[f].domNode?this.items[f].destroy():l.destroy(this.items[f]);this.items.splice(f,1);this.resize();break}},empty:function(){var d;for(d=0;d<this.items.length;d++)this.items[d].domNode?this.items[d].destroy():l.destroy(this.items[d]);this.items=[]},resize:function(){var d,h,q;d=l.getMarginBox(this.domNode);h=this.getItemSize(d);q=Math.floor((d.w+this.hmargin)/(h.width+this.hmargin));this.items.forEach(f.hitch(this,function(a,d){this.setItemPosition(a,
d,h,q)}))},getItemSize:function(d){var f={},h;if("fixWidth"===this.strategy)f.width=this.itemSize.width,f.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(h=0;h<this.itemSize.length;h++){if(d.w<=this.itemSize[h].screenWidth){f.width=this.itemSize[h].width;f.height=this.itemSize[h].height;break}}else"fixCols"===this.strategy&&(f.width=(d.w-this.hmargin*(this.maxCols-1))/this.maxCols,f.height="number"===typeof this.itemSize.height?this.itemSize.height:f.width*parseFloat(this.itemSize.height.substring(0,
this.itemSize.height.length-1))/100);return f},setItemPosition:function(d,f,h,a){f++;var k=f%a;f=Math.ceil(f/a);0===k&&(k=a);a={position:"absolute",top:(this.vmargin+h.height)*(f-1)+"px"};a[window.isRTL?"right":"left"]=(this.hmargin+h.width)*(k-1)+"px";0<=h.width&&(a.width=h.width+"px");0<=h.height&&(a.height=h.height+"px");l.setStyle(d.domNode?d.domNode:d,a)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer esri/toolbars/draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u){return n([f,l,h,r],{templateString:d,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,_isDisabled:!1,_shiftKey:!1,_ctrlKey:!1,_metaKey:!1,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);
var a={};this.drawLayerId&&(a.id=this.drawLayerId);this.drawLayer=new p(a);this._initDefaultSymbols();this._initTypes();a=c(".draw-item",this.domNode);this.own(a.on("click",m.hitch(this,this._onItemClick)));this.own(k(this.btnClear,"click",m.hitch(this,this._onClickClear)));this.own(k(document.body,"keydown",m.hitch(this,function(a){this._shiftKey=!!a.shiftKey;this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.own(k(document.body,"keyup",m.hitch(this,function(a){this._shiftKey=!!a.shiftKey;
this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.map&&this.setMap(this.map);q.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none");this.enable()},enable:function(){this._isDisabled=!1;q.addClass(this.domNode,"enabled");q.removeClass(this.domNode,"disabled")},disable:function(){this._isDisabled=!0;q.addClass(this.domNode,"disabled");q.removeClass(this.domNode,"enabled");this.deactivate()},hideLayer:function(){this.drawLayer&&this.drawLayer.hide()},showLayer:function(){this.drawLayer&&
this.drawLayer.show()},isEnabled:function(){return!this._isDisabled},isActive:function(){var a=c(".draw-item.jimu-state-active",this.domNode);return a&&0<a.length},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.deactivate();this.drawLayer&&this.map&&this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;this.inherited(arguments)},setMap:function(a){a&&
(this.map=a,this.map.addLayer(this.drawLayer),this.drawToolBar=new e(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(k(this.drawToolBar,"draw-end",m.hitch(this,this._onDrawEnd))))},setPointSymbol:function(a){this.pointSymbol=a;this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(a){this.polylineSymbol=a;this.drawToolBar.setLineSymbol(a)},setPolygonSymbol:function(a){this.polygonSymbol=
a;this.drawToolBar.setFillSymbol(a)},setTextSymbol:function(a){this.textSymbol=a},reset:function(){this.deactivate();this.clear()},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();c(".draw-item",this.domNode).removeClass("jimu-state-active");this.drawToolBar&&(this.drawToolBar.deactivate(),this.emit("draw-deactivate"))},activate:function(a){var b=null,e=c(".draw-item",this.domNode);"TEXT"===a?(a="POINT",b=this.textIcon):(e=e.filter(function(b){return b.getAttribute("data-geotype")===
a}),0<e.length&&(b=e[0]));b&&this._activate(b)},onIconSelected:function(a,b,c){this.emit("icon-selected",a,b,c)},onDrawEnd:function(a,b,c,e,d,g){this.emit("draw-end",a,b,c,e,d,g)},onClear:function(){this.emit("clear")},addGraphic:function(a){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(a)},removeGraphic:function(a){this.drawLayer.remove(a)},getFirstGraphic:function(){var a=null;this.drawLayer&&0<this.drawLayer.graphics.length&&(a=this.drawLayer.graphics[0]);return a},show:function(){q.removeClass(this.domNode,
"hidden")},hide:function(){q.addClass(this.domNode,"hidden")},getDrawItemIcons:function(){return c(".draw-item",this.domNode)},_onClickClear:function(){this._isDisabled||(this.clear(),this.emit("user-clear"))},_initDefaultSymbols:function(){var a={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},c={style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},e={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",
outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=b.fromJson(a));this.polylineSymbol||(this.polylineSymbol=b.fromJson(c));this.polygonSymbol||(this.polygonSymbol=b.fromJson(e))},_initTypes:function(){this.geoTypes&&0<this.geoTypes.length?this.types=null:(this.geoTypes=[],this.types&&0<this.types.length||(this.types=["point","polyline","polygon"]),0<=this.types.indexOf("point")&&(this.geoTypes=this.geoTypes.concat(["POINT"])),0<=this.types.indexOf("polyline")&&
(this.geoTypes=this.geoTypes.concat(["LINE","POLYLINE","FREEHAND_POLYLINE"])),0<=this.types.indexOf("polygon")&&(this.geoTypes=this.geoTypes.concat("TRIANGLE EXTENT CIRCLE ELLIPSE POLYGON FREEHAND_POLYGON".split(" "))),0<=this.types.indexOf("text")&&(this.geoTypes=this.geoTypes.concat(["TEXT"])));var b=c(".draw-item",this.domNode);b.style("display","none");a.forEach(b,m.hitch(this,function(b){var c=b.getAttribute("data-geotype"),c=0<=a.indexOf(this.geoTypes,c);q.setStyle(b,"display",c?"block":"none")}))},
_onItemClick:function(a){this._isDisabled||(a=a.target||a.srcElement,q.hasClass(a,"draw-item")&&(q.hasClass(a,"jimu-state-active")?this.deactivate():this._activate(a)))},_activate:function(a){c(".draw-item",this.domNode).removeClass("jimu-state-active");q.addClass(a,"jimu-state-active");var b=a.getAttribute("data-geotype"),d=a.getAttribute("data-commontype"),g=e[b];"TEXT"===b&&(g=e.POINT);this.disableWebMapPopup();this.drawToolBar.activate(g);this.emit("draw-activate",g);this.onIconSelected(a,b,d)},
_onDrawEnd:function(a){var b=c(".draw-item.jimu-state-active",this.domNode)[0],e=b.getAttribute("data-geotype"),b=b.getAttribute("data-commontype"),d=null,d="extent"===a.geometry.type?u.fromExtent(a.geometry):a.geometry;d.geoType=e;d.commonType=b;a=d.type;var f=null,f="point"===a||"multipoint"===a?q.hasClass(this.textIcon,"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===a||"polyline"===a?this.polylineSymbol:this.polygonSymbol,d=new g(d,f,null,null);this.keepOneGraphic&&this.drawLayer.clear();
this.drawLayer.add(d);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(d,e,b,this._shiftKey,this._ctrlKey,this._metaKey)}})})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z,x,A,B,F,E){var C=n(b,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(b,c){this.markerSymbol=new u(u.STYLE_SOLID,10,new t(t.STYLE_SOLID,new d([255,0,0]),2),new d([0,0,0,.25]));this.lineSymbol=new t(t.STYLE_SOLID,new d([255,0,0]),2);this.fillSymbol=new v(v.STYLE_SOLID,new t(t.STYLE_SOLID,new d([255,0,0]),2),new d([0,0,0,.25]));this._points=[];this._mouse=!q("esri-touch")&&!q("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=f.mixin(f.mixin({},this._defaultOptions),c||{});if(a("ios")||a("android"))this._options.showTooltips=!1;this._onKeyDownHandler=f.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=f.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=f.hitch(this,this._onMouseUpHandler);this._onClickHandler=f.hitch(this,this._onClickHandler);this._onMouseMoveHandler=f.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=f.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=f.hitch(this,this._onDblClickHandler);this._updateTooltip=f.hitch(this,this._updateTooltip);this._hideTooltip=f.hitch(this,this._hideTooltip);this._redrawGraphic=f.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(a){this.respectDrawingVertexOrder=a},setMarkerSymbol:function(a){this.markerSymbol=a},setLineSymbol:function(a){this.lineSymbol=a},
setFillSymbol:function(a){this.fillSymbol=a},activate:function(a,b){this._geometryType&&this.deactivate();var c=this.map,e=h.connect,d=C;this._options=f.mixin(f.mixin({},this._options),b||{});c.navigationManager.setImmediateClick(!1);switch(a){case d.ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.UP_ARROW:case d.DOWN_ARROW:case d.TRIANGLE:case d.CIRCLE:case d.ELLIPSE:case d.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=e(c,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=e(c,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=e(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=e(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler2_connect=e(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=e(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler2_connect=e(c,"onMouseDragEnd",this._onMouseUpHandler));q("esri-touch")&&!q("esri-pointer")&&
(this._onMouseDownHandler2_connect=e(c,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=e(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=e(c,"onSwipeEnd",this._onMouseUpHandler));break;case d.POINT:this._onClickHandler_connect=e(c,"onClick",this._onClickHandler);break;case d.LINE:case d.EXTENT:case d.FREEHAND_POLYLINE:case d.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=e(c,"onMouseDown",this._onMouseDownHandler),
this._onMouseDragHandler_connect=e(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=e(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=e(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=e(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=e(c,"onMouseDragEnd",this._onMouseUpHandler));q("esri-touch")&&!q("esri-pointer")&&(this._onMouseDownHandler2_connect=e(c,"onSwipeStart",this._onMouseDownHandler),
this._onMouseDragHandler2_connect=e(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=e(c,"onSwipeEnd",this._onMouseUpHandler));break;case d.POLYLINE:case d.POLYGON:case d.MULTI_POINT:c.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=e(c,"onClick",this._onClickHandler);this._onDblClickHandler_connect=e(c,"onDblClick",this._onDblClickHandler);this._dblClickZoom=c.isDoubleClickZoom;c.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+
a);return}this._onKeyDown_connect=e(c,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=e(c,"onExtentChange",this._redrawGraphic);this._geometryType=a;this._toggleTooltip(!0);c.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(c.snappingManager._startSelectionLayerQuery(),c.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var a=this.map;this._clear();var b=h.disconnect;b(this._onMouseMoveHandler_connect);
b(this._onMouseDownHandler_connect);b(this._onMouseDragHandler_connect);b(this._onMouseUpHandler_connect);b(this._onMouseDownHandler2_connect);b(this._onMouseDragHandler2_connect);b(this._onMouseUpHandler2_connect);b(this._onClickHandler_connect);b(this._onDblClickHandler_connect);b(this._onKeyDown_connect);b(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=
this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;a.snappingManager&&(a.snappingManager._stopSelectionLayerQuery(),a.snappingManager._killOffSnapping());switch(this._geometryType){case C.CIRCLE:case C.ELLIPSE:case C.TRIANGLE:case C.ARROW:case C.LEFT_ARROW:case C.RIGHT_ARROW:case C.UP_ARROW:case C.DOWN_ARROW:case C.RECTANGLE:case C.LINE:case C.EXTENT:case C.FREEHAND_POLYLINE:case C.FREEHAND_POLYGON:this._activateMapTools(!0,
!1,!1,!0);break;case C.POLYLINE:case C.POLYGON:case C.MULTI_POINT:this._dblClickZoom&&a.enableDoubleClickZoom()}b=this._geometryType;this._geometryType=null;a.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(b)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._tGraphic&&this.map.graphics.remove(this._tGraphic,!0);this._graphic=this._tGraphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},
finishDrawing:function(){var a,b=this._points,c=this.map.spatialReference,e=C,b=b.slice(0,b.length);switch(this._geometryType){case e.POLYLINE:if(!this._graphic||2>b.length)return;a=new x(c);a.addPath([].concat(b));break;case e.POLYGON:if(!this._graphic||3>b.length)return;a=new A(c);b=[].concat(b,[b[0].offset(0,0)]);A.prototype.isClockwise(b)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),b.reverse());
a.addRing(b);break;case e.MULTI_POINT:a=new B(c),l.forEach(b,function(b){a.addPoint(b)})}h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(a)},_drawEnd:function(a){if(a){var b=this.map.spatialReference,c;this.onDrawEnd(a);b&&(b.isWebMercator()?c=z.webMercatorToGeographic(a,!0):4326===b.wkid&&(c=y.fromJson(a.toJson())));this.onDrawComplete({geometry:a,geographicGeometry:c})}},_normalizeRect:function(a,b,c){var e=a.x;a=a.y;var d=b.x;b=b.y;return{x:Math.min(e,
d),y:Math.max(a,b),width:Math.abs(e-d),height:Math.abs(a-b),spatialReference:c}},_onMouseDownHandler:function(a){this._dragged=!1;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=b||a.mapPoint,e=C;b=this.map;var d=b.spatialReference;this._points.push(c.offset(0,0));switch(this._geometryType){case e.LINE:this._graphic=b.graphics.add(new w(new x({paths:[[[c.x,c.y],[c.x,c.y]]],spatialReference:d}),this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);
break;case e.FREEHAND_POLYLINE:this._oldPoint=a.screenPoint;c=new x(d);c.addPath(this._points);this._graphic=b.graphics.add(new w(c,this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);break;case e.CIRCLE:case e.ELLIPSE:case e.TRIANGLE:case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.RECTANGLE:case e.FREEHAND_POLYGON:this._oldPoint=a.screenPoint,c=new A(d),c.addRing(this._points),this._graphic=b.graphics.add(new w(c,this.fillSymbol),
!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)}q("esri-touch")&&a.preventDefault()},_onMouseMoveHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[this._points.length-1];a=b||a.mapPoint;b=this._tGraphic;var e=b.geometry;switch(this._geometryType){case C.POLYLINE:case C.POLYGON:e.setPoint(0,0,{x:c.x,y:c.y}),e.setPoint(0,1,{x:a.x,y:a.y}),b.setGeometry(e)}},_onMouseDragHandler:function(a){if(this._graphic||this._points.length)if(q("esri-touch")&&
!this._points.length)a.preventDefault();else{this._dragged=!0;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0],e=b||a.mapPoint,d=this.map,g=d.spatialReference;b=this._graphic;var k=C,h=d.toScreen(c),p=d.toScreen(e),m=[],m=p.x-h.x,p=p.y-h.y,l=Math.sqrt(m*m+p*p);switch(this._geometryType){case k.CIRCLE:this._hideTooltip();b.geometry=A.createCircle({center:h,r:l,numberOfPoints:60,map:d});b.setGeometry(b.geometry);break;case k.ELLIPSE:this._hideTooltip();
b.geometry=A.createEllipse({center:h,longAxis:m,shortAxis:p,numberOfPoints:60,map:d});b.setGeometry(b.geometry);break;case k.TRIANGLE:this._hideTooltip();m=[[0,-l],[.8660254037844386*l,.5*l],[-.8660254037844386*l,.5*l],[0,-l]];b.geometry=this._toPolygon(m,h.x,h.y);b.setGeometry(b.geometry);break;case k.ARROW:this._hideTooltip();c=p/l;d=m/l;e=.25*d*l;g=.25*l/(p/m);l*=.25*c;m=[[m,p],[m-e*(1+24/g),p+24*d-l],[m-e*(1+12/g),p+12*d-l],[-12*c,12*d],[12*c,-12*d],[m-e*(1-12/g),p-12*d-l],[m-e*(1-24/g),p-24*
d-l],[m,p]];b.geometry=this._toPolygon(m,h.x,h.y);b.setGeometry(b.geometry);break;case k.LEFT_ARROW:this._hideTooltip();m=0>=m?[[m,0],[.75*m,p],[.75*m,.5*p],[0,.5*p],[0,-.5*p],[.75*m,-.5*p],[.75*m,-p],[m,0]]:[[0,0],[.25*m,p],[.25*m,.5*p],[m,.5*p],[m,-.5*p],[.25*m,-.5*p],[.25*m,-p],[0,0]];b.geometry=this._toPolygon(m,h.x,h.y);b.setGeometry(b.geometry);break;case k.RIGHT_ARROW:this._hideTooltip();m=0<=m?[[m,0],[.75*m,p],[.75*m,.5*p],[0,.5*p],[0,-.5*p],[.75*m,-.5*p],[.75*m,-p],[m,0]]:[[0,0],[.25*m,p],
[.25*m,.5*p],[m,.5*p],[m,-.5*p],[.25*m,-.5*p],[.25*m,-p],[0,0]];b.geometry=this._toPolygon(m,h.x,h.y);b.setGeometry(b.geometry);break;case k.UP_ARROW:this._hideTooltip();m=0>=p?[[0,p],[-m,.75*p],[-.5*m,.75*p],[-.5*m,0],[.5*m,0],[.5*m,.75*p],[m,.75*p],[0,p]]:[[0,0],[-m,.25*p],[-.5*m,.25*p],[-.5*m,p],[.5*m,p],[.5*m,.25*p],[m,.25*p],[0,0]];b.geometry=this._toPolygon(m,h.x,h.y);b.setGeometry(b.geometry);break;case k.DOWN_ARROW:this._hideTooltip();m=0<=p?[[0,p],[-m,.75*p],[-.5*m,.75*p],[-.5*m,0],[.5*m,
0],[.5*m,.75*p],[m,.75*p],[0,p]]:[[0,0],[-m,.25*p],[-.5*m,.25*p],[-.5*m,p],[.5*m,p],[.5*m,.25*p],[m,.25*p],[0,0]];b.geometry=this._toPolygon(m,h.x,h.y);b.setGeometry(b.geometry);break;case k.RECTANGLE:this._hideTooltip();m=[[0,0],[m,0],[m,p],[0,p],[0,0]];b.geometry=this._toPolygon(m,h.x,h.y);b.setGeometry(b.geometry);break;case k.LINE:b.setGeometry(f.mixin(b.geometry,{paths:[[[c.x,c.y],[e.x,e.y]]]}));break;case k.EXTENT:b&&d.graphics.remove(b,!0);b=new F(this._normalizeRect(c,e,g));b._originOnly=
!0;this._graphic=d.graphics.add(new w(b,this.fillSymbol),!0);d.snappingManager&&d.snappingManager._setGraphic(this._graphic);break;case k.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){q("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([e.offset(0,0)],0);b.setGeometry(b.geometry);break;case k.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){q("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,
0));b.geometry._insertPoints([e.offset(0,0)],0);b.setGeometry(b.geometry)}q("esri-touch")&&a.preventDefault()}},_canDrawFreehandPoint:function(a){if(!this._oldPoint)return!1;var b=this._oldPoint.x-a.screenPoint.x,c=this._oldPoint.y-a.screenPoint.y,e=this._options.tolerance;if((0>b?-1*b:b)<e&&(0>c?-1*c:c)<e)return!1;b=new Date;if(b-this._startTime<this._options.drawTime)return!1;this._startTime=b;this._oldPoint=a.screenPoint;return!0},_onMouseUpHandler:function(a){if(this._dragged&&this._graphic){0===
this._points.length&&this._points.push(a.mapPoint.offset(0,0));var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0];b=b||a.mapPoint;var e=this.map.spatialReference,d=C,g;switch(this._geometryType){case d.CIRCLE:case d.ELLIPSE:case d.TRIANGLE:case d.ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.UP_ARROW:case d.DOWN_ARROW:case d.RECTANGLE:g=this._graphic.geometry;break;case d.LINE:g=new x({paths:[[[c.x,c.y],[b.x,b.y]]],spatialReference:e});break;case d.EXTENT:g=
(new F(this._normalizeRect(c,b,e))).getExtent();break;case d.FREEHAND_POLYLINE:g=new x(e);g.addPath([].concat(this._points,[b.offset(0,0)]));break;case d.FREEHAND_POLYGON:g=new A(e),c=[].concat(this._points,[b.offset(0,0),this._points[0].offset(0,0)]),A.prototype.isClockwise(c)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),c.reverse()),g.addRing(c)}q("esri-touch")&&a.preventDefault();this._clear();
this._drawEnd(g)}else this._clear()},_onClickHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);a=b||a.mapPoint;b=this.map;var c=b.toScreen(a),e=C;this._points.push(a.offset(0,0));switch(this._geometryType){case e.POINT:this._drawEnd(a.offset(0,0));this._setTooltipMessage(0);break;case e.POLYLINE:1===this._points.length?(c=new x(b.spatialReference),c.addPath(this._points),this._graphic=b.graphics.add(new w(c,this.lineSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),
this._onMouseMoveHandler_connect=h.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new w(new x({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.lineSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,1,a.offset(0,0)),b.setGeometry(c));break;case e.POLYGON:1===this._points.length?
(c=new A(b.spatialReference),c.addRing(this._points),this._graphic=b.graphics.add(new w(c,this.fillSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=h.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new w(new x({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.fillSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol),
b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,1,a.offset(0,0)),b.setGeometry(c));break;case e.MULTI_POINT:a=this._points;1===a.length?(c=new B(b.spatialReference),c.addPoint(a[a.length-1]),this._graphic=b.graphics.add(new w(c,this.markerSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)):(this._graphic.geometry.addPoint(a[a.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case e.ARROW:this._addShape([[0,
0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case e.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],c.x,c.y);break;case e.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case e.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],c.x,c.y);break;case e.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],
[12,-24],[24,-24],[0,0]],c.x,c.y);break;case e.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],c.x,c.y);break;case e.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],c.x-48,c.y+48);break;case e.CIRCLE:this._clear();this._drawEnd(A.createCircle({center:c,r:48,numberOfPoints:60,map:b}));break;case e.ELLIPSE:this._clear(),this._drawEnd(A.createEllipse({center:c,longAxis:48,shortAxis:24,numberOfPoints:60,map:b}))}this._setTooltipMessage(this._points.length)},
_addShape:function(a,b,c){this._setTooltipMessage(0);this._clear();this._drawEnd(this._toPolygon(a,b,c))},_toPolygon:function(a,b,c){var e=this.map,d=new A(e.spatialReference);d.addRing(l.map(a,function(a){return e.toMap({x:a[0]+b,y:a[1]+c})}));return d},_onDblClickHandler:function(a){var b,c=this._points,e=this.map.spatialReference,d=C;q("esri-touch")&&c.push(a.mapPoint);var g=c[c.length-1],f=c[c.length-2],c=g&&f&&g.x===f.x&&g.y===f.y?c.slice(0,c.length-1):c.slice(0,c.length);switch(this._geometryType){case d.POLYLINE:if(!this._graphic||
2>c.length){h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new x(e);b.addPath([].concat(c));break;case d.POLYGON:if(!this._graphic||2>c.length){h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new A(e);a=[].concat(c,[c[0].offset(0,0)]);A.prototype.isClockwise(a)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),
a.reverse());b.addRing(a);break;case d.MULTI_POINT:b=new B(e),l.forEach(c,function(a){b.addPoint(a)})}h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(b)},_onKeyDownHandler:function(a){a.keyCode===k.ESCAPE&&(h.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(a){this._options.showTooltips&&(a?this._tooltip||(this._tooltip=c.create("div",{"class":"tooltip"},this.map.container),g.isBodyLtr()||
r.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=h.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=h.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=h.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(h.disconnect(this._onTooltipMouseEnterHandler_connect),h.disconnect(this._onTooltipMouseLeaveHandler_connect),
h.disconnect(this._onTooltipMouseMoveHandler_connect),c.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var a=this._tooltip;a&&(a.style.display="none")},_setTooltipMessage:function(a){var b=this._tooltip;if(b){var c="";switch(this._geometryType){case C.POINT:c=E.toolbars.draw.addPoint;break;case C.ARROW:case C.LEFT_ARROW:case C.RIGHT_ARROW:case C.UP_ARROW:case C.DOWN_ARROW:case C.TRIANGLE:case C.RECTANGLE:case C.CIRCLE:case C.ELLIPSE:c=E.toolbars.draw.addShape;break;case C.LINE:case C.EXTENT:case C.FREEHAND_POLYLINE:case C.FREEHAND_POLYGON:c=
E.toolbars.draw.freehand;break;case C.POLYLINE:case C.POLYGON:c=E.toolbars.draw.start;1===a?c=E.toolbars.draw.resume:2<=a&&(c=E.toolbars.draw.complete);break;case C.MULTI_POINT:c=E.toolbars.draw.addMultipoint,1<=a&&(c=E.toolbars.draw.finish)}b.innerHTML=c}},_updateTooltip:function(a){var b=this._tooltip;if(b){var c;a.clientX||a.pageY?(c=a.clientX,a=a.clientY):(c=a.clientX+m.body().scrollLeft-m.body().clientLeft,a=a.clientY+m.body().scrollTop-m.body().clientTop);b.style.display="none";r.set(b,{left:c+
this._options.tooltipOffset+"px",top:a+"px"});b.style.display=""}},_redrawGraphic:function(a,b,c,e){if(c||this.map.wrapAround180)(a=this._graphic)&&a.setGeometry(a.geometry),(a=this._tGraphic)&&a.setGeometry(a.geometry)},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawEnd:function(){}});f.mixin(C,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",
ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});q("extend-esri")&&f.setObject("toolbars.Draw",C,p);return C})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(n,f,l,h,d){n=n([d],{declaredClass:"esri.toolbars._Toolbar",constructor:function(d){this.map=d},_cursors:{move:"pointer","move-v":"pointer",
"move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(d,f,a,k){var c=this.map;d&&(this._mapNavState={isDoubleClickZoom:c.isDoubleClickZoom,isClickRecenter:c.isClickRecenter,isPan:c.isPan,isRubberBandZoom:c.isRubberBandZoom,isKeyboardNavigation:c.isKeyboardNavigation,isScrollWheelZoom:c.isScrollWheelZoom},c.disableDoubleClickZoom(),c.disableClickRecenter(),
c.disablePan(),c.disableRubberBandZoom(),c.disableKeyboardNavigation());f&&c.hideZoomSlider();a&&c.hidePanArrows();k&&c.graphics.disableMouseEvents()},_activateMapTools:function(d,f,a,k){var c=this.map,h=this._mapNavState;d&&h&&(h.isDoubleClickZoom&&c.enableDoubleClickZoom(),h.isClickRecenter&&c.enableClickRecenter(),h.isPan&&c.enablePan(),h.isRubberBandZoom&&c.enableRubberBandZoom(),h.isKeyboardNavigation&&c.enableKeyboardNavigation(),h.isScrollWheelZoom&&c.enableScrollWheelZoom());f&&c.showZoomSlider();
a&&c.showPanArrows();k&&c.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var d=this.map;this._scrollWheelState={isScrollWheelZoom:d.isScrollWheelZoom,isScrollWheelPan:d.isScrollWheelPan};d.disableScrollWheelZoom();d.disableScrollWheelPan()},_activateScrollWheel:function(){var d=this.map,f=this._scrollWheelState;f&&(f.isScrollWheelZoom&&d.enableScrollWheelZoom(),f.isScrollWheelPan&&d.enableScrollWheelPan())}});l("extend-esri")&&f.setObject("toolbars._Toolbar",n,h);return n})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare",
"dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(n,f,l,h){return n([l],{required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,declaredClass:"jimu.dijit.URLInput",postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?this.nls.invalidUrl:"Invalid Url"},postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-url-input")},validator:function(d){if(isFinite(d))return!1;
var f="^"+h.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),f=(new RegExp(f,"g")).test(d);return this.rest?(d=/\/rest\/services/gi.test(d),f&&d):f}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(n,f,l){var h=n.getObject("validate.regexp",!0,l);return h=l.validate.regexp={ipAddress:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowDottedDecimal&&(d.allowDottedDecimal=!0);"boolean"!=typeof d.allowDottedHex&&(d.allowDottedHex=
!0);"boolean"!=typeof d.allowDottedOctal&&(d.allowDottedOctal=!0);"boolean"!=typeof d.allowDecimal&&(d.allowDecimal=!0);"boolean"!=typeof d.allowHex&&(d.allowHex=!0);"boolean"!=typeof d.allowIPv6&&(d.allowIPv6=!0);"boolean"!=typeof d.allowHybrid&&(d.allowHybrid=!0);var f=[];d.allowDottedDecimal&&f.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");d.allowDottedHex&&f.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");d.allowDottedOctal&&
f.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");d.allowDecimal&&f.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");d.allowHex&&f.push("0[xX]0*[\\da-fA-F]{1,8}");d.allowIPv6&&f.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");d.allowHybrid&&f.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");d=
"";0<f.length&&(d="("+f.join("|")+")");return d},host:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowIP&&(d.allowIP=!0);"boolean"!=typeof d.allowLocal&&(d.allowLocal=!1);"boolean"!=typeof d.allowPort&&(d.allowPort=!0);"boolean"!=typeof d.allowNamed&&(d.allowNamed=!1);var f=d.allowPort?"(\\:\\d+)?":"",l="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.?)";d.allowIP&&(l+="|"+h.ipAddress(d));d.allowLocal&&(l+="|localhost");d.allowNamed&&
(l+="|^[^-][a-zA-Z0-9_-]*");return"("+l+")"+f},url:function(d){d="object"==typeof d?d:{};"scheme"in d||(d.scheme=[!0,!1]);return f.buildGroupRE(d.scheme,function(d){return d?"(https?|ftps?)\\://":""})+h.host(d)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},emailAddress:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowCruft&&(d.allowCruft=!1);d.allowPort=!1;var f="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+h.host(d);d.allowCruft&&
(f="\x3c?(mailto\\:)?"+f+"\x3e?");return f},emailAddressList:function(d){d="object"==typeof d?d:{};"string"!=typeof d.listSeparator&&(d.listSeparator="\\s;,");var f=h.emailAddress(d);return"("+f+"\\s*["+d.listSeparator+"]\\s*)*"+f+"\\s*["+d.listSeparator+"]?\\s*"},numberFormat:function(d){d="object"==typeof d?d:{};"undefined"==typeof d.format&&(d.format="###-###-####");return f.buildGroupRE(d.format,function(d){return f.escapeString(d,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},
province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowTerritories&&(d.allowTerritories=!0);"boolean"!=typeof d.allowMilitary&&(d.allowMilitary=!0);var f="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";d.allowTerritories&&(f+="|AS|FM|GU|MH|MP|PW|PR|VI");d.allowMilitary&&(f+="|AA|AE|AP");return"("+f+")"}}}})},
"jimu/dijit/ColorPalette":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dojo/query jimu/dijit/ColorChooser jimu/dijit/ColorPicker jimu/dijit/ColorRecords dijit/popup jimu/utils dijit/a11yclick".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b){return n([f,h,l],{templateString:"\x3cdiv\x3e\x3c/div\x3e",baseClass:"jimu-color-palette",declaredClass:"jimu.dijit.ColorPalette",_TRANSPARENT_STR:"rgba(0, 0, 0, 0)",
value:"",_defaultAppearance:{showTransparent:!0,showColorPalette:!0,showColorPickerOK:!1,showCoustom:!0,showCoustomRecord:!0},recordUID:"",postMixInProperties:function(){this.nls=window.jimuNls.colorPalette},postCreate:function(){this.inherited(arguments);this.value=this.value?new a(this.value):new a("#fff");this._createContent()},_createContent:function(){this.appearance=d.mixin(this._defaultAppearance,this.appearance);var a=m.create("div",{"class":"jimu-colorpalette"},this.domNode);this.appearance.showTransparent&&
this._createSpecialColors(a);this.appearance.showColorPalette&&this._createColorChooser(a);this.appearance.showCoustom&&this._createJimuColorPicker(a);this.appearance.showCoustom&&this.appearance.showCoustomRecord&&this._createCoustomRecord(a)},setColor:function(b){this._isColorEqual(b)||(this.value=new a(b),this._setSpatialColor(this.value),"undefined"!==typeof this.value.a&&0===this.value.a?(this.colorChooser.setColor(new a("transparent"),!1),this.picker.setColor(new a("#fff"),!1)):(this.colorChooser.setColor(this.value.toHex(),
!1),this.picker.setColor(this.value,!1)),this.colorRecords&&this.colorRecords.selecteColor(this.value))},getColor:function(){return this.value},changeColor:function(){if("undefined"!==typeof this.value.a&&0===this.value.a)this.onChange(this.value);else this.onChange(this.value.toHex())},refreshRecords:function(){this.colorRecords&&this.colorRecords.refresh()},destroy:function(){p.close(this.tooltipDialog);this.picker.destroy();this.inherited(arguments)},_createSpecialColors:function(a){a=m.create("div",
{"class":"special-color"},a);this.transparentBtn=m.create("div",{"class":"transparent btn",innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"transparent icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"transparent text jimu-float-leading"\x3e'+this.nls.transparent+"\x3c/div\x3e\x3c/div\x3e"},a);this.own(q(this.transparentBtn,b,d.hitch(this,this._onTransparentClick)))},_onTransparentClick:function(){this.setColor(new a("transparent"));this.changeColor()},_setSpatialColor:function(a){if(this.transparentBtn){var b=
k(".btn-wapper",this.transparentBtn)[0];m.removeClass(b,"selected");a&&a.toString&&a.toString()===this._TRANSPARENT_STR&&m.addClass(b,"selected")}},_createColorChooser:function(b){this.colorChooser=new c({});this.colorChooser.placeAt(b);this.own(q(this.colorChooser,"change",d.hitch(this,function(b){b=new a(b);this.setColor(b);this.changeColor()})))},_createJimuColorPicker:function(b){this.coustomtBtn=m.create("div",{"class":"coustom btn"},b);b='\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"custom icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"custom text jimu-float-leading"\x3e'+
this.nls.custom+"\x3c/div\x3e\x3c/div\x3e";this.picker=new r({ensureMode:!0,showOk:this.appearance.showColorPickerOK,showLabel:!1,value:this.value.toHex(),onChange:d.hitch(this,function(b){b=new a(b);this.setColor(b);this.changeColor();this.colorRecords&&this.colorRecords.push&&this.colorRecords.push(b)})});this.picker.placeAt(this.coustomtBtn);this.picker.setLabel(b);this.picker.setColor(this.value)},_createCoustomRecord:function(b){this.colorRecords=new g({recordsLength:10,uid:this.recordUID||""});
this.colorRecords.placeAt(b);this.own(q(this.colorRecords,"choose",d.hitch(this,function(b){this.setColor(new a(b));this.changeColor()})))},_isColorEqual:function(b){return this.value.toString()===(new a(b)).toString()?!0:!1},_changeLabel:function(a){m.empty(this.domNode);m.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:e.invertColor(a.toHex())}},this.domNode)},getPickerTooltipDialog:function(){var a=null;this.picker&&this.picker.tooltipDialog&&(a=this.picker.tooltipDialog);
return a}})})},"jimu/dijit/ColorChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/i18n dojo/_base/Color dijit/a11yclick dojo/i18n!dojo/nls/colors".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g){return f([l,h,d,n],{templateString:'\x3cdiv\x3e\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\x3ctable class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e',
baseClass:"jimu-color-chooser",declaredClass:"jimu.dijit.ColorChooser",uid:"",colorsArray:["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"rgb(0,0,1) darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],postCreate:function(){this.inherited(arguments);this.colorTitleNls=c.getLocalization("dojo","colors");this._createColorsBlocks()},_createColorsBlocks:function(){this._row=this.colorsArray.length;
this._col=this.colorsArray[0].length;for(var c=0;c<this._row;c++)for(var e=q.create("tr",{role:"row"},this.gridNode),b=0;b<this._col;b++){var d=this.colorsArray[c][b],f=r.named[d],k="";f?k=d:"rgb(0,0,1)"===d&&(k="black",f="rgb(0,0,1)");d=this.colorTitleNls[k];f=(new r(f)).toString();this["record"+b]=q.create("td",{"class":"dijitPaletteCell","data-title":f,role:"gridcell"},e);var h=q.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+b]);q.create("img",{"class":"dijitColorPaletteSwatch",
src:require.toUrl("dojo/resources/blank.gif"),alt:d,title:d,"data-title":k,width:"16px",height:"16px",style:"background-color: "+f},h)}this.own(a(this.gridNode,g,m.hitch(this,this.onColorClick)))},onColorClick:function(a){for(var c=a.target;"TD"!==c.tagName;){if(!c.parentNode||c===this.gridNode)return;c=c.parentNode}c=q.getAttr(c,"data-title");c=(new r(c)).toString();this.setColor(c);a.stopPropagation();a.preventDefault()},_onChange:function(a){this.emit("change",a)},setColor:function(a,c){for(var b=
new r(a),e=null,d=k("td",this.domNode),g=0,f=d.length;g<f;g++)q.removeClass(d[g],"dijitPaletteCellSelected");g=0;for(f=d.length;g<f;g++)if(b.toString()===q.getAttr(d[g],"data-title")){e=d[g];break}e&&q.addClass(e,"dijitPaletteCellSelected");(e&&"undefined"===typeof c||!0===c)&&this._onChange(b)}})})},"jimu/dijit/ColorRecords":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/_base/Color dojo/cookie dojo/text!./templates/ColorRecords.html dijit/a11yclick".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p){return f([l,h,d,n],{templateString:g,baseClass:"jimu-color-records",declaredClass:"jimu.dijit.ColorRecords",uid:"",recordsLength:10,colorList:null,postCreate:function(){this.inherited(arguments);this.colorList=[];this._createCoustomRecord();""===this.uid&&(this.uid="wab_colorRecords");this.refresh()},push:function(a){this.colorList.unshift(a);this.colorList.length>this.recordsLength&&this.colorList.pop();this._setColors()},selecteColor:function(a){a=new c(a);for(var b=
null,e=k("td",this.domNode),d=0,g=e.length;d<g;d++)q.removeClass(e[d],"dijitPaletteCellSelected");d=0;for(g=e.length;d<g;d++)if(a.toString()===q.getAttr(e[d],"title")){b=e[d];break}b&&(q.addClass(b,"dijitPaletteCellSelected"),this.onChoose(a))},refresh:function(){this._getCookie(this.uid);this._setColors()},_setColors:function(){for(var a=0;a<this.recordsLength;a++){var b=this["record"+a];if(b&&this.colorList[a]&&this.colorList[a].toString){var c=this.colorList[a].toString();q.setAttr(b,"title",c);
b=this._findImg(b);q.setStyle(b,"background-color",c);q.setAttr(b,"alt",c);q.setAttr(b,"title",c)}}this._setCookie(this.uid)},_createCoustomRecord:function(){for(var c=0;c<this.recordsLength;c++){this["record"+c]=q.create("td",{"class":"dijitPaletteCell",tabindex:c,title:"",role:"gridcell"},this.container);var b=q.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+c]);q.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),style:"background-color: #ffffff"},
b)}this.own(a(this.gridNode,p,m.hitch(this,this.onRecordClick)))},onRecordClick:function(a){for(var b=a.target;"TD"!==b.tagName;){if(!b.parentNode||b===this.gridNode)return;b=b.parentNode}b=q.getAttr(b,"title");b=(new c(b)).toString();this.onChoose(b);a.stopPropagation();a.preventDefault()},onChoose:function(a){this.emit("choose",a)},_findImg:function(a){var b=null;return a.nodeName&&"IMG"===a.nodeName.toUpperCase()?a:b=k(".dijitColorPaletteSwatch",a)[0]},_setCookie:function(a){for(var b=[],c=0,d=
this.recordsLength;c<d;c++){var e=this.colorList[c];e&&e.toString&&(b[c]=e.toString())}this._cleanCookie(a);try{var g=JSON.stringify(b);r(a,g,{expires:1E3,path:"/"})}catch(y){console.error("ColorRecords: cookieList JSON.stringify error."+y.stack)}},_getCookie:function(a){a=r(a);if("undefined"!==typeof a)try{var b=JSON.parse(a);if(b&&"undefined"!==typeof b.length){a=0;for(var d=this.recordsLength;a<d;a++){var e=b[a];e&&e.toString&&(this.colorList[a]=new c(e.toString()))}}}catch(v){console.error("ColorRecords: cookieList JSON.parse error."+
v.stack)}},_cleanCookie:function(a){r(a,null,{expires:-1})}})})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),function(n,f,l,h,d,m,q,a,k){return n([q,m],{baseClass:"jimu-panel jimu-on-screen-widget-panel jimu-main-background",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(a){a.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(a){a.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(l.removeClass(this.foldableNode,"fold-up"),l.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(l.removeClass(this.foldableNode,"fold-down"),l.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(a){this.panelManager.closePanel(this);a.stopPropagation();"touchstart"===a.type&&a.preventDefault()},_normalizePositionObj:function(a){var c=
this._getLayoutBox();a.left=isFinite(a.left)?a.left:c.w-a.right;a.top=isFinite(a.top)?a.top:c.h-a.bottom;delete a.right;delete a.bottom;this.position=f.mixin(f.clone(this.position),a)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new k({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(a,k){this.disableMoveable();var c=l.getMarginBox(jimuConfig.layoutId);c.l=c.l-a+k;c.w+=2*(a-k);this.moveable=new d.boxConstrainedMoveable(this.domNode,{box:c,handle:this.titleNode,within:!0});this.own(h(this.moveable,
"Moving",f.hitch(this,this.onMoving)));this.own(h(this.moveable,"MoveStop",f.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){l.removeClass(this.titleNode,"title-normal");l.addClass(this.titleNode,"title-full");l.setStyle(this.foldableNode,"display",
"block");l.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(l.removeClass(this.foldableNode,"fold-up"),l.addClass(this.foldableNode,"fold-down")):(l.removeClass(this.foldableNode,"fold-down"),l.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){l.removeClass(this.titleNode,"title-full");l.addClass(this.titleNode,"title-normal");l.setStyle(this.foldableNode,"display","none");l.setStyle(this.maxNode,"display","none")},resize:function(a){var c=this._getPositionInfo(),
d={left:c.position.left,top:c.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};a&&(a.t=this.domNode.offsetTop,d.left=isFinite(a.l)?a.l:d.left,d.top=isFinite(a.t)?a.t:d.top,d.width=isFinite(a.w)?a.w:d.width,d.height=isFinite(a.h)?a.h:d.height,this._normalizePositionObj(f.clone(d)),this.makePositionInfoBox(),d.width=this._positionInfoBox.w,d.height=this._positionInfoBox.h);c.position=d;this._onResponsible(c);this.inherited(arguments)},_onResponsible:function(a){a.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(a.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(a){this._normalizePositionObj(a);this.makePositionInfoBox();a=this._getPositionInfo();this._onResponsible(a)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var a=jimuConfig.layoutId,
a="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return l.getMarginBox(a)},_getPositionInfo:function(){var a={isRunInMobile:!1,position:{left:0,top:5}},d=this._getLayoutBox(),g=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return a.isRunInMobile=!0,a;window.isRTL?(a.position.left=d.w-g,a.position.left+this._positionInfoBox.w>d.w&&(a.position.left-=this._positionInfoBox.w,0>a.position.left&&(a.position.left=d.w-this._positionInfoBox.w))):(a.position.left=g,a.position.left+
this._positionInfoBox.w>d.w&&(a.position.left=d.w>this._positionInfoBox.w?d.w-this._positionInfoBox.w:0));g=this._positionInfoBox.t;d=d.h-g;g>=d?g>=this._positionInfoBox.h&&(a.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):d>=this._positionInfoBox.h&&(a.position.top=this._positionInfoBox.t+40+3);return a},_setMobilePosition:function(){window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==l.byId(jimuConfig.layoutId)&&l.place(this.domNode,jimuConfig.layoutId);var c=
this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(c.zIndex=this.position.zIndex);var d=a.getPositionStyle(c);f.mixin(d,c.borderRadiusStyle);l.setStyle(this.domNode,d)},_setDesktopPosition:function(a){!window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==l.byId(jimuConfig.mapId)&&l.place(this.domNode,jimuConfig.mapId);l.setStyle(this.domNode,{left:a.left+"px",right:"auto",top:a.top+"px",width:(a.width||this.position.width||this._originalBox.w)+"px",height:(a.height||
this.position.height||this._originalBox.h)+"px"})},onMoving:function(a){l.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){l.setStyle(a.node,"opacity",1);a=l.getMarginBox(a.node);this._normalizePositionObj(f.clone({left:a.l,top:a.t,width:a.w,height:a.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t){n.experimental("dojox.layout.ResizeHandle");var v=p("dojox.layout._ResizeHelper",u,{show:function(){g.set(this.domNode,"display","")},hide:function(){g.set(this.domNode,"display","none")},resize:function(a){r.setMarginBox(this.domNode,a)}});return p("dojox.layout.ResizeHandle",[u,t],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,e.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=b.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new v({id:"dojoxGlobalResizeHelper"})).placeAt(q.body()),
c.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=f.partial(c.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(a){if(!this._isSizing&&
(l.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=b.byId(this.targetId))?this.targetWidget.domNode:k.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var c=r.position(this.targetDomNode,!0);this._resizeHelper.resize({l:c.x,t:c.y,w:c.w,h:c.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:c.x,t:c.y})}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};
var c=g.getComputedStyle(this.targetDomNode),f="border-model"===r.boxModel?{w:0,h:0}:r.getPadBorderExtents(this.targetDomNode,c),h=r.getMarginExtents(this.targetDomNode,c);this.startSize={w:g.get(this.targetDomNode,"width",c),h:g.get(this.targetDomNode,"height",c),pbw:f.w,pbh:f.h,mw:h.w,mh:h.h};this.isLeftToRight()||"absolute"!=g.get(this.targetDomNode,"position")||(c=r.position(this.targetDomNode,!0),this.startPosition={l:c.x,t:c.y});this._pconnects=[l.connect(q.doc,e.move,this,"_updateSizing"),
l.connect(q.doc,e.release,this,"_endSizing")];d.stop(a)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,c){try{if(!a.clientX||!a.clientY)return!1}catch(B){return!1}this._activeResizeLastEvent=a;var d=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),e=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
d:0);e=this._checkConstraints(a,this.startSize.h-(this._resizeY?e:0));(c=c||this.startPosition)&&this._resizeX&&(e.l=c.l+d,e.w!=a&&(e.l+=a-e.w),e.t=c.t);switch(b){case "margin":e.w+=this.startSize.mw,e.h+=this.startSize.mh;case "border":e.w+=this.startSize.pbw,e.h+=this.startSize.pbh}return e},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,
d=this.startSize.h,e=c*b-d*a;0>e?a=b*c/d:0<e&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(b){var c=this.targetWidget&&f.isFunction(this.targetWidget.resize),d=this._getNewCoords(b,c&&"margin");if(!1!==d&&(c?this.targetWidget.resize(d):this.animateSizing?a[this.animateMethod]([m.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:d.w}},duration:this.animateDuration}),m.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:d.h}},
duration:this.animateDuration})]).play():g.set(this.targetDomNode,{width:d.w+"px",height:d.h+"px"}),this.intermediateChanges))this.onResize(b)},_endSizing:function(a){h.forEach(this._pconnects,l.disconnect);var b=f.partial(l.publish,this.endTopic,[this]);this.activeResize?b():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(b,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"jimu/LayerInfos/LayerInfoForCollection":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils ./LayerInfo ./LayerInfoFactory".split(" "),
function(n,f,l,h,d,m){return n(d,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection",empty:!0}},getExtent:function(){var d=[],a;f.forEach(this.originOperLayer.featureCollection.layers,function(a){d=d.concat(a.layerObject.graphics)});0===d.length?a=null:(a=1===d.length?d[0].getLayer().fullExtent:h.graphicsExtent(d),a=this._convertGeometryToMapSpatialRef(a));return a},_resetLayerObjectVisiblity:function(d){var a=d?d[this.id]:null;a&&(f.forEach(this.newSubLayers,
function(a){var c=d?d[a.id]:null;c&&a.layerObject.setVisibility(c.visible)},this),this._setTopLayerVisible(a.visible))},initVisible:function(){var d=!1,a;for(a=0;a<this.newSubLayers.length;a++)d=d||this.newSubLayers[a].layerObject.visible;d&&(this._visible=!0)},_setTopLayerVisible:function(d){this._visible=d?!0:!1;f.forEach(this.newSubLayers,function(a){a.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var d=[];f.forEach(this.originOperLayer.featureCollection.layers,
function(a){this._getLayerIndexesInMapByLayerId(a.layerObject.id)&&(l.setObject("_wabProperties.originOperLayer.showLegend",this.originOperLayer.featureCollection.showLegend,a.layerObject),a=m.getInstance().create({layerObject:a.layerObject,title:a.layerObject.label||a.layerObject.title||a.layerObject.name||a.layerObject.id||" ",id:a.id||" ",collection:{layerInfo:this},selfType:"collection",showLegend:this.originOperLayer.featureCollection.showLegend,parentLayerInfo:this}),d.push(a),a.init())},this);
d.reverse();return d},_obtainLayerIndexesInMap:function(){var d=[],a,f;for(f=0;f<this.newSubLayers.length;f++)(a=this._getLayerIndexesInMapByLayerId(this.newSubLayers[f].layerObject.id))&&d.push(a);return d},moveLeftOfIndex:function(d){var a;for(a=this.newSubLayers.length-1;0<=a;a--)this.map.reorderLayer(this.newSubLayers[a].layerObject,d)},moveRightOfIndex:function(d){var a;for(a=0;a<this.newSubLayers.length;a++)this.map.reorderLayer(this.newSubLayers[a].layerObject,d)},_getShowLegendOfWebmap:function(){return void 0!==
this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0},getScaleRange:function(){var d=this.getSubLayers();return d[0]?d[0].getScaleRange():{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic dojo/aspect jimu/portalUrlUtils jimu/portalUtils jimu/ConfigManager esri/request esri/config esri/tasks/ProjectParameters esri/SpatialReference esri/geometry/webMercatorUtils".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u){var t=n(null,{originOperLayer:null,layerObject:null,map:null,title:null,id:null,newSubLayers:null,parentLayerInfo:null,_oldIsShowInMap:null,_oldFilter:null,_eventHandles:null,constructor:function(a,b){this.originOperLayer=a;this.layerObject=a.layerObject;this.map=b;this.title=this.originOperLayer.title;this.id=this.originOperLayer.id;this.parentLayerInfo=a.parentLayerInfo?a.parentLayerInfo:null;this._eventHandles=[]},init:function(){this.newSubLayers=this.obtainNewSubLayers();
this.initVisible();this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=this.isShowInMap();this._initOldFilter();this._bindEvent()},_initOldFilter:function(){this._oldFilter=null},isGraphicLayer:function(){var a=this._obtainLayerIndexesInMap();return a.length?a[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},getExtent:function(){},getOpacity:function(){var a,b=0;for(a=0;a<this.newSubLayers.length;a++)if(this.newSubLayers[a].layerObject.opacity)b=
this.newSubLayers[a].layerObject.opacity>b?this.newSubLayers[a].layerObject.opacity:b;else return 1;return b},setOpacity:function(a){f.forEach(this.newSubLayers,function(b){b.layerObject.setOpacity&&b.layerObject.setOpacity(a)})},moveLayerByIndex:function(a){this.map.reorderLayer(this.layerObject,a)},traversal:function(a){if(a(this))return!0;for(var b=this.getSubLayers(),c=0;c<b.length;c++)if(b[c].traversal(a))return!0},findLayerInfoById:function(a){var b=null,c=0;if(this.id&&this.id===a)return this;
for(c=0;c<this.newSubLayers.length&&!(b=this.newSubLayers[c].findLayerInfoById(a));c++);return b},setTopLayerVisible:function(a){this._setTopLayerVisible(a)},_setTopLayerVisible:function(a){},setSubLayerVisible:function(a,b){},setLayerVisiblefromTopLayer:function(){},_resetLayerObjectVisiblity:function(){},resetLayerObjectVisibility:function(a){var b=a?a[this.id]:null;this.isRootLayer&&b&&this._resetLayerObjectVisiblity(a)},initVisible:function(){},isVisible:function(){return this._visible?!0:!1},
_obtainLayerIndexesInMap:function(){var a=[],b;(b=this._getLayerIndexesInMapByLayerId(this.id))&&a.push(b);return a},_getLayerIndexesInMapByLayerId:function(a){var b;for(b=0;b<this.map.graphicsLayerIds.length;b++)if(this.map.graphicsLayerIds[b]===a)return{isGraphicLayer:!0,index:b};for(b=0;b<this.map.layerIds.length;b++)if(this.map.layerIds[b]===a)return{isGraphicLayer:!1,index:b};return null},_convertGeometryToMapSpatialRef:function(a){var c=new h;if(this.map.spatialReference.equals(a.spatialReference))return c.resolve([a]),
c;if(this.map.spatialReference.isWebMercator()&&a.spatialReference.equals(new b(4326)))return c.resolve([u.geographicToWebMercator(a)]),c;if(this.map.spatialReference.equals(new b(4326))&&a.spatialReference.isWebMercator())return c.resolve([u.webMercatorToGeographic(a)]),c;c=new e;c.geometries=[a];c.outSR=this.map.spatialReference;return p.defaults.geometryService.project(c)},_isShowInMapChanged:function(){var a=!1,b=this.isShowInMap();!1===b&&this.map.infoWindow.hide();this._oldIsShowInMap!==b&&
(this._oldIsShowInMap=b,a=!0);return a},_isShowInMapChanged2:function(){var a=[];this.traversal(function(b){b._isShowInMapChanged()&&a.push(b)});q.publish("layerInfos/layerInfo/isShowInMapChanged",a)},_visibleChanged:function(){q.publish("layerInfos/layerInfo/visibleChanged",[this])},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return m.create("div",{"class":"legends-div"})},drawLegends:function(a,b){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},
_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},getLayerObject:function(){var a=new h;this.layerObject?a.resolve(this.layerObject):a.resolve(null);return a},getSubLayers:function(){return this.newSubLayers},isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},getRootLayerInfo:function(){for(var a=this;a.parentLayerInfo;)a=a.parentLayerInfo;return a},isShowInMap:function(){for(var a=
!0,b=this;b;)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},getLayerType:function(){var a=[null],b=new h;this.layerObject.declaredClass&&(a=this.layerObject.declaredClass.split("."));b.resolve(a[a.length-1]);return b},getPopupInfo:function(){return this.originOperLayer.popupInfo},loadInfoTemplate:function(){var a=new h;a.resolve(null);return a},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?this.originOperLayer.layerDefinition.definitionExpression:
null},getFilter:function(){return null},setFilter:function(){},getShowLegendOfWebmap:function(){for(var a=this,b=!0;a;)b=b&&a._getShowLegendOfWebmap(),a=a.parentLayerInfo;return b},getUrl:function(){return this.layerObject.url||this.layerObject._url},hasLayerTypes:function(a){},getSupportTableInfo:function(){var a=new h,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},c=this.getLayerType(),e=this.getLayerObject();d({type:c,layerObject:e}).then(l.hitch(this,function(c){var d=c.type;c=c.layerObject;
b.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(b.isSupportedLayer=!0);if(!c)b.isSupportQuery=!1;else if(this.parentLayerInfo&&this.parentLayerInfo.isMapNotesLayerInfo())b.isSupportQuery=!1;else if(!c.url||c.capabilities&&0<=c.capabilities.indexOf("Query"))b.isSupportQuery=!0;a.resolve(b)}),function(){a.resolve(b)});return a},getRelatedTableInfoArray:function(a){a=new h;a.resolve([]);return a},removeSubLayerById:function(a){var b=[];f.forEach(this.newSubLayers,function(c){c.id!==
a?b.push(c):c.destroyLayerInfo()});this.newSubLayers=b},destroy:function(){f.forEach(this._eventHandles,function(a){a.remove()});this.destroyLabelLayer();this.inherited(arguments)},destroyLayerInfo:function(){f.forEach(this.newSubLayers,function(a){a.destroyLayerInfo()});this.destroy()},isMapNotesLayerInfo:function(){return this.originOperLayer.featureCollection&&0===this.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===this.originOperLayer.layerType&&!this.map.getLayer(this.id)?!0:!1},getScaleRange:function(){return this.layerObject&&
0<=this.layerObject.minScale&&0<=this.layerObject.maxScale?{minScale:this.layerObject.minScale,maxScale:this.layerObject.maxScale}:{minScale:0,maxScale:0}},isCurrentScaleInTheScaleRange:function(){var a=this.getScaleRange(),b=this.map.getScale();return 0===a.minScale&&0===a.maxScale?!0:(0===a.minScale||a.minScale>b)&&(0===a.maxScale||b>a.maxScale)?!0:!1},isInScale:function(){for(var a=!0,b=this;b&&(a=b.isCurrentScaleInTheScaleRange(),b=b.parentLayerInfo,a););return a},enablePopup:function(){},disablePopup:function(){},
isPopupEnabled:function(){return!1},getCapabilitiesOfWebMap:function(){return this.originOperLayer.capabilities},isItemLayer:function(){return this.originOperLayer.itemId||l.getObject("_wabProperties.itemLayerInfo.itemId",!1,this.layerObject)},_getItemDetailsPageUrl:function(){var a="",b;b=l.getObject("_wabProperties.itemLayerInfo",!1,this.layerObject);this.originOperLayer.itemId?(b=r.getInstance().getAppConfig(),a=k.getStandardPortalUrl(b.map.portalUrl||b.portalUrl),a=k.getItemDetailsPageUrl(a,this.originOperLayer.itemId)):
b&&b.portalUrl&&b.itemId&&(a=k.getStandardPortalUrl(b.portalUrl),a=k.getItemDetailsPageUrl(a,b.itemId));return a},getItemInfo:function(){var a=new h,b=this.getRootLayerInfo();if(b.isItemLayer()){var c=new t.ItemInfo(b);c.onLoad().then(l.hitch(this,function(){a.resolve(c)}))}else a.resolve(null);return a},isHostedLayer:function(){var a=new h,b=this.getUrl();b?g({url:b,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(l.hitch(this,function(b){a.resolve(b&&b.serviceItemId?!0:!1)})):
a.resolve(!1);return a},obtainLabelControl:function(){},restoreLabelControl:function(){},destroyRealtedLabelLayer:function(){},destroyLabelLayer:function(){},canShowLabel:function(){},isShowLabels:function(){},showLabels:function(){},hideLabels:function(){},_bindEvent:function(){var b;this.layerObject&&!this.layerObject.empty&&(b=this.layerObject.on("visibility-change",l.hitch(this,this._onVisibilityChanged)),this._eventHandles.push(b),b=a.after(this.layerObject,"setDefinitionExpression",l.hitch(this,
this._onFilterChanged)),this._eventHandles.push(b),b=a.after(this.layerObject,"setRenderer",l.hitch(this,this._onRendererChanged)),this._eventHandles.push(b),this.isRootLayer()&&(b=this.layerObject.on("opacity-change",l.hitch(this,this._onOpacityChanged)),this._eventHandles.push(b)))},_onVisibilityChanged:function(){this.initVisible();this._visibleChanged();this._isShowInMapChanged2()},_onFilterChanged:function(){var a=this._oldFilter?this._oldFilter:null,b=this.layerObject.getDefinitionExpression(),
b=b?b:null;a!==b&&(q.publish("layerInfos/layerInfo/filterChanged",[this]),this._oldFilter=b)},_onRendererChanged:function(){q.publish("layerInfos/layerInfo/rendererChanged",[this])},_onOpacityChanged:function(){q.publish("layerInfos/layerInfo/opacityChanged",[this])}});t.ItemInfo=n(null,{originItemInfo:null,_itemInfoLoadedDef:null,_layerDefinition:null,constructor:function(a){this._itemInfoLoadedDef=new h;if(a=a.isItemLayer()){var b=window.appConfig||window.getAppConfig(),b=k.getStandardPortalUrl(b&&
b.map.portalUrl||window.portalUrl);c.getPortal(b).getItemById(a).then(l.hitch(this,function(a){this.originItemInfo=a;this._itemInfoLoadedDef.resolve(this)}),l.hitch(this,function(a){a&&a.message&&console.log(a.message);this._itemInfoLoadedDef.resolve(this)}))}else this._itemInfoLoadedDef.resolve(this)},onLoad:function(){return this._itemInfoLoadedDef}});return t})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/lang ./LayerInfoFactory".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r){return n(a,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,_jsapiLayerInfos:null,_oldFilter:null,_subLayerInfoIndex:null,constructor:function(a,c){this._initJsapiLayerInfos();this.initSubLayerVisible();this._initSubLayerIdent();this._initControlPopup()},init:function(){this.inherited(arguments);this._initSubLayerInfoIndex()},_initOldFilter:function(){this._oldFilter=this.layerObject&&this.layerObject.layerDefinitions?this.layerObject.layerDefinitions:[]},
_initJsapiLayerInfos:function(){var a=f.filter(this.originOperLayer.layers,function(a){return c.isDefined(a.id)&&c.isDefined(a.name)&&c.isDefined(a.minScale)&&c.isDefined(a.maxScale)&&c.isDefined(a.parentLayerId)&&c.isDefined(a.defaultVisibility)});this._jsapiLayerInfos=0<a.length?a:this.layerObject.layerInfos},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplates:l.clone(this.layerObject.infoTemplates)};this.layerObject._infoTemplates=l.clone(this.layerObject.infoTemplates);
m.after(this.layerObject,"setInfoTemplates",l.hitch(this,function(){this.layerObject._infoTemplates=l.clone(this.layerObject.infoTemplates);this.controlPopupInfo.infoTemplates=l.clone(this.layerObject.infoTemplates);this.traversal(function(a){a._afterSetInfoTemplates&&a._afterSetInfoTemplates()})}))},_initSubLayerIdent:function(){this._sublayerIdent={definitions:{},empty:!0,defLoad:new h}},initSubLayerVisible:function(a){this.subLayerVisible={};for(var c=0;c<this._jsapiLayerInfos.length;c++)this.subLayerVisible[this._jsapiLayerInfos[c].id]=
0;a?f.forEach(a,function(a){this.subLayerVisible[a]++},this):this.originOperLayer.visibleLayers?f.forEach(this.originOperLayer.visibleLayers,function(a){this.subLayerVisible[a]++},this):f.forEach(this._jsapiLayerInfos,function(a){a.defaultVisibility&&this.subLayerVisible[a.id]++},this)},_initSubLayerInfoIndex:function(){var a={};this.traversal(function(c){c.originOperLayer.mapService&&(a[c.originOperLayer.mapService.subId]=c)});this._subLayerInfoIndex=a},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.fullExtent||
this.originOperLayer.layerObject.initialExtent)},_resetLayerObjectVisiblity:function(a){var d=a?a[this.id]:null;if(a&&(d&&this.layerObject.setVisibility(d.visible),"esri.layers.ArcGISDynamicMapServiceLayer"===this.layerObject.declaredClass)){var e=!1,b=[];f.forEach(this._jsapiLayerInfos,function(d){var g=this.id+"_"+d.id;c.isDefined(a[g])&&(e=!0,a[g].visible&&b.push(d.id))},this);if(e){this.initSubLayerVisible(b);this.traversal(function(a){a.initVisible()});var g={};this.traversal(function(a){0===
a.getSubLayers().length&&(g[a.originOperLayer.mapService.subId]=a.isVisbleOrInvisilbe())});this.setSubLayerVisible(g)}}},initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(a){this.originOperLayer.layerObject.setVisibility(a);this._visible=a},setSubLayerVisible:function(a){var c=[-1,-1,-1],d,b=[],g=f.filter(this.originOperLayer.layerObject.visibleLayers,function(a){return-1!==a});f.forEach(g,function(a){if(!this._isGroupLayerBySubId(a)){var c=
this._subLayerInfoIndex[a];c&&c.isVisbleOrInvisilbe()&&b.push(a)}},this);var g=b,k;for(k in a)if(a.hasOwnProperty(k)&&"function"!==typeof a[k]){var h=Number(k);a[k]?(d=f.indexOf(g,h),0>d&&g.push(h)):(d=f.indexOf(g,h),0<=d&&g.splice(d,1))}c=c.concat(g);this.originOperLayer.layerObject.setVisibleLayers(c)},obtainNewSubLayers:function(){var a=[],c=this.originOperLayer.layerObject,d=null,d="esri.layers.ArcGISDynamicMapServiceLayer"===c.declaredClass?"dynamic":"tiled";f.forEach(this._jsapiLayerInfos,function(b){var e=
null,e=c.url+"/"+b.id,g=c.id+"_"+b.id;b.subLayerIds&&0<b.subLayerIds.length?(e={url:e,empty:!0},this._addNewSubLayer(a,e,g,b,d+"_group")):(e={url:e,empty:!0},this._addNewSubLayer(a,e,g,b,d))},this);var b=[];f.forEach(this._jsapiLayerInfos,function(b,c){var d=b.parentLayerId;if(-1!==d){for(var e=null,g=0;g<a.length;g++)if(a[g].mapService.subId===d){e=a[g];break}(d=e)&&d.subLayers.push(a[c])}},this);f.forEach(this._jsapiLayerInfos,function(c,d){var e;-1===c.parentLayerId&&(e=r.getInstance().create(a[d]),
b.push(e),e.init())},this);return b},_addNewSubLayer:function(a,c,d,b,f){a.push({layerObject:c,title:b.name||b.id||" ",id:d||" ",subLayers:[],mapService:{layerInfo:this,subId:b.id},selfType:"mapservice_"+f,parentLayerInfo:this})},_handleErrorSubLayer:function(a,c,d,b,f,k){a[c]={layerObject:null,title:k.name||k.id||" ",id:d||" ",subLayers:[],mapService:{layerInfo:this,subId:b}}},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&
this.layerObject.setOpacity(a)},getLegendInfo:function(a){var c=new h;this._legendInfo?c.resolve(this._legendInfo):this._legendRequest(a).then(l.hitch(this,function(a){this._legendInfo=a.layers;c.resolve(this._legendInfo)}),function(){c.reject()});return c},_legendRequest:function(a){return 10.01<=this.layerObject.version?this._legendRequestServer():this._legendRequestTools(a)},_legendRequestServer:function(){var a=this.layerObject.url+"/legend",c={f:"json"};this.layerObject._params.dynamicLayers&&
(c.dynamicLayers=d.stringify(this._createDynamicLayers(this.layerObject)),"[{}]"===c.dynamicLayers&&(c.dynamicLayers="[]"));return k({url:a,content:c,handleAs:"json",callbackParamName:"callback"})},_legendRequestTools:function(a){return k({url:a+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_createDynamicLayers:function(a){var c=[],d;f.forEach(a.dynamicLayerInfos||a.layerInfos,function(b){d={id:b.id};d.source=b.source&&b.source.toJson();
var e;a.layerDefinitions&&a.layerDefinitions[b.id]&&(e=a.layerDefinitions[b.id]);e&&(d.definitionExpression=e);var g;a.layerDrawingOptions&&a.layerDrawingOptions[b.id]&&(g=a.layerDrawingOptions[b.id]);g&&(d.drawingInfo=g.toJson());d.minScale=b.minScale||0;d.maxScale=b.maxScale||0;c.push(d)});return c},_getLayerDefinition:function(){var a=new h;this._request(this.layerObject.url).then(l.hitch(this,function(c){a.resolve(c)}),function(c){console.error(c.message||c);a.resolve(null)});return a},_getSublayerDefinition:function(a){var c;
this._sublayerIdent.definitions[a]?(c=new h,c.resolve(this._sublayerIdent.definitions[a])):c=this._layerAndTableRequest(a);return c},_layerAndTableRequest:function(a){return 10.11<=this.layerObject.version?this._allLayerAndTableServer(a):this._allLayerAndTable(a)},_allLayerAndTableServer:function(a){var c=new h,d=this.layerObject.url+"/layers";this._sublayerIdent.empty?(this._sublayerIdent.empty=!1,this._request(d).then(l.hitch(this,function(b){f.forEach(b.layers,function(a){this._sublayerIdent.definitions[a.id]=
a},this);this._sublayerIdent.defLoad.resolve();c.resolve(this._sublayerIdent.definitions[a])}),l.hitch(this,function(a){console.error(a.message||a);this._sublayerIdent.defLoad.reject();this._sublayerIdent.defLoad=new h;this._sublayerIdent.empty=!0;c.resolve(null)}))):this._sublayerIdent.defLoad.then(l.hitch(this,function(){c.resolve(this._sublayerIdent.definitions[a])}),function(a){console.error(a.message||a);c.resolve(null)});return c},_allLayerAndTable:function(a){var c=new h;this._request(this.layerObject.url+
"/"+a).then(l.hitch(this,function(d){this._sublayerIdent.definitions[a]=d;c.resolve(d)}),function(a){console.error(a.message||a);c.resolve(null)});return c},_request:function(a){return k({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_getSublayerSettingOfWebmap:function(a){var c=f.filter(this.originOperLayer.layers,function(c){return c.id===a});return 1===c.length?c[0]:null},_getSublayerShowLegendOfWebmap:function(a){return(a=this._getSublayerSettingOfWebmap(a))?void 0!==
a.showLegend?a.showLegend:!0:!0},_idIsInJsapiLayerInfos:function(a){return null===this._getJsapiLayerInfoById(a)?!1:!0},_getJsapiLayerInfoById:function(a){for(var c=null,d=0;d<this._jsapiLayerInfos.length;d++)this._jsapiLayerInfos[d].id===a&&(c=this._jsapiLayerInfos[d]);return c},_isGroupLayerBySubId:function(a){return(a=this._getJsapiLayerInfoById(a))&&a.subLayerIds&&0<a.subLayerIds.length?!0:!1},_subLayerVisibleChanged:function(){var a=[];this.traversal(function(c){a.push(c)});q.publish("layerInfos/layerInfo/visibleChanged",
a)},_bindEvent:function(){var a;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(a=this.layerObject.on("visible-layers-change",l.hitch(this,this._onVisibleLayersChanged)),this._eventHandles.push(a),a=m.after(this.layerObject,"setLayerDefinitions",l.hitch(this,this._onFilterChanged)),this._eventHandles.push(a))},_onVisibleLayersChanged:function(a){var c=a.visibleLayers;if(-1===c[0]&&-1===c[1]&&-1===c[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();else{a=[];var d=
[-1,-1,-1],c=this._converVisibleLayers(c);a=c.visibleLayersForUpdateSubLayerVisible;d=d.concat(c.visibleLayersForSetVisibleLayers);this.initSubLayerVisible(a);this.traversal(function(a){a.initVisible()});this.layerObject.setVisibleLayers(d)}},_converVisibleLayers:function(a){var c={visibleLayersForUpdateSubLayerVisible:[],visibleLayersForSetVisibleLayers:[]};f.forEach(a,function(c){var b=this.findLayerInfoById(this.id+"_"+c);if(this._isGroupLayerBySubId(c))b.traversal(function(b){a.push(b.originOperLayer.mapService.subId)});
else for(;b&&b.originOperLayer.mapService;)a.push(b.originOperLayer.mapService.subId),b=b.parentLayerInfo},this);f.forEach(a,function(a){0>c.visibleLayersForUpdateSubLayerVisible.indexOf(a)&&c.visibleLayersForUpdateSubLayerVisible.push(a)},this);f.forEach(c.visibleLayersForUpdateSubLayerVisible,function(a){this._isGroupLayerBySubId(a)||c.visibleLayersForSetVisibleLayers.push(a)},this);return c},_onFilterChanged:function(){for(var a,c=[],d=this.layerObject.layerDefinitions,b=d.length>this._oldFilter.length?
d.length:this._oldFilter.length,f=0;f<b;f++)(d[f]?d[f]:null)!==(this._oldFilter[f]?this._oldFilter[f]:null)&&(a=this.findLayerInfoById(this.id+"_"+f))&&a.isLeaf()&&c.push(a);0<c.length&&(q.publish("layerInfos/layerInfo/filterChanged",c),this._oldFilter=d)}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefault ./LayerInfoFactory dojo/Deferred".split(" "),function(n,f,l,h,d,m,q,a,
k){return n(m,{constructor:function(){},getExtent:function(){var a=this.originOperLayer.layerObject.getLayers(),d=null,g;f.forEach(a,function(a){g=this._convertGeometryToMapSpatialRef(a.initialExtent);d=d?d.union(g):g},this);return d},_resetLayerObjectVisiblity:function(a){var c=a?a[this.id]:null;c&&(f.forEach(this.newSubLayers,function(c){var d=a?a[c.id]:null;d&&c.layerObject.setVisibility(d.visible)},this),this._setTopLayerVisible(c.visible))},initVisible:function(){var a=!1,d;for(d=0;d<this.newSubLayers.length;d++)a=
a||this.newSubLayers[d].layerObject.visible;a&&(this._visible=!0)},_setTopLayerVisible:function(a){this._visible=a?!0:!1;f.forEach(this.newSubLayers,function(a){a.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var c=[],d=this.originOperLayer.layerObject.getLayers();f.forEach(d,function(d){this._getLayerIndexesInMapByLayerId(d.id)&&(d=a.getInstance().create({layerObject:d,title:d.label||d.title||d.name||d.id||" ",id:d.id||" ",collection:{layerInfo:this},
selfType:"kml",parentLayerInfo:this}),c.push(d),d.init())},this);return c}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred ./LayerInfo ./LayerInfos dojox/gfx dojo/dom-construct dojo/dom-attr dojo/dom-class dojo/aspect jimu/portalUrlUtils jimu/portalUtils jimu/utils esri/symbols/jsonUtils esri/layers/LabelLayer esri/layers/LabelClass esri/dijit/PopupTemplate esri/dijit/Legend".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,
g,p,e,b,u,t,v,w){var y=n(d,{_legendsNode:null,controlPopupInfo:null,constructor:function(){this._initControlPopup();this._updateLayerObjectName();try{this._initToShowLabels()}catch(z){console.warn(z.message)}},_updateLayerObjectName:function(){this.layerObject&&!this.layerObject.empty&&this.layerObject.name&&!l.getObject("_wabProperties.originalLayerName",!1,this.layerObject)&&(l.setObject("_wabProperties.originalLayerName",this.layerObject.name,this.layerObject),this.layerObject.name=this.title)},
_initToShowLabels:function(){var a=l.getObject("_wabProperties.itemLayerInfo",!1,this.layerObject);a&&m.getInstanceSync()&&!this.layerObject.empty&&p.getPortal(a.portalUrl).getItemData(a.itemId).then(l.hitch(this,function(a){var b;a&&a.layers&&(f.some(a.layers,function(a){return a.id===this.layerObject.layerId?(b=a,!0):!1},this),b&&b.showLabels&&((a=l.getObject("layerDefinition.drawingInfo.labelingInfo",!1,b))&&!this.layerObject.labelingInfo&&this.layerObject.setLabelingInfo&&(a=f.map(a,function(a){return new t(a)},
this),this.layerObject.setLabelingInfo(a)),this.showLabels()))}),l.hitch(this,function(a){a&&a.message&&console.log(a.message)}))},_initOldFilter:function(){this._oldFilter=this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},_getLayerOptionsForCreateLayerObject:function(){var a={};a.id=this.id;var b=[],c=this.getInfoTemplate();c&&c.info&&c.info.fieldInfos?f.forEach(c.info.fieldInfos,function(a){a.visible&&b.push(a.fieldName)},
this):b=["*"];a.outFields=b;return a},getExtent:function(){var a=this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent;if(a)return this._convertGeometryToMapSpatialRef(a);a=new h;a.resolve(null);return a},_resetLayerObjectVisiblity:function(a){a=a?a[this.id]:null;!this.originOperLayer.collection&&a&&(this.layerObject.setVisibility(a.visible),this._visible=this.layerObject.visible)},initVisible:function(){var a=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){var a=
this.originOperLayer.collection.layerInfo,b=this.layerObject.visible;if(a._oldIsShowInMap!==a.isShowInMap())return;this._visible=b?!0:!1;a._onVisibilityChanged()}else this._visible=a=this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;r.after(this.layerObject,"setInfoTemplate",
l.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||(this.layerObject.infoTemplate=null)}))},_setTopLayerVisible:function(a){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?a?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):a?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),this._visible=
!1):(a?this.layerObject.show():this.layerObject.hide(),this._visible=a)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&this.layerObject.show():this.layerObject.hide()},createLegendsNode:function(){var b=a.create("div",{"class":"legends-div jimu-legends-div-flag jimu-leading-margin1",legendsDivId:this.id},document.body);a.create("img",{"class":"legends-loading-img",src:require.toUrl("jimu")+"/images/loading.gif"},b);return b},drawLegends:function(a){this._initLegendsNodeByLegendDijit(a)},
_initLegendsNodeByLegendDijit:function(b){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&this.layerObject.loaded){a.empty(b);c.remove(b,"jimu-legends-div-flag");var d=new w({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:w.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},a.create("div",{},b));d.startup();b._legendDijit=d}},_initLegendsNode:function(c){var d=[],e=this.layerObject;!this.layerObject||
this.layerObject.empty||this.originOperLayer.subLayer&&0!==this.originOperLayer.subLayers.length||(a.empty(c),e.renderer&&(e.renderer.infos?d=l.clone(e.renderer.infos):d.push({label:e.renderer.label,symbol:e.renderer.symbol}),e.renderer&&e.renderer.defaultSymbol&&0<d.length&&d.push({label:e.renderer.defaultLabel||"others",symbol:e.renderer.defaultSymbol}),f.forEach(d,function(d){d.legendDiv=a.create("div",{"class":"legend-div"},c);d.symbolDiv=a.create("div",{"class":"legend-symbol jimu-float-leading"},
d.legendDiv);d.labelDiv=a.create("div",{"class":"legend-label jimu-float-leading",innerHTML:d.label||" "},d.legendDiv);if("textsymbol"===d.symbol.type)k.set(d.symbolDiv,"innerHTML",d.symbol.text);else{var e=q.createSurface(d.symbolDiv,50,50);d=b.getShapeDescriptors(d.symbol);e.createShape(d.defaultShape).setFill(d.fill).setStroke(d.stroke).setTransform(q.matrix.translate(25,25))}},this)))},obtainNewSubLayers:function(){var a=[];this.originOperLayer.subLayers&&0!==this.originOperLayer.subLayers.length&&
f.forEach(this.originOperLayer.subLayers,function(b){b=new y(b,this.map);a.push(b);b.init()},this);return a},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},_getDefaultPopupInfo:function(a){var b=null;a&&a.fields&&(b={title:a.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},f.forEach(a.fields,function(c){if(c.name!==a.objectIdField&&"globalid"!==c.name.toLowerCase()&&
"shape"!==c.name.toLowerCase()){var d=e.getDefaultPortalFieldInfo(c);d.visible=!0;d.isEditable=c.editable;b.fieldInfos.push(d)}}));return b},_getDefaultPopupTemplate:function(a){var b=null;(a=this.getPopupInfo()||this._getDefaultPopupInfo(a))&&(b=new v(a));return b},enablePopup:function(){return this.loadInfoTemplate().then(l.hitch(this,function(){return this.controlPopupInfo.infoTemplate?(this.controlPopupInfo.enablePopup=!0,this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate,!0):!1}))},
disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=null},isPopupEnabled:function(){return this.controlPopupInfo&&this.controlPopupInfo.enablePopup?!0:!1},loadInfoTemplate:function(){var a=new h;this.controlPopupInfo.infoTemplate?a.resolve(this.controlPopupInfo.infoTemplate):this.getLayerObject().then(l.hitch(this,function(){this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject);a.resolve(this.controlPopupInfo.infoTemplate)}),l.hitch(this,
function(){a.resolve(null)}));return a},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate},_getRelatedUrls:function(a,b){var c=[];if(!a||!a.url||!a.relationships)return c;var d=a.url.lastIndexOf("/"),e=a.url.slice(0,d);f.forEach(a.relationships,function(a){b&&a.role&&b!==a.role||c.push(e+"/"+a.relatedTableId.toString())},this);return c},getRelatedTableInfoArray:function(a){var b=[],c=new h;this.getLayerObject().then(l.hitch(this,function(d){var e=this._getRelatedUrls(d,a);0!==e.length&&
m.getInstanceSync().traversalAll(l.hitch(this,function(a){var c=-1;if(0===e.length)return!0;f.forEach(e,function(d,e){l.getObject("layerObject.url",!1,a)&&g.removeProtocol(d.toString().replace(/\/+/g,"/").toLowerCase())===g.removeProtocol(a.layerObject.url.toString().replace(/\/+/g,"/").toLowerCase())&&(b.push(a),c=e)},this);0<=c&&e.splice(c,1);return!1}));c.resolve(b)}),l.hitch(this,function(){c.resolve(b)}));return c},getFilter:function(){return this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?
this.layerObject.getDefinitionExpression():null},setFilter:function(a){this.layerObject&&!this.layerObject.empty&&this.layerObject.setDefinitionExpression&&this.layerObject.setDefinitionExpression(a)},_isAlreadyInLabelLayerOfMap:function(a){var b=!1;a&&(b=f.some(a.getFeatureLayers(),function(a){return this.id===a.id},this));return b},_addToLabelLayerOfMap:function(){var a=this.getLabelLayerOfMap();a&&!this._isAlreadyInLabelLayerOfMap(a)&&(a.addFeatureLayer(this.layerObject),this.map.removeLayer(a),
this.map.addLayer(a))},_removeFromLabelLayerOfMap:function(){this.getLabelLayerOfMap().removeFeatureLayer(this.id)},_isSupportLabelControl:function(){return this.isRootLayer()&&!this.layerObject.empty&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass&&this.layerObject.labelingInfo&&0<this.layerObject.labelingInfo.length?!0:!1},getLabelLayerOfMap:function(){var a;this.map._labels?a=this.map._labels:(a=this.map.getLayer("labels"),a||(a=new u({id:"labels"}),this.map.addLayer(a)));return a},
obtainLabelControl:function(){var a=this.id+"_labelLayer",b=this.map.getLayer(a);if(!b&&this._isSupportLabelControl()){var c=this.getLabelLayerOfMap();c&&this._isAlreadyInLabelLayerOfMap(c)&&(b=new u({id:a}),b.addFeatureLayer(this.layerObject),this.map.addLayer(b),this._removeFromLabelLayerOfMap())}return b?b:null},restoreLabelControl:function(){this._isSupportLabelControl()&&(this.destroyRealtedLabelLayer(),this._addToLabelLayerOfMap())},destroyRealtedLabelLayer:function(){var a=this.map.getLayer(this.id+
"_labelLayer");a&&this.map.removeLayer(a)},destroyLabelLayer:function(){this.map.getLayer(this.id)||(this._removeFromLabelLayerOfMap(),this.destroyRealtedLabelLayer())},canShowLabel:function(){return this._isSupportLabelControl()},isShowLabels:function(){var a=this.map.getLayer(this.id+"_labelLayer"),b=this.getLabelLayerOfMap();return this._isSupportLabelControl()&&(a||b&&this._isAlreadyInLabelLayerOfMap(b))?this.layerObject.showLabels:!1},showLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&
(this.map.getLayer(this.id+"_labelLayer")||this._addToLabelLayerOfMap(),this.layerObject.setShowLabels(!0))},hideLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&this.layerObject.setShowLabels(!1)}});return y})},"esri/layers/LabelLayer":function(){define("require dojo/_base/declare dojo/_base/lang dojo/number dojo/i18n!dojo/cldr/nls/number dojo/_base/array dojo/_base/connect dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ./GraphicsLayer ./LabelClass ../renderers/SimpleRenderer ../renderers/arcadeUtils".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z,x,A,B){function F(a){return"sizeInfo"===a.type}n=f(z,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=l.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
l.hitch(this,"_handleLevelChange")));var b=this.inherited(arguments);this.refresh();return b},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)q.disconnect(this._mapEventHandlers[a]);this.refresh();clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,c,d){if(!this.getFeatureLayer(a.layerId)){var e=[];e.push(a.on("update-end",
l.hitch(this,"refresh")));e.push(a.on("suspend",l.hitch(this,"refresh")));e.push(a.on("resume",l.hitch(this,"refresh")));e.push(a.on("edits-complete",l.hitch(this,"refresh")));e.push(a.on("labeling-info-change",l.hitch(this,"refresh")));e.push(a.on("time-extent-change",l.hitch(this,"refresh")));e.push(a.on("show-labels-change",l.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:c,LabelingOptions:d,LabelRenderer:b,EventHandlers:e});this.featureLayers.push(a);
this.refresh()}},getFeatureLayer:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return c;return null},removeFeatureLayer:function(a){var b;a=this.getFeatureLayer(a);if(void 0!==a&&(b=m.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)q.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,1);this.refresh()}},removeAllFeatureLayers:function(){var a;
for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)q.disconnect(this._featureLayerInfos[a].EventHandlers[b]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return this._featureLayerInfos[b];return null},refresh:function(){null==this._refreshHandle&&
(this._refreshHandle=setTimeout(this._refreshLabels,0))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var c,d,g,f,k,h=[],p,m="DYNAMIC"===this._engineType?new e:new b;if(this._map){m.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(d=this.featureLayers[a],d.visible&&d.showLabels&&d.visibleAtMapScale&&!d._suspended)if(c=this._featureLayerInfos[a],k=this._convertOptions(null),c.LabelRenderer){if(h=
d.labelingInfo)if(p=h[0])f=this._getLabelExpression(p),k=this._convertOptions(p);g=c.LabelRenderer;c.LabelExpressionInfo&&(f=c.LabelExpressionInfo);c.LabelingOptions&&(k=this._convertOptions(null),void 0!==c.LabelingOptions.pointPriorities&&(h=c.LabelingOptions.pointPriorities,k.pointPriorities="above-center"==h||"AboveCenter"==h||"esriServerPointLabelPlacementAboveCenter"==h?"AboveCenter":"above-left"==h||"AboveLeft"==h||"esriServerPointLabelPlacementAboveLeft"==h?"AboveLeft":"above-right"==h||"AboveRight"==
h||"esriServerPointLabelPlacementAboveRight"==h?"AboveRight":"below-center"==h||"BelowCenter"==h||"esriServerPointLabelPlacementBelowCenter"==h?"BelowCenter":"below-left"==h||"BelowLeft"==h||"esriServerPointLabelPlacementBelowLeft"==h?"BelowLeft":"below-right"==h||"BelowRight"==h||"esriServerPointLabelPlacementBelowRight"==h?"BelowRight":"center-center"==h||"CenterCenter"==h||"esriServerPointLabelPlacementCenterCenter"==h?"CenterCenter":"center-left"==h||"CenterLeft"==h||"esriServerPointLabelPlacementCenterLeft"==
h?"CenterLeft":"center-right"==h||"CenterRight"==h||"esriServerPointLabelPlacementCenterRight"==h?"CenterRight":"AboveRight"),void 0!==c.LabelingOptions.lineLabelPlacement&&(k.lineLabelPlacement=c.LabelingOptions.lineLabelPlacement),void 0!==c.LabelingOptions.lineLabelPosition&&(k.lineLabelPosition=c.LabelingOptions.lineLabelPosition),void 0!==c.LabelingOptions.labelRotation&&(k.labelRotation=c.LabelingOptions.labelRotation),void 0!==c.LabelingOptions.howManyLabels&&(k.howManyLabels=c.LabelingOptions.howManyLabels));
g instanceof x&&(f=this._getLabelExpression(g),g=new A(g.symbol),k=this._convertOptions(g));this._addLabels(d,g,f,k)}else if(h=d.labelingInfo)for(c=h.length-1;0<=c;c--)if(p=h[c])g=new x(p instanceof x?p.toJson():p),f=this._getLabelExpression(p),k=this._convertOptions(p),this._addLabels(d,g,f,k);f=m._process(this._preparedLabels);this.clear();this.drawLabels(this._map,f)}},drawLabels:function(a,b){this._scale=(a.extent.xmax-a.extent.xmin)/a.width;var c;for(c=0;c<b.length;c++){var d=b[c],e=d.x,f=d.y,
k=d.text,h=d.angle,p=d.layer.labelSymbol;"polyline"==d.layer.geometry.type&&d.layer.options.labelRotation&&p.setAngle(180/Math.PI*h);p.setText(k);d=e;p instanceof u&&(e=p.getHeight(),d-=.25*e*this._scale*Math.sin(h),f-=.33*e*this._scale);h=new g(new w(d,f,a.extent.spatialReference));h.setSymbol(p);this.add(h)}},_addLabels:function(a,b,c,d){var e,g,f,k;if(this._isWithinScaleRange(b.minScale,b.maxScale)&&c&&""!==c){var h=this._map,p=!a.url&&!h.spatialReference.equals(a.spatialReference);for(e=0;e<a.graphics.length;e++)if(g=
a.graphics[e],!1!==g.visible){f=g.geometry;if(p){if(!y.canProject(f,h))continue;f=y.project(f,h)}f&&this._isWhere(b.where,g.attributes)&&this._isWithinScreenArea(f)&&(k=this._buildLabelText(c,g,a.fields,d),this._addLabel(k,b,a.renderer,g,d,f,h))}}},_isWithinScreenArea:function(a){a="point"===a.type?new v(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();if(void 0===a)return!1;a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var c=this._map.getScale();
return 0<a&&c>=a||0<b&&c<=b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var c=a.split(" ");if(3===c.length)return this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2]));if(7===c.length){var d=this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2])),e=c[3],g=this._sqlEquation(b[this._removeQuotes(c[4])],c[5],this._removeQuotes(c[6]));switch(e){case "AND":return d&&g;case "OR":return d||g}}}return!1}catch(Q){console.log("Error.: can't parse \x3d "+
a)}},_sqlEquation:function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1},_removeQuotes:function(a){var b=a.indexOf('"'),c=a.lastIndexOf('"');if(-1!=b&&-1!=c)return a.substr(1,a.length-2);b=a.indexOf("'");c=a.lastIndexOf("'");return-1!=b&&-1!=c?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||m.filter(a.visualVariables,
F)[0]:null},_addLabel:function(a,b,c,d,e,g,f){var h,p,m,q;if(a&&""!==l.trim(a)&&b){a=a.replace(/\s+/g," ");h=b.getSymbol(d);h instanceof u?(h=new u(h.toJson()),h.setVerticalAlignment("baseline"),h.setHorizontalAlignment("center")):h=h instanceof t?new t(h.toJson()):new u;h.setText(a);b.symbol=h;if(m=this._getProportionalSize(b.sizeInfo,d.attributes))h instanceof u?h.setSize(m):h instanceof t&&(h.setWidth(m),h.setHeight(m));q=m=0;if(c){p=c.getSymbol(d);var r=this._getSizeInfo(c),n;r&&(n=c.getSize(d,
{sizeInfo:r,resolution:f.getResolutionInMeters()}));if(n&&null!==n)m=q=n;else if(p)if("simplemarkersymbol"==p.type)q=m=p.size;else if("picturemarkersymbol"==p.type)m=p.width,q=p.height;else if("simplelinesymbol"==p.type||"cartographiclinesymbol"==p.type)m=p.width}c={};c.graphic=d;c.options=e;c.geometry=g;c.labelRenderer=b;c.labelSymbol=h;c.labelWidth=h.getWidth()/2;c.labelHeight=h.getHeight()/2;c.symbolWidth=k.normalizedLength(m)/2;c.symbolHeight=k.normalizedLength(q)/2;c.text=a;c.angle=h.angle;this._preparedLabels.push(c)}},
_buildLabelText:function(a,b,c,e){if(e.hasExpression)return a=B.executeFunction(e.compiledFunc,B.createExecContext(b,b._getView())),r.isDefined(a)?""+a:"";var g=b.attributes;return a.replace(/{[^}]*}/g,function(a){var b,f=a;for(b=0;b<c.length;b++)if("{"+c[b].name+"}"==a){var f=g[c[b].name],k=c[b].domain;if(k&&l.isObject(k)){if("codedValue"==k.type&&e.useCodedValues)for(b=f,a=0;a<k.codedValues.length;a++){if(k.codedValues[a].code==b){f=k.codedValues[a].name;break}}else"range"==k.type&&k.minValue<=
f&&f<=k.maxValue&&(f=k.name);break}k=c[b].type;if(e.fieldInfos){var m=e.fieldInfos;for(b=0;b<m.length;b++)if("{"+m[b].fieldName+"}"==a){a=m[b].format;"esriFieldTypeDate"==k?(a="DateFormat"+p.prototype._dateFormats[a.dateFormat?a.dateFormat:"shortDate"])&&(f=r.substitute({myKey:f},"${myKey:"+a+"}")):"esriFieldTypeInteger"!=k&&"esriFieldTypeSingle"!=k&&"esriFieldTypeSmallInteger"!=k&&"esriFieldTypeLong"!=k&&"esriFieldTypeDouble"!=k||!a||(f=h.format(f,{places:a.places}),a.digitSeparator||d.group&&(f=
f.replace(new RegExp("\\"+d.group,"g"),"")));break}}break}else f="";return null==f?"":f})},_getLabelExpression:function(a){var b="";a.labelExpressionInfo?b=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&(b=this._convertLabelExpression(a.labelExpression));return b},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(RegExp("\\[","g"),"{").replace(RegExp("\\]","g"),"}")},_getProportionalSize:function(a,
b){if(!a)return null;var c=r.substitute(b,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&c)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(c-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=!0,c="shortDate",d=null,e=null,g="",f=!0,k,h;if(a&&(a.format&&(c=a.format.dateFormat,d={places:a.format.places,digitSeparator:a.format.digitSeparator}),e=a.fieldInfos,g=a.labelPlacement,null!=a.useCodedValues&&
(b=a.useCodedValues),a=a.labelExpressionInfo)){var p=a.expression;p&&!a.value&&(h=!0,k=B.createFunction(p))}if("always-horizontal"==g||"esriServerPolygonPlacementAlwaysHorizontal"==g)f=!1;return{useCodedValues:b,dateFormat:c,numberFormat:d,fieldInfos:e,pointPriorities:"above-center"==g||"esriServerPointLabelPlacementAboveCenter"==g?"AboveCenter":"above-left"==g||"esriServerPointLabelPlacementAboveLeft"==g?"AboveLeft":"above-right"==g||"esriServerPointLabelPlacementAboveRight"==g?"AboveRight":"below-center"==
g||"esriServerPointLabelPlacementBelowCenter"==g?"BelowCenter":"below-left"==g||"esriServerPointLabelPlacementBelowLeft"==g?"BelowLeft":"below-right"==g||"esriServerPointLabelPlacementBelowRight"==g?"BelowRight":"center-center"==g||"esriServerPointLabelPlacementCenterCenter"==g?"CenterCenter":"center-left"==g||"esriServerPointLabelPlacementCenterLeft"==g?"CenterLeft":"center-right"==g||"esriServerPointLabelPlacementCenterRight"==g?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==g||"below-start"==
g||"center-start"==g?"PlaceAtStart":"above-end"==g||"below-end"==g||"center-end"==g?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==g||"esriServerLinePlacementAboveAfter"==g||"above-along"==g||"esriServerLinePlacementAboveAlong"==g||"above-before"==g||"esriServerLinePlacementAboveBefore"==g||"above-start"==g||"esriServerLinePlacementAboveStart"==g||"above-end"==g||"esriServerLinePlacementAboveEnd"==g?"Above":"below-after"==g||"esriServerLinePlacementBelowAfter"==g||"below-along"==g||
"esriServerLinePlacementBelowAlong"==g||"below-before"==g||"esriServerLinePlacementBelowBefore"==g||"below-start"==g||"esriServerLinePlacementBelowStart"==g||"below-end"==g||"esriServerLinePlacementBelowEnd"==g?"Below":"center-after"==g||"esriServerLinePlacementCenterAfter"==g||"center-along"==g||"esriServerLinePlacementCenterAlong"==g||"center-before"==g||"esriServerLinePlacementCenterBefore"==g||"center-start"==g||"esriServerLinePlacementCenterStart"==g||"center-end"==g||"esriServerLinePlacementCenterEnd"==
g?"OnLine":"Above",labelRotation:f,howManyLabels:"OneLabel",hasExpression:h,compiledFunc:k}}});a("extend-esri")&&l.setObject("layers.LabelLayer",n,c);return n})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),function(n,f,l,h,d,m){n=n(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=
[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(d,a){this._labelLayer=a;this._xmin=d.extent.xmin;this._xmax=d.extent.xmax;this._ymin=d.extent.ymin;this._ymax=d.extent.ymax;this._scale=(this._xmax-this._xmin)/d.width},_process:function(d){this._preparedLabels=d;this._placedLabels=[];var a;for(d=this._preparedLabels.length-1;0<=d;d--){var f=this._preparedLabels[d],c=Math.min(f.labelWidth,f.labelHeight),h=f.labelWidth+
0*c,c=f.labelHeight+0*c,g=(a=f.options)&&void 0!==a.lineLabelPlacement?a.lineLabelPlacement:"PlaceAtCenter",p=a&&void 0!==a.lineLabelPosition?a.lineLabelPosition:"Above",e=a&&void 0!==a.pointPriorities?a.pointPriorities:"AboveRight",b=[2,2,1,3,0,2,3,3,2];"AboveLeft"==e?b=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==e?b=[2,1,2,2,0,2,3,3,3]:"AboveRight"==e?b=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==e?b=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==e?b=[0,0,0,0,1,0,0,0,0]:"CenterRight"==e?b=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==e?
b=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==e?b=[3,3,3,2,0,2,2,1,2]:"BelowRight"==e&&(b=[3,3,2,3,0,2,2,2,1]);var m=a&&void 0!==a.labelRotation?a.labelRotation:!0,e=Math.PI/180*f.angle;a=a&&void 0!==a.howManyLabels?a.howManyLabels:"OneLabel";if("point"==f.geometry.type)this._generatePointPositions(f,f.geometry.x,f.geometry.y,f.text,e,h,c,f.symbolWidth,f.symbolHeight,b);else if("multipoint"==f.geometry.type)for(g=f.geometry,p=0;p<g.points.length;p++)this._generatePointPositions(f,g.points[p][0],g.points[p][1],
f.text,e,h,c,f.symbolWidth,f.symbolHeight,b);else"polyline"==f.geometry.type?this._generateLinePositions(f,f.geometry,f.text,h,c,2*f.symbolHeight+c,g,p,m):"polygon"==f.geometry.type&&this._generatePolygonPositions(f,a,f.geometry,f.text,e,h,c)}return this._placedLabels},_generatePointPositions:function(d,a,f,c,h,g,p,e,b,m){e=(e+g)*this._scale;b=(b+p)*this._scale;var k,l;for(k=1;3>=k;k++)for(l=1;9>=l;l++)if(m[l-1]==k)switch(l){case 1:if(this._findPlace(d,c,a-e,f+b,h,g,p))return;break;case 2:if(this._findPlace(d,
c,a,f+b,h,g,p))return;break;case 3:if(this._findPlace(d,c,a+e,f+b,h,g,p))return;break;case 4:if(this._findPlace(d,c,a-e,f,h,g,p))return;break;case 5:if(this._findPlace(d,c,a,f,h,g,p))return;break;case 6:if(this._findPlace(d,c,a+e,f,h,g,p))return;break;case 7:if(this._findPlace(d,c,a-e,f-b,h,g,p))return;break;case 8:if(this._findPlace(d,c,a,f-b,h,g,p))return;break;case 9:if(this._findPlace(d,c,a+e,f-b,h,g,p))return}},_generateLinePositions:function(d,a,f,c,h,g,p,e,b){var k=c*this._scale*c*this._scale,
m,l,q;for(m=0;m<a.paths.length;m++){var r=a.paths[m],n=r.length,x=Math.floor((n-1)/2),A=0!==(n-1)%2?1:-1;"PlaceAtStart"==p&&(x=0,A=1);"PlaceAtEnd"==p&&(x=n-2,A=-1);for(;0<=x&&x<n-1;){for(l=x;l<n;l++){var B=r[x][0],F=r[x][1],E=r[l][0]-B,C=r[l][1]-F;if(E*E+C*C>k){for(var G=Math.atan2(C,E);G>Math.PI/2;)G-=Math.PI;for(;G<-(Math.PI/2);)G+=Math.PI;var H=Math.sin(G),I=Math.cos(G),K=0,Q=0;"Above"==e&&(K=g*H*this._scale,Q=g*I*this._scale);"Below"==e&&(K=-g*H*this._scale,Q=-g*I*this._scale);if(1==l-x){if(this._clipLine(B,
F,r[l][0],r[l][1])&&(B=this._x1-this._x0,q=this._y1-this._y0,B*B+q*q>k&&(l=Math.atan2(q,B),E=c/2+2*h,F=E*this._scale*Math.cos(l),E=E*this._scale*Math.sin(l),"PlaceAtStart"==p?(B=this._x0+F,q=this._y0+E):"PlaceAtEnd"==p?(B=this._x1-F,q=this._y1-E):(B=this._x0+B/2,q=this._y0+q/2),this._findPlace(d,f,B-K,q+Q,b?-l:0,c,h))))return}else{var O=0;for(q=x;q<=l;q++)O=Math.max(O,Math.abs((r[q][1]-F)*I-(r[q][0]-B)*H));if(O<h&&this._findPlace(d,f,B+E/2-K,F+C/2+Q,b?-G:0,c,h))return}break}}x+=A}}},_generatePolygonPositions:function(d,
a,f,c,h,g,p){var e;if("ManyLabels"==a)for(a=0;a<f.rings.length;a++)e=f.rings[a],m.prototype.isClockwise(e)&&(e=this._findCentroid(e,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(d,c,e[0],e[1],h,g,p));else{e=this._findCentroidForFeature(f,this._xmin,this._ymin,this._xmax,this._ymax);var b=e[1],k=0;for(a=0;10>a;a++){k+=p/4;e=this._findCentroidForFeature(f,this._xmin,b+(k-p/4),this._xmax,b+(k+p/4));if(this._findPlace(d,c,e[0],e[1],h,g,p))break;e=this._findCentroidForFeature(f,this._xmin,
b-(k+p/4),this._xmax,b-(k-p/4));if(this._findPlace(d,c,e[0],e[1],h,g,p))break}}},_findCentroid:function(d,a,f,c,h){var g=d.length,k=[0,0],e=0,b=d[0][0],m=d[0][1];b>c&&(b=c);b<a&&(b=a);m>h&&(m=h);m<f&&(m=f);for(var l=1;l<g-1;l++){var q=d[l][0],r=d[l][1],n=d[l+1][0],z=d[l+1][1];q>c&&(q=c);q<a&&(q=a);r>h&&(r=h);r<f&&(r=f);n>c&&(n=c);n<a&&(n=a);z>h&&(z=h);z<f&&(z=f);var x=(q-b)*(z-m)-(n-b)*(r-m);k[0]+=x*(b+q+n);k[1]+=x*(m+r+z);e+=x}k[0]/=3*e;k[1]/=3*e;if(isNaN(k[0])||isNaN(k[1]))return k;f=[];this._fillBuffer(d,
f,k);k[0]=this._sortBuffer(f,k[0],a,c);return k},_findCentroidForFeature:function(d,a,f,c,h){for(var g,k=0,e=[0,0],b=0;b<d.rings.length;b++){var m=d.rings[b],l=m.length,q=m[0][0],r=m[0][1];q>c&&(q=c);q<a&&(q=a);r>h&&(r=h);r<f&&(r=f);for(g=1;g<l-1;g++){var n=m[g][0],z=m[g][1],x=m[g+1][0],A=m[g+1][1];n>c&&(n=c);n<a&&(n=a);z>h&&(z=h);z<f&&(z=f);x>c&&(x=c);x<a&&(x=a);A>h&&(A=h);A<f&&(A=f);var B=(n-q)*(A-r)-(x-q)*(z-r);e[0]+=B*(q+n+x);e[1]+=B*(r+z+A);k+=B}}e[0]/=3*k;e[1]/=3*k;if(isNaN(e[0])||isNaN(e[1]))return e;
f=[];for(g=0;g<d.rings.length;g++)this._fillBuffer(d.rings[g],f,e);e[0]=this._sortBuffer(f,e[0],a,c);return e},_fillBuffer:function(d,a,f){for(var c=d.length-1,h=d[0][1]>=d[c][1]?1:-1,g=0;g<=c;g++){var k=g,e=g+1;g==c&&(e=0);var b=d[k][0],k=d[k][1],m=d[e][0],e=d[e][1],l=e>=k?1:-1;if(k<=f[1]&&f[1]<=e||e<=f[1]&&f[1]<=k)f[1]!=k&&f[1]!=e?(a.push((f[1]-k)*(m-b)/(e-k)+b),h=l):f[1]==k&&f[1]!=e?(h!=l&&a.push(b),h=l):f[1]!=k&&f[1]==e?(a.push(m),h=l):f[1]==k&&f[1]==e&&(1==h&&a.push(b),a.push(m),h=l)}},_sortBuffer:function(d,
a,f,c){var h=d.length;d.sort();if(0<h){for(var g=0,k=a=0;k<h-1;k+=2){var e=Math.abs(d[k+1]-d[k]);!(d[k]<=f&&d[k+1]<=f||d[k]>=c&&d[k+1]>=c)&&e>g&&(g=e,a=k)}h=d[a];d=d[a+1];h>c&&(h=c);h<f&&(h=f);d>c&&(d=c);d<f&&(d=f);a=(h+d)/2}return a},_findPlace:function(f,a,h,c,l,g,p){if(isNaN(h)||isNaN(c))return!1;for(var e=0;e<this._placedLabels.length;e++){var b=this._placedLabels[e].angle,k=this._placedLabels[e].width*this._scale,q=this._placedLabels[e].height*this._scale,r=this._placedLabels[e].x-h,n=this._placedLabels[e].y-
c;if(0===l&&0===b){if(this._findPlace2(-g*this._scale,-p*this._scale,g*this._scale,p*this._scale,r-k,n-q,r+k,n+q))return!1}else{var y=new d(-g*this._scale,-p*this._scale,g*this._scale,p*this._scale,null),z=0,x=1;0!==l&&(z=Math.sin(l),x=Math.cos(l));var A=r*x-n*z,r=r*z+n*x,b=b-l,z=Math.sin(b),x=Math.cos(b),B=-k*x- -q*z,n=-k*z+-q*x,b=+k*x- -q*z,F=+k*z+-q*x,k=A+B,q=r-n,z=A+b,x=r-F,B=A-B,n=r+n,A=A-b,r=r+F,b=new m;b.addRing([[k,q],[z,x],[B,n],[A,r],[k,q]]);if(y.intersects(b))return!1}}for(;l>Math.PI/2;)l-=
Math.PI;for(;l<-(Math.PI/2);)l+=Math.PI;e={};e.layer=f;e.text=a;e.angle=l;e.x=h;e.y=c;e.width=g;e.height=p;this._placedLabels.push(e);return!0},_findPlace2:function(d,a,f,c,h,g,p,e){return(d>=h&&d<=p||f>=h&&f<=p||d<=h&&f>=p)&&(a>=g&&a<=e||c>=g&&c<=e||a<=g&&c>=e)?!0:!1},_clipLine:function(d,a,f,c){for(var h=this._code(d,a),g=this._code(f,c);0!==h||0!==g;){if(0!==(h&g))return!1;var k=f-d,e=c-a;0!==h?(d<this._xmin?(a+=e*(this._xmin-d)/k,d=this._xmin):d>this._xmax?(a+=e*(this._xmax-d)/k,d=this._xmax):
a<this._ymin?(d+=k*(this._ymin-a)/e,a=this._ymin):a>this._ymax&&(d+=k*(this._ymax-a)/e,a=this._ymax),h=this._code(d,a)):(f<this._xmin?(c+=e*(this._xmin-f)/k,f=this._xmin):f>this._xmax?(c+=e*(this._xmax-f)/k,f=this._xmax):c<this._ymin?(f+=k*(this._ymin-c)/e,c=this._ymin):c>this._ymax&&(f+=k*(this._ymax-c)/e,c=this._ymax),g=this._code(f,c))}this._x0=d;this._y0=a;this._x1=f;this._y1=c;return!0},_code:function(d,a){var f=0;d<this._xmin&&(f+=8);d>this._xmax&&(f+=4);a<this._ymin&&(f+=2);a>this._ymax&&(f+=
1);return f}});l("extend-esri")&&f.setObject("layers.labelLayerUtils.DynamicLabelClass",n,h);return n})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(n,f,l,h,d,m,q){return n(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=
this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(a,d){this._labelLayer=d;this._map=a;this._xmin=a.extent.xmin;this._xmax=a.extent.xmax;this._ymin=a.extent.ymin;this._ymax=a.extent.ymax;this._scale=(this._xmax-this._xmin)/a.width},_process:function(a){var d,c,f,g,h,e,b,l,t;this._preparedLabels=a;this._placedLabels=[];for(a=this._preparedLabels.length-1;0<=a;a--){d=this._preparedLabels[a];h=d.labelWidth;
e=d.labelHeight;l=(b=d.options)&&b.lineLabelPlacement?b.lineLabelPlacement:"PlaceAtCenter";t=b&&b.lineLabelPosition?b.lineLabelPosition:"Above";c=b&&b.labelRotation?b.labelRotation:!0;f=Math.PI/180*d.angle;g=b&&b.howManyLabels?b.howManyLabels:"OneLabel";var n=[];if("point"===d.geometry.type)this._generatePointPositions(d.geometry.x,d.geometry.y,d.text,f,h,e,d.symbolWidth,d.symbolHeight,b,n);else if("multipoint"===d.geometry.type)for(c=0;c<d.geometry.points.length;c++)this._generatePointPositions(d.geometry.points[c][0],
d.geometry.points[c][1],d.text,f,h,e,d.symbolWidth,d.symbolHeight,b,n);else if("polyline"===d.geometry.type)if("PlaceAtStart"===l)this._generateLinePositionsPlaceAtStart(d.geometry,!0,d.text,h,e,2*d.symbolHeight+e,l,t,c,n);else if("PlaceAtEnd"===l)this._generateLinePositionsPlaceAtEnd(d.geometry,!0,d.text,h,e,2*d.symbolHeight+e,l,t,c,n);else{b=[];var w=d.geometry.getExtent(),y=this._map.extent;if(w.getWidth()<h*this._scale/this._OVERRUN&&w.getHeight()<h*this._scale/this._OVERRUN)continue;else.5*w.getWidth()<
y.getWidth()&&.5*w.getHeight()<y.getHeight()?this._generateLinePositionsPlaceAtCenter(d.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,d.text,h,e,2*d.symbolHeight+e,l,t,c,b):this._generateLinePositionsPlaceAtCenter(d.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,d.text,h,e,2*d.symbolHeight+e,l,t,c,b);this._postSorting(y,b,n)}else if("polygon"===d.geometry.type){l=[];for(c=0;c<d.geometry.rings.length;c++)t=d.geometry.rings[c],1<d.geometry.rings.length&&
!q.prototype.isClockwise(t)||(b=this._calcRingExtent(t),b.xmax-b.xmin<4*h*this._scale/this._OVERRUN&&b.ymax-b.ymin<4*e*this._scale/this._OVERRUN||l.push(t));l.sort(function(a,b){return b.length-a.length});for(c=0;c<l.length;c++)this._generatePolygonPositionsForManyLabels(l[c],d.geometry.spatialReference,d.text,f,h,e,n)}for(c=0;c<n.length&&(l=n[c].x,t=n[c].y,void 0!==n[c].angle&&(f=n[c].angle),b=this._findPlace(d,d.text,l,t,f,h,e),"OneLabel"!==g||!b||!this._labelLayer._isWithinScreenArea(new m(l,t,
d.geometry.spatialReference)));c++);}return this._placedLabels},_generatePointPositions:function(a,d,c,f,g,h,e,b,m,l){c=m&&m.pointPriorities?m.pointPriorities:"AboveRight";g=(e+g)*this._scale;h=(b+h)*this._scale;switch(c.toLowerCase()){case "aboveleft":a-=g;d+=h;break;case "abovecenter":d+=h;break;case "aboveright":a+=g;d+=h;break;case "centerleft":a-=g;break;case "centercenter":break;case "centerright":a+=g;break;case "belowleft":a-=g;d-=h;break;case "belowcenter":d-=h;break;case "belowright":a+=
g;d-=h;break;default:return}l.push({x:a,y:d})},_generateLinePositionsPlaceAtStart:function(a,d,c,f,g,h,e,b,m,l){e=f*this._scale;var k=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,p,q,r,t,u,n,F,E;for(p=0;p<a.paths.length;p++){var C=a.paths[p],G=e,H=0;for(q=0;q<C.length-1;q++)r=C[q][0],t=C[q][1],u=C[q+1][0],n=C[q+1][1],F=u-r,E=n-t,F=Math.sqrt(F*F+E*E),H+F>G?(H=this._generatePositionsOnLine(a.spatialReference,d,G,k,H,r,t,u,n,c,f,g,h,b,m,l),G=k):H+=F}},_generateLinePositionsPlaceAtEnd:function(a,
d,c,f,g,h,e,b,m,l){e=f*this._scale;var k=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,p,q,r,t,u,n,F,E;for(p=0;p<a.paths.length;p++){var C=a.paths[p],G=e,H=0;for(q=C.length-2;0<=q;q--)r=C[q+1][0],t=C[q+1][1],u=C[q][0],n=C[q][1],F=u-r,E=n-t,F=Math.sqrt(F*F+E*E),H+F>G?(H=this._generatePositionsOnLine(a.spatialReference,d,G,k,H,r,t,u,n,c,f,g,h,b,m,l),G=k):H+=F}},_generateLinePositionsPlaceAtCenter:function(a,d,c,f,g,h,e,b,m,l,q){var k,p,r,t,u,n,v,E;for(b=0;b<a.paths.length;b++){var C=
a.paths[b];if(!(2>C.length)){if(2==C.length){t=C[0];k=C[1];r=t[0];t=t[1];C=k[0];n=k[1];u=(C-r)*(C-r)+(n-t)*(n-t);v=Math.atan2(n-t,C-r);n=Math.cos(v);v=Math.sin(v);C=[];E=r;for(var G=t;(E-r)*(E-r)+(G-t)*(G-t)<u;)C.push([E,G]),E+=c/2*n,G+=c/2*v;C.push(k)}var H=0;for(k=0;k<C.length-1;k++)r=C[k][0],t=C[k][1],u=C[k+1][0],n=C[k+1][1],v=u-r,E=n-t,H+=Math.sqrt(v*v+E*E);for(k=G=0;k<C.length-1;k++){r=C[k][0];t=C[k][1];u=C[k+1][0];n=C[k+1][1];v=u-r;E=n-t;v=Math.sqrt(v*v+E*E);if(G+v>H/2)break;G+=v}k==C.length-
1&&k--;r=C[k][0];t=C[k][1];u=C[k+1][0];n=C[k+1][1];v=u-r;E=n-t;G=H/2-G;v=Math.atan2(E,v);E=r+G*Math.cos(v);v=t+G*Math.sin(v);r=this._angleAndShifts(r,t,u,n,e,m,l);q.push({x:E+r.shiftX,y:v+r.shiftY,angle:r.angle});var H=E,I=v,G=0;for(p=k;p<C.length-1;p++)p==k?(r=H,t=I):(r=C[p][0],t=C[p][1]),u=C[p+1][0],n=C[p+1][1],v=u-r,E=n-t,v=Math.sqrt(v*v+E*E),G=G+v>c?this._generatePositionsOnLine(a.spatialReference,d,c,c,G,r,t,u,n,f,g,h,e,m,l,q):G+v;G=0;for(p=k;0<=p;p--)p==k?(r=H,t=I):(r=C[p+1][0],t=C[p+1][1]),
u=C[p][0],n=C[p][1],v=u-r,E=n-t,v=Math.sqrt(v*v+E*E),G=G+v>c?this._generatePositionsOnLine(a.spatialReference,d,c,c,G,r,t,u,n,f,g,h,e,m,l,q):G+v}}},_generatePositionsOnLine:function(a,f,c,h,g,p,e,b,m,l,q,n,y,z,x,A){l=Math.atan2(m-e,b-p);q=p;n=e;var k=q,r=n;do if(g=c-g,q+=g*Math.cos(l),n+=g*Math.sin(l),this._belongs(q,n,p,e,b,m))g=this._angleAndShifts(p,e,b,m,y,z,x),c=q+g.shiftX,r=n+g.shiftY,f?this._labelLayer._isWithinScreenArea(new d(c,r,c,r,a))&&A.push({x:c,y:r,angle:g.angle}):A.push({x:c,y:r,angle:g.angle}),
k=q,r=n,g=0,c=h;else return a=b-k,m-=r,Math.sqrt(a*a+m*m);while(1)},_postSorting:function(a,d,c){if(a&&0<d.length){var f=.5*(a.xmin+a.xmax);a=.5*(a.ymin+a.ymax);for(var g=d[0].x,h=d[0].y,e=Math.sqrt((g-f)*(g-f)+(h-a)*(h-a)),b=d[0].angle,k=0;k<d.length;k++){var m=d[k].x,l=d[k].y,q=Math.sqrt((m-f)*(m-f)+(l-a)*(l-a));q<e&&(g=m,h=l,e=q,b=d[k].angle)}c.push({x:g,y:h,angle:b})}},_belongs:function(a,d,c,f,g,h){if(g==c&&h==f)return!1;if(g>c){if(a>g||a<c)return!1}else if(a<g||a>c)return!1;if(h>f){if(d>h||
d<f)return!1}else if(d<h||d>f)return!1;return!0},_angleAndShifts:function(a,d,c,f,g,h,e){for(a=Math.atan2(f-d,c-a);a>Math.PI/2;)a-=Math.PI;for(;a<-(Math.PI/2);)a+=Math.PI;f=Math.sin(a);var b=Math.cos(a);c=d=0;"Above"==h&&(d=g*f*this._scale,c=g*b*this._scale);"Below"==h&&(d=-g*f*this._scale,c=-g*b*this._scale);g=[];g.angle=e?-a:0;g.shiftX=-d;g.shiftY=c;return g},_generatePolygonPositionsForManyLabels:function(a,d,c,f,g,h,e){g=this._findCentroidForRing(a);f=g[0];var b=g[1],k=this._calcRingExtent(a);
g=k.xmin;h=k.ymin;var p=k.xmax,k=k.ymax,m=(k-h)/(this._map.height*this._scale);if(!(10<(p-g)/(this._map.width*this._scale)&&10<m)){var l=!0;if(p-g>this._map.width*this._scale||k-h>this._map.height*this._scale)l=!1;var m=this._map.width*this._scale*(l?.1875:.5),l=this._map.height*this._scale*(l?.1875:.5),q=!0,r=!0,n=0;do{b+=(n%2?-1:1)*n*l;if(this._scanRingByX(c,d,a,f,b,g,p,m,e))break;b<h&&(q=!1);b>k&&(r=!1);n++}while(q||r)}},_scanRingByX:function(a,f,c,h,g,p,e,b,m){var k=!0,l=!0,q=0,r=1E3;do{h+=(q%
2?-1:1)*q*b;var n=this._movePointInsideRing(c,h,g),u=this._labelLayer._isWithinScreenArea(new d(n,g,n,g,f)),A=this._isPointWithinRing(a,c,n,g);if(u&&A)return m.push({x:n,y:g}),!0;h<p&&(k=!1);h>e&&(l=!1);q++;r--;if(0>=r)return!0}while(k||l);return!1},_movePointInsideRing:function(a,d,c){for(var f=[],g=a.length-1,h=a[0][1]>=a[g][1]?1:-1,e=0;e<=g;e++){var b=e,k=e+1;e==g&&(k=0);var m=a[b][0],b=a[b][1],l=a[k][0],k=a[k][1],q=k>=b?1:-1;if(b<=c&&c<=k||k<=c&&c<=b)c!=b&&c!=k?(f.push((c-b)*(l-m)/(k-b)+m),h=
q):c==b&&c!=k?(h!=q&&f.push(m),h=q):c!=b&&c==k?(f.push(l),h=q):c==b&&c==k&&(1==h&&f.push(m),f.push(l),h=q)}f.sort(function(a,b){return a-b});a=f.length;if(0<a){for(e=c=d=0;e<a-1;e+=2)g=Math.abs(f[e+1]-f[e]),g>d&&(d=g,c=e);d=(f[c]+f[c+1])/2}return d},_calcRingExtent:function(a){var f,c;c=new d;for(f=0;f<a.length-1;f++){var h=a[f][0],g=a[f][1];if(void 0===c.xmin||h<c.xmin)c.xmin=h;if(void 0===c.ymin||g<c.ymin)c.ymin=g;if(void 0===c.xmax||h>c.xmax)c.xmax=h;if(void 0===c.ymax||g>c.ymax)c.ymax=g}return c},
_isPointWithinPolygon:function(a,d,c,f){var g;for(g=0;g<d.rings.length;g++)if(this._isPointWithinRing(a,d.rings[g],c,f))return!0;return!1},_isPointWithinRing:function(a,d,c,f){var g,h,e,b,k=[],m=d.length;for(a=0;a<m-1;a++)if(g=d[a][0],h=d[a][1],e=d[a+1][0],b=d[a+1][1],g!=e||h!=b){if(h==b)if(f==h)k.push(g);else continue;g==e?(h<b&&f>=h&&f<b&&k.push(g),h>b&&f<=h&&f>b&&k.push(g)):(h=(e-g)/(b-h)*(f-h)+g,g<e&&h>=g&&h<e&&k.push(h),g>e&&h<=g&&h>e&&k.push(h))}k.sort(function(a,b){return a-b});for(a=0;a<k.length-
1;a++)if(g=k[a],e=k[a+1],c>=g&&c<e)if(a%2)break;else return!0;return!1},_findCentroidForRing:function(a){for(var d=a.length,c=[0,0],f=0,g=a[0][0],h=a[0][1],e=1;e<d-1;e++){var b=a[e][0],m=a[e][1],l=a[e+1][0],q=a[e+1][1],n=(b-g)*(q-h)-(l-g)*(m-h);c[0]+=n*(g+b+l);c[1]+=n*(h+m+q);f+=n}c[0]/=3*f;c[1]/=3*f;return c},_findCentroidForFeature:function(a){for(var d=0,c=[0,0],f=0;f<a.rings.length;f++)for(var g=a.rings[f],h=g.length,e=g[0][0],b=g[0][1],m=1;m<h-1;m++){var l=g[m][0],q=g[m][1],n=g[m+1][0],y=g[m+
1][1],z=(l-e)*(y-b)-(n-e)*(q-b);c[0]+=z*(e+l+n);c[1]+=z*(b+q+y);d+=z}c[0]/=3*d;c[1]/=3*d;return c},_findPlace:function(a,f,c,h,g,m,e){if(isNaN(c)||isNaN(h))return!1;for(var b=0;b<this._placedLabels.length;b++){var k=this._placedLabels[b].angle,l=this._placedLabels[b].width*this._scale,p=this._placedLabels[b].height*this._scale,r=this._placedLabels[b].x-c,n=this._placedLabels[b].y-h;if(0===g&&0===k){if(this._findPlace2(-m*this._scale,-e*this._scale,m*this._scale,e*this._scale,r-l,n-p,r+l,n+p))return!1}else{var z=
new d(-m*this._scale,-e*this._scale,m*this._scale,e*this._scale,null),x=0,A=1;0!==g&&(x=Math.sin(g),A=Math.cos(g));var B=r*A-n*x,r=r*x+n*A,k=k-g,x=Math.sin(k),A=Math.cos(k),F=-l*A- -p*x,n=-l*x+-p*A,k=+l*A- -p*x,E=+l*x+-p*A,l=B+F,p=r-n,x=B+k,A=r-E,F=B-F,n=r+n,B=B-k,r=r+E,k=new q;k.addRing([[l,p],[x,A],[F,n],[B,r],[l,p]]);if(z.intersects(k))return!1}}for(;g>Math.PI/2;)g-=Math.PI;for(;g<-(Math.PI/2);)g+=Math.PI;b={};b.layer=a;b.text=f;b.angle=g;b.x=c;b.y=h;b.width=m;b.height=e;this._placedLabels.push(b);
return!0},_findPlace2:function(a,d,c,f,g,h,e,b){return(a>=g&&a<=e||c>=g&&c<=e||a<=g&&c>=e)&&(d>=h&&d<=b||f>=h&&f<=b||d<=h&&f>=b)?!0:!1}})})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleLineSymbol ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z,x,A,B,F,E,C,G,H,I,K,Q,O,L,S,P,M,N,J,R,X){var D=f([R,v],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,_preserveCacheOnDestroy:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new q([64,64,64]),defaultText:"Aa",sizeRampLightColor:new q([255,255,255]),sizeRampDarkColor:new q([128,128,128]),layerConnects:[],gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",
gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(b,c){l.mixin(this,X.widgets.legend);this._i18n=X.widgets.legend;b=b||{};b.map?c?(this.map=b.map,this.layerInfos=b.layerInfos,this._respectCurrentMapScale=!1===b.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===b.respectVisibility?!1:!0,this._preserveCacheOnDestroy=b.preserveCacheOnDestroy?!0:!1,this.arrangement=b.arrangement===D.ALIGN_RIGHT?D.ALIGN_RIGHT:D.ALIGN_LEFT,this.arrangement===D.ALIGN_RIGHT&&
(this.alignRight=!0),this.autoUpdate=!1===b.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=a(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],n.locale&&-1!==n.locale.indexOf(c)&&(-1!==n.locale.indexOf("-")?-1!==n.locale.indexOf(c+
"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>k("ie")&&(this._repaintItems=l.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();
this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||h.forEach(this.layers,function(a){delete a.legendResponse})},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],h.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=
a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)b.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&
(this.layers=[],h.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=
!0;this.layers=[];var a=[],b=[];h.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);var d;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==c.declaredClass&&(d=c.getLayers(),h.forEach(d,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==c.declaredClass&&(d=c.getFeatureLayers(),h.forEach(d,function(a){b.push(a.id)},this))},this);h.forEach(this.map.graphicsLayerIds,function(c){var d=
this.map.getLayer(c);-1==h.indexOf(a,c)&&-1==h.indexOf(b,c)&&this._isSupportedLayerType(d)&&d._params&&d._params.drawMode&&(d.arcgisProps&&d.arcgisProps.title&&(d._titleForLegend=d.arcgisProps.title),this.layers.push(d))},this)}this._createLegend()},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=d.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=d.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),
this._olrConnect=d.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=d.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),h.forEach(this.layers,function(a){var b={};b.ovcConnect=d.connect(a,"onVisibilityChange",this,"_refreshLayers");b.oocConnect=d.connect(a,"onOpacityChange",this,"_refreshLayers");b.oscConnect=d.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(b.odcConnect=
d.connect(a,"_onDynamicLayersChange",l.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(b.oirConnect=d.connect(a,"onRenderingChange",l.partial(this._updateImageServiceLayers,this,a)));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(b.oivrConnect=d.connect(a,"onRendererChange",l.hitch(this,"_refreshLayers")));this.layerConnects[a.id]=b},this))},_deactivate:function(){this._ozeConnect&&d.disconnect(this._ozeConnect);this._olaConnect&&d.disconnect(this._olaConnect);
this._olroConnect&&d.disconnect(this._olroConnect);this._olrConnect&&d.disconnect(this._olrConnect);h.forEach(this.layers,function(a){a=this.layerConnects[a.id]||{};a.ovcConnect&&d.disconnect(a.ovcConnect);a.oocConnect&&d.disconnect(a.oocConnect);a.oscConnect&&d.disconnect(a.oscConnect);a.odcConnect&&d.disconnect(a.odcConnect);a.oirConnect&&d.disconnect(a.oirConnect);a.oivrConnect&&d.disconnect(a.oivrConnect)},this);this.layerConnects=[]},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},
_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];h.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);h.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&a._params&&a._params.drawMode&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1,
c=!1;u.set(this.domNode,"position","relative");b.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var f=[];h.forEach(this.layers,function(e){if("esri.layers.KMLLayer"==e.declaredClass||"esri.layers.GeoRSSLayer"==e.declaredClass){var g;e.loaded?("esri.layers.KMLLayer"==e.declaredClass?g=e.getLayers():"esri.layers.GeoRSSLayer"==e.declaredClass&&(g=e.getFeatureLayers(),this.hideLayersInLegend[e.id]&&(g=h.filter(g,function(a){return-1==h.indexOf(this.hideLayersInLegend[e.id],
a.id)},this))),h.forEach(g,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&e._titleForLegend&&(a._titleForLegend=e._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==a.geometryType&&(a._titleForLegend+=this.NLS_areas),f.push(a))},this)):d.connect(e,"onLoad",l.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===e.declaredClass)if(!e.loaded)d.connect(e,
"onLoad",l.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&e.visible)&&0<e.layerInfos.length&&h.some(e.layerInfos,function(a){return a.legendURL})){var k=!1;h.forEach(e.layerInfos,function(c){if(c.legendURL&&-1<h.indexOf(e.visibleLayers,c.name)){k||(b.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(e._titleForLegend||e.name||e.id)+"\x3c/span\x3e"},this.domNode),k=!0);var d;c=c.legendURL;if(e.customParameters||
e.customLayerParameters){var f=l.clone(e.customParameters||{});l.mixin(f,e.customLayerParameters||{});for(d in f)c+=(-1===c.indexOf("?")?"?":"\x26")+d+"\x3d"+f[d]}b.create("div",{innerHTML:"\x3cimg src\x3d'"+c+"'/\x3e"},this.domNode);a=!0}},this)}}else"esri.layers.WFSLayer"!==e.declaredClass||e.renderer?f.push(e):(g=b.create("div",{id:this.id+"_"+e.id,"class":"esriLegendService"}),b.create("span",{innerHTML:this._getServiceTitle(e),"class":"esriLegendServiceLabel"},b.create("td",{align:this._align},
b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},g))))),b.place(g,this.id,"first"),tableNode=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g),tableBody=b.create("tbody",{},tableNode),"esriGeometryComplex"===e.geometryType?(this._buildRow_Renderer(e,e._pointSymbol,null,this.NLS_points,null,tableBody),this._buildRow_Renderer(e,e._lineSymbol,null,this.NLS_lines,null,tableBody),this._buildRow_Renderer(e,e._polygonSymbol,null,this.NLS_areas,null,
tableBody)):"esriGeometryPoint"===e.geometryType?this._buildRow_Renderer(e,e._pointSymbol,null,"",null,tableBody):"esriGeometryPolyline"===e.geometryType?this._buildRow_Renderer(e,e._lineSymbol,null,"",null,tableBody):"esriGeometryPolygon"===e.geometryType&&this._buildRow_Renderer(e,e._polygonSymbol,null,"",null,tableBody),c=!0)},this);var k=[];h.forEach(f,function(a){if(!a.loaded)var c=d.connect(a,"onLoad",this,function(a){d.disconnect(c);c=null;this.refresh()});else if((!this._respectVisibility||
this._respectVisibility&&a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var e=b.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});b.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},b.create("td",{align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},e)))));b.place(e,this.id,"first");a.legendResponse||a.renderer?this._createLegendForLayer(a):this.isHostedTileService(a)?
this._getLayerInfos(a).then(l.hitch(this,function(a){this._createLegendForLayer(a)}),l.hitch(this,function(a){k.push(this._legendRequest(a))})):k.push(this._legendRequest(a))}},this);0!==k.length||a||c?(new g(k)).addCallback(l.hitch(this,function(b){a||c?e.byId(this.id+"_msg").innerHTML="":e.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):(e.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForLayer:function(a){if(a.legendResponse||a.renderer||this.isHostedTileService(a)){var b=
!1;if(a.legendResponse||this.isHostedTileService(a)){var c=a.dynamicLayerInfos||a.layerInfos;c&&c.length?h.forEach(c,function(c,d){if(!this.hideLayersInLegend[a.id]||-1===h.indexOf(this.hideLayersInLegend[a.id],c.id)){var e=this._buildLegendItems(a,c,d);b=b||e}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+1,a.url.length):
"fc_"+a.id,b=this._buildLegendItems(a,{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(u.set(e.byId(this.id+"_"+a.id),"display","block"),u.set(e.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);d.connect(a,"onLoad",l.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?"),b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";(c=a._getToken())&&
(b+="?token\x3d"+c);var d=l.hitch(this,"_processLegendResponse"),e={f:"json"};a._params.dynamicLayers&&(e.dynamicLayers=p.stringify(this._createDynamicLayers(a)),"[{}]"===e.dynamicLayers&&(e.dynamicLayers="[]"));a._params.bandIds&&(e.bandIds=a._params.bandIds);a._params.renderingRule?e.renderingRule=a._params.renderingRule:a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&h.forEach(a.rasterFunctionInfos,function(a){a&&a.name&&"none"===a.name.toLowerCase()&&(e.renderingRule=p.stringify({rasterFunction:a.name}))});
return B({url:b,content:e,callbackParamName:"callback",load:function(b,c){d(a,b,c)},error:A.defaults.io.errorHandler})},_legendRequestTools:function(a){var b=a.url.toLowerCase().indexOf("/rest/"),b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length),b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!k("ie")||8<k("ie"))b+="\x26returnbytes\x3dtrue";var c=l.hitch(this,"_processLegendResponse");return B({url:b,content:{f:"json"},callbackParamName:"callback",load:function(b,d){c(a,b,d)},error:A.defaults.io.errorHandler})},
_processLegendResponse:function(a,c){c&&c.layers?(a.legendResponse=c,e.byId(this.id+"_"+a.id)&&b.empty(e.byId(this.id+"_"+a.id)),b.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},b.create("td",{align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},e.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+m.toJson(c))},_buildLegendItems:function(a,c,d){var f=!1,g=e.byId(this.id+
"_"+a.id),k=c.parentLayerId;if(c.subLayerIds)a=b.create("div",{id:this.id+"_"+a.id+"_"+c.id+"_group",style:{display:"none"},"class":-1==k?0<d?"esriLegendGroupLayer":"":this._legendAlign},-1==k?g:e.byId(this.id+"_"+a.id+"_"+k+"_group")),b.create("td",{innerHTML:z.encode(c.name),align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&a.visibleLayers)if(d=a.dynamicLayerInfos||a.layerInfos)if(a._params&&
a._params.layers){if(-1===h.indexOf(a.visibleLayers,c.id))return f}else{if(d=this._getReallyVisibleLayers(d,a.visibleLayers),-1===h.indexOf(d,c.id))return f}else if(-1===h.indexOf(a.visibleLayers,c.id))return f;g=b.create("div",{id:this.id+"_"+a.id+"_"+c.id,style:{display:"none"},"class":-1<k?this._legendAlign:""},-1==k?g:e.byId(this.id+"_"+a.id+"_"+k+"_group"));b.create("td",{innerHTML:z.encode(c.name)||"",align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%","class":"esriLegendLayerLabel"},
g))));d=a.dynamicLayerInfos||a.layerInfos;k=!1;d&&d.length&&(k=h.some(d,function(a){return!!a.drawingInfo}));if(a.legendResponse)f=f||this._buildLegendItems_Tools(a,c,g);else if(a.renderer||k)f=f||this._buildLegendItems_Renderer(a,c,g)}return f},_getReallyVisibleLayers:function(a,b){if(!a||!b||!b.length)return[];var c=[],d=[],e;for(e=0;e<a.length;e++)if(a[e].subLayerIds){if(-1===h.indexOf(b,a[e].id)||-1<h.indexOf(d,a[e].id))d=d.concat(a[e].subLayerIds)}else-1<h.indexOf(b,a[e].id)&&-1===h.indexOf(d,
a[e].id)&&c.push(a[e].id);return c},_buildLegendItems_Tools:function(a,c,d){var f=c.parentLayerId,g=this.map.getScale(),k=!1,m=function(a,b){var c,d;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(d=0;d<b.dynamicLayerInfos[d].length;d++){if(b.dynamicLayerInfos[d].mapLayerId==a[c].layerId)return a[c]}else if(b.id==a[c].layerId)return a[c];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,c,g)){var l=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===
a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var p=this._getEffectiveScale(a,c);if(p.minScale&&p.minScale<g||p.maxScale&&p.maxScale>g)l=!1}if(l){var g=m(a.legendResponse.layers,c),q=g.legendType,r=g.layerType,t=g.legend;if(t){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&this._sanitizeLegendResponse(a,g,c);d=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);var n=b.create("tbody",{},d);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(d,
a,c);h.forEach(t,function(b){if(!(10.1<=a.version&&!b.values&&1<t.length)||!a._hideDefaultSymbol&&"\x3call other values\x3e"!==b.label&&(b.label||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version||"Raster Layer"===r))if(b.url&&0===b.url.indexOf("http")||b.imageData&&0<b.imageData.length)k=!0,this._buildRow_Tools(b,n,a,c.id,q)},this)}}}k&&(u.set(e.byId(this.id+"_"+a.id+"_"+c.id),"display","block"),-1<f&&(u.set(e.byId(this.id+"_"+a.id+"_"+f+"_group"),"display","block"),this._findParentGroup(a.id,
a,f)));return k},_getLayerInfos:function(a){var b=new r,c=a.dynamicLayerInfos||a.layerInfos;if(c&&c.length)if(h.some(c,function(a){return!!a.drawingInfo}))b.resolve(a);else{var d=a.url,e=d.indexOf("?"),d=-1==e?d+"/layers":d.substring(0,e)+"/layers"+d.substring(e,d.length);B({url:d,content:{f:"json"},callbackParamName:"callback",load:function(d,e){d.layers?(h.forEach(c,function(a){var b=h.filter(d.layers,function(b){return a.source?b.id===a.source.mapLayerId:b.id===a.id});b&&b[0]&&b[0].drawingInfo&&
(a.drawingInfo=b[0].drawingInfo,a.fields=b[0].fields)}),b.resolve(a)):b.reject(a)},error:function(c){b.reject(a)}})}return b},_sanitizeLegendResponse:function(a,b,c){var d=b.legend;if(10.1<=a.version&&1<d.length&&!b._sanitized){a=l.getObject("layerDefinition.drawingInfo.renderer",!1,c);var e,f;a||(a=l.getObject("drawingInfo.renderer",!1,c));h.some(d,function(a){if(a.values)return!0})&&h.some(d,function(a,b){a.values||(f=b,e=a);return!!e});a?"uniqueValue"===a.type?e&&(d.splice(f,1),d.push(e)):"classBreaks"===
a.type&&(e&&d.splice(f,1),d.reverse(),e&&d.push(e)):e&&(d.splice(f,1),d.push(e));b._sanitized=!0}},_buildRow_Tools:function(a,c,d,e,f){var g=b.create("tr",{},c),h;this.alignRight?(c=b.create("td",{align:this._isRightToLeft?"left":"right"},g),h=b.create("td",{align:this._isRightToLeft?"left":"right",width:35},g)):(h=b.create("td",{width:35,align:"center"},g),c=b.create("td",{},g));g=a.url;(!k("ie")||9<=k("ie")||9>k("ie")&&"esri.layers.ArcGISImageServiceLayer"===d.declaredClass)&&a.imageData&&0<a.imageData.length?
g="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(g=d.url+"/"+e+"/images/"+a.url,(e=d._getToken())&&(g+="?token\x3d"+e));e=b.create("img",{src:g,border:0,style:"opacity:"+d.opacity},h);a=b.create("td",{innerHTML:z.encode(a.label),align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%",dir:"ltr"},c))));f&&"Stretched"===f&&10.3<=d.version&&"esri.layers.ArcGISImageServiceLayer"===d.declaredClass&&(a.style.verticalAlign="top",a.style.lineHeight="1",e.style.marginBottom=
"-1px",e.style.display="block",c.style.verticalAlign="top");9>k("ie")&&(e.style.filter="alpha(opacity\x3d"+100*d.opacity+")")},_getVariable:function(a,b,c){var d;a&&(d=(a=a.getVisualVariablesForType(b,c))&&a[0]);return d},_getVariables:function(a,b,c){a=[this._getVariable(a,"colorInfo",!1),this._getVariable(a,"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return b?h.filter(a,function(a){return!(!a||a.field!==b||a.normalizationField!=c)}):a},_getFieldAlias:function(a,b,c){var d=b.infoTemplate,
d=d&&d.getFieldInfo&&d.getFieldInfo(a);a=l.isFunction(a)?null:this.getField(b,a,c);b=d||a;c="";b&&(c=d&&d.label||a&&a.alias||b.name||b.fieldName);return c},_getRampTitle:function(a,b,c){var d,e=a.field,f=a.normalizationField,g=!1,h=!1,k=!1,e=l.isFunction(e)?null:e,f=l.isFunction(f)?null:f;if(a.legendOptions&&a.legendOptions.title)d=a.legendOptions.title;else if(a.valueExpressionTitle)d=a.valueExpressionTitle;else{if(b.renderer&&b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables){var m=
b.renderer.authoringInfo.visualVariables;for(a=0;a<m.length;a++){var p=m[a];if("colorInfo"===p.type&&"ratio"===p.style){g=!0;break}else if("colorInfo"===p.type&&"percent"===p.style){h=!0;break}else if("colorInfo"===p.type&&"percentTotal"===p.style){k=!0;break}}}(g=k&&"showRatioPercentTotal"||h&&"showRatioPercent"||g&&"showRatio"||f&&"showNormField"||e&&"showField"||null)&&(d=F.substitute({field:e&&this._getFieldAlias(e,b,c),normField:f&&this._getFieldAlias(f,b,c)},this._i18n[g]))}return d},_getRendererTitle:function(a,
b,c){var d;if(a){var e,f,g;a instanceof I&&(e=a.attributeField,f=a.normalizationField,g="percent-of-total"===a.normalizationType);e=l.isFunction(e)?null:e;f=l.isFunction(f)?null:f;a.legendOptions&&a.legendOptions.title?d=a.legendOptions.title:a.valueExpressionTitle?d=a.valueExpressionTitle:(a=f&&"showNormField"||(g?"showNormPct":null)||e&&"showField"||null)&&(d=F.substitute({field:e&&this._getFieldAlias(e,b,c),normField:f&&this._getFieldAlias(f,b,c)},this._i18n[a]))}return d},_buildLegendItems_Renderer:function(a,
c,d){var f=c.parentLayerId,g=this.map,k=g.getScale(),m,p=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,c,k)){var q,t,r,n,v,x,y,w;r="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:c&&c.drawingInfo?J.fromJson(l.clone(c.drawingInfo.renderer)):a.renderer;if(r instanceof K&&(r=(r="zoom"===r.rangeType?r.getRendererInfoByZoom(g.getZoom()):r.getRendererInfoByScale(k))&&r.renderer,!r))return!1;var A=this._getVariables(r),B=h.filter(A,function(a){return!!a}).length,
k=A[0],g=A[1],A=A[2],F,E,C,W,V;k&&(n=this._getMedianColor(r,k),k.field&&(x=l.isFunction(k.field)?null:this.getField(a,k.field,c)),F=!(k.legendOptions&&!1===k.legendOptions.showLegend));g&&(g.field&&(w=l.isFunction(g.field)?null:this.getField(a,g.field,c)),E=!(g.legendOptions&&!1===g.legendOptions.showLegend));A&&(A.field&&(y=l.isFunction(A.field)?null:this.getField(a,A.field,c)),C=!(A.legendOptions&&!1===A.legendOptions.showLegend));if(r instanceof S)m=p=!0,this._showHeatRamp(a,c,r,d);else if(r instanceof
Q)m=p=!0,this._showDotDensityLegend(a,c,r,d);else if(r instanceof O)m=p=!0,t=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),q=b.create("tbody",{},t),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(t,a,c),r.latestObservationRenderer&&r.latestObservationRenderer instanceof G&&this._buildRow_Renderer(a,r.latestObservationRenderer.symbol,n,z.encode(r.latestObservationRenderer.label)||this.NLS_currentObservations,null,q),r.observationRenderer&&r.observationRenderer instanceof
G&&this._buildRow_Renderer(a,r.observationRenderer.symbol,n,z.encode(r.observationRenderer.label)||this.NLS_previousObservations,null,q);else if(r instanceof H){if(r.infos&&0<r.infos.length){m=p=!0;if(r.legendOptions&&r.legendOptions.title||r.valueExpressionTitle)t=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),q=b.create("tbody",{},t),B=r.legendOptions&&r.legendOptions.title?r.legendOptions.title:r.valueExpressionTitle,this._buildRow_Renderer(a,null,n,z.encode(B),
null,q);t=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);q=b.create("tbody",{},t);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(t,a,c);r.attributeField&&A&&this._addSubHeader(q,this._getFieldAlias(r.attributeField,a,c));var D=[];h.forEach(r.infos,function(b){var c=null;a._editable&&a.types&&(c=this._getTemplateFromTypes(a.types,b.value));var d=b.label;null==d&&(d=b.value);-1===h.indexOf(D,d)&&(D.push(d),this._buildRow_Renderer(a,b.symbol,n,z.encode(d),
c,q))},this)}V=this._displayDefaultSymbol(a,r,d)}else if(r instanceof I){if(r.infos&&0<r.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass)m=p=!0,W=this._isUnclassedRenderer(r),k||1!==r.infos.length||(v=(v=r.infos[0])&&v.symbol),W||(t=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),q=b.create("tbody",{},t),B=this._getRendererTitle(r,a,c),this._buildRow_Renderer(a,null,n,z.encode(B),null,q)),t=b.create("table",{cellpadding:0,cellspacing:0,
width:"95%","class":"esriLegendLayer"},d),q=b.create("tbody",{},t),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(t,a,c),W&&A&&C||(B=r.infos.slice(0).reverse(),h.forEach(B,function(b){var c=b.label;null!=c||W||(c=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,n,z.encode(c),null,q)},this)),"esri.layers.ArcGISImageServiceVectorLayer"!==a.declaredClass||a.renderer.style!==L.STYLE_SCALAR&&a.renderer.style!==L.STYLE_SINGLE_ARROW||(this._buildRow_Renderer(a,r.defaultSymbol,null,
"",null,q),a._hideDefaultSymbol=!0);W||(V=this._displayDefaultSymbol(a,r,d))}else r instanceof G&&(m=p=!0,t=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),q=b.create("tbody",{},t),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(t,a,c),v=null,a._editable&&a.templates&&0<a.templates.length&&(v=a.templates[0]),t=1<B?null:x&&F||w&&E||y&&C,this._buildRow_Renderer(a,r.symbol,n,z.encode(t?this._getRampTitle(1<B?null:k||g||A,a,c):r.label),v,q),v=k?null:r.symbol,
t&&(x=w=y=null));m&&(k&&F&&(k.field||k.valueExpression)&&this._showGradientRamp(a,c,r,null,d,k,x,null,A&&C?!0:!1),A&&C&&(A.field||A.valueExpression)&&(m=k&&F||r instanceof H?!1:!0,this._showSizeLegend(a,c,r,A,n,d,y,null,m)),g&&E&&(g.field||g.valueExpression)&&this._showGradientRamp(a,c,r,v&&!v.url&&v.color?v.color:this.transparencyRampColor,d,g,w,null,!1));V||W&&!F&&!C&&!E||(V=this._displayDefaultSymbol(a,r,d));p=p||V}p&&(u.set(e.byId(this.id+"_"+a.id+"_"+c.id),"display","block"),-1<f&&(u.set(e.byId(this.id+
"_"+a.id+"_"+f+"_group"),"display","block"),this._findParentGroup(a.id,f)));return p},_isUnclassedRenderer:function(a,b){var c;if(a instanceof I&&a.infos&&1===a.infos.length){c=a.attributeField;var d=a.normalizationField;c=b?c===b:!!this._getVariables(a,c,d).length}return c},_displayDefaultSymbol:function(a,c,d){var e;!a._hideDefaultSymbol&&c.defaultSymbol&&(e=!0,d=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),d=b.create("tbody",{},d),this._buildRow_Renderer(a,
c.defaultSymbol,null,z.encode(c.defaultLabel)||"others",null,d));return e},_showGradientRamp:function(a,c,d,e,f,g,h,k,m){m=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(m?"":" esriLegendSubFragment")},f);f=b.create("tbody",{},m);(a._hoverLabel||a._hoverLabels||k)&&this._createHoverAction(m,a,c,k);(h||g.valueExpression)&&this._addSubHeader(f,this._getRampTitle(g,a,c));h=g.field;var p;h&&(p=l.isFunction(h)?null:this.getField(a,h,c));(c=this._getRampStops(d,g,e,
p&&"esriFieldTypeDate"===p.type))&&c.length&&this._drawGradientRamp(f,c,!0,a,this._getRampBorderColor(d),!!e)},_getMedianColor:function(a,b){var c,d;b.colors?(c=b.minDataValue,d=b.maxDataValue):b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,b,c,d){var e,f,g,k,m=!1;b.colors||b.opacityValues?(f=b.maxDataValue-b.minDataValue,e=h.map([0,.25,.5,.75,1],function(a){g=b.minDataValue+a*f;return Number(g.toFixed(6))}),this._checkPrecision(0,
4,e)):b.stops&&(e=h.map(b.stops,function(a){return a.value}),(m=h.some(b.stops,function(a){return!!a.label}))&&(k=h.map(b.stops,function(a){return a.label})));var p=e[0],l,r;f=e[e.length-1]-p;return h.map(e,function(g,h){c?(l=new q(c.toRgba()),r=a.getOpacity(g,{opacityInfo:b}),null!=r&&(l.a=r)):l=a.getColor(g,{colorInfo:b});var t="";if(m)t=k[h];else{var t=d?C.formatDate(g,C.timelineDateFormatOptions):E.format(g),n="";0===h?n=this._specialChars.lt+" ":h===e.length-1&&(n=this._specialChars.gt+" ");
t=n+t}return{value:g,color:l,offset:1-(g-p)/f,label:t}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,e=c[a],f=c[d],g=c[b],h=Math.floor(e),k=Math.floor(f),m=Math.floor(g);h===e&&m===g&&k!==f&&h!==k&&m!==k&&(c[d]=k);a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_getRampBorderColor:function(a){var b;if(a instanceof G)b=a.symbol;else if(a instanceof H||a instanceof I)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&
a.color},_drawGradientRamp:function(a,c,d,e,f,g){var m=b.create("tr",{},a),p,l,r,t,n,v=c.length-1,x;t=0;this.alignRight?(a=b.create("td",{align:this._isRightToLeft?"left":"right"},m),p=b.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},m)):(p=b.create("td",{width:this.gradientWidth,align:"center"},m),a=b.create("td",{},m));m=f&&0<f.a&&!(240<=f.r&&240<=f.g&&240<=f.b);l=b.create("div",{"class":m?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+
"px;"},p);p=b.create("div",{"class":"esriLegendColorRamp"+(g?" esriLegendTransparencyRamp":"")},l);g=u.get(p,"width");m&&(f=9>k("ie")?f.toHex():"rgba("+f.toRgba().join(",")+")",u.set(p,"border",this.colorRampBorder+" "+f));d?(f=this.gradientHeight*v,u.set(p,"height",f+"px")):f=u.get(p,"height");u.set(l,"height",f+"px");m=w.createSurface(p,g,f);9>k("ie")&&(t=m.getEventSource(),u.set(t,"position","relative"),u.set(t.parentNode,"position","relative"),t=1);try{d&&h.forEach(c,function(a,b){a.offset=b/
v}),n=m.createRect({x:-t,y:-t,width:g+t,height:f+t}),n.setFill({type:"linear",x1:0,y1:0,x2:0,y2:f,colors:c}).setStroke(null),m.createRect({width:g,height:f}).setFill(new q([255,255,255,1-e.opacity])).setStroke(null),this._surfaceItems.push(m)}catch(ca){m.clear(),m.destroy()}h.forEach(c,function(a,d){if(a.label){x="top:"+100*a.offset+"%;";var e="";0===d&&(e+=" esriLegendColorRampTickFirst");d===c.length-1&&(e+=" esriLegendColorRampTickLast");b.create("div",{"class":"esriLegendColorRampTick"+e,innerHTML:"\x26nbsp;",
style:x},l)}});r=b.create("div",{"class":"esriLegendColorRampLabels",style:{height:f+this.gradientHeight+"px"}},a);d?h.forEach(c,function(a){b.create("div",{"class":"esriLegendColorRampLabel",innerHTML:z.encode(a.label)||"\x26nbsp;"},r)}):(b.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},r),b.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(f+this.gradientHeight-2*this.gradientHeight)+"px;"},r))},_showHeatRamp:function(a,c,d,e,f){var g,
h=d.field;g=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);e=b.create("tbody",{},g);(a._hoverLabel||a._hoverLabels||f)&&this._createHoverAction(g,a,c,f);(h=h&&this.getField(a,h,c))&&this._addSubHeader(e,this._getFieldAlias(h.name,a,c));c=this._getHeatmapStops(d);c.length&&this._drawGradientRamp(e,c,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var c,d,e,f;b&&b[0]?(c=b.length-1,(a=b[0]&&null!=b[0].ratio)?(a=b[c])&&1!==a.ratio&&(b=b.slice(0),
b.push({ratio:1,color:a.color}),c++):(d=b[0].value,e=b[c].value-d,b=h.map(b,function(a){return{color:a.color,ratio:(a.value-d)/e}}))):a&&a[0]&&(c=a.length-1,f=1/(a.length-1),b=h.map(a,function(a,b){return{color:a,ratio:b*f}}));b=h.map(b,function(a,b){var d="";0===b?d="Low":b===c&&(d="High");return{color:a.color,label:d,offset:1-a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,c,d,e){var f=d.legendOptions,g,k,m,p,q,r,t,n=this.dotDensitySwatchSize,u=Math.round(n/2);f&&(k=f.backgroundColor,
m=f.outline,p=f.valueUnit,q=f.dotCoverage);q=(q||this.dotCoverage)/100;t=Math.round(n*n/Math.pow(d.dotSize,2)*q);e=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);r=b.create("tbody",{},e);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(e,a,c);this._addSubHeader(r,F.substitute({value:d.dotValue,unit:p||""},this.NLS_dotValue));h.forEach(d.fields,function(b){b=l.mixin({},b);b.numPoints=t;g=new P(d._generateImageSrc(n,n,[b],{x:0,y:0},{x:n,y:n},k),m||d.outline,
n,n);b=this.getField(a,b.name,c)||b;this._buildRow_Renderer(a,g,null,z.encode(this._getFieldAlias(b.name,a,c)),null,r,{type:"path",path:"M "+-u+","+-u+" L "+u+","+-u+" L "+u+","+u+" L "+-u+","+u+" L "+-u+","+-u+" E"})},this)},_showSizeLegend:function(a,c,d,e,f,g,h,k,m){var p=e.legendOptions,p=p&&p.customValues;f=this._getSizeSymbol(d,f);if((!e.valueUnit||"unknown"===e.valueUnit)&&f&&(p||null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue||e.stops&&!(1>=e.stops.length))){m=
b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(m?"":" esriLegendSubFragment")},g);g=b.create("tbody",{},m);(a._hoverLabel||a._hoverLabels||k)&&this._createHoverAction(m,a,c,k);(h||e.valueExpression)&&this._addSubHeader(g,this._getRampTitle(e,a,c));h=e.field;var q;h&&(q=l.isFunction(h)?null:this.getField(a,h,c));c=q&&"esriFieldTypeDate"===q.type;p=p||this._getDataValues(d,f,e,c);for(q=m=p.length-1;0<=q;q--)h=p[q],f=N.fromJson(f.toJson()),this._applySize(f,d,e,
h),h=c?C.formatDate(h,C.timelineDateFormatOptions):E.format(h),k="",q===m?k=this._specialChars.gt+" ":0===q&&(k=this._specialChars.lt+" "),k="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+z.encode(k+h)+"\x3c/span\x3e",this._buildRow_Renderer(a,f,null,k,null,g)}},_getSizeSymbol:function(a,b){var c,d;if(a instanceof G)c=a.symbol;else if(a instanceof L)c=a.defaultSymbol;else if(a instanceof H||a instanceof I)c=a.infos[0].symbol,d=1<a.infos.length;if(c=c&&-1!==c.type.indexOf("fillsymbol")?null:c)if(c=
N.fromJson(c.toJson()),b||d)-1!==c.type.indexOf("linesymbol")?c.setColor(new q(this.sizeRampDarkColor)):(c.setColor(new q(this.sizeRampLightColor)),c.setOutline&&(d=new M,d.setColor(new q(this.sizeRampDarkColor)),d.setWidth(1.5),c.setOutline(d)));return c},_getDataValues:function(a,b,c,d,e,f){e=null==e?5:e;f=null==f?20:f;var g=a.getSizeRangeAtScale(c,this.map.getScale());e=this._interpolateSizeRange(g,e);var k=this._getDataRange(c),m=h.map(e,function(a){return this._getDataValueFromSize(a,k,g)},this);
if(!d){var p,m=E.round(m);for(d=1;d<m.length-1;d++)if(p=this._roundDataValue(a,b,c,m[d],m[d-1],f))m[d]=p[0],e[d]=p[1]}return m},_getDataRange:function(a){var b=a.stops;return b?{min:b[0].value,max:b[b.length-1].value}:{min:a.minDataValue,max:a.maxDataValue}},_interpolateSizeRange:function(a,b){var c=a.minSize,d=(a.maxSize-c)/(b-1),e,f=[];for(e=0;e<b;e++)f.push(c+d*e);return f},_getDataValueFromSize:function(a,b,c){var d=c.minSize;c=c.maxSize;var e=b.min;b=b.max;return a<=d?e:a>=c?b:(a-d)/(c-d)*(b-
e)+e},_roundDataValue:function(a,b,c,d,e,f){var g=this._getSize(b,a,c,d);e=this._getSize(b,a,c,e);var h,k=E.getDigits(d),m=k.integer,k=k.fractional,p,l,q,r,t,n,u,v,x,y,w;0<d&&1>d&&(h=Math.pow(10,k),d*=h,m=E.getDigits(d).integer);for(--m;0<=m&&(p=Math.pow(10,m),k=Math.floor(d/p)*p,p*=Math.ceil(d/p),null!=h&&(k/=h,p/=h),l=(k+p)/2,l=E.round([k,l,p],{indexes:[1]})[1],q=this._getSize(b,a,c,k),r=this._getSize(b,a,c,p),t=this._getSize(b,a,c,l),n=E.getPctChange(g,q,e,null),u=E.getPctChange(g,r,e,null),v=
E.getPctChange(g,t,e,null),x=n.prev<=f,y=u.prev<=f,x&&y&&(n.prev<=u.prev?(x=!0,y=!1):(y=!0,x=!1)),x?w=[k,q]:y?w=[p,r]:v.prev<=f&&(w=[l,t]),!w);m--);return w},_applySize:function(a,b,c,d){var e=a.type;b=this._getSize(a,b,c,d);switch(e){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":e=a.width;c=a.height;a.setHeight(b);a.setWidth(e/c*b);break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,
b,c,d){return b.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,c,d,e,f,g,h){var k=b.create("tr",{},g),m;this.alignRight?(g=b.create("td",{align:this._isRightToLeft?"left":"right"},k),c&&(m=b.create("td",{align:this._isRightToLeft?"left":"right",width:35},k))):(c&&(m=b.create("td",{width:35,align:"center"},k)),g=b.create("td",{},k));var p=k=30,l;if(c){if("simplemarkersymbol"==c.type)k=Math.min(Math.max(k,c.size+
12),125),p=Math.min(Math.max(p,c.size+12),125);else if("picturemarkersymbol"==c.type)k=Math.min(Math.max(k,c.width),125),p=Math.min(c.height||p,125);else if("textsymbol"==c.type){var q,r;c.text||(q=c.text,r=!0,c.setText(this.defaultText));k=Math.min(Math.max(k,c.getWidth()+12),125);p=Math.min(Math.max(p,c.getHeight()+12),125);r&&c.setText(q)}l=b.create("div",{style:"width:"+k+"px;height:"+p+"px;"},m)}F.isDefined(e)&&"number"===typeof e&&(e=""+e);b.create("td",{innerHTML:e||"",align:this._align},b.create("tr",
{},b.create("tbody",{},b.create("table",{width:"95%"},g))));c&&(a=this._drawSymbol(l,c,d,k,p,f,a,h),this._surfaceItems.push(a))},_addSubHeader:function(a,c){var d=b.create("tr",{},a),d=b.create("td",{align:this._align,colspan:2},d);b.create("td",{innerHTML:z.encode(c)||"",align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},d))))},_drawSymbol:function(a,b,c,d,e,f,g,h){b=N.fromJson(b.toJson());var m=g.opacity;c&&b.setColor(new q(c.toRgba()));if("simplelinesymbol"===
b.type||"cartographiclinesymbol"===b.type||"textsymbol"===b.type){if(!b.color)return;c=b.color.toRgba();c[3]*=m;b.color.setColor(c)}else"simplemarkersymbol"===b.type||"simplefillsymbol"===b.type?(b.color&&(c=b.color.toRgba(),c[3]*=m,b.color.setColor(c)),b.outline&&b.outline.color&&(c=b.outline.color.toRgba(),c[3]*=m,b.outline.color.setColor(c))):"picturemarkersymbol"===b.type&&(a.style.opacity=m,a.style.filter="alpha(opacity\x3d("+100*m+"))");a=w.createSurface(a,d,e);9>k("ie")&&(c=a.getEventSource(),
u.set(c,"position","relative"),u.set(c.parentNode,"position","relative"));f=this._getDrawingToolShape(b,f)||N.getShapeDescriptors(b);var p,m=(c=f.defaultShape)&&"text"===c.type;try{m&&!c.text&&(c.text=this.defaultText),p=a.createShape(h||c).setFill(f.fill).setStroke(f.stroke),m&&p.setFont(f.font)}catch(fa){a.clear();a.destroy();return}var r=p.getBoundingBox();h=r.width;f=r.height;var m=-(r.x+h/2),t=-(r.y+f/2);c=a.getDimensions();m={dx:m+c.width/2,dy:t+c.height/2};if("simplemarkersymbol"===b.type&&
"path"===b.style)d=g._getScaleMatrix(r,b.size),p.applyTransform(y.scaleAt(d.xx,d.yy,{x:c.width/2,y:c.height/2}));else if(h>d||f>e)g=h/d>f/e,d=((g?d:e)-5)/(g?h:f),l.mixin(m,{xx:d,yy:d});p.applyTransform(m);return a},_getDrawingToolShape:function(a,b){var c;switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};
break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){h.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());
try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(V){}a.children&&l.isArray(a.children)&&h.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,c,f,g){if(g=c._hoverLabel||c._hoverLabels&&c._hoverLabels[f.id]||g)g=z.encode(g),c.mouseMoveHandler=c.mouseMoveHandler||{},c.mouseMoveHandler[f.id]=d.connect(a,"onmousemove",l.hitch(this,function(a,c){this.mouseX=c.clientX;this.mouseY=c.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,u.set(e.byId(this.id+"_hoverLabel"),"display",
"none"));setTimeout(l.hitch(this,function(a,c,d){if(a==this.mouseX&&c==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,e.byId(this.id+"_hoverLabel")){var f=e.byId(this.id+"_hoverLabel");f.innerHTML="\x3cspan\x3e"+d+"\x3c/span\x3e";u.set(f,"top",c+"px");u.set(f,"left",a+15+"px");u.set(f,"display","")}else b.create("div",{innerHTML:"\x3cspan\x3e"+d+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:c+"px",left:a+15+"px"}},document.body)},c.clientX,c.clientY,
a),500)},g)),c.mouseOutHandler=c.mouseOutHandler||{},c.mouseOutHandler[f.id]=d.connect(a,"onmouseout",l.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,u.set(e.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;h.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)d.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)d.disconnect(b.mouseOutHandler[a])})},
_createDynamicLayers:function(a){var b=[],c;h.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();var e;a.layerDefinitions&&a.layerDefinitions[d.id]&&(e=a.layerDefinitions[d.id]);e&&(c.definitionExpression=e);var f;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&(f=a.layerDrawingOptions[d.id]);f&&(c.drawingInfo=f.toJson());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<
a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,f=b.dynamicLayerInfos||b.layerInfos;for(d=0;d<f.length;d++)if(c==f[d].id){-1<f[d].parentLayerId&&(u.set(e.byId(this.id+"_"+a+"_"+f[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,f[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,d){var e=a.layer.dynamicLayerInfos||a.layer.layerInfos,f,g;for(f=0;f<e.length;f++)if(e[f].id===
c&&e[f].subLayerIds)for(g=0;g<e[f].subLayerIds.length;g++){var k=e[f].subLayerIds[g];-1===h.indexOf(d,k)&&(d.push(k),b(k,d))}}a.layer.layerInfos&&h.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,e=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var f=a.legendResponse.layers[d];if(b.id==f.layerId){var g,h;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?
(0==f.minScale&&a.tileInfo&&(g=a.tileInfo.lods[0].scale),0==f.maxScale&&a.tileInfo&&(h=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(g=Math.min(a.minScale,f.minScale)||a.minScale||f.minScale,h=Math.max(a.maxScale,f.maxScale));if(0<g&&g<c||h>c)e=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)e=!1;return e},_getServiceTitle:function(a){var b=a._titleForLegend;b||(b=a.url,a.url?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),
b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+
a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],F.isDefined(a)&&(b+=" ("+a+")"));return z.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,d=b.maxScale;if(F.isDefined(b.parentLayerId)){var e=a.layerInfos,f=b.parentLayerId,g;for(g=e.length-1;0<=g;g--)if(e[g].id==f)if(0==c&&0<e[g].minScale?c=e[g].minScale:0<c&&0==e[g].minScale||0<c&&0<e[g].minScale&&(c=Math.min(c,e[g].minScale)),d=Math.max(d||0,e[g].maxScale||0),-1<e[g].parentLayerId)f=e[g].parentLayerId;
else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===
a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1},isHostedTileService:function(a){var b=/(https?:)?\/\/services.*\.arcgis\.com/i;return"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass&&b.test(a.url)?!0:!1},getField:function(a,b,c){if(a.getField)return a.getField(b);if(c&&c.fields){var d;h.forEach(c.fields,function(a){a.name===b&&(d=a)});return d}return null}});l.mixin(D,{ALIGN_LEFT:0,ALIGN_RIGHT:1});
k("extend-esri")&&l.setObject("dijit.Legend",D,x);return D})},"dojo/debounce":function(){define([],function(){return function(n,f){var l;return function(){l&&clearTimeout(l);var h=this,d=arguments;l=setTimeout(function(){n.apply(h,d)},f)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(n,f,l,h){var d=function(d,a){return d-a},m={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(d){var a=String(d),f=a.match(m._reNumber);d={integer:0,
fractional:0};f&&f[1]?(d.integer=f[1].split("").length,d.fractional=f[3]?f[3].split("").length:0):-1<a.toLowerCase().indexOf("e")&&(f=a.split("e"),a=f[0],f=f[1],a&&f&&(a=Number(a),f=Number(f),(d=0<f)||(f=Math.abs(f)),a=m.getDigits(a),d?(a.integer+=f,a.fractional=f>a.fractional?0:a.fractional-f):(a.fractional+=f,a.integer=f>a.integer?1:a.integer-f),d=a));return d},getFixedNumbers:function(d,a){var f,c;f=Number(d.toFixed(a));f<d?c=f+1/Math.pow(10,a):(c=f,f-=1/Math.pow(10,a));f=Number(f.toFixed(a));
c=Number(c.toFixed(a));return[f,c]},getPctChange:function(d,a,f,c){var h={prev:null,next:null},g;null!=f&&(g=d-f,h.prev=Math.floor(Math.abs(100*(a-f-g)/g)));null!=c&&(g=c-d,h.next=Math.floor(Math.abs(100*(c-a-g)/g)));return h},round:function(f,a){var h=f.slice(0),c,l,g,p,e,b,q,t,n,w=a&&null!=a.tolerance?a.tolerance:2,y=a&&a.indexes,z=a&&null!=a.strictBounds?a.strictBounds:!1;if(y)y.sort(d);else for(y=[],b=0;b<h.length;b++)y.push(b);for(b=0;b<y.length;b++)if(n=y[b],c=h[n],l=0===n?null:h[n-1],g=n===
h.length-1?null:h[n+1],p=m.getDigits(c),p=p.fractional){q=0;for(t=!1;q<=p&&!t;)e=m.getFixedNumbers(c,q),e=z&&0===b?e[1]:e[0],t=m.hasMinimalChange(c,e,l,g,w),q++;t&&(h[n]=e)}return h},hasMinimalChange:function(d,a,f,c,h){d=m.getPctChange(d,a,f,c);a=null==d.prev||d.prev<=h;f=null==d.next||d.next<=h;return a&&f||d.prev+d.next<=2*h},_reAllZeros:new RegExp("\\"+l.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(d,a){a=a||{places:20,round:-1};var h=f.format(d,a);h&&(h=h.replace(m._reSomeZeros,
"$1").replace(m._reAllZeros,""));return h}};n("extend-esri")&&(h.numberUtils=m);return m})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!../nls/jsapi dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(n,f,l,h,d,m,q,a,k){function c(a){return a&&f.map(a,function(a){return new q(a)})}function r(a,b,c){var d="";0===b?d=p.lt+" ":b===c&&(d=p.gt+" ");return d+a}var g={},p={lte:"\x3c\x3d",gte:"\x3e\x3d",
lt:"\x3c",gt:"\x3e",pct:"%"},e={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},b={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},
year:{selector:"date",dateOptions:{selector:"year"}}},u={formatLength:"short",fullYear:!0},t={formatLength:"short"};n.mixin(g,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(a,b){var c,d=[];null==a||a instanceof Date||(a=new Date(a));b=b||{};b=n.mixin({},b);var e=b.selector?b.selector.toLowerCase():null;c=!e||-1<e.indexOf("time");e=!e||-1<e.indexOf("date");c&&(b.timeOptions=b.timeOptions||t,b.timeOptions&&(b.timeOptions=n.mixin({},b.timeOptions),
b.timeOptions.selector=b.timeOptions.selector||"time",d.push(b.timeOptions)));e&&(b.dateOptions=b.dateOptions||u,b.dateOptions&&(b.dateOptions=n.mixin({},b.dateOptions),b.dateOptions.selector=b.dateOptions.selector||"date",d.push(b.dateOptions)));d&&d.length?(d=f.map(d,function(b){return h.format(a,b)}),c=1==d.length?d[0]:k["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,b){return d[b]})):c=h.format(a);return c},createColorStops:function(a){var b=a.values,c=a.colors,d=a.labelIndexes,
e=a.isDate,h=a.dateFormatOptions;a=[];return a=f.map(b,function(a,k){var p=null;if(!d||-1<f.indexOf(d,k)){var l;(l=e?g.formatDate(a,h):m.format(a))&&(p=r(l,k,b.length-1))}return{value:a,color:c[k],label:p}})},updateColorStops:function(a){var b=a.stops,c=a.changes,d=a.isDate,e=a.dateFormatOptions,h=[],k,p=f.map(b,function(a){return a.value});f.forEach(c,function(a){h.push(a.index);p[a.index]=a.value});k=m.round(p,{indexes:h});f.forEach(b,function(a,c){a.value=p[c];if(null!=a.label){var f,h=null;(f=
d?g.formatDate(k[c],e):m.format(k[c]))&&(h=r(f,c,b.length-1));a.label=h}})},createClassBreakLabel:function(b){var c=b.minValue,d=b.maxValue,e=b.isFirstBreak?"":p.gt+" ";b="percent-of-total"===b.normalizationType?p.pct:"";c=null==c?"":m.format(c);d=null==d?"":m.format(d);return e+c+b+" "+a.smartMapping.minToMax+" "+d+b},setLabelsForClassBreaks:function(a){var b=a.classBreaks,c=a.classificationMethod,d=a.normalizationType,e=[];b&&b.length&&("standard-deviation"===c?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):
a.round?(e.push(b[0].minValue),f.forEach(b,function(a){e.push(a.maxValue)}),e=m.round(e),f.forEach(b,function(a,b){a.label=g.createClassBreakLabel({minValue:0===b?e[0]:e[b],maxValue:e[b+1],isFirstBreak:0===b,normalizationType:d})})):f.forEach(b,function(a,b){a.label=g.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===b,normalizationType:d})}))},updateClassBreak:function(a){var b=a.classBreaks,c=a.normalizationType,d=a.change,e=d.index,d=d.value,f=-1,h=-1,k=b.length;"standard-deviation"===
a.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===e?f=e:e===k?h=e-1:(h=e-1,f=e),-1<f&&f<k&&(a=b[f],a.minValue=d,a.label=g.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===f,normalizationType:c})),-1<h&&h<k&&(a=b[h],a.maxValue=d,a.label=g.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===h,normalizationType:c})))},calculateDateFormatInterval:function(a){var b,
c,d=a.length,g,h,k,m,p,l,q=Infinity,r;a=f.map(a,function(a){return new Date(a)});for(b=0;b<d-1;b++){g=a[b];k=[];p=Infinity;l="";for(c=b+1;c<d;c++)h=a[c],h=g.getFullYear()!==h.getFullYear()&&"year"||g.getMonth()!==h.getMonth()&&"month"||g.getDate()!==h.getDate()&&"day"||g.getHours()!==h.getHours()&&"hour"||g.getMinutes()!==h.getMinutes()&&"minute"||g.getSeconds()!==h.getSeconds()&&"second"||"millisecond",m=e[h],m<p&&(p=m,l=h),k.push(h);p<q&&(q=p,r=l)}return r},createUniqueValueLabel:function(a){var c=
a.value,d=a.fieldInfo,e=a.domain;a=a.dateFormatInterval;var f=String(c);(e=e&&e.codedValues?e.getName(c):null)?f=e:"number"===typeof c&&(f=d&&"esriFieldTypeDate"===d.type?g.formatDate(c,a&&b[a]):m.format(c));return f},cloneColorInfo:function(a){var b;a&&(b=n.mixin({},a),b.colors=c(b.colors),b.stops=b.stops&&f.map(b.stops,function(a){a=n.mixin({},a);a.color&&(a.color=new q(a.color));return a}),b.legendOptions&&(b.legendOptions=n.mixin({},b.legendOptions)));return b},cloneOpacityInfo:function(a){var b;
if(a){b=n.mixin({},a);if(a=b.opacityValues)b.opacityValues=a.slice(0);if(a=b.stops)b.stops=f.map(a,function(a){return n.mixin({},a)});if(a=b.legendOptions)b.legendOptions=n.mixin({},a)}return b},cloneSizeInfo:function(a){var b;a&&(b=n.mixin({},a),b.stops&&(b.stops=f.map(b.stops,function(a){return n.mixin({},a)})),(a=b.minSize)&&"object"===typeof a&&(b.minSize=g.cloneSizeInfo(a)),(a=b.maxSize)&&"object"===typeof a&&(b.maxSize=g.cloneSizeInfo(a)),a=b.legendOptions)&&(b.legendOptions=n.mixin({},a),a=
a.customValues)&&(b.legendOptions.customValues=a.slice(0));return b}});l("extend-esri")&&n.setObject("renderer.utils",g,d);return g})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define(["dojo/_base/declare","dojo/_base/array","esri/graphicsUtils","./LayerInfo","./LayerInfoFactory"],function(n,f,l,h,d){return n(h,{constructor:function(){},getExtent:function(){var d=this.layerObject.items;if(0===d.length)return null;d=l.graphicsExtent(d);return this._convertGeometryToMapSpatialRef(d)},_resetLayerObjectVisiblity:function(d){var h=
d?d[this.id]:null;h&&(f.forEach(this.newSubLayers,function(a){var f=d?d[a.id]:null;f&&a.layerObject.setVisibility(f.visible)},this),this._setTopLayerVisible(h.visible))},initVisible:function(){var d=!1,f;for(f=0;f<this.newSubLayers.length;f++)d=d||this.newSubLayers[f].layerObject.visible;d&&(this._visible=!0)},_setTopLayerVisible:function(d){this._visible=d?!0:!1;f.forEach(this.newSubLayers,function(d){d.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var h=
[],l=this.layerObject.getFeatureLayers();f.forEach(l,function(a){a=d.getInstance().create({layerObject:a,title:a.label||a.title||a.name||a.id||" ",id:a.id||" ",collection:{layerInfo:this},selfType:"geo_rss",parentLayerInfo:this});h.push(a);a.init()},this);return h},_obtainLayerIndexesInMap:function(){var d=[],f,a;for(a=0;a<this.newSubLayers.length;a++)(f=this._getLayerIndexesInMapByLayerId(this.newSubLayers[a].layerObject.id))&&d.push(f);return d},moveLeftOfIndex:function(d){var f;for(f=this.newSubLayers.length-
1;0<=f;f--)this.map.reorderLayer(this.newSubLayers[f].layerObject,d)},moveRightOfIndex:function(d){var f;for(f=0;f<this.newSubLayers.length;f++)this.map.reorderLayer(this.newSubLayers[f].layerObject,d)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS ./LayerInfoFactory esri/layers/FeatureLayer esri/lang".split(" "),function(n,f,l,h,d,m,q,a,k,c,
r,g){return n(a,{constructor:function(a,c){},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.extent)},_resetLayerObjectVisiblity:function(a){var c=a?a[this.id]:null;if(a){c&&this.layerObject.setVisibility(c.visible);var b=[],d=!1;f.forEach(this.layerObject.layerInfos,function(c){var e=this.id+"_"+c.name;g.isDefined(a[e])&&(d=!0,a[e].visible&&b.push(c.name))},this);if(0<b.length||d)this.layerObject.setVisibleLayers(b),this.traversal(function(a){a.initVisible()})}},
initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(a){this.layerObject.setVisibility(a);this._visible=a},setSubLayerVisible:function(a){var c=[],b,c=l.clone(this.originOperLayer.layerObject.visibleLayers),d;for(d in a)if(a.hasOwnProperty(d)&&"function"!==typeof a[d]){var g=a[d],h=d.toString();b=f.indexOf(c,h);g?0>b&&c.push(h):0<=b&&c.splice(b,1)}this.originOperLayer.layerObject.setVisibleLayers(c)},obtainNewSubLayers:function(){var a=[];f.forEach(this.layerObject.layerInfos,
function(d,b){var e;e=c.getInstance().create({layerObject:this.layerObject,title:d.label||d.title||d.name||" ",id:this.id+"_"+(d.name||" "),wms:{layerInfo:this,subId:d.name,wmsLayerInfo:d},selfType:"wms",parentLayerInfo:this});a.push(e);e.init()},this);return a},_bindEvent:function(){this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&q.after(this.layerObject,"setVisibleLayers",l.hitch(this,this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(){var a=[];this.traversal(function(c){c.initVisible();
a.push(c)});h.publish("layerInfos/layerInfo/visibleChanged",a);this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),function(n,f,l,h,d,m,q){return n(q,{constructor:function(a,d){this.layerObject=a.layerObject},getExtent:function(){},_resetLayerObjectVisiblity:function(){},initVisible:function(){var a=[],a=!1,a=l.clone(this.originOperLayer.layerObject.visibleLayers);
this._visible=a=0<=f.indexOf(a,this.originOperLayer.wms.subId)?!0:!1},_setTopLayerVisible:function(a){var d=this.originOperLayer.wms;this._visible=a?!0:!1;var c={};c[d.subId]=a;d.layerInfo.setSubLayerVisible(c)},drawLegends:function(a){this._initLegendsNode(a)},_initLegendsNode:function(a){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var f=d.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});m(f,"load",function(){d.empty(a);var c=d.create("div",{"class":"legend-div"},
a);h.place(f,c)})}else d.empty(a)},obtainNewSubLayers:function(){return[]},getOpacity:function(){},setOpacity:function(a){},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.originOperLayer.wms.layerInfo.getScaleRange()}})})},"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo ./LayerInfoFactory".split(" "),function(n,f,l,h,d,m,q){return n(m,{constructor:function(a,
d,c){this.noLegend=c},getExtent:function(){},initVisible:function(){var a=!1,d=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<d.layerInfo.subLayerVisible[d.subId]&&(a=!0);this._visible=a},_setTopLayerVisible:function(a){var d;if(this.originOperLayer.mapService&&(d=this.originOperLayer.mapService,0<this.originOperLayer.subLayers.length)){a?d.layerInfo.subLayerVisible[d.subId]++:d.layerInfo.subLayerVisible[d.subId]--;this._visible=a;var c={};this.traversal(function(a){0===a.getSubLayers().length&&
(c[a.originOperLayer.mapService.subId]=a.isVisbleOrInvisilbe())});d.layerInfo.setSubLayerVisible(c)}},setLayerVisiblefromTopLayer:function(){},_visibleChanged:function(a){},_sevVisible:function(a){this.visible=a},obtainNewSubLayers:function(){var a=[];f.forEach(this.originOperLayer.subLayers,function(d){d.parentLayerInfo=this;d=q.getInstance().create(d);a.push(d);d.init()},this);return a},getOpacity:function(){},setOpacity:function(a){},getLayerObject:function(){var a=new h;this.layerObject.empty?
d({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(l.hitch(this,function(d){var c=this.layerObject.url;this.layerObject=d;this.layerObject.url=c;this.layerObject.id=this.id;a.resolve(this.layerObject)}),function(d){a.reject(d)}):a.resolve(this.layerObject);return a},getLayerType:function(){var a=new h;a.resolve("GroupLayer");return a},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},
getScaleRange:function(){var a=this.originOperLayer.mapService;return(a=a.layerInfo._getJsapiLayerInfoById(a.subId))&&0<=a.minScale&&0<=a.maxScale?{minScale:a.minScale,maxScale:a.maxScale}:{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(n,f){return n(f,{constructor:function(f,h){},initVisible:function(){var f=!1,h=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<h.layerInfo.subLayerVisible[h.subId]&&
(f=!0);this._visible=f},_setTopLayerVisible:function(f){var h;this.originOperLayer.mapService&&(h=this.originOperLayer.mapService,f?h.layerInfo.subLayerVisible[h.subId]++:h.layerInfo.subLayerVisible[h.subId]--,this._visible=f,this.visbleOrInvisilbe())},visbleOrInvisilbe:function(){var f=this.originOperLayer.mapService,h={};h[f.subId]=this.isVisbleOrInvisilbe();f.layerInfo.setSubLayerVisible(h)},isVisbleOrInvisilbe:function(){for(var f=this.originOperLayer.mapService,h=-1,d=f.subId,m=0;;){h++;m+=f.layerInfo.subLayerVisible[d];
d=f.layerInfo._getJsapiLayerInfoById(d);if(-1===d.parentLayerId)return m>h?!0:!1;d=d.parentLayerId}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/dom-construct ./LayerInfoForDefault esri/layers/FeatureLayer esri/layers/RasterLayer esri/layers/StreamLayer esri/layers/ArcGISImageServiceLayer esri/layers/ArcGISImageServiceVectorLayer".split(" "),function(n,f,l,h,d,m,q,a,k,c,r){return n(m,{_legendsNode:null,
_layerObjectLoadingIndicator:null,constructor:function(){this._layerObjectLoadingIndicator={loadingFlag:!1,loadedDef:new h}},_resetLayerObjectVisiblity:function(){},_loadLegends:function(a){var c=new h;this.originOperLayer.mapService.layerInfo.getLegendInfo(a).then(l.hitch(this,function(a){c.resolve(a)}));return c},drawLegends:function(a,c){this._loadLegends(c).then(l.hitch(this,function(c){this._initLegendsNode(c,a)}))},_initLegendsNode:function(a,c){var e=this.originOperLayer.mapService;if(a){d.empty(c);
for(var b=null,g=0;g<a.length;g++)if(a[g].layerId===e.subId){b=a[g];break}if(b){var h=d.create("table",{"class":"legend-table",style:"font-size: 12px"},c);f.forEach(b.legend,function(a){if("\x3call other values\x3e"!==a.label){var b=d.create("tr",{"class":"legend-tr",style:"border: 1px solid"},h),c=d.create("td",{"class":"legend-symbol-td",style:""},b),e=null,e=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;d.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",
src:e},c);d.create("td",{"class":"legend-label-td",innerHTML:a.label||" ",style:"padding-left: 5px"},b)}},this)}}},_initControlPopup:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,c=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:a.infoTemplates&&a.infoTemplates[c]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,c=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&
a.infoTemplates&&delete a.infoTemplates[c]},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},getLayerObject:function(){var d=new h,f,e;this.getLayerType().then(l.hitch(this,function(b){this.layerObject.empty?("RasterLayer"===b?this.layerObject=new a(this.layerObject.url):"FeatureLayer"===b?this.layerObject=new q(this.layerObject.url,this._getLayerOptionsForCreateLayerObject()):"StreamLayer"===
b?this.layerObject=new k(this.layerObject.url):"ArcGISImageServiceLayer"===b?this.layerObject=new c(this.layerObject.url):"ArcGISImageServiceVectorLayer"===b&&(this.layerObject=new r(this.layerObject.url)),this.layerObject.empty?d.resolve():(this._layerObjectLoadingIndicator.loadingFlag=!0,f=this.layerObject.on("load",l.hitch(this,function(){this.layerObject.empty||!this.layerObject.name||l.getObject("_wabProperties.originalLayerName",!1,this.layerObject)||(l.setObject("_wabProperties.originalLayerName",
this.layerObject.name,this.layerObject),this.layerObject.name=this.title);this.layerObject.id=this.id;d.resolve(this.layerObject);this._layerObjectLoadingIndicator.loadedDef.resolve(this.layerObject);f.remove&&f.remove()})),e=this.layerObject.on("error",l.hitch(this,function(){d.resolve(null);this._layerObjectLoadingIndicator.loadedDef.resolve(null);e.remove&&e.remove()})))):this._layerObjectLoadingIndicator.loadingFlag?this._layerObjectLoadingIndicator.loadedDef.then(l.hitch(this,function(a){d.resolve(a)})):
d.resolve(this.layerObject)}),l.hitch(this,function(){d.resolve(null)}));return d},getPopupInfo:function(){var a=null,c=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(c)for(var d=0;d<c.length;d++)if(c[d].id===this.originOperLayer.mapService.subId){a=c[d].popupInfo;break}return a},getFilterOfWebmap:function(){var a=null,c=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(c)for(var d=0;d<c.length;d++)if(c[d].id===this.originOperLayer.mapService.subId){a=c[d].layerDefinition?
c[d].layerDefinition.definitionExpression:null;break}return a},getFilter:function(){var a=this.originOperLayer.mapService;return a.layerInfo.layerObject&&a.layerInfo.layerObject.layerDefinitions?a.layerInfo.layerObject.layerDefinitions[a.subId]:null},setFilter:function(a){var c,d=this.originOperLayer.mapService;d.layerInfo.layerObject&&d.layerInfo.layerObject.setLayerDefinitions&&(c=d.layerInfo.layerObject.layerDefinitions?f.map(d.layerInfo.layerObject.layerDefinitions,function(a){return a}):[],c[d.subId]=
a,d.layerInfo.layerObject.setLayerDefinitions(c))},getLayerType:function(){var a=new h,c=this.originOperLayer.mapService;c.layerInfo._getSublayerDefinition(c.subId).then(l.hitch(this,function(c){c?a.resolve(c.type.replace(/\ /g,"")):a.resolve(null)}),function(){a.resolve(null)});return a},getSupportTableInfo:function(){var a=new h,c={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(l.hitch(this,function(d){c.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&
(c.isSupportedLayer=!0);d=this.originOperLayer.mapService;d.layerInfo._getSublayerDefinition(d.subId).then(l.hitch(this,function(b){b&&0<=b.capabilities.indexOf("Data")&&(c.isSupportQuery=!0);a.resolve(c)}),function(){a.resolve(c)})}),function(){a.resolve(c)});return a},enablePopup:function(){var a=this.originOperLayer.mapService.layerInfo,c=a.layerObject,d=this.originOperLayer.mapService.subId;return this.loadInfoTemplate().then(l.hitch(this,function(){return a.controlPopupInfo.infoTemplates&&a.controlPopupInfo.infoTemplates[d]?
(this.controlPopupInfo.enablePopup=!0,c.infoTemplates||(c.infoTemplates={}),c.infoTemplates[d]=a.controlPopupInfo.infoTemplates[d],!0):!1}))},disablePopup:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,c=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!1;a.infoTemplates&&delete a.infoTemplates[c]},loadInfoTemplate:function(){var a=new h,c=this.originOperLayer.mapService.layerInfo,d=this.originOperLayer.mapService.subId;c.controlPopupInfo.infoTemplates&&
c.controlPopupInfo.infoTemplates[d]&&c.controlPopupInfo.infoTemplates[d].infoTemplate?a.resolve(c.controlPopupInfo.infoTemplates[d].infoTemplate):(c.controlPopupInfo.infoTemplates||(c.controlPopupInfo.infoTemplates={}),this.getLayerObject().then(l.hitch(this,function(b){b=this._getDefaultPopupTemplate(b);c.controlPopupInfo.infoTemplates[d]={infoTemplate:b,layerUrl:null};a.resolve(b)}),l.hitch(this,function(){a.resolve(null)})));return a},getInfoTemplate:function(){var a=this.originOperLayer.mapService.layerInfo,
c=this.originOperLayer.mapService.subId;return a.controlPopupInfo.infoTemplates&&a.controlPopupInfo.infoTemplates[c]&&a.controlPopupInfo.infoTemplates[c].infoTemplate?a.controlPopupInfo.infoTemplates[c].infoTemplate:null},getScaleRange:function(){var a=this.originOperLayer.mapService;return(a=a.layerInfo._getJsapiLayerInfoById(a.subId))&&0<=a.minScale&&0<=a.maxScale?{minScale:a.minScale,maxScale:a.maxScale}:{minScale:0,maxScale:0}},_onVisibilityChanged:function(){}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../lang ../domUtils ./BaseRasterLayer ./ImageServiceLayerMixin ./pixelFilters/StretchFilter ../SpatialReference ../geometry/Point".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b){return n([r,g],{declaredClass:"esri.layers.RasterLayer",constructor:function(a,b){this.pixelData=null;null!==this.format&&void 0!==this.format||this.setImageFormat("LERC",!0)},_setDefaultFilter:function(){if(this.loaded&&this.drawType&&!this._isVectorData()&&(!this.pixelFilter||this._isDefaultPixelFilter))if("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))this._isDefaultPixelFilter&&(this.pixelFilter=
null,this._isDefaultPixelFilter=!1);else{var a,b;if(this.minValues&&this.maxValues&&this.stdvValues&&this.meanValues){a=[];for(b=0;b<this.minValues.length;b++)a.push([this.minValues[b],this.maxValues[b],this.meanValues[b],this.stdvValues[b]]);this.bandCount!==a.length&&(a=null)}b=0;var c=!1;"U8"===this.pixelType?(b=5,c=a?!1:!0):a?(b=5,c=!1):(b=6,c=!0);this.renderingRule&&(b=5,c=!0);this.pixelFilter=(new p({stretchType:b,min:0,max:255,dra:c,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,
statistics:a,numberOfStandardDeviations:2.5})).filter;this._isDefaultPixelFilter=!0}}})})},"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g,p,e){var b=c.defaults.map.zoomDuration;return n([e],{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,
opacity:1,constructor:function(a,b){this.drawMode=b&&void 0!==b.drawMode?b.drawMode:!0;this.drawType=b&&b.drawType?b.drawType:"2d";this.pixelData=null;this._initialize(a,b)},setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){this.opacity!==a&&(this.opacity=a,this.onOpacityChange(a))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>d("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},
clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var a=this._map.__visibleDelta;this._left=this._tdx=a.x;this._top=this._tdy=a.y;q.set(this._div,k._css.names.transform,k._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(f.hitch(this,function(){this._extentChangeHandler(this._map.extent,
null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var a=this._map.extent;return new p((a.xmax-a.xmin)/this._map.width,(a.ymax-a.ymin)/this._map.height,a.spatialReference)},setPixelFilter:function(a,b){this.pixelFilter=a;b||this.redraw()},_toggleTime:function(){},_setMap:function(a,b){this.inherited(arguments);
this._dragOrigin={x:0,y:0};var c=this._div=m.create("div",null,b),d={width:a.width+"px",height:a.height+"px",position:"absolute"};"css-transforms"===a.navigationMode?(d[k._css.names.transform]=k._css.translate(a.__visibleDelta.x,a.__visibleDelta.y),this._left=a.__visibleDelta.x,this._top=a.__visibleDelta.y):this._left=this._top=0;q.set(c,d);this._canvas=m.create("canvas",{id:"canvas",width:a.width+"px",height:a.height+"px",style:"position: absolute;"},c);r.isDefined(this.opacity)&&q.set(c,"opacity",
this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(l.connect(a,"onPan",this,this._panHandler));this._connects.push(l.connect(a,"onPanEnd",this,this._panEndHandler));"css-transforms"===a.navigationMode?this._connects.push(l.connect(a,"onScale",this,this._onScaleHandler)):(this._connects.push(l.connect(a,
"onZoom",this,this._onZoomHandler)),this._connects.push(l.connect(a,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(l.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(l.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(l.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(l.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};
this.evaluateSuspension();if(this.suspended&&!a.loaded)var e=l.connect(a,"onLoad",this,function(){l.disconnect(e);e=null;this.evaluateSuspension()});return c},_unsetMap:function(a,b){h.forEach(this._connects,l.disconnect,this);var c=this._div;c&&(b.removeChild(c),m.destroy(c));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(a){"CancelError"!==
a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var a=this._useBrowserDecoding();!a&&this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,q.set(this._div,k._css.names.transform,k._css.translate(this._left,this._top)),q.set(this._canvas,k._css.names.transform,k._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});if(this._canDraw&&
this.drawMode)if(a)this._fireUpdateEnd();else if(this.drawMode)if(this.pixelData&&this.pixelData.pixelBlock){var a=this.pixelData.pixelBlock,b=this._context,c=b.createImageData(a.width,a.height);c.data.set(a.getAsRGBA());var d=this.pixelData.extent,e=this._map.extent,f=this.getCurrentResolution(),g=0,h=0;Math.abs(d.xmin-e.xmin)>f.x&&(g=Math.round((d.xmin-e.xmin)/f.x));Math.abs(e.ymax-d.ymax)>f.y&&(h=Math.round((e.ymax-d.ymax)/f.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=
this._left,this._tdy=this._top,this._multiply=null,q.set(this._div,k._css.names.transform,k._css.translate(this._left,this._top)),q.set(this._canvas,k._css.names.transform,k._css.translate(-this._left,-this._top))):(q.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),q.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};b.putImageData(c,g,h,0,0,a.width,a.height);this._fireUpdateEnd()}else this.clear()},
_panHandler:function(a,b){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+b.x,this._top=this._map.__visibleDelta.y+b.y,q.set(this._div,k._css.names.transform,k._css.translate(this._left,this._top))):q.set(this._div,{left:this._startRect.left+b.x+"px",top:this._startRect.top+b.y+"px"})},_panEndHandler:function(a,b){b&&(this._startRect.left+=b.x,this._startRect.top+=b.y)},_onScaleHandler:function(c,d){var e={},f=k._css.names;q.set(this._canvas,f.transition,d?"none":
f.transformName+" "+b+"ms ease");this._matrix=c;c=this._multiply?a.multiply(c,this._multiply):c;if(this._tdx||this._tdy)c=a.multiply(c,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});e[f.transform]=k._css.matrix(c);q.set(this._canvas,e)},_onZoomHandler:function(a,b,c){var d=this._startRect;a=d.width*b;b*=d.height;var e=d.left-(a-d.width)*(c.x-d.left)/d.width;c=d.top-(b-d.height)*(c.y-d.top)/d.height;q.set(this._canvas,{left:e+"px",top:c+"px",width:a+"px",height:b+"px"});this._endRect={left:e,top:c,
width:a,height:b}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,b,c){q.set(this._div,{width:b+"px",height:c+"px"});q.set(this._canvas,{width:b+"px",height:c+"px"});this._startRect.width=this._canvas.width=b;this._startRect.height=this._canvas.height=c},_extentChangeHandler:function(b,c,d,e){this.suspended||c&&0===c.x&&0===c.y&&!d||("css-transforms"===this._map.navigationMode&&(c&&(this._dragOrigin.x+=c.x,this._dragOrigin.y+=c.y),d||(this._left=
this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,q.set(this._div,k._css.names.transform,k._css.translate(this._left,this._top))),d&&(q.set(this._canvas,k._css.names.transition,"none"),this._multiply=this._multiply?a.multiply(this._matrix,this._multiply):this._matrix)),this._fireUpdateStart(),b=this._map,this._requestData(b.extent,b.width,b.height))},_visibilityChangeHandler:function(a){a?g.show(this._div):g.hide(this._div)},_opacityChangeHandler:function(a){q.set(this._div,"opacity",
a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z,x,A,B,F,E,C,G,H,I){n=n(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0,"spatial-reference-change":!0},constructor:function(a,b){this.useMapTime=b&&b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0},_initialize:function(a,c){this._url=b.urlToObject(a);this.raster=new x(this._url.path);this.infoTemplate=c&&
c.infoTemplate;var d=c&&c.imageServiceParameters;this.format=d&&d.format;this.compressionTolerance=d&&d.compressionTolerance?d.compressionTolerance:.01;this.interpolation=d?d.interpolation:null;this.compressionQuality=d?d.compressionQuality:null;this.bandIds=d?d.bandIds:null;this.mosaicRule=d?d.mosaicRule:null;this.renderingRule=d?d.renderingRule:null;this.useMapDimensionValue=c&&c.hasOwnProperty("useMapDimensionValue")?!!c.useMapDimensionValue:!0;this.activeMapDimensions=c&&c.activeMapDimensions;
this._params=f.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},d?d.toJson():{});this.pixelFilter=c&&c.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=f.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=f.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=f.hitch(this,
this._initLayer);this._queryVisibleRastersHandler=f.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=c&&c.loadCallback;(d=c&&c.resourceInfo)?this._initLayer(d):p({url:this._url.path,content:f.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},
disableClientCaching:!1,_initLayer:function(a,b){if(null!==a&&void 0!==a){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var c=this.minScale,d=this.maxScale;f.mixin(this,a);this.minScale=c;this.maxScale=d;this.initialExtent=this.fullExtent=this.extent=new u(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var e=this.minValues,h=this.maxValues,k=this.meanValues,
m=this.stdvValues,l=this.bands=[],c=0,d=this.bandCount;c<d;c++)l[c]={min:e[c],max:h[c],mean:k[c],stddev:m[c]};this.timeInfo=(c=this.timeInfo)&&c.timeExtent?new E(c):null;d=this.fields=[];if(e=a.fields)for(c=0;c<e.length;c++)d.push(new C(e[c]));this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);g.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);g.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);c={};
a.defaultMosaicMethod?(c.method=a.defaultMosaicMethod,c.operation=a.mosaicOperator,c.sortField=a.sortField,c.sortValue=a.sortValue):c.method=w.METHOD_NONE;this.defaultMosaicRule=new w(c);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType&&!this.hasRasterAttributeTable;this._setDefaultRenderingRule(!0);this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&
this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(f.hitch(this,function(a){a&&a.features&&0<a.features.length&&(this._rasterAttributeTableFeatures=f.clone(a.features));a&&a.fields&&0<a.fields.length&&(this._rasterAttributeTableFields=f.clone(a.fields))}));this._isVectorData()&&!g.isDefined(this.pixelFilter)&&(this.vectorFieldPixelFilter=new B,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===this.serviceDataType,
this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(f.hitch(this,this._setFlowRepresentation)));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(c=this._loadCallback)delete this._loadCallback,c(this)}},getKeyProperties:function(){var a=this._url.path+"/keyProperties",b=new l(e._dfdCanceller);10<this.version?(b._pendingDfd=p({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},
function(a){b.errback(a)})):(a=Error("Layer does not have key properties"),a.log=m.isDebug,b.errback(a));return b},getRasterAttributeTable:function(a){var b=this._url.path+"/rasterAttributeTable",c=new l(e._dfdCanceller),f={f:"json"},g=this.hasRasterAttributeTable;a&&a.renderingRule&&(f.renderingRule=d.toJson(a.renderingRule.toJson()),g=!0);10<this.version&&g?(c._pendingDfd=p({url:b,content:f,handleAs:"json",callbackParamName:"callback"}),c._pendingDfd.then(function(a){c.callback(a)},function(a){c.errback(a)})):
(a=Error("Layer does not support raster attribute table"),a.log=m.isDebug,c.errback(a));return c},_getRenderingRuleAttributeTable:function(a){var b=new l(e._dfdCanceller);if(!a||!a.renderingRule)return b.errback(Error("Rendering rule is not specified")),b;a=a.renderingRule;var c=a.functionName;this._renderingRuleAttributeTable&&c&&this._renderingRuleAttributeTable.hasOwnProperty(c)?b.resolve(this._renderingRuleAttributeTable[c]):b=this.getRasterAttributeTable({renderingRule:a}).then(f.hitch(this,
function(a){var b;a&&a.features&&a.features.length&&a.fields&&a.fields.length&&(b={features:f.clone(a.features),fields:f.clone(a.fields)},c&&(this._renderingRuleAttributeTable[c]=b));return b}));return b},_getRasterAttributeTableFeatures:function(){var a=new l;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(f.hitch(this,
function(a){a&&a.features&&0<a.features.length&&(this._rasterAttributeTableFeatures=f.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},_getRenderingRuleAttributeTableFeatures:function(a){a=a&&a.renderingRule;return a?this._getRenderingRuleAttributeTable({renderingRule:a}).then(function(a){return a&&a.features}):(a=new l,a.errback(Error("Rendering rule is not specified")),a)},getCustomRasterFields:function(a){var b=a?a.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;
a=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var c={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:a},d={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:a},e={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},k=this.fields?f.clone(this.fields):[];a=k.length;
k[a]=d;10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRasterFunctionInfoAvailable("none"))&&(a++,k[a]=e);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a++,k[a]=c;!g.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(c={name:this._rasterFieldPrefix+
"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},d={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},a++,k[a]=c,a++,k[a]=d);a=this._rasterAttributeTableFields;(c=this.renderingRule&&this.renderingRule.functionName)&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(c)&&(a=this._renderingRuleAttributeTable[c].fields);a&&0<a.length&&(a=h.filter(a,function(a){return"esriFieldTypeOID"!==
a.type&&"value"!==a.name.toLowerCase()}),a=h.map(a,function(a){var c=f.clone(a);c.name=b+a.name;return c}),k=k.concat(a));var m=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&h.forEach(this.rasterFunctionInfos,function(a){a&&a.name&&"none"!==a.name.toLowerCase()&&(a={name:m+a.name.replace(/ /gi,"_"),alias:a.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},k.push(a))});return k},_prepareGetImageParameters:function(a,b,c,e){e=g.isDefined(e)?
e:this._params;var h=a.spatialReference.wkid||d.toJson(a.spatialReference.toJson(!1));delete e._ts;f.mixin(e,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:h,bboxSR:h,size:b+","+c},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete e.compressionTolerance;e.format&&"LERC"===e.format.toUpperCase()&&(e.compressionTolerance=this.compressionTolerance);e.token=this._getToken()},getImageUrl:function(a,c,d,e,h){h=g.isDefined(h)?h:this._params;this._prepareGetImageParameters(a,c,d,h);a=
f.clone(h);this._cleanupRequestParams(a);c=this._url.path+"/exportImage?";d=b.addProxy(c+k.objectToQuery(f.mixin(a,{f:"image"})));var m=a.token;d.length>r.defaults.io.postLength||this.useMapImage?this._jsonRequest=p({url:c,content:f.mixin(a,{f:"json"}),callbackParamName:"callback",load:function(a,c){var d=a.href;m&&(d+=-1===d.indexOf("?")?"?token\x3d"+m:"\x26token\x3d"+m);e(b.addProxy(d))},error:this._errorHandler}):e(d)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,
b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setCompressionTolerance:function(a,b){this.compressionTolerance=a;b||this.refresh(!0)},setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;
a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=d.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=a?d.toJson(a.toJson()):null;this._useRenderingRuleAttributeTable&&this._getRenderingRuleAttributeTable({renderingRule:a});
if(c)this.onRenderingChange();this._setDefaultFilter();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;this._setDefaultFilter();b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=w.METHOD_NONE);c.where=a;c=new w(c);this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?
this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a;this._isDefaultPixelFilter=!1},getPixelData:function(a){return a?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},queryVisibleRasters:function(a,b,c,d){var g=this._map,k=e._fixDfd(new l(e._dfdCanceller));
this._visibleRasters=[];var m,p,q=!0,r=this.infoTemplate?this.infoTemplate.info:null,n=r?f.clone(this.infoTemplate.info.fieldInfos):null;b=b||{};if(r&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var u=[];h.forEach(this.infoTemplate.info.mediaInfos,function(a){u=u.concat(a&&a.value&&a.value.fields||[])});u.length&&h.forEach(n,function(a){a&&-1<u.indexOf(a.fieldName)&&(a.visible=!0)})}if(n&&0<n.length)for(q=!1,m=0;m<n.length;m++)if((p=n[m])&&p.fieldName.toLowerCase()!==
this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(p.visible||r.title&&-1<r.title.toLowerCase().indexOf(p.fieldName.toLowerCase()))){q=!0;break}var x=(p=this._removeVisualizationStretchFunction(this.renderingRule))&&p.functionName,v=[];if(10.4<=this.version){var w=!1;if(this.rasterFunctionInfos&&n){var z=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;h.forEach(this.rasterFunctionInfos,function(a){var b=z+a.name.replace(/ /gi,"_");h.some(n,function(a){return a.visible&&a.fieldName===
b})&&(w=w||x&&x===a.name,v.push(new y({rasterFunction:a.name})))})}p&&!w&&v.push(p)}m=new I;m.geometry=a.geometry;m.returnGeometry=this._map.spatialReference.equals(this.spatialReference);m.returnCatalogItems=q;m.timeExtent=a.timeExtent;m.mosaicRule=this.mosaicRule||null;m.renderingRule=10.4>this.version&&p||null;m.renderingRules=v||null;g&&(a=new t((g.extent.xmax-g.extent.xmin)/g.width,(g.extent.ymax-g.extent.ymin)/g.height,g.extent.spatialReference),m.pixelSize=a);b.requestParams=m;var A=this;a=
new H(this.url);(k._pendingDfd=a.execute(m)).addCallbacks(function(a){A._queryVisibleRastersHandler(a,b,c,d,k)},function(a){A._resolve([a],null,d,k,!0)});return k},_queryVisibleRastersHandler:function(a,b,c,e,k){function m(){var a=this.getCustomRasterFields(b),d=this._getDomainFields(a),e=b?b.returnDomainValues:!1,m=b&&b.rasterAttributeTableFieldPrefix,p,t,x,y,v,w,z,B,C,E;this._useRenderingRuleAttributeTable&&this.renderingRule?(a=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),
E=l):a=this._getRasterAttributeTableFeatures();a.then(f.hitch(this,function(a){for(p=0;p<n.length;p++){L=n[p];L.setInfoTemplate(this.infoTemplate);L._layer=this;if(l){C=l.replace(/ /gi,"").split(",");t=l;x=C;r&&r.length>=p&&(t=r[p].replace(/ /gi,", "),x=r[p].split(" "));L.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=x;L.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=C;q&&(L.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=q.replace(/ /gi,"").split(","));if(this.pixelFilter){var b=
new A({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});h.forEach(x,function(a){b.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:b,extent:new u(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)L.attributes[this._rasterFieldPrefix+"Magnitude"]=b.pixels[0][0],L.attributes[this._rasterFieldPrefix+"Direction"]=b.pixels[1][0]}h.forEach(F,
function(a){L.attributes[a.name]=a.value});var G=E||t;if(a&&0<a.length&&(y=h.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==G:a.attributes.VALUE==G}),0<y.length&&(v=f.clone(y[0]),m&&v))){B={};for(w in v.attributes)v.attributes.hasOwnProperty(w)&&(z=m+w,B[z]=v.attributes[w]);v.attributes=B;L.attributes=f.mixin(L.attributes,v.attributes)}}e&&d&&0<d.length&&h.forEach(d,function(a){if(a){var b=L.attributes[a.name];g.isDefined(b)&&(b=this._getDomainValue(a.domain,
b),g.isDefined(b)&&(L.attributes[a.name]=b))}},this);S.push(L);this._visibleRasters.push(L)}this._resolve([S,null,!0],null,c,k)}))}var l=a.value,q=a.value,r,n,t=0,x=0,y=this,w=this.objectIdField,z,B,F=[];e=b.requestParams.renderingRules;var C=a.processedValues,E=this.renderingRule&&d.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(e&&C&&e.length===C.length){var H=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;h.forEach(e,function(a,b){if(a.functionName){var c=
{name:H+a.functionName.replace(/ /gi,"_"),value:C[b].replace(/ /gi,"").split(",")};F.push(c);E&&E===d.toJson(a.toJson())&&(l=C[b])}})}e=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(a.catalogItems){var K=0,Q,I,O=a.catalogItems.features.length;B=0;n=Array(O);r=Array(O);z=Array(O);for(t=0;t<O;t++)-1<a.properties.Values[t].toLowerCase().indexOf("nodata")&&
B++;Q=O-B;for(t=0;t<O;t++)B=!0,-1<a.properties.Values[t].toLowerCase().indexOf("nodata")?(I=Q++,e||(B=!1,n.length--,r.length--,z.length--)):I=K++,B&&(n[I]=a.catalogItems.features[t],r[I]=a.properties.Values[t],z[I]=n[I].attributes[w])}this._visibleRasters=[];var L;(a=-1<l.toLowerCase().indexOf("nodata"))&&!e&&(n=[],r=[],z=[]);!l||n||a||(w="ObjectId",n=[],L=new G(new u(this.fullExtent),null,{ObjectId:0}),n.push(L));var S=[];n?!this._map.spatialReference.equals(this.spatialReference)&&z&&0<z.length?
p({url:this._url.path+"/query",content:{f:"json",objectIds:z.join(","),returnGeometry:!0,outSR:d.toJson(y._map.spatialReference.toJson()),outFields:w},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)y._resolve([S,null,null],null,c,k);else{for(t=0;t<a.features.length;t++)for(x=0;x<n.length;x++)n[x].attributes[w]==a.features[t].attributes[w]&&(n[x].geometry=new v(a.features[t].geometry),n[x].geometry.setSpatialReference(y._map.spatialReference));m.call(y)}},error:function(a){y._resolve([S,
null,null],null,c,k)}}):m.call(this):this._resolve([S,null,null],null,c,k)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},_getDomainFields:function(a){if(a){var b=[];h.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;h.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_requestData:function(a,
b,c){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=f.clone(a);var d=a._normalize(!0);this._prepareGetImageParameters(d,b,c);b=f.clone(this._params);this._cleanupRequestParams(b);b.extent=a;b.format=b.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===b.format.toLowerCase()&&!b.lercVersion&&10.5<=this.version&&(b.lercVersion=2);c=null;this._useBrowserDecoding()&&(c=new F({ctx:this._context}));b={imageServiceParameters:b,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:c?
f.hitch(c,"decode"):null};this._rasterReadPromise=this.raster.read(b,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a))},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=
null)},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=f.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=a.clone();return b},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(a,b,c){a=a.getImageData(0,0,b,c).data;for(var d=b*c,e=0,f=0,g=new Uint8Array(d),h=new Uint8Array(d),k=new Uint8Array(d),m=new Uint8Array(d),l=Infinity,p=Infinity,q=Infinity,r=-Infinity,n=-Infinity,t=-Infinity,u,x,y,e=0;e<d;e++)u=a[f++],x=a[f++],
y=a[f++],l=l<u?l:u,r=r>u?r:u,p=p<x?p:x,n=n>x?n:x,q=q<y?q:y,t=t>y?t:y,g[e]=u,h[e]=x,k[e]=y,m[e]=a[f++]&1;return new A({width:b,height:c,pixels:[g,h,k],pixelType:"U8",mask:m,statistics:[{minValue:l,maxValue:r},{minValue:p,maxValue:n},{minValue:q,maxValue:t}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=
this._url.path+"/multiDimensionalInfo",b=new l(e._dfdCanceller);if(this._multidimensionalInfo)return b.resolve(this._multidimensionalInfo),b;10.3<=this.version&&this.hasMultidimensions?(b._pendingDfd=p({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(f.hitch(this,function(a){this._multidimensionalInfo=a.multidimensionalInfo;b.callback(a.multidimensionalInfo)}),function(a){b.errback(a)})):(a=Error("Layer does not support multidimensional info"),a.log=m.isDebug,
b.errback(a));return b},getDefaultMultidimensionalDefinition:function(){var a,b,c,d=[],g=new l(e._dfdCanceller);if(this._defaultMultidimensionalDefinition)return g.resolve(this._defaultMultidimensionalDefinition),g;g._pendingDfd=this.getMultidimensionalInfo();g._pendingDfd.then(f.hitch(this,function(e){a=e;b=a.variables[0].dimensions;for(c in b)b.hasOwnProperty(c)&&(b[c].hasRanges?d.push(new z({variableName:"",dimensionName:b[c].name,isSlice:!1,values:[b[c].values[0]]})):d.push(new z({variableName:"",
dimensionName:b[c].name,isSlice:!0,values:[b[c].extent[0]]})));this._defaultMultidimensionalDefinition=d;g.callback(d)}),function(a){g.errback(a)});return g},_setDefaultMultidimensionalDefinition:function(a){var b,c={};this.getDefaultMultidimensionalDefinition().then(f.hitch(this,function(d){b=d;0<b.length&&(this.mosaicRule?(c=f.clone(this.mosaicRule),c.multidimensionalDefinition=b):this.defaultMosaicRule?(c=f.clone(this.defaultMosaicRule),c.multidimensionalDefinition=b):c=new w({multidimensionalDefinition:b}),
this.setMosaicRule(c,a))}))},_setDefaultRenderingRule:function(a){var b={};if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())b.rasterFunction=this.rasterFunctionInfos[0].name;else if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version){var c="esriImageServiceDataTypeVector-UV"===this.serviceDataType?
7:10;b.rasterFunction="Resample";b.rasterFunctionArguments={ResamplingType:c,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}}}b.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new y(b),this.setRenderingRule(this.defaultRenderingRule,a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var b=new w(d.fromJson(a.mosaicRule));if(b&&b.multidimensionalDefinition&&0<b.multidimensionalDefinition.length){var c=h.filter(b.multidimensionalDefinition,function(a){return"StdTime"!==
a.dimensionName});b.multidimensionalDefinition=c;a.mosaicRule=d.toJson(b.toJson())}}var b="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent".split(" "),e;for(e in b)a.hasOwnProperty(b[e])&&delete a[b[e]];return a},_removeVisualizationStretchFunction:function(a){var b=a&&a.functionName;if(!b||"stretch"!==b.toLowerCase())return a;var c=a.functionArguments.Raster;return c&&c.functionName&&h.some(this.rasterFunctionInfos,function(a){return c.functionName===a.name})?
c:a},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType},_isRasterFunctionInfoAvailable:function(a){return h.some(a&&(this.rasterFunctionInfos||[]),function(b){return b&&b.name&&
b.name.toLowerCase()===a.toLowerCase()})},_createPixelData:function(a){a=new A({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var b=this.fullExtent.getCenter(),b=new u(b.x,b.y,b.x+this.pixelSizeX,b.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,extent:b}},_resolve:function(a,b,c,d,f){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&e._resDfd(d,a,f)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=
q.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(q.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,b){this.useMapTime=a;this._toggleTime();!b&&this._map&&this.refresh(!0)},_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()}});
a("extend-esri")&&f.setObject("layers.ImageServiceLayerMixin",n,c);return n})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(n,f,l,h,d,m){var q=n(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],constructor:function(a){f.isObject(a)&&(f.mixin(this,
a),a.mosaicMethod&&(this.method=a.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),a.mosaicOperation&&(this.operation=a.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),a.fids&&(this.objectIds=a.fids),a.viewpoint&&(this.viewpoint=new m(a.viewpoint)),this.multidimensionalDefinition=a.multidimensionalDefinition||[])},toJson:function(){var a=
null,f=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(f)for(var a=[],c=0;c<f;c++)a.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[c].declaredClass?this.multidimensionalDefinition[c].toJson():this.multidimensionalDefinition[c]);a={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,
mosaicOperation:this.operation,multidimensionalDefinition:a};return d.filter(a,function(a){if(null!==a)return!0})},_getMethodEnum:function(a){if(a){var d=q.METHOD_NONE;switch(a.toLowerCase()){case "byattribute":d=q.METHOD_ATTRIBUTE;break;case "center":d=q.METHOD_CENTER;break;case "lockraster":d=q.METHOD_LOCKRASTER;break;case "nadir":d=q.METHOD_NADIR;break;case "northwest":d=q.METHOD_NORTHWEST;break;case "seamline":d=q.METHOD_SEAMLINE;break;case "viewpoint":d=q.METHOD_VIEWPOINT}return d}},_getOperatorEnum:function(a){if(a)switch(a.toLowerCase()){case "first":return q.OPERATION_FIRST;
case "last":return q.OPERATION_LAST;case "max":return q.OPERATION_MAX;case "min":return q.OPERATION_MIN;case "blend":return q.OPERATION_BLEND;case "mean":return q.OPERATION_MEAN;case "sum":return q.OPERATION_SUM}}});f.mixin(q,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",
OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});l("extend-esri")&&f.setObject("layers.MosaicRule",q,h);return q})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,f,l,h,d){var m=n(null,{declaredClass:"esri.layers.RasterFunction",functionName:null,arguments:null,functionArguments:null,variableName:null,
outputPixelType:null,constructor:function(d){if(f.isObject(d)){var a=0;this.functionName=d.rasterFunction;this.functionArguments=f.clone(d.rasterFunctionArguments||d.arguments);f.mixin(this,d);if(d=this.functionArguments)if(d.Raster=this._toRasterFunction(d.Raster),d.Raster2=this._toRasterFunction(d.Raster2),d.DEM=this._toRasterFunction(d.DEM),d.FillRaster=this._toRasterFunction(d.FillRaster),d.Rasters&&d.Rasters.length)for(a=0;a<d.Rasters.length;a++)d.Rasters[a]=this._toRasterFunction(d.Rasters[a])}},
_toRasterFunction:function(d){return d&&(d.rasterFunction||d.functionName)?new m(d):d},_rfToJson:function(d){d&&"esri.layers.RasterFunction"===d.declaredClass&&(d=d.toJson());return d},toJson:function(){var h=f.clone(this.functionArguments||this.arguments);if(h&&(h.Raster=this._rfToJson(h.Raster),h.Raster2=this._rfToJson(h.Raster2),h.DEM=this._rfToJson(h.DEM),h.FillRaster=this._rfToJson(h.FillRaster),h.Rasters&&h.Rasters.length)){var a,k=[];for(a=0;a<h.Rasters.length;a++)k.push(this._rfToJson(h.Rasters[a]));
h.Rasters=k}return d.filter({rasterFunction:this.functionName,rasterFunctionArguments:h,variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(a){if(null!==a&&void 0!==a)return!0})}});l("extend-esri")&&f.setObject("layers.RasterFunction",m,h);return m})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,f,l,h,d){n=n(null,{declaredClass:"esri.layers.DimensionalDefinition",
variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(d){f.isObject(d)&&f.mixin(this,d)},toJson:function(){return d.filter({variableName:this.variableName,dimensionName:this.dimensionName,values:this.values,isSlice:this.isSlice},function(d){return null!==d})}});l("extend-esri")&&f.setObject("layers.DimensionalDefinition",n,h);return n})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t){var v,w,y,z,x,A;f=f(c,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(b,c,f){var g=this,k=new h(e._dfdCanceller);if(10>a("ie"))throw"This browser is not supported.";
if(!b.imageServiceParameters)throw"Insufficient parameters to read data";var m=l.clone(b.imageServiceParameters),p=b.pixelType;d.some(this.validPixelTypes,function(a){return a===p})||(m.pixelType="F32");d.some(this.validFormats,function(a){return a.toLowerCase()===m.format.toLowerCase()})||(m.format="lerc");var q=b.decodeFunc,n;this._prepareGetImageParameters(m);var t=m.width,u=m.height,x=m.extent;delete m.width;delete m.height;delete m.extent;k._pendingDfd=r({url:this.imageServiceUrl+"/exportImage",
handleAs:"arraybuffer",content:l.mixin(m,{f:"image"}),load:function(a){g.decode(a,{width:t,height:u,planes:null,pixelType:p,noDataValue:m.noData,format:m.format,decodeFunc:q}).then(function(a){n={pixelBlock:a,extent:x};g._resolve([n,m],"onRasterReadComplete",c,k)},function(a){g._resolve([a],null,f,k,!0)})},error:function(a){g._resolve([a],null,f,k,!0)}});return k.promise},decode:function(a,b){if(void 0===b||null===b)throw"missing decode options";var c,d;b.format&&(c=b.format.toUpperCase());"BSQ"!==
c&&"BIP"!==c&&(c=this._getFormat(a));d=b.decodeFunc;if(void 0===d||null===d)d=this._getFormatDecoderDfd(c);return d(a,b)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(a){if(a.size&&a.bbox){var b=a.size.split(",");a.width=parseFloat(b[0]);a.height=parseFloat(b[1]);a.extent||(b=a.bbox.split(","),a.extent=new g(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]),new p(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==a.width||!a.height||Math.floor(a.height)!==
a.height)throw"Incorrect Image Dimensions";if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw"Incorrect extent";var b=a.extent,c=b.spatialReference.wkid||q.toJson(b.spatialReference.toJson());delete a._ts;l.mixin(a,{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,imageSR:c,bboxSR:c,size:a.width+","+a.height},a.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,c){var d=a.ymax-a.ymin,e=a.xmax-a.xmin;c>=b?a.ymax=a.ymin+e*b/c:a.xmax=a.xmin+d*c/b;return a},
_resolve:function(a,b,c,d,f){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&e._resDfd(d,a,f)},_getFormatDecoderDfd:function(a){var b=null;switch(a){case "LERC":b=this._decodeLerc;break;case "LERC2":b=this._decodeLerc2;break;case "JPEG":b=this._decodeJpeg;break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip;break;case "TIFF":b=this._decodeTiff;break;default:b=function(a,b){throw"The raster format is not supported";}}b=l.hitch(this,b);return function(c,
d){var e=new h;try{var f;"LERC"===a||!0===x?(f=b(c,d),e.resolve(f)):A.then(function(){f=b(c,d);e.resolve(f)})}catch(L){e.reject(L)}return e}},_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";if(255===a[0]&&216===a[1])b="JPEG";else if(137===a[0]&&80===a[1]&&78===a[2]&&71===a[3])b="PNG";else if(67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9])b="LERC";else if(76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5])b=
"LERC2";else if(-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error"))b="ERROR";else if(73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3])b="TIFF";return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,c){if(!v)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(c);var d=(new v).decode(a);
if(!C(d,c))throw"The decoded image dimensions are incorrect.";var e=[],f,g;for(f=0;f<d.pixels.length;f++)g=d.pixels[f],e.push(this._calculateBandStatistics(g));return new b({width:d.width,height:d.height,pixels:d.pixels,pixelType:"U8",mask:d.mask,statistics:e})},_decodePng:function(a,c){if(!w)throw"The png decoder module is not loaded.";this._validateDecodeParams(c);var d=new Uint8Array(a),e=new w(d),d=new Uint8Array(c.width*c.height*4);e.copyToImageData(d,e.decodePixels());for(var f=e=0,g,f=new Uint8Array(c.width*
c.height),e=0;e<c.width*c.height;e++)f[e]=d[4*e+3];for(var h=new b({width:c.width,height:c.height,pixels:[],pixelType:"U8",mask:f,statistics:[]}),e=0;3>e;e++){g=new Uint8Array(c.width*c.height);for(f=0;f<c.width*c.height;f++)g[f]=d[4*f+e];h.addData({pixels:g,statistics:this._calculateBandStatistics(g)})}return h},_decodeBsq:function(a,c){if(!y)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(c);F=c.noDataValue;c.pixelType=E(c.pixelType);var d=y.decodeBSQ(a,{bandCount:c.planes,
width:c.width,height:c.height,pixelType:B,noDataValue:F}),e=[],f,g=null;for(f=0;f<d.pixels.length;f++)g=d.pixels[f],e.push(this._calculateBandStatistics(g));return new b({width:c.width,height:c.height,pixels:d.pixels,pixelType:c.pixelType,mask:d.maskData,statistics:e})},_decodeBip:function(a,c){this._validateDecodeParams(c);F=c.noDataValue;c.pixelType=E(c.pixelType);var d=y.decodeBIP(a,{bandCount:c.planes,width:c.width,height:c.height,pixelType:B,noDataValue:F}),e=[],f,g=null;for(f=0;f<d.pixels.length;f++)g=
d.pixels[f],e.push(this._calculateBandStatistics(g));return new b({width:c.width,height:c.height,pixels:d.pixels,pixelType:c.pixelType,mask:d.maskData,statistics:e})},_decodeTiff:function(a,c){this._validateDecodeParams(c);F=c.noDataValue;c.pixelType=E(c.pixelType);var d=z.decode(a),e=[],f,g=null;for(f=0;f<d.pixels.length;f++)g=d.pixels[f],e.push(this._calculateBandStatistics(g,d.maskData));return new b({width:d.width,height:d.height,pixels:d.pixels,pixelType:d.pixelType,mask:d.maskData,statistics:e})},
_decodeLerc:function(a,c){this._validateDecodeParams(c);F=c.noDataValue;c.pixelType=E(c.pixelType);for(var d=0,e,f=0,g,h=a.byteLength-10;f<h;){var k=u.decode(a,{inputOffset:f,encodedMaskData:e,returnMask:0===d?!0:!1,returnEncodedMask:0===d?!0:!1,returnFileInfo:!0,pixelType:B,noDataValue:F}),f=k.fileInfo.eofOffset;0===d&&(e=k.encodedMaskData,g=new b({width:c.width,height:c.height,pixels:[],pixelType:c.pixelType,mask:k.maskData,statistics:[]}));d++;if(!C(k,c))throw"The decoded image dimensions are incorrect";
g.addData({pixels:k.pixelData,statistics:{minValue:k.minValue,maxValue:k.maxValue,noDataValue:k.noDataValue}})}return g},_decodeLerc2:function(a,c){this._validateDecodeParams(c);F=c.noDataValue;c.pixelType=E(c.pixelType);for(var d=0,e,f,g=0,h,k=a.byteLength-10;g<k;){f=t.decode(a,{inputOffset:g,maskData:e,returnFileInfo:!0});g=f.fileInfo.eofOffset;0===d&&(e=f.maskData,h=new b({width:c.width,height:c.height,pixels:[],pixelType:f.fileInfo.pixelType,mask:f.maskData,statistics:[]}));d++;if(!C(f,c))throw"The decoded image dimensions are incorrect";
h.addData({pixels:f.pixelData,statistics:{minValue:f.minValue,maxValue:f.maxValue,noDataValue:f.noDataValue}})}return h},_calculateBandStatistics:function(a,b){var c=Infinity,d=-Infinity,e=a.length,f,g=0;if(b)for(f=0;f<e;f++)b[f]&&(g=a[f],c=g<c?g:c,d=g>d?g:d);else for(f=0;f<e;f++)g=a[f],c=g<c?g:c,d=g>d?g:d;return{minValue:c,maxValue:d}},_loadRasterFormatModules:function(){x||(A||(A=new h),10>a("ie")?A.isRejected()||A.reject("unsupported browser version"):n(["./rasterFormats/JpgPlus","./rasterFormats/Png",
"./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(a,b,c,d){v=a;w=b;y=c;z=d;x=!0;A.isResolved()||A.resolve(!0)}))}});var B=null,F=null,E=function(a){if("U1"===a||"U2"===a||"U4"===a||"U8"===a)return F=Math.pow(2,8)-1,B=Uint8Array,"U8";"U16"===a?(F=F||Math.pow(2,16)-1,B=Uint16Array):"U32"===a?(F=F||Math.pow(2,32)-1,B=Uint32Array):"S8"===a?(F=F||0-Math.pow(2,7),B=Int8Array):"S16"===a?(F=F||0-Math.pow(2,15),B=Int16Array):"S32"===a?(F=F||0-Math.pow(2,31),B=Int32Array):
B=Float32Array;return a},C=function(a,b){return a.height!==b.height||a.width!==b.width?!1:!0};a("extend-esri")&&l.setObject("layers.Raster",f,k);return f})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,f,l,h){n=n([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],constructor:function(d){if(d){if(!d.width||Math.floor(d.width)!==d.width)throw"PixelBlock: incorrect width";
if(!d.height||Math.floor(d.height)!==d.height)throw"PixelBlock: incorrect height";if(!d.pixels||!d.statistics)throw"PixelBlock: pixel data or statistics not present";this.width=d.width;this.height=d.height;this.pixels=d.pixels;this.pixelType=d.pixelType||null;this.statistics=d.statistics;this.mask=d.mask||null}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(d){if(!d.pixels||
!d.statistics)throw"Pixel data or statistics are not present";if(d.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(d.statistics);this.pixels.push(d.pixels)},getAsRGBA:function(){var d=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(d);break;default:this._fillFrom8Bit(d)}return new Uint8ClampedArray(d)},getAsRGBAFloat:function(){var d=new Float32Array(this.width*
this.height*4);this._fillFrom32Bit(d);return d},clone:function(){var d=new this.constructor;d.width=this.width;d.height=this.height;d.pixelType=this.pixelType;this.mask&&(d.mask=new Uint8Array(this.mask));var h,l;if(this.pixels)for(d.pixels=[],l=this.pixels.length,h=0;h<l;h++)d.pixels[h]=new Float32Array(this.pixels[h]);if(this.statistics)for(d.statistics=[],l=this.statistics.length,h=0;h<l;h++)d.statistics[h]=f.clone(this.statistics[h]);return d},_fillFrom8Bit:function(d){var f=this.pixels,h=this.mask;
if(!d||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,k,c;a=k=c=f[0];3<=f.length&&(k=f[1],c=f[2]);var f=new Uint32Array(d),l=this.width*this.height;if(a.length!==l)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(h&&h.length===l)for(d=0;d<l;d++)h[d]&&(f[d]=-16777216|c[d]<<16|k[d]<<8|a[d]);else for(d=0;d<l;d++)f[d]=-16777216|c[d]<<16|k[d]<<8|a[d]},_fillFromNon8Bit:function(d){var f=this.pixels,h=this.mask,a=this.statistics;
if(!d||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var k=1,c=0;a&&0<a.length?(c=a[0].minValue,k=255/(a[0].maxValue-a[0].minValue)):(k=255,"S8"===this.pixelType?(c=-128,k=127):"U16"===this.pixelType?k=65535:"S16"===this.pixelType?(c=-32768,k=32767):"U32"===this.pixelType?k=4294967295:"S32"===this.pixelType?(c=-2147483648,k=2147483647):"F32"===this.pixelType?(c=-3.4*1E39,k=3.4*1E39):"F64"===this.pixelType&&(c=-Number.MAX_VALUE,k=Number.MAX_VALUE),
k=255/(k-c));d=new Uint32Array(d);var a=this.width*this.height,l,g,p;l=f[0];if(l.length!==a)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=f.length)if(g=f[1],p=f[2],h&&h.length===a)for(f=0;f<a;f++)h[f]&&(d[f]=-16777216|(p[f]-c)*k<<16|(g[f]-c)*k<<8|(l[f]-c)*k);else for(f=0;f<a;f++)d[f]=-16777216|(p[f]-c)*k<<16|(g[f]-c)*k<<8|(l[f]-c)*k;else if(h&&h.length===a)for(f=0;f<a;f++)g=(l[f]-c)*k,h[f]&&(d[f]=-16777216|g<<16|g<<8|g);else for(f=0;f<a;f++)g=(l[f]-c)*k,d[f]=
-16777216|g<<16|g<<8|g},_fillFrom32Bit:function(d){var f=this.pixels,h=this.mask;if(!d||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,k,c;a=k=c=f[0];3<=f.length&&(k=f[1],c=f[2]);var l=this.width*this.height;if(a.length!==l)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var g=0;if(h&&h.length===l)for(f=0;f<l;f++)d[g++]=a[f],d[g++]=k[f],d[g++]=c[f],d[g++]=h[f];else for(f=0;f<l;f++)d[g++]=a[f],d[g++]=k[f],d[g++]=
c[f],d[g++]=255}});l("extend-esri")&&f.setObject("layers.PixelBlock",n,h);return n})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var n={defaultNoDataValue:-3.4027999387901484E38,decode:function(l,h){var d;h=h||{};var m=h.inputOffset||0,q=h.encodedMaskData||null===h.encodedMaskData,a={},k=new Uint8Array(l,m,10);a.fileIdentifierString=String.fromCharCode.apply(null,k);if("CntZImage"!=a.fileIdentifierString.trim())throw"Unexpected file identifier string: "+a.fileIdentifierString;
m+=10;k=new DataView(l,m,24);a.fileVersion=k.getInt32(0,!0);a.imageType=k.getInt32(4,!0);a.height=k.getUint32(8,!0);a.width=k.getUint32(12,!0);a.maxZError=k.getFloat64(16,!0);m+=24;if(!q)if(k=new DataView(l,m,16),a.mask={},a.mask.numBlocksY=k.getUint32(0,!0),a.mask.numBlocksX=k.getUint32(4,!0),a.mask.numBytes=k.getUint32(8,!0),a.mask.maxValue=k.getFloat32(12,!0),m+=16,0<a.mask.numBytes){var q=new Uint8Array(Math.ceil(a.width*a.height/8)),k=new DataView(l,m,a.mask.numBytes),c=k.getInt16(0,!0),r=2,
g=0;do{if(0<c)for(;c--;)q[g++]=k.getUint8(r++);else for(var p=k.getUint8(r++),c=-c;c--;)q[g++]=p;c=k.getInt16(r,!0);r+=2}while(r<a.mask.numBytes);if(-32768!==c||g<q.length)throw"Unexpected end of mask RLE encoding";a.mask.bitset=q;m+=a.mask.numBytes}else 0===(a.mask.numBytes|a.mask.numBlocksY|a.mask.maxValue)&&(q=new Uint8Array(Math.ceil(a.width*a.height/8)),a.mask.bitset=q);k=new DataView(l,m,16);a.pixels={};a.pixels.numBlocksY=k.getUint32(0,!0);a.pixels.numBlocksX=k.getUint32(4,!0);a.pixels.numBytes=
k.getUint32(8,!0);a.pixels.maxValue=k.getFloat32(12,!0);m+=16;q=a.pixels.numBlocksX;k=a.pixels.numBlocksY;q+=0<a.width%q?1:0;c=k+(0<a.height%k?1:0);a.pixels.blocks=Array(q*c);for(g=r=0;g<c;g++)for(p=0;p<q;p++){var e=0,k=new DataView(l,m,Math.min(10,l.byteLength-m)),b={};a.pixels.blocks[r++]=b;var u=k.getUint8(0);e++;b.encoding=u&63;if(3<b.encoding)throw"Invalid block encoding ("+b.encoding+")";if(2===b.encoding)m++;else{if(0!==u&&2!==u){u>>=6;b.offsetType=u;if(2===u)b.offset=k.getInt8(1),e++;else if(1===
u)b.offset=k.getInt16(1,!0),e+=2;else if(0===u)b.offset=k.getFloat32(1,!0),e+=4;else throw"Invalid block offset type";if(1===b.encoding)if(u=k.getUint8(e),e++,b.bitsPerPixel=u&63,u>>=6,b.numValidPixelsType=u,2===u)b.numValidPixels=k.getUint8(e),e++;else if(1===u)b.numValidPixels=k.getUint16(e,!0),e+=2;else if(0===u)b.numValidPixels=k.getUint32(e,!0),e+=4;else throw"Invalid valid pixel count type";}m+=e;if(3!=b.encoding)if(0===b.encoding){u=(a.pixels.numBytes-1)/4;if(u!==Math.floor(u))throw"uncompressed block has invalid length";
k=new ArrayBuffer(4*u);e=new Uint8Array(k);e.set(new Uint8Array(l,m,4*u));k=new Float32Array(k);b.rawData=k;m+=4*u}else 1===b.encoding&&(u=Math.ceil(b.numValidPixels*b.bitsPerPixel/8),k=new ArrayBuffer(4*Math.ceil(u/4)),e=new Uint8Array(k),e.set(new Uint8Array(l,m,u)),b.stuffedData=new Uint32Array(k),m+=u)}}a.eofOffset=m;var m=null!=h.noDataValue?h.noDataValue:n.defaultNoDataValue,c=h.encodedMaskData,t=h.returnMask,r=0,g=a.pixels.numBlocksX,p=a.pixels.numBlocksY,b=Math.floor(a.width/g),e=Math.floor(a.height/
p),u=2*a.maxZError,k=Number.MAX_VALUE,v,c=c||(a.mask?a.mask.bitset:null),w,q=new (h.pixelType||Float32Array)(a.width*a.height);t&&c&&(w=new Uint8Array(a.width*a.height));for(var t=new Float32Array(b*e),y,z,x=0;x<=p;x++){var A=x!==p?e:a.height%p;if(0!==A)for(var B=0;B<=g;B++){var F=B!==g?b:a.width%g;if(0!==F){var E=x*a.width*e+B*b,C=a.width-F,G=a.pixels.blocks[r],H,I;if(2>G.encoding){if(0===G.encoding)H=G.rawData;else{H=G.stuffedData;I=G.bitsPerPixel;v=G.numValidPixels;y=G.offset;z=u;var K=t,Q=a.pixels.maxValue,
O=(1<<I)-1,L=0,S=void 0,P=0,M=void 0,N=void 0,J=Math.ceil((Q-y)/z);H[H.length-1]<<=8*(4*H.length-Math.ceil(I*v/8));for(S=0;S<v;S++)0===P&&(N=H[L++],P=32),P>=I?(M=N>>>P-I&O,P-=I):(P=I-P,M=(N&O)<<P&O,N=H[L++],P=32-P,M+=N>>>P),K[S]=M<J?y+M*z:Q;H=t}I=0}else d=2===G.encoding?0:G.offset;var R;if(c)for(z=0;z<A;z++){E&7&&(R=c[E>>3],R<<=E&7);for(y=0;y<F;y++)E&7||(R=c[E>>3]),R&128?(w&&(w[E]=1),v=2>G.encoding?H[I++]:d,k=k>v?v:k,q[E++]=v):(w&&(w[E]=0),q[E++]=m),R<<=1;E+=C}else if(2>G.encoding)for(z=0;z<A;z++){for(y=
0;y<F;y++)v=H[I++],k=k>v?v:k,q[E++]=v;E+=C}else for(k=k>d?d:k,z=0;z<A;z++){for(y=0;y<F;y++)q[E++]=d;E+=C}if(1===G.encoding&&I!==G.numValidPixels)throw"Block and Mask do not match";r++}}}d=w;w={width:a.width,height:a.height,pixelData:q,minValue:k,maxValue:a.pixels.maxValue,noDataValue:m};d&&(w.maskData=d);h.returnEncodedMask&&a.mask&&(w.encodedMaskData=a.mask.bitset?a.mask.bitset:null);if(h.returnFileInfo&&(w.fileInfo=f(a),h.computeUsedBitDepths)){d=w.fileInfo;R=a.pixels.numBlocksX*a.pixels.numBlocksY;
H={};for(I=0;I<R;I++)m=a.pixels.blocks[I],0===m.encoding?H.float32=!0:1===m.encoding?H[m.bitsPerPixel]=!0:H[0]=!0;a=Object.keys(H);d.bitDepths=a}return w}},f=function(f){return{fileIdentifierString:f.fileIdentifierString,fileVersion:f.fileVersion,imageType:f.imageType,height:f.height,width:f.width,maxZError:f.maxZError,eofOffset:f.eofOffset,mask:f.mask?{numBlocksX:f.mask.numBlocksX,numBlocksY:f.mask.numBlocksY,numBytes:f.mask.numBytes,maxValue:f.mask.maxValue}:null,pixels:{numBlocksX:f.pixels.numBlocksX,
numBlocksY:f.pixels.numBlocksY,numBytes:f.pixels.numBytes,maxValue:f.pixels.maxValue,noDataValue:this.noDataValue}}};return n})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var n={unstuff:function(f,d,m,l,a,k,c,r){var g=(1<<m)-1,h=0,e,b=0,q,n;f[f.length-1]<<=8*(4*f.length-Math.ceil(m*l/8));if(a)for(e=0;e<l;e++)0===b&&(n=f[h++],b=32),b>=m?(q=n>>>b-m&g,b-=m):(b=m-b,q=(n&g)<<b&g,n=f[h++],b=32-b,q+=n>>>b),d[e]=a[q];else for(a=Math.ceil((r-k)/c),e=0;e<l;e++)0===b&&(n=f[h++],
b=32),b>=m?(q=n>>>b-m&g,b-=m):(b=m-b,q=(n&g)<<b&g,n=f[h++],b=32-b,q+=n>>>b),d[e]=q<a?k+q*c:r},unstuffLUT:function(f,d,m,l,a,k){var c=(1<<d)-1,h=0,g=0,p=0,e=p=0,b,q=[];f[f.length-1]<<=8*(4*f.length-Math.ceil(d*m/8));for(var n=Math.ceil((k-l)/a),g=0;g<m;g++)0===p&&(b=f[h++],p=32),p>=d?(e=b>>>p-d&c,p-=d):(p=d-p,e=(b&c)<<p&c,b=f[h++],p=32-p,e+=b>>>p),q[g]=e<n?l+e*a:k;q.unshift(l);return q},unstuff2:function(f,d,m,l,a,k,c,r){var g=(1<<m)-1,h=0,e,b=0,q=0,n,v,w;if(a)for(e=0;e<l;e++)0===b&&(v=f[h++],b=32,
q=0),b>=m?(n=v>>>q&g,b-=m,q+=m):(w=m-b,n=v>>>q&g,v=f[h++],b=32-w,n|=(v&(1<<w)-1)<<m-w,q=w),d[e]=a[n];else for(a=Math.ceil((r-k)/c),e=0;e<l;e++)0===b&&(v=f[h++],b=32,q=0),b>=m?(n=v>>>q&g,b-=m,q+=m):(w=m-b,n=v>>>q&g,v=f[h++],b=32-w,n|=(v&(1<<w)-1)<<m-w,q=w),d[e]=n<a?k+n*c:r;return d},unstuffLUT2:function(f,d,m,l,a,k){for(var c=(1<<d)-1,h=0,g=0,p=0,e=0,b=0,q=0,n,v=[],w=Math.ceil((k-l)/a),g=0;g<m;g++)0===e&&(n=f[h++],e=32,q=0),e>=d?(b=n>>>q&c,e-=d,q+=d):(p=d-e,b=n>>>q&c,n=f[h++],e=32-p,b|=(n&(1<<p)-1)<<
d-p,q=p),v[g]=b<w?l+b*a:k;v.unshift(l);return v},originalUnstuff:function(f,d,m,l){var a=(1<<m)-1,h=0,c,q=0,g,p;f[f.length-1]<<=8*(4*f.length-Math.ceil(m*l/8));for(c=0;c<l;c++)0===q&&(p=f[h++],q=32),q>=m?(g=p>>>q-m&a,q-=m):(q=m-q,g=(p&a)<<q&a,p=f[h++],q=32-q,g+=p>>>q),d[c]=g;return d},originalUnstuff2:function(f,d,m,l){var a=(1<<m)-1,h=0,c,q=0,g=0,p,e,b;for(c=0;c<l;c++)0===q&&(e=f[h++],q=32,g=0),q>=m?(p=e>>>g&a,q-=m,g+=m):(b=m-q,p=e>>>g&a,e=f[h++],q=32-b,p|=(e&(1<<b)-1)<<m-b,g=b),d[c]=p;return d}},
f={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(f){for(var d=65535,h=65535,l=f.length,a=Math.floor(l/2),k=0;a;){var c=359<=a?359:a,a=a-c;do d+=f[k++]<<8,h+=d+=f[k++];while(--c);d=(d&65535)+(d>>>16);h=(h&65535)+(h>>>16)}l&1&&(h+=d+=f[k]<<8);return((h&65535)+(h>>>16)<<16|(d&65535)+(d>>>16))>>>0},readHeaderInfo:function(f,d){var h=d.ptr,l=new Uint8Array(f,h,6),a={};a.fileIdentifierString=String.fromCharCode.apply(null,l);if(0!==a.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+
a.fileIdentifierString;h+=6;l=new DataView(f,h,52);a.fileVersion=l.getInt32(0,!0);h+=4;3<=a.fileVersion&&(a.checksum=l.getUint32(4,!0),h+=4);l=new DataView(f,h,48);a.height=l.getUint32(0,!0);a.width=l.getUint32(4,!0);a.numValidPixel=l.getUint32(8,!0);a.microBlockSize=l.getInt32(12,!0);a.blobSize=l.getInt32(16,!0);a.imageType=l.getInt32(20,!0);a.maxZError=l.getFloat64(24,!0);a.zMin=l.getFloat64(32,!0);a.zMax=l.getFloat64(40,!0);h+=48;d.headerInfo=a;d.ptr=h;if(3<=a.fileVersion&&(h=this.computeChecksumFletcher32(new Uint8Array(f,
h-48,a.blobSize-14)),h!==a.checksum))throw"Checksum failed.";return!0},readMask:function(f,d){var h=d.ptr,l=d.headerInfo,a=l.width*l.height,k=l.numValidPixel,c=new DataView(f,h,4),l={};l.numBytes=c.getUint32(0,!0);h+=4;if((0===k||a===k)&&0!==l.numBytes)throw"invalid mask";if(0===k)k=new Uint8Array(Math.ceil(a/8)),l.bitset=k,c=new Uint8Array(a),d.pixels.resultMask=c,h+=l.numBytes;else if(0<l.numBytes){var k=new Uint8Array(Math.ceil(a/8)),c=new DataView(f,h,l.numBytes),n=c.getInt16(0,!0),g=2,p=0,e=
0;do{if(0<n)for(;n--;)k[p++]=c.getUint8(g++);else for(e=c.getUint8(g++),n=-n;n--;)k[p++]=e;n=c.getInt16(g,!0);g+=2}while(g<l.numBytes);if(-32768!==n||p<k.length)throw"Unexpected end of mask RLE encoding";c=new Uint8Array(a);for(g=g=n=0;g<a;g++)g&7?(n=k[g>>3],n<<=g&7):n=k[g>>3],n&128&&(c[g]=1);d.pixels.resultMask=c;l.bitset=k;h+=l.numBytes}d.ptr=h;d.mask=l;return!0},readDataOneSweep:function(h,d,l){var m=d.ptr,a=d.headerInfo,k=a.width*a.height,a=a.numValidPixel*f.getDateTypeSize(a.imageType);if(l===
Uint8Array)h=new Uint8Array(h,m,a);else{var c=new ArrayBuffer(a);(new Uint8Array(c)).set(new Uint8Array(h,m,a));h=new l(c)}if(h.length===k)d.pixels.resultPixels=h;else for(d.pixels.resultPixels=new l(k),c=c=l=0;c<k;c++)d.pixels.resultMask[c]&&(d.pixels.resultPixels[c]=h[l++]);d.ptr=m+a;return!0},readHuffman:function(h,d,m){var q=d.headerInfo,a=q.width*q.height,k=this.HUFFMAN_LUT_BITS_MAX,q=new DataView(h,d.ptr,16);d.ptr+=16;if(2>q.getInt32(0,!0))throw"unsupported Huffman version";var c=q.getInt32(4,
!0),n=q.getInt32(8,!0),g=q.getInt32(12,!0);if(n>=g)return!1;var p=new Uint32Array(g-n);f.decodeBits(h,d,p);for(var e=[],b,u,q=n;q<g;q++)b=q-(q<c?0:c),e[b]={first:p[q-n],second:null};q=h.byteLength-d.ptr;p=new ArrayBuffer(4*Math.ceil(q/4));(new Uint8Array(p)).set(new Uint8Array(h,d.ptr,q));h=new Uint32Array(p);var p=0,t,v=0;t=h[0];for(q=n;q<g;q++)b=q-(q<c?0:c),u=e[b].first,0<u&&(e[b].second=t<<p>>>32-u,32-p>=u?(p+=u,32===p&&(p=0,v++,t=h[v])):(p+=u-32,v++,t=h[v],e[b].second|=t>>>32-p));for(var w=0===
d.headerInfo.imageType?128:0,y=d.headerInfo.height,z=d.headerInfo.width,x=0,A=0,B=new l,q=0;q<e.length;q++)void 0!==e[q]&&(x=Math.max(x,e[q].first));A=x>=k?k:x;30<=x&&console.log("WARning, large NUM LUT BITS IS "+x);for(var k=[],F,q=n;q<g;q++)if(b=q-(q<c?0:c),u=e[b].first,0<u)if(t=[u,b],u<=A)for(b=e[b].second<<A-u,F=1<<A-u,n=0;n<F;n++)k[b|n]=t;else for(b=e[b].second,F=B,n=u-1;0<=n;n--)(u=b>>>n&1)?(F.right||(F.right=new l),F=F.right):(F.left||(F.left=new l),F=F.left),0!==n||F.val||(F.val=t[1]);var c=
d.pixels.resultMask,E,e=g=0;0<p&&(v++,p=0);t=h[v];m=new m(a);if(d.headerInfo.numValidPixel===z*y)for(q=n=0;q<y;q++)for(b=0;b<z;b++,n++){a=0;e=E=t<<p>>>32-A;32-p<A&&(e=E|=h[v+1]>>>64-p-A);if(k[e])a=k[e][1],p+=k[e][0];else for(e=E=t<<p>>>32-x,32-p<x&&(e=E|=h[v+1]>>>64-p-x),F=B,e=0;e<x;e++)if(F=(u=E>>>x-e-1&1)?F.right:F.left,!F.left&&!F.right){a=F.val;p=p+e+1;break}32<=p&&(p-=32,v++,t=h[v]);a-=w;a=0<b?a+g:0<q?a+m[n-z]:a+g;a&=255;g=m[n]=a}else for(q=n=0;q<y;q++)for(b=0;b<z;b++,n++)if(c[n]){a=0;e=E=t<<
p>>>32-A;32-p<A&&(e=E|=h[v+1]>>>64-p-A);if(k[e])a=k[e][1],p+=k[e][0];else for(e=E=t<<p>>>32-x,32-p<x&&(e=E|=h[v+1]>>>64-p-x),F=B,e=0;e<x;e++)if(F=(u=E>>>x-e-1&1)?F.right:F.left,!F.left&&!F.right){a=F.val;p=p+e+1;break}32<=p&&(p-=32,v++,t=h[v]);a-=w;a=0<b&&c[n-1]?a+g:0<q&&c[n-z]?a+m[n-z]:a+g;a&=255;g=m[n]=a}d.pixels.resultPixels=m;d.ptr=d.ptr+4*(v+1)+(0<p?4:0)},decodeBits:function(f,d,l,q){var a=d.headerInfo.fileVersion,h=0,c=new DataView(f,d.ptr,5),m=c.getUint8(0);h++;var g=m>>6,p=0===g?4:3-g,e=0<
(m&32)?!0:!1,g=m&31,m=0;if(1===p)m=c.getUint8(h),h++;else if(2===p)m=c.getUint16(h,!0),h+=2;else if(4===p)m=c.getUint32(h,!0),h+=4;else throw"Invalid valid pixel count type";var p=2*d.headerInfo.maxZError,b,u,t;if(e){d.counter.lut++;t=c.getUint8(h);h++;e=Math.ceil((t-1)*g/8);b=Math.ceil(e/4);b=new ArrayBuffer(4*b);u=new Uint8Array(b);d.ptr+=h;u.set(new Uint8Array(f,d.ptr,e));h=new Uint32Array(b);d.ptr+=e;for(c=0;t-1>>>c;)c++;e=Math.ceil(m*c/8);b=Math.ceil(e/4);b=new ArrayBuffer(4*b);u=new Uint8Array(b);
u.set(new Uint8Array(f,d.ptr,e));f=new Uint32Array(b);d.ptr+=e;d=3<=a?n.unstuffLUT2(h,g,t-1,q,p,d.headerInfo.zMax):n.unstuffLUT(h,g,t-1,q,p,d.headerInfo.zMax);3<=a?n.unstuff2(f,l,c,m,d):n.unstuff(f,l,c,m,d)}else d.counter.bitstuffer++,c=g,d.ptr+=h,0<c&&(e=Math.ceil(m*c/8),b=Math.ceil(e/4),b=new ArrayBuffer(4*b),u=new Uint8Array(b),u.set(new Uint8Array(f,d.ptr,e)),f=new Uint32Array(b),d.ptr+=e,3<=a?null==q?n.originalUnstuff2(f,l,c,m):n.unstuff2(f,l,c,m,!1,q,p,d.headerInfo.zMax):null==q?n.originalUnstuff(f,
l,c,m):n.unstuff(f,l,c,m,!1,q,p,d.headerInfo.zMax))},readTiles:function(h,d,l){var m=d.headerInfo,a=m.width,k=m.height,c=m.microBlockSize,m=m.imageType,n=Math.ceil(a/c),g=Math.ceil(k/c);d.pixels.numBlocksY=g;d.pixels.numBlocksX=n;for(var p=d.pixels.ptr=0,e=0,b=0,u=0,t=0,v=0,w=0,y=0,z=p=0,x=0,A=0,w=w=p=w=0,B,F=new l(c*c),k=k%c||c,E=a%c||c,b=0;b<g;b++)for(t=b!==g-1?c:k,u=0;u<n;u++){v=u!==n-1?c:E;x=b*a*c+u*c;A=a-v;w=h.byteLength-d.ptr;e=new DataView(h,d.ptr,Math.min(10,w));B={};w=0;y=e.getUint8(0);w++;
p=y>>6&255;z=y>>2&15;if(z!==(u*c>>3&15))throw"integrity issue";y&=3;if(3<y)throw d.ptr+=w,"Invalid block encoding ("+y+")";if(2===y)d.counter.constant++,d.ptr+=w;else if(0===y){d.counter.uncompressed++;d.ptr+=w;w=t*v*f.getDateTypeSize(m);p=h.byteLength-d.ptr;w=w<p?w:p;p=new ArrayBuffer(w);e=new Uint8Array(p);e.set(new Uint8Array(h,d.ptr,w));B=new l(p);w=0;if(d.pixels.resultMask)for(p=0;p<t;p++){for(e=0;e<v;e++)d.pixels.resultMask[x]&&(d.pixels.resultPixels[x]=B[w++]),x++;x+=A}else for(p=0;p<t;p++){for(e=
0;e<v;e++)d.pixels.resultPixels[x++]=B[w++];x+=A}d.ptr+=w*f.getDateTypeSize(m)}else if(p=f.getDataTypeUsed(m,p),B=f.getOnePixel(B,w,p,e),w+=f.getDateTypeSize(p),3===y)if(d.ptr+=w,d.counter.constantoffset++,d.pixels.resultMask)for(p=0;p<t;p++){for(e=0;e<v;e++)d.pixels.resultMask[x]&&(d.pixels.resultPixels[x]=B),x++;x+=A}else for(p=0;p<t;p++){for(e=0;e<v;e++)d.pixels.resultPixels[x++]=B;x+=A}else if(d.ptr+=w,f.decodeBits(h,d,F,B),w=0,d.pixels.resultMask)for(p=0;p<t;p++){for(e=0;e<v;e++)d.pixels.resultMask[x]&&
(d.pixels.resultPixels[x]=F[w++]),x++;x+=A}else for(p=0;p<t;p++){for(e=0;e<v;e++)d.pixels.resultPixels[x++]=F[w++];x+=A}}},formatFileInfo:function(h){return{fileIdentifierString:h.headerInfo.fileIdentifierString,fileVersion:h.headerInfo.fileVersion,imageType:h.headerInfo.imageType,height:h.headerInfo.height,width:h.headerInfo.width,numValidPixel:h.headerInfo.numValidPixel,microBlockSize:h.headerInfo.microBlockSize,blobSize:h.headerInfo.blobSize,maxZError:h.headerInfo.maxZError,pixelType:f.getPixelType(h.headerInfo.imageType),
eofOffset:h.eofOffset,mask:h.mask?{numBytes:h.mask.numBytes}:null,pixels:{numBlocksX:h.pixels.numBlocksX,numBlocksY:h.pixels.numBlocksY,maxValue:h.headerInfo.zMax,minValue:h.headerInfo.zMin,noDataValue:h.noDataValue}}},constructConstantSurface:function(f){var d=f.headerInfo.zMax,h=f.headerInfo.height*f.headerInfo.width,l=0;if(f.pixels.resultMask)for(l=0;l<h;l++)f.pixels.resultMask[l]&&(f.pixels.resultPixels[l]=d);else for(l=0;l<h;l++)f.pixels.resultPixels[l]=d},getDataTypeArray:function(f){switch(f){case 0:f=
Int8Array;break;case 1:f=Uint8Array;break;case 2:f=Int16Array;break;case 3:f=Uint16Array;break;case 4:f=Int32Array;break;case 5:f=Uint32Array;break;case 6:f=Float32Array;break;case 7:f=Float64Array;break;default:f=Float32Array}return f},getPixelType:function(f){switch(f){case 0:f="S8";break;case 1:f="U8";break;case 2:f="S16";break;case 3:f="U16";break;case 4:f="S32";break;case 5:f="U32";break;case 6:f="F32";break;case 7:f="F64";break;default:f="F32"}return f},isValidPixelValue:function(f,d){if(null===
d||void 0===d)return!1;var h;switch(f){case 0:h=-128<=d&&127>=d;break;case 1:h=0<=d&&255>=d;break;case 2:h=-32768<=d&&32767>=d;break;case 3:h=0<=d&&65536>=d;break;case 4:h=-2147483648<=d&&2147483647>=d;break;case 5:h=0<=d&&4294967296>=d;break;case 6:h=-3.4027999387901484E38<=d&&3.4027999387901484E38>=d;break;case 7:h=4.9E-324<=d&&1.7976931348623157E308>=d;break;default:h=!1}return h},getDateTypeSize:function(f){var d=0;switch(f){case 0:case 1:d=1;break;case 2:case 3:d=2;break;case 4:case 5:case 6:d=
4;break;case 7:d=8;break;default:d=f}return d},getDataTypeUsed:function(f,d){var h=f;switch(f){case 2:case 4:h=f-d;break;case 3:case 5:h=f-2*d;break;case 6:h=0===d?f:1===d?2:1;break;case 7:h=0===d?f:f-2*d+1;break;default:h=f}return h},getOnePixel:function(f,d,l,n){f=0;switch(l){case 0:f=n.getInt8(d);break;case 1:f=n.getUint8(d);break;case 2:f=n.getInt16(d,!0);break;case 3:f=n.getUint16(d,!0);break;case 4:f=n.getInt32(d,!0);break;case 5:f=n.getUInt32(d,!0);break;case 6:f=n.getFloat32(d,!0);break;case 7:f=
n.getFloat64(d,!0);break;default:throw"the decoder does not understand this pixel type";}return f}},l=function(f,d,l){this.val=f;this.left=d;this.right=l};return{decode:function(h,d){d=d||{};var l=d.maskData||null===d.maskData,n=d.noDataValue,a=0,k={};k.ptr=d.inputOffset||0;k.pixels={};if(f.readHeaderInfo(h,k)){var a=k.headerInfo,c=f.getDataTypeArray(a.imageType);if(l)k.pixels.resultMask=d.maskData,k.ptr+=4;else if(!f.readMask(h,k))return;l=a.width*a.height;k.pixels.resultPixels=new c(l);k.counter=
{onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==a.numValidPixel)if(a.zMax===a.zMin)f.constructConstantSurface(k);else{var r=new DataView(h,k.ptr,2),g=r.getUint8(0,!0);k.ptr++;g?f.readDataOneSweep(h,k,c):1<a.fileVersion&&1>=a.imageType&&1E-5>Math.abs(a.maxZError-.5)?(r=r.getUint8(1,!0),k.ptr++,r?f.readHuffman(h,k,c):f.readTiles(h,k,c)):f.readTiles(h,k,c)}k.eofOffset=k.ptr;d.inputOffset?(c=k.headerInfo.blobSize+d.inputOffset-k.ptr,1<=Math.abs(c)&&(k.eofOffset=d.inputOffset+
k.headerInfo.blobSize)):(c=k.headerInfo.blobSize-k.ptr,1<=Math.abs(c)&&(k.eofOffset=k.headerInfo.blobSize));c={width:a.width,height:a.height,pixelData:k.pixels.resultPixels,minValue:a.zMin,maxValue:a.zMax,maskData:k.pixels.resultMask};if(k.pixels.resultMask&&f.isValidPixelValue(a.imageType,n)){r=k.pixels.resultMask;for(a=0;a<l;a++)r[a]||(c.pixelData[a]=n);c.noDataValue=n}k.noDataValue=n;d.returnFileInfo&&(c.fileInfo=f.formatFileInfo(k));return c}},getBandCount:function(h){for(var d=0,l=0,n={ptr:0,
pixels:{}};l<h.byteLength-58;)f.readHeaderInfo(h,n),l+=n.headerInfo.blobSize,d++,n.ptr=l;return d}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(n,f,l,h,d,m){n=n(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(d){f.mixin(this,
d);this.isDataUV=d&&d.isDataUV?d.isDataUV:!1;this.computeMagnitudeAndDirection=f.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(d,a){this.inputUnit=d;this.outputUnit=a;this.unitConversionFactor=1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var d=m.indexOf(this.speedUnits,this.inputUnit),a=m.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=d&&0<=a){var f=[1,.277778,.514444,.3048,
.44704,0];this.unitConversionFactor=f[d]/f[a]}},computeMagnitudeAndDirection:function(f){if(!d.isDefined(f))throw"Could not compute magnitude and direction. No pixel data is available.";var a=f.pixelBlock;if(!d.isDefined(a)||2!==a.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";var h=f.extent,c=(h.xmax-h.xmin)/a.width,l=(h.ymax-h.ymin)/a.height,g=h.xmin+c/2,h=h.ymax-l/2;a.statistics[0].minValue=0;a.statistics[0].maxValue=0;var p=180/Math.PI,
e=[],b=0,m=0,n=0,q=!d.isDefined(a.mask),w,y,z,x,A,B,F,E;A=F=Infinity;B=E=-Infinity;for(b=0;b<a.height;b++)for(m=0;m<a.width;m++,n++)if(e.push([g+c*m,h-l*b]),q||a.mask[n])z=w=a.pixels[0][n]*this.unitConversionFactor,x=y=a.pixels[1][n],this.isDataUV&&(z=Math.sqrt(w*w+y*y),x=90-p*Math.atan2(y,w),a.pixels[0][n]=z*this.unitConversionFactor,a.pixels[1][n]=x),z>B&&(B=z),z<A&&(A=z),x>E&&(E=x),x<F&&(F=x);a.statistics[0].maxValue=B;a.statistics[0].minValue=A;a.statistics[1].maxValue=E;a.statistics[1].minValue=
F;f.locations=e;return f}});l("extend-esri")&&f.setObject("layers.pixelFilters.VectorFieldPixelFilter",n,h);return n})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(n,f,l,h){var d;return f(null,{constructor:function(d){this.ctx=d.ctx;this._loadRasterFormatModule()},decode:function(d,f){if(!f.width||!f.height)throw"Native decoding requires the image format, width and height";var a=new l,h,c=new Uint8Array(d),
m=this._getFormat(d);if("error"===m)throw"invalid format";"jpeg"===m&&(h=this._getMask(c,f));var g="",p,e;for(p=0;p<c.length;p+=65535)e=c.subarray(p,p+65535>c.length-1?c.length-1:p+65535),g+=String.fromCharCode.apply(null,e);var c="data:image/"+m+";base64,"+window.btoa(g),b=new Image,n;b.src=c;var q=this;b.onload=function(){q.ctx.clearRect(0,0,f.width,f.height);q.ctx.drawImage(b,0,0);var c=q.ctx.getImageData(0,0,b.width,b.height);n=c.data;if(h)for(p=0;p<h.length;p++)n[4*p+3]=h[p]?255:0;q.ctx.putImageData(c,
0,0);a.resolve(null)};b.onerror=function(){a.reject("cannot load image")};return a},_getFormat:function(d){d=new Uint8Array(d,0,10);var f="error";255===d[0]&&216===d[1]?f="jpeg":137===d[0]&&80===d[1]&&78===d[2]&&71===d[3]&&(f="png");return f},_getMask:function(f,h){var a;try{if(!d)throw"The zlib decoder module is not loaded.";var k=0,c=0,l=Math.round(f.length/2);1===l%2&&(l+=1);for(var g=f.length-2,k=l;k<g&&(255!==f[k]||217!==f[k+1]);k++);l=k+=2;if(l<f.length-1){var p=(new d(f.subarray(l))).getBytes();
a=new Uint8Array(h.width*h.height);for(k=l=0;k<p.length;k++)for(c=7;0<=c;c--)a[l++]=p[k]>>c&1}}catch(e){}return a},_loadRasterFormatModule:function(){10>h("ie")||n(["./Zlib"],function(f){d=f})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(n,f,l,h,d,m,q,a){n=n(q,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(a){this._url.path+=
"/identify";this._handler=f.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(d,c,f,g,h){try{var e=new a(d);this._successHandler([e],"onComplete",f,h)}catch(b){this._errorHandler(b,g,h)}},execute:function(a,c,h,g){var k=g.assembly;a=this._encode(f.mixin({},this._url.query,{f:"json"},a.toJson(k&&k[0])));var e=this._handler,b=this._errorHandler;return d({url:this._url.path,content:a,callbackParamName:"callback",load:function(a,b){e(a,b,c,h,g.dfd)},
error:function(a){b(a,h,g.dfd)}})},onComplete:function(){}});m._createWrappers(n);l("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyTask",n,h);return n})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(n,f,l,h,d,m){n=n(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(f){f.catalogItems&&(this.catalogItems=new m(f.catalogItems));f.location&&
(this.location=d.fromJson(f.location));this.catalogItemVisibilities=f.catalogItemVisibilities;this.name=f.name;this.objectId=f.objectId;this.value=f.value;this.processedValues=f.processedValues;this.properties=f.properties}});l("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyResult",n,h);return n})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(n,
f,l,h,d,m,q,a){n=n(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(d){var c=d&&d.geometry||this.geometry;d={geometry:c,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?l.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?
l.toJson(this.renderingRule.toJson()):null};c&&(d.geometryType=a.getJsonType(c));c=this.timeExtent;d.time=c?c.toJson().join(","):null;q.isDefined(this.pixelSizeX)&&q.isDefined(this.pixelSizeY)?d.pixelSize=l.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(d.pixelSize=this.pixelSize?l.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(d.renderingRules=l.toJson(h.map(this.renderingRules,function(a){return a.toJson()})));return d}});d("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyParameters",
n,m);return n})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare","dojo/_base/lang","../PixelBlock"],function(n,f,l){var h;return n(null,{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(d){this.stretchType=d.stretchType||d.StretchType||this.stretchType;this.min=d.min||d.Min||this.min;this.max=d.max||
d.Max||this.max;this.numberOfStandardDeviations=d.numberOfStandardDeviations||d.NumberOfStandardDeviations||this.numberOfStandardDeviations;this.statistics=d.statistics||d.Statistics||this.statistics;this.dra=d.dra||d.DRA||d.dRA||this.dra;this.minPercent=d.minPercent||d.MinPercent||this.minPercent;this.maxPercent=d.maxPercent||d.MaxPercent||this.maxPercent;this.useGamma=d.useGamma||d.UseGamma||this.useGamma;this.gamma=d.gamma||d.Gamma||this.gamma;this.computeGamma=d.computeGamma||d.ComputeGamma||
this.computeGamma;this.raster=d.raster||d.Raster||this.raster;this.outputPixelType=d.outputPixelType||d.OutputPixelType||this.outputPixelType;this.raster=d.raster||d.Raster||this.raster;h=this},filter:function(d){if(null!==d&&null!==d.pixelBlock&&null!==d.pixelBlock.pixels){var f=d.pixelBlock,l=f.pixels,a=f.width*f.height,k=l.length,c;(c=6===h.stretchType||3===h.stretchType&&h.dra)&&h._calculateStatisticsHistograms(d);if(h.dra)if(c)h._statistics=f.statistics,h._histograms=f.histograms;else{var n=
f.statistics;h._statistics=[];for(c=0;c<k;c++)h._statistics[c]=[n[c].minValue,n[c].maxValue,0,0]}else h._statistics=h.statistics,h._histograms=h.histograms;h.computeGamma&&(h.gamma=h._computeGammaValues(f.pixelType),h.useGamma=!0);h._createLUT(d);if(void 0===h.LUT||null===h.LUT)return h._filterNoLUT(d);var n=h.LUT,g=h.LUTOffset,p,e;for(c=0;c<k;c++)for(e=n[c],f=0;f<a;f++)p=l[c][f],l[c][f]=e[p-g];d.pixelBlock.pixelType="U8";return d}},_calculateStatisticsHistograms:function(d){d=d.pixelBlock;var h=
d.pixelType,l=d.pixels,a=d.mask,k=l.length,c,n,g,p,e=function(a){this.min=-.5;this.max=255.5;this.size=256;f.mixin(this,a);this.counts=this.counts||new Uint32Array(this.size)},b=[],u,t,v,w,y,z;for(g=0;g<k;g++){u=new e;t=u.counts;w=l[g];if("U8"===h)if(a)for(p=0;p<d.width*d.height;p++)a[p]&&t[w[p]]++;else for(p=0;p<d.width*d.height;p++)t[w[p]]++;else{c=d.statistics[g].minValue;n=d.statistics[g].maxValue;u.min=c;u.max=n;n=(n-c)/256;v=new Uint32Array(257);if(a)for(p=0;p<d.width*d.height;p++)a[p]&&v[Math.floor((w[p]-
c)/n)]++;else for(p=0;p<d.width*d.height;p++)v[Math.floor((w[p]-c)/n)]++;for(p=0;255>p;p++)t[p]=v[p];t[255]=v[255]+v[256]}b.push(u);w=[];c=d.statistics[g].minValue;n=d.statistics[g].maxValue;for(p=z=y=v=0;p<u.size;p++)v+=t[p],y+=p*t[p];y/=v;for(p=0;p<u.size;p++)z+=t[p]*Math.pow(p-y,2);t=Math.sqrt(z/(v-1));p=(y+.5)*(u.max-u.min)/u.size+u.min;u=t*(u.max-u.min)/u.size;w.push(c);w.push(n);w.push(p);w.push(u);d.statistics[g]=w}d.histograms=b},_getCutOffPoints:function(d){d=d.pixelBlock.pixels.length;var f=
[],l=[],a,k,c,n,g,p;switch(h.stretchType){case 5:for(g=0;g<d;g++)f[g]=h._statistics[g][0],l[g]=h._statistics[g][1];break;case 3:for(g=0;g<d;g++)f[g]=h._statistics[g][2]-h.numberOfStandardDeviations*h._statistics[g][3],l[g]=h._statistics[g][2]+h.numberOfStandardDeviations*h._statistics[g][3],f[g]<h._statistics[g][0]&&(f[g]=h._statistics[g][0]),l[g]>h._statistics[g][1]&&(l[g]=h._statistics[g][1]);break;case 6:for(g=0;g<d;g++){a=h._histograms[g];n=new Uint32Array(a.size);c=a.counts;for(p=k=0;p<a.size;p++)k+=
c[p],n[p]=k;c=h.minPercent*k/100;for(p=1;p<a.size;p++)if(n[p]>c){f[g]=a.min+(a.max-a.min)/a.size*(p-.5);break}c=(1-h.maxPercent/100)*k;for(p=a.size-2;0<=p;p--)if(n[p]<c){l[g]=a.min+(a.max-a.min)/a.size*(p+.5);break}}break;default:for(g=0;g<d;g++)f[g]=0,l[g]=255}return{minCutOff:f,maxCutOff:l}},_createLUT:function(d){var f=d.pixelBlock,l=f.pixelType;if("U8"===l||"U16"===l||"S8"===l||"S16"===l){if(h._LUTSignature&&(l=h._computeLutSignature(),l.length===h._LUTSignature.length&&!l.some(function(a,b){return a!==
h._LUTSignature[b]})))return;var l=f.pixels.length,a=[],k=[],c=[],n,g,p,e=h.max,b=h.min,u=h.gamma,t=e-b,v=h._getCutOffPoints(d);d=v.minCutOff;var v=v.maxCutOff,w=0,y=256,z;"S8"===f.pixelType?w=-127:"S16"===f.pixelType&&(w=-32767);if("U16"===f.pixelType||"S16"===f.pixelType)y=65536;for(f=0;f<l;f++)a[f]=v[f]-d[f];if(h.useGamma&&null!==u&&u.length===l)for(f=0;f<l;f++)c[f]=1<u[f]?2<u[f]?6.5+Math.pow(u[f]-2,2.5):6.5+100*Math.pow(2-u[f],4):1;if(h.useGamma)for(var x,f=0;f<l;f++){z=[];for(n=0;n<y;n++)g=n+
w,x=(g-d[f])/a[f],p=1,1<u[f]&&(p-=Math.pow(1/t,x*c[f])),g<v[f]&&g>d[f]?z[n]=Math.floor(p*t*Math.pow(x,1/u[f]))+b:g>v[f]?z[n]=e:g<d[f]&&(z[n]=b);k[f]=z}else for(f=0;f<l;f++){z=[];for(n=0;n<y;n++)g=n+w,z[n]=g<d[f]?b:g>v[f]?e:Math.floor((g-d[f])/a[f]*t)+b;k[f]=z}h.LUT=k;h.LUTOffset=w;h._LUTSignature=h._computeLutSignature()}},_computeLutSignature:function(){var d=[],f,l;d.push(h.stretchType);d.push(h.min);d.push(h.max);d.push(h.numberOfStandardDeviations);if(h._statistics)for(f=0;f<h._statistics.length;f++)for(l=
0;l<h._statistics[f].length;l++)d.push(h._statistics[f][l]);d.push(h.dra?1:0);d.push(h.minPercent);d.push(h.maxPercent);if(h.gamma)for(f=0;f<h._statistics.length;f++)d.push(h.gamma[f]);d.push(h.useGamma?1:0);return d},_filterNoLUT:function(d){if(null!==d&&null!==d.pixelBlock&&null!==d.pixelBlock.pixels){var f=d.pixelBlock,l=f.pixels,a=f.mask,f=f.width*f.height,k=l.length,c=[],n=[],g,p,e,b,u,t=h.max,v=h.min,w=h.gamma,y=t-v;g=h._getCutOffPoints(d);var z=g.minCutOff,x=g.maxCutOff;for(g=0;g<k;g++)c[g]=
x[g]-z[g];if(h.useGamma&&null!==w&&w.length===k)for(g=0;g<k;g++)n[g]=1<w[g]?2<w[g]?6.5+Math.pow(w[g]-2,2.5):6.5+100*Math.pow(2-w[g],4):1;if(h.useGamma)if(void 0!==a&&null!==a)for(p=0;p<f;p++){if(a[p])for(g=0;g<k;g++)e=l[g][p],u=(e-z[g])/c[g],b=1,1<w[g]&&(b-=Math.pow(1/y,u*n[g])),e<x[g]&&e>z[g]?l[g][p]=Math.floor(b*y*Math.pow(u,1/w[g]))+v:e>x[g]?l[g][p]=t:e<z[g]&&(l[g][p]=v)}else for(p=0;p<f;p++)for(g=0;g<k;g++)e=l[g][p],u=(e-z[g])/c[g],b=1,1<w[g]&&(b-=Math.pow(1/y,u*n[g])),e<x[g]&&e>z[g]?l[g][p]=
Math.floor(b*y*Math.pow(u,1/w[g]))+v:e>x[g]?l[g][p]=t:e<z[g]&&(l[g][p]=v);else if(void 0!==a&&null!==a)for(p=0;p<f;p++){if(a[p])for(g=0;g<k;g++)e=l[g][p],e<x[g]&&e>z[g]?l[g][p]=Math.floor((e-z[g])/c[g]*y)+v:e>x[g]?l[g][p]=t:e<z[g]&&(l[g][p]=v)}else for(p=0;p<f;p++)for(g=0;g<k;g++)e=l[g][p],e<x[g]&&e>z[g]?l[g][p]=Math.floor((e-z[g])/c[g]*y)+v:e>x[g]?l[g][p]=t:e<z[g]&&(l[g][p]=v);d.pixelBlock.pixelType="U8";return d}},_computeGammaValues:function(d){var f=this._statistics.length,h,a=[],k;for(h=0;h<
f;h++)k=this._statistics[h][2],"U8"!==d&&(k=255*(k-this._statistics[h][0])/(this._statistics[h][1]-this._statistics[h][0])),a.push(this._computeGammaValue(k));return a},_computeGammaValue:function(d){if(0!==d&&!(255<d||0>d)){var f=0;0<d&&150!=d&&255>d&&(f=150>=d?45*Math.cos(.01047*d):17*Math.sin(.021*d));f=Math.log((d+f)/255);if(0!==f&&(d=Math.log(d/255)/f,!isNaN(d)))return Math.min(9.9,Math.max(.01,d))}}})})},"esri/layers/StreamLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/_base/lang dojo/has dojo/io-query dojo/on dojo/aspect ../kernel ../request ../graphic ./FeatureLayer ./StreamMode ./StreamTrackManager ../geometry/jsonUtils ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../renderers/SimpleRenderer ./PurgeOptions".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z){n=n([p],{declaredClass:"esri.layers.StreamLayer",_preventInit:!0,constructor:function(a,b){b=b||{};b.mode&&b.mode!==p.MODE_STREAM||(this._isStream=!0,this.currentMode=this.mode=p.MODE_STREAM,this._mode=new e(this));this.purgeOptions=new z(this,b.purgeOptions||{});this.purgeInterval=b.purgeInterval||0;this._reconnectAttempts=0;this.maxReconnectAttempts=10;this.socket=this._reconnectTimeoutId=null;this._keepLatestQueried=!1;this._keepLatestUrl=null;
this._relatedQueried=!1;this._joinField=this._relatedUrl=null;this._refreshing=!1;this._attemptReconnect=d.hitch(this,this._attemptReconnect);this._purge=d.hitch(this,this._purge);this._processServiceJson=d.hitch(this,this._processServiceJson);if(d.isObject(a)&&a.layerDefinition)this._initFeatureLayer(a,b);else{var c=this;r({url:a,content:d.mixin({f:"json"}),callbackParamName:"callback"}).then(function(a){c._processServiceJson(a,b)},function(a){c._errorHandler(a)})}},_processServiceJson:function(a,
b){var c=this;a.relatedFeatures&&a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField?(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=this._joinField=a.relatedFeatures.joinField,r({url:this._relatedUrl,content:{f:"json"},callbackParamName:"callback"}).then(function(d){d=d.fields||[];var e=l.map(a.fields,function(a){return a.name.toLowerCase()});l.forEach(d,function(b){-1===l.indexOf(e,b.name.toLowerCase())&&a.fields.push(b)});b.resourceInfo=a;c._initFeatureLayer(c._url,b)},
function(a){c.onError({error:a})})):(b.resourceInfo=a,this._initFeatureLayer(this._url,b))},_initLayer:function(a,b){this.inherited(arguments);if(a){var c;if(a.layerDefinition)this.purgeOptions=new z(this,this._params.purgeOptions||{}),this.socketUrl=this._params.socketUrl||a.layerDefinition.socketUrl||void 0;else{if(this._params.socketUrl)this.socketUrl=this._params.socketUrl;else{var d=this._getWebsocketConnectionInfo(a),e=d.urls;e&&e.length?(this._socketUrls=e,this.socketUrl=e[0],this.socketDirection=
"broadcast"===this._params.socketDirection?"broadcast":"subscribe",this.socketUrl+="/"+this.socketDirection,this._websocketToken=d.token,e.length>this.maxReconnectAttempts&&(this.maxReconnectAttempts=e.length)):(this.socketUrl=void 0,d="No web socket urls were retrieved from the Stream Service. Layer will not attempt to connect.","https:"===location.protocol&&(d+=" An insecure web socket connection cannot be made from a secure web page."),this.onError(Error(d)))}if(this._params.filter)try{this._filter=
c=this._makeFilter(this._params.filter)}catch(C){this.onError(Error("Error trying to create filter object: "+C+". Layer will not have filter applied")),this._filter=null}if(this._params.geometryDefinition||this._outFields||this._defnExpr){c=c||{};c.geometry=this._params.geometryDefinition;c.outFields=this._outFields;c.where=this._defnExpr;try{this._filter=c=this._makeFilter(c)}catch(C){this.onError(Error("Error trying to create filter object: "+C+". Layer will not have filter applied")),this._filter=
null}}}this.maximumTrackPoints=this._params.maximumTrackPoints||0===this._params.maximumTrackPoints?this._params.maximumTrackPoints:1;(this._params.refreshRate||0===this._params.refreshRate)&&this._mode&&this._mode._setRefreshRate&&this._mode._setRefreshRate(this._params.refreshRate);this._keepLatestUrl=a.keepLatestArchive?a.keepLatestArchive.featuresUrl:null;a.relatedFeatures&&a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField&&(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=
this._joinField=a.relatedFeatures.joinField);this.objectIdField||this._makeObjectIdField();this._map&&this.socketUrl&&!this._connected&&this.connect()}},_setMap:function(a){var c=this.inherited(arguments),d=this._getRenderer();this.timeInfo&&(this._trackIdField||d&&(d.latestObservationRenderer||d.trackRenderer))&&(this._trackManager=new b(this),this._trackManager.initialize(a));this.socketUrl&&!this._connected&&this._map&&this.connect();return c},_unsetMap:function(a,b){l.forEach(this._connects,f.disconnect);
(this._connected||this._reconnecting||this.socket)&&this.disconnect();this._togglePurgeT();this.inherited(arguments);this._map=null},_suspend:function(){this._togglePurgeT();this.inherited(arguments)},_resume:function(){this.inherited(arguments);this._togglePurgeT(!0)},clear:function(){try{this._mode&&this._mode._clearDrawBuffer&&this._mode._clearDrawBuffer(),this._mode&&this._mode._clearTimeBin&&this._mode._clearTimeBin(),this._mode&&this._mode._clearFeatureMap&&this._mode._clearFeatureMap(),this._trackManager&&
this._trackManager.clearTracks()}catch(x){}this.inherited(arguments)},redraw:function(){this._mode&&this._mode._flushDrawBuffer&&this._mode._flushDrawBuffer();this.inherited(arguments)},setDefinitionExpression:function(a){this.setFilter({where:a})},getDefinitionExpression:function(){var a;this._filter&&(a=this._filter.where);return a},destroy:function(){this.disconnect();this.inherited(arguments)},onResume:function(a){this.inherited(arguments)},setGeometryDefinition:function(a){this.setFilter({geometry:a})},
getGeometryDefinition:function(){var a;this._filter&&(a=this._filter.geometry);return a},connect:function(a){var b=this,c={},d=this._filter,e,f,g=this.socketUrl,h;try{if(!this._connected){if(this._map){var k;if(this._relatedUrl&&!this._relatedQueried&&this._mode._fetchArchive)return k=this.on("update-end",function(a){b._relatedQueried=!0;k.remove();k=null;a&&a.error?console.log("Not connecting. Error fetching related features"):b.connect()}),this._mode._fetchArchive(this._relatedUrl),!1;if(this._keepLatestUrl&&
!this._keepLatestQueried&&this._mode._fetchArchive)return k=this.on("update-end",function(a){b._keepLatestQueried=!0;k.remove();k=null;a&&a.error?console.log("Not connecting. Error fetching archived features"):b.connect()}),this._mode._fetchArchive(this._keepLatestUrl),!1}this._websocketToken&&(c.token=this._websocketToken);this._map&&this._map.spatialReference&&this.spatialReference&&this._map.spatialReference.wkid!==this.spatialReference.wkid&&(c.outSR=this._map.spatialReference.wkid);if(d)for(f in d)null!==
d[f]&&(e="geometry"===f?JSON.stringify(d[f]):d[f],c[f]=e);g+="?"+q.objectToQuery(c);return h=this._createConnection(g,a)}}catch(K){console.log("Error connecting to data stream: ",K),a&&a(K,!1),this.onConnectionError({error:K})}},disconnect:function(a){var b=this._refreshing?"Disconnecting as part of layer refresh cycle":"Connection closed from client",c=this._refreshing?!0:!1;this._reconnectTimeoutId&&clearTimeout(this._reconnectTimeoutId);this._refreshing=this._reconnecting=this._connected=!1;this.socket&&
this.socket.close();this.onDisconnect({willReconnect:c,message:b});a&&a(null,!0)},setFilter:function(b){var c,d;if(this._collection)return this.onError("Filter can only be set when the source of the layer is a Stream Service"),!1;try{if(void 0!==b.outFields)return d=Error("Outfields property cannot be changed after layer is created"),this.onFilterChange({filter:this.getFilter(),error:d}),!1;c=this._makeFilter(b)}catch(F){return d=Error(F),this.onFilterChange({filter:this.getFilter(),error:d}),!1}if(this.socket)b=
{filter:c},this.socket.send(JSON.stringify(b));else a.once(this,"connect",function(a){this.setFilter(c)});return!0},getFilter:function(){var a=this._filter,b={},c=["geometry","outFields","where"];a&&l.forEach(c,function(c){var d=a[c];d&&("geometry"===c?d=u.fromJson(d):"outFields"===c&&(d=d.split(",")),b[c]=d)});return b},setMaximumTrackPoints:function(a){if(!a&&0!==a)return!1;this.maximumTrackPoints=a;this._mode.propertyChangeHandler(3)},getUniqueValues:function(a){var b,c={},d=[];b=this._getField(a,
!0);if(!b)return d;a=b.name;l.forEach(this.graphics||[],function(b){b=(b.attributes||{})[a];void 0===b||c[b]||(c[b]=1,d.push(b))});d.sort(function(a,b){return a<b?-1:a>b?1:0});return d},getLatestObservations:function(){var a=[];return a=this._trackManager?this._trackManager.getLatestObservations():this.graphics},setPurgeInterval:function(a){var b=this.purgeInterval;this.purgeInterval=a;this._togglePurgeT();a&&this._togglePurgeT(!0);if(b!==a)this.onPurgeIntervalChange();return this},_togglePurgeT:function(a){if(a&&
this.purgeInterval){var b=this;clearTimeout(this._purgeT);this._mode&&this._mode._flushDrawBuffer&&(this._purgeT=setTimeout(function(){b.updating||b.suspended||(b._mode._flushDrawBuffer(),b._togglePurgeT(!0))},6E4*this.purgeInterval))}else this._purgeT&&(clearTimeout(this._purgeT),this._refreshT=null)},onMessage:function(){},onConnect:function(){},onDisconnect:function(){},onFilterChange:function(){},onAttemptReconnect:function(){},onConnectionError:function(){},onPurgeIntervalChange:function(){},
_createConnection:function(a,b){var c=this,d=new WebSocket(a);d.onopen=function(){c.socket=d;c._connected=!0;c._reconnecting=!1;c._reconnectAttempts=0;c._bind();c.onConnect();b&&b(null,!0)};d.onclose=function(a){var b,d=!0,e=c._connected,f=null;if(c._connected||c._reconnecting){if(a.code)if(b="Connection failed: ",1001===a.code)b+=a.reason||"Service is going away.",d=!1;else if(4400===a.code)b+=a.reason||"Invalid url parameters. Check filter properties.",d=!1;else if(4404===a.code)b+="Service not found",
d=!1;else if(4401===a.code||4403===a.code)b+="Not authorized",d=!1;d&&(c._reconnectAttempts+=1,c._reconnectAttempts>c.maxReconnectAttempts&&(b="Maximum reconnect attempts exceeded",d=!1,e=!0));c._connected=!1;e&&(b&&(f=Error(b)),c.onDisconnect({error:f,willReconnect:d}));d?c._attemptReconnect():c.socket=null}else c.socket||(f=Error("Could not make connection to service"),c.onConnectionError({error:f})),c.socket=null,c._connected=!1};d.onerror=function(a){console.log("Socket error")};return d},_purge:function(){var a,
b=[],c;if(this.purgeOptions.displayCount&&this.graphics.length>this.purgeOptions.displayCount)for(a=0;a<this.graphics.length-this.purgeOptions.displayCount;a++)c=this.graphics[a],b.push(c);0<b.length&&(this._mode._removeFeatures(b),this._trackManager&&this._trackManager.removeFeatures(b))},_bind:function(){var a=this;this.socket.onmessage=function(b){a._onMessage(JSON.parse(b.data))}},_onMessage:function(a){var b=this;this.onMessage(a);var c={create:function(a){b._create(a)},update:function(a){b._update(a)},
"delete":function(a){b._delete(a)}};if(a.type)c[a.type](a.feature);else a.hasOwnProperty("filter")?b._handleFilterMessage(a):this._create(a)},_create:function(a){function b(a){if(!c._featureHasOID(a,d)){if(!a.geometry)return!1;a.attributes=a.attributes||{};a.attributes[d]=c._nextId++}a=a.declaredClass?a:new g(a);c._mode.drawFeature(a)}var c=this,d=c.objectIdField;a.length?a.forEach(function(a){a&&b(a)}):a&&b(a)},_delete:function(a){var b=this,c=a[b.objectIdField]||a.attributes[b.objectIdField],d=
!1;this.graphics.forEach(function(a){a.attributes[b.objectIdField]==c&&(d=a)});d&&this.remove(d)},_update:function(a){var b=this,c=!1;this.graphics.forEach(function(d){d.attributes[b.objectIdField]==a.attributes[b.objectIdField]&&(c=d)});c&&(a.attributes&&c.setAttributes(a.attributes),a.geometry&&c.setGeometry(u.fromJson(a.geometry)))},_makeFilter:function(a){var b,c=null;a=a||{};if(void 0!==a.geometry)if(c=c||{},null===a.geometry)c.geometry=null;else{b="string"===typeof a.geometry?u.fromJson(JSON.parse(a.geometry)):
a.geometry.declaredClass?a.geometry:u.fromJson(a.geometry);if(!b||"point"===b.type)throw"Query object contains invalid geometry";"extent"!==b.type&&(b=b.getExtent());if(!b||0===b.getHeight()&&0===b.getWidth())throw"Invalid filter geometry: Extent cannot have a height and width of 0";c.spatialRel="esriSpatialRelIntersects";c.geometryType="esriGeometryEnvelope";c.geometry=b.toJson()}void 0!==a.where&&(c=c||{},c.where=a.where);if(void 0!==a.outFields&&(c=c||{},a="string"===typeof a.outFields?"*"===a.outFields?
null:a.outFields.replace(/,\s+/g,",").split(","):null===a.outFields?null:a.outFields,a=this._makeOutFields(a))){if(a.errors&&0<a.errors.length)throw"Invalid filter outFields. "+a.errors.join(",");c.outFields=a.fields?a.fields.join(","):null}return c},_makeOutFields:function(a){var b=this,c=[],d=[],e={fields:null};if(!a||0===a.length)return e;l.forEach(a,function(a){if("*"===a)return e;var f=b._getField(a,!0);f?c.push(f.name):d.push("Field named "+a+" not found in schema.")});a=b._getOutFields();l.forEach(a,
function(a){b._getField(a)&&-1===l.indexOf(c,a)&&c.push(a)});e.fields=c;e.errors=d;return e},_handleFilterMessage:function(a){a.error?(a=Error(a.error.join(",")),this.onFilterChange({filter:this.getFilter(),error:a})):(a=a.filter,a.geometry&&"string"===typeof a.geometry&&(a.geometry=JSON.parse(a.geometry)),this._filter=a,this.onFilterChange({filter:this.getFilter()}))},_getWebsocketConnectionInfo:function(a){var b={urls:[]},c,d=[],e=[],f,g,h;a.streamUrls&&l.forEach(a.streamUrls,function(a){"ws"===
a.transport&&(c=a.urls,b.token=a.token)});if(!c)return b;l.forEach(c,function(a){0===a.lastIndexOf("wss",0)?e.push(a):d.push(a)});a="https:"===location.protocol||0===this.url.lastIndexOf("https:",0)?e:0===d.length?e:d;if(1<a.length)for(f=0;f<a.length-1;f++)g=f+Math.floor(Math.random()*(a.length-f)),h=a[g],a[g]=a[f],a[f]=h;b.urls=a;return b},_attemptReconnect:function(){var a=this,b;this._reconnectTimeoutId=null;a._connected=!1;if(!a._socketUrls)return!1;if(!a._collection&&!a._reconnecting&&a.socket&&
a.credential)return a._reconnecting=!0,a._getServiceConnectionMetadata(a._attemptReconnect),!1;a._reconnecting=!0;a.socket=null;if(a._reconnectAttempts>a.maxReconnectAttempts)return a._reconnecting=!1;a.socketUrl=a._socketUrls[a._reconnectAttempts>a._socketUrls.length-1?a._reconnectAttempts%a._socketUrls.length:a._reconnectAttempts];a.socketUrl+="/"+a.socketDirection;b=a._randomIntFromInterval(0,1E3);this._reconnectTimeoutId=setTimeout(function(){a.onAttemptReconnect({count:a._reconnectAttempts,url:a.socketUrl});
a.connect()},1E3*a._reconnectAttempts+b)},_getServiceConnectionMetadata:function(a){var b=this,c=b._url.path;a="function"===typeof a?a:null;r({url:c,content:d.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(function(c){c=b._getWebsocketConnectionInfo(c);b._websocketToken=c.token;a&&a()},function(a){b.onError(Error(a))})},_setDefaultRenderer:function(){var a=this.geometryType,b=new h([5,112,176,.8]),c=new h([255,255,255]),c=new v(v.STYLE_SOLID,c,1),d;if("esriGeometryPoint"===
a||"esriGeometryMultipoint"===a)d=new w(w.STYLE_CIRCLE,10,c,b);else if("esriGeometryPolyline"===a)d=new v(v.STYLE_SOLID,b,2);else if("esriGeometryPolygon"===a||"esriGeometryEnvelope"===a)b=new h([5,112,176,.2]),c=new h([5,112,176,.8]),c=new v(v.STYLE_SOLID,c,1),d=new t(t.STYLE_SOLID,c,b);d&&this.setRenderer(new y(d))},_makeObjectIdField:function(){var a=1,b,c,d=[];if(!this.objectIdField){b=this.fields.length;for(c=0;c<b;c++)d.push(this.fields[c].name.toLowerCase());for(;-1!==l.indexOf(d,"objectid_"+
a);)a+=1;this.objectIdField="objectid_"+a;this.fields.push({name:"objectid_"+a,type:"esriFieldTypeOID",alias:"objectid_"+a,nullable:!1})}},_featureHasOID:function(a,b){return a.attributes&&(a.attributes[b]||0===a.attributes[b])},_randomIntFromInterval:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)}});m("extend-esri")&&d.setObject("layers.StreamLayer",n,c);return n})},"esri/layers/StreamTrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Polyline ./TrackManager".split(" "),
function(n,f,l,h,d,m,q,a){n=n([a],{declaredClass:"esri.layers._StreamTrackManager",constructor:function(a){this.inherited(arguments)},initialize:function(a){this.inherited(arguments)},addFeatures:function(a,c){function d(a,c){var d,e,g,h;f[a]||(f[a]=[]);d=f[a];0<b&&(c.length>b&&c.splice(0,c.length-b),g=c.length+d.length,g>b&&(e=d.splice(0,g-b)));g=c.length;for(h=0;h<g;h+=1)d.push(c[h]);return{deletes:e,adds:c}}var f,h,e,b,k={},m={},n;if(c)return this.inherited(arguments),k;f=this.trackMap;h=this.layer;
e=h._trackIdField;b=h.maximumTrackPoints||0;l.forEach(a,function(a){var b=a.attributes[e];a.visible&&(m[b]||(m[b]=[]),m[b].push(a))});for(n in m)m.hasOwnProperty(n)&&(h=d(n,m[n]),k[n]=h);return k},removeFeatures:function(a){var c=[],d=this.layer.objectIdField,f=this.layer._trackIdField;a&&(l.forEach(a,function(a){var e,b,g,h;b=a.attributes[f];e=a.attributes[d];if(g=this.trackMap[b])for(a=0;a<g.length;a+=1)if(h=g[a],h.attributes[d]===e){this.trackMap[b].splice(a,1);-1===l.indexOf(b)&&c.push(b);break}},
this),0<a.length&&this.refreshTracks(c))},drawTracks:function(a){function c(a){var c=h[a],g=c&&1<c.length,k,l,p;(p=d.trackLineMap[a])&&!g&&(f.remove(p),delete d.trackLineMap[a],p=null);if(!g)return!1;g=[];for(k=c.length-1;0<=k;--k)(l=c[k].geometry)&&g.push([l.x,l.y]);c={};c[b]=a;1<g.length&&(p?(a=p.geometry,a.removePath(0),a.addPath(g),p.setGeometry(a)):(p=new m(new q({paths:[g],spatialReference:e}),null,c),f.add(p),d.trackLineMap[a]=p))}var d=this,f=this.container,h,e,b,k;if(f)if(h=this.trackMap,
e=this.map.spatialReference,b=this.layer._trackIdField,a)l.forEach(a,function(a){c(a)});else for(k in h)h.hasOwnProperty(k)&&c(k)},refreshTracks:function(a){function c(a){var b,c;a=d[a]||[];b=a.length;for(c=0;c<b;c++)f._repaint(a[c],null,!0)}var d=this.trackMap,f=this.layer;f._getRenderer();var h;this.drawTracks(a);if(a)l.forEach(a,function(a){c(a)});else for(h in d)d.hasOwnProperty(h)&&c(h)},getLatestObservations:function(){var a,c,d=this.trackMap,f=[];for(a in d)d.hasOwnProperty(a)&&(c=d[a],f.push(c[c.length-
1]));return f},destroy:function(){this.inherited(arguments);this.trackLineMap=null}});h("extend-esri")&&f.setObject("layers._StreamTrackManager",n,d);return n})},"esri/layers/PurgeOptions":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/has","../kernel"],function(n,f,l,h,d){n=n([l],{declaredClass:"esri.layers.PurgeOptions",constructor:function(d,f){this.parent=d;for(var a in f)this[a]=f[a]},_displayCountSetter:function(d){this.displayCount=d;this.parent.refresh()}});
h("extend-esri")&&f.setObject("layers.PurgeOptions",n,d);return n})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),function(n,f,l,h,d,m,q){n=n([m,q],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(a,d){this._initialize(a,d);this.useMapImage=d&&d.useMapImage||!1},refresh:function(a){if(a)this.inherited(arguments);else{var d=this.disableClientCaching;
this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=d}},exportMapImage:function(a,h){var c=d.defaults.map,c=f.mixin({size:c.width+","+c.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete c._ts;this._exportMapImage(this._url.path+"/exportImage",c,h)}});l("extend-esri")&&f.setObject("layers.ArcGISImageServiceLayer",n,h);return n})},"esri/layers/ArcGISImageServiceVectorLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/sniff ../kernel ../lang ./GraphicsLayer ./ImageServiceLayerMixin ../renderers/VectorFieldRenderer ../geometry/Point ../geometry/Extent ../graphic dojox/gfx".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e){n=n([a,k],{declaredClass:"esri.layers.ArcGISImageServiceVectorLayer",constructor:function(a,d){this.symbolTileSize=d&&d.symbolTileSize?d.symbolTileSize:50;this._maxMag=this._minMag=null;this.setVectorRendererStyle(d&&d.rendererStyle?d.rendererStyle:c.STYLE_SINGLE_ARROW);var b=f.clone(this._params);delete b.imageServiceParameters;delete b.pixelFilter;delete b.rendererStyle;delete b.symbolTileSize;this._initialize(a,d);this.geometryType="esriGeometryPoint";this.symbolTileSizeUnits=
"Pixels";f.mixin(this._params,b)},getField:function(a){return this._getField(a,!0)},setVectorRendererStyle:function(a){this.rendererStyle=a;this._updateVectorFieldRenderer();this.useDefaultRenderer=!0},setRenderer:function(){this.useDefaultRenderer=!1;this.inherited(arguments)},getFlowRepresentation:function(){return this._vectorFlowRepresentation},onRendererChange:function(){},onResume:function(){this.inherited(arguments);this._toggleTime()},onSuspend:function(){this.inherited(arguments);this._toggleTime()},
_refresh:function(a){if(10>d("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else if(!1===this.hasMultidimensions)this.onError(Error("Unable to refresh. This layer does not have multi-dimensional info."));else{this.setImageFormat("LERC",!0);a=this.fullExtent.xmin;var b=this.fullExtent.ymax,c=f.clone(this._map.extent),e=1/this.symbolTileSize*this._map.width,e=e?Math.ceil(e):50,g=1/this.symbolTileSize*this._map.height,g=g?Math.ceil(g):Math.ceil((c.ymax-
c.ymin)/(c.xmax-c.xmin)*e),h=(c.xmax-c.xmin)/e,k=(c.ymax-c.ymin)/g;c.xmin=a+Math.floor((c.xmin-a)/h)*h;c.xmax=a+Math.ceil((c.xmax-a)/h)*h;c.ymin=b+Math.floor((c.ymin-b)/k)*k;c.ymax=b+Math.ceil((c.ymax-b)/k)*k;this._requestData(c,e,g)}},_drawPixelData:function(){this.clear();if(this.pixelData){var a=this.pixelData.pixelBlock,c=this.pixelData.extent,d=this.pixelData.locations,f=q.isDefined(a.mask)&&0<a.mask.length;if(a&&c&&d){if(this.useDefaultRenderer&&this.renderer&&(!q.isDefined(this._minMag)||!q.isDefined(this._maxMag))){var k=
this._getServiceMinMaxStats();k?(this._minMag=k.min,this._maxMag=k.max):(this._minMag=a.statistics[0].minValue,this._maxMag=a.statistics[0].maxValue);var k={type:"sizeInfo",minSize:e.px2pt(.2*this.symbolTileSize),maxSize:e.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},l=[];l.push(k);l.push({type:"colorInfo"});this.renderer.setVisualVariables(l)}for(var m=l=k=0,n,A=c.spatialReference?c.spatialReference._getInfo():null,k=0;k<a.height;k++)for(l=0;l<a.width;l++,m++)if(n=
d[m],(!f||a.mask[m])&&n&&2===n.length){n=new r(n[0],n[1],c.spatialReference);A&&(n.x=g.prototype._normalizeX(n.x,A).x);var B={Magnitude:a.pixels[0][m],Direction:a.pixels[1][m],Location:h.toJson(n.toJson())};n=new p(n,null,B);this.add(n)}}}},_getServiceMinMaxStats:function(){if(!q.isDefined(this.minValues)||!q.isDefined(this.maxValues)||2>this.minValues.length||2>this.maxValues.length)return null;var a=this.minValues[0],c=this.maxValues[0],d=this.minValues[1],e=this.maxValues[1];if(this.pixelFilter&&
a&&c&&d&&e){var f=[];f.push([a,c]);f.push([d,e]);d=this._createPixelData(f);this.pixelFilter(d);d&&d.pixelBlock&&d.pixelBlock.pixels&&0<d.pixelBlock.pixels.length&&(a=d.pixelBlock.pixels[0][0],c=d.pixelBlock.pixels[0][1])}return a&&c?{min:a,max:c}:null},_updateVectorFieldRenderer:function(){var a={type:"sizeInfo",minSize:e.px2pt(.2*this.symbolTileSize),maxSize:e.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},d=[];d.push(a);a=new c({style:this.rendererStyle,visualVariables:d,
flowRepresentation:this._vectorFlowRepresentation});this.setRenderer(a)},_getField:function(a,c){if(q.isDefined(a))return c&&(a=a.toLowerCase()),"magnitude"!==a&&"direction"!==a?null:{name:a,alias:a,domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"}},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_setFlowRepresentation:function(a){a&&this.renderer&&q.isDefined(a.FlowDirection)&&(this._vectorFlowRepresentation="oceanographic"===a.FlowDirection.toLowerCase()?
this.renderer.FLOW_TO:this.renderer.FLOW_FROM);this.renderer&&(this.renderer.flowRepresentation=this._vectorFlowRepresentation)}});d("extend-esri")&&f.setObject("layers.ArcGISImageServiceVectorLayer",n,m);return n})},"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(n,f){return n(f,{constructor:function(f,h){this.noLegend=!0},getExtent:function(){},initVisible:function(){},_setTopLayerVisible:function(f){},setLayerVisiblefromTopLayer:function(){},
getOpacity:function(){},setOpacity:function(f){},isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred dojo/aspect ./LayerInfoForDefault esri/dijit/PopupTemplate esri/layers/FeatureLayer".split(" "),function(n,f,l,h,d,m,q,a){return n(m,{isTable:null,constructor:function(){this.newSubLayers=[];this.isTable=!0},init:function(){},getLayerObject:function(){var d=
new h;if(this.layerObject.empty)if(this.layerObject.url){var c=this._getLayerOptionsForCreateLayerObject();this.layerObject=new a(this.layerObject.url,f.mixin(c,this.originOperLayer.options||{})||{});this.layerObject.on("load",f.hitch(this,function(){this.layerObject.empty||!this.layerObject.name||f.getObject("_wabProperties.originalLayerName",!1,this.layerObject)||(f.setObject("_wabProperties.originalLayerName",this.layerObject.name,this.layerObject),this.layerObject.name=this.title);this._bindEventAfterLayerObjectLoaded();
d.resolve(this.layerObject)}));this.layerObject.on("error",f.hitch(this,function(){d.resolve(null)}))}else this.layerObject.featureCollectionData?(this.layerObject=new a(this.layerObject.featureCollectionData,this.originOperLayer.options||{}),d.resolve(this.layerObject)):d.resolve(null);else d.resolve(this.layerObject);return d},getLayerType:function(){var a=new h;a.resolve("Table");return a},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return l.create("div",
{"class":"legends-div"})},_initControlPopup:function(){this.inherited(arguments);this.controlPopupInfo={enablePopup:this.originOperLayer.popupInfo?!0:!1,infoTemplate:this.originOperLayer.popupInfo?new q(this.originOperLayer.popupInfo):null}},_bindEventAfterLayerObjectLoaded:function(){var a=d.after(this.layerObject,"setDefinitionExpression",f.hitch(this,this._onFilterChanged));this._eventHandles.push(a)},getFilter:function(){return this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?
this.layerObject.getDefinitionExpression():this.getFilterOfWebmap()},setFilter:function(){var a=arguments;return this.getLayerObject().then(f.hitch(this,function(){this.inherited(a)}))}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/aspect esri/request ./LayerInfoForDefault".split(" "),function(n,f,l,h,d,m,q,a,k){return n(k,{constructor:function(){this._addImageServiceLayerType()},
_addImageServiceLayerType:function(){this.layerObject.type=!this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-UV"!==this.layerObject.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.layerObject.serviceDataType?"ArcGISImageServiceLayer":"ArcGISImageServiceVectorLayer"},_initLegendsNode:function(a){10.2<=this.layerObject.version?this._legendRequestServer().then(h.hitch(this,function(c){f.empty(a);l.forEach(c.layers,function(c){l.forEach(c.legend,function(c){if("\x3call other values\x3e"!==
c.label){var d=f.create("div",{"class":"legend-div"},a),b=f.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},d),g=null,g=c.imageData?"data:"+c.contentType+";base64,"+c.imageData:c.url;f.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:g},b);f.create("div",{"class":"legend-label jimu-float-leading",innerHTML:c.label||" "},d)}},this)},this)}),h.hitch(this,function(){f.empty(a)})):
f.empty(a)},_legendRequestServer:function(){var c=this.layerObject.url+"/legend",d={f:"json"};this.layerObject._params.bandIds&&(d.bandIds=this.layerObject._params.bandIds);this.layerObject._params.renderingRule&&(d.renderingRule=this.layerObject._params.renderingRule);return a({url:c,content:d,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var a=new d,f={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},g=this.getLayerType(),k=this.getLayerObject();m({type:g,layerObject:k}).then(h.hitch(this,
function(c){var b=c.type;c=c.layerObject;f.layerType=b;0<=this._getLayerTypesOfSupportTable().indexOf(b)&&(f.isSupportedLayer=!0);c.capabilities&&0<=c.capabilities.indexOf("Catalog")?f.isSupportQuery=!0:f.isSupportedLayer=!1;a.resolve(f)}),function(){a.resolve(f)});return a},_bindEvent:function(){var a;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(a=q.after(this.layerObject,"setRenderingRule",h.hitch(this,this._onRendererChanged)),this._eventHandles.push(a))}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(n,f,l,h,d){return n(d,{getSupportTableInfo:function(){var d=new l,n={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,otherReasonCanNotSupport:!0},a=this.getLayerType(),k=this.getLayerObject();h({type:a,layerObject:k}).then(f.hitch(this,function(a){var c=a.type;a=a.layerObject;n.layerType=c;0<=this._getLayerTypesOfSupportTable().indexOf(c)&&(n.isSupportedLayer=!0);(c=a.getLatestObservations())&&0<c.length&&
(n.otherReasonCanNotSupport=!1);d.resolve(n)}),function(){d.resolve(n)});return d}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(n,f,l,h,d,m,q,a,k){return m("dijit.layout._LayoutWidget",[f,l,h],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);q.add(this.domNode,
"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var a=this.getParent&&this.getParent();a&&a.isLayoutContainer||(this.resize(),this.own(d.on("resize",n.hitch(this,"resize"))))}},resize:function(c,d){var f=this.domNode;c&&a.setMarginBox(f,c);var h=d||{};n.mixin(h,c||{});"h"in h&&"w"in h||(h=n.mixin(a.getMarginBox(f),h));var e=k.getComputedStyle(f),b=a.getMarginExtents(f,e),l=a.getBorderExtents(f,e),h=this._borderBox={w:h.w-(b.w+l.w),h:h.h-(b.h+l.h)},b=a.getPadExtents(f,
e);this._contentBox={l:k.toPixelValue(f,e.paddingLeft),t:k.toPixelValue(f,e.paddingTop),w:h.w-b.w,h:h.h-b.h};this.layout()},layout:function(){},_setupChild:function(a){q.add(a.domNode,this.baseClass+"-child "+(a.baseClass?this.baseClass+"-"+a.baseClass:""))},addChild:function(a,d){this.inherited(arguments);this._started&&this._setupChild(a)},removeChild:function(a){q.remove(a.domNode,this.baseClass+"-child"+(a.baseClass?" "+this.baseClass+"-"+a.baseClass:""));this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u){r("dijit-legacy-requires")&&u(0,function(){n(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return l("dijit.Menu",b,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):f.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return p.get(this._iframeContentDocument(a))||
this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(b){b=h.byId(b,this.ownerDocument);var e;if("iframe"==b.tagName.toLowerCase()){var f=b;e=this._iframeContentWindow(f);e=g.body(e.document)}else e=b==g.body(this.ownerDocument)?this.ownerDocument.documentElement:b;var l={node:b,
iframe:f};d.set(b,"_dijitMenu"+this.id,this._bindings.push(l));var p=k.hitch(this,function(b){var d=this.selector,e=d?function(a){return c.selector(d,a)}:function(a){return a},g=this;return[c(b,e(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<g._lastKeyDown+500||g._scheduleOpen(this,f,{x:a.pageX,y:a.pageY},a.target)}),c(b,e("keydown"),function(b){if(93==b.keyCode||b.shiftKey&&b.keyCode==a.F10||g.leftClickToOpen&&b.keyCode==a.SPACE)b.stopPropagation(),
b.preventDefault(),g._scheduleOpen(this,f,null,b.target),g._lastKeyDown=(new Date).getTime()})]});l.connects=e?p(e):[];f&&(l.onloadHandler=k.hitch(this,function(){var a=this._iframeContentWindow(f),a=g.body(a.document);l.connects=p(a)}),f.addEventListener?f.addEventListener("load",l.onloadHandler,!1):f.attachEvent("onload",l.onloadHandler))},unBindDomNode:function(a){var b;try{b=h.byId(a,this.ownerDocument)}catch(x){return}a="_dijitMenu"+this.id;if(b&&d.has(b,a)){for(var c=d.get(b,a)-1,e=this._bindings[c],
f;f=e.connects.pop();)f.remove();(f=e.iframe)&&(f.removeEventListener?f.removeEventListener("load",e.onloadHandler,!1):f.detachEvent("onload",e.onloadHandler));d.remove(b,a);delete this._bindings[c]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(a){function b(){n.refocus&&t&&t.focus();e.close(n)}var c=a.target,d=a.iframe,f=a.coords,g=!f;this.currentTarget=
a.delegatedTarget;if(f){if(d){a=m.position(d,!0);var c=this._iframeContentWindow(d),c=m.docScroll(c.document),k=q.getComputedStyle(d),l=q.toPixelValue,p=(r("ie")&&r("quirks")?0:l(d,k.paddingLeft))+(r("ie")&&r("quirks")?l(d,k.borderLeftWidth):0),d=(r("ie")&&r("quirks")?0:l(d,k.paddingTop))+(r("ie")&&r("quirks")?l(d,k.borderTopWidth):0);f.x+=a.x+p-c.x;f.y+=a.y+d-c.y}}else f=m.position(c,!0),f.x+=10,f.y+=10;var n=this,d=this._focusManager.get("prevNode");a=this._focusManager.get("curNode");var t=!a||
h.isDescendant(a,this.domNode)?d:a;e.open({popup:this,x:f.x,y:f.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});this.focus();g||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);e.close(this)}},destroy:function(){f.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],
function(n,f,l){return n("dgrid.OnDemandGrid",[f,l],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(n,f,l,h,d,m,q){function a(a,c){c&&c.nodeType&&a.appendChild(c)}function k(a,c,d,e){if(this.formatter){e=this.formatter;var b=this.grid.formatterScope;d.innerHTML="string"===typeof e&&b?b[e](c,a):this.formatter(c,a)}else null!=c&&d.appendChild(document.createTextNode(c))}var c=8>h("ie")&&
!h("quirks");f=f("dgrid.Grid",m,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return"object"!=typeof a?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,c){if(a.column&&a.element)return a;a.target&&a.target.nodeType&&(a=a.target);var d;if(a.nodeType){do{if(this._rowIdToObject[a.id])break;var e=a.columnId;if(e){c=e;d=a;break}a=a.parentNode}while(a&&a!=this.domNode)}if(!d&&"undefined"!=typeof c){var b=this.row(a);if(e=b&&b.element)for(var e=e.getElementsByTagName("td"),
f=0;f<e.length;f++)if(e[f].columnId==c){d=e[f];break}}if(null!=a)return{row:b||this.row(a),column:c&&this.column(c),element:d}},createRowCells:function(a,f,k,e){var b=d("table.dgrid-row-table[role\x3dpresentation]"),g=9>h("ie")||h("quirks")?d(b,"tbody"):b,l,p,m,n,r,x,A,B,F,E;k=k||this.subRows;p=0;for(m=k.length;p<m;p++)for(x=k[p],l=d(g,"tr"),x.className&&d(l,"."+x.className),n=0,r=x.length;n<r;n++){A=x[n];B=A.id;F=A.field?".field-"+q.escapeCssIdentifier(A.field,"-"):"";(E="function"===typeof A.className?
A.className(e):A.className)&&(F+="."+E);F=d(a+(".dgrid-cell.dgrid-cell-padding"+(B?".dgrid-column-"+q.escapeCssIdentifier(B,"-"):"")+F.replace(/ +/g,"."))+"[role\x3d"+("th"===a?"columnheader":"gridcell")+"]");F.columnId=B;c?(B=d(F,"!dgrid-cell-padding div.dgrid-cell-padding"),F.contents=B):B=F;if(E=A.colSpan)F.colSpan=E;if(E=A.rowSpan)F.rowSpan=E;f(B,A);l.appendChild(F)}return b},left:function(a,c){a.element||(a=this.cell(a));return this.cell(this._move(a,-(c||1),"dgrid-cell"))},right:function(a,
c){a.element||(a=this.cell(a));return this.cell(this._move(a,c||1,"dgrid-cell"))},renderRow:function(c,f){var g=this.createRowCells("td",function(d,b){var e=c;b.get?e=b.get(c):"field"in b&&"_item"!=b.field&&(e=e[b.field]);b.renderCell?a(d,b.renderCell(c,e,d,f)):k.call(b,c,e,d,f)},f&&f.subRows,c);return d("div[role\x3drow]\x3e",g)},renderHeader:function(){var f=this,g=this.headerNode,k=g.childNodes.length;for(g.setAttribute("role","row");k--;)d(g.childNodes[k],"!");k=this.createRowCells("th",function(d,
b){var e=b.headerNode=d;c&&(d=d.parentNode);var f=b.field;f&&(d.field=f);b.renderHeaderCell?a(e,b.renderHeaderCell(e)):("label"in b||b.field)&&e.appendChild(document.createTextNode("label"in b?b.label:b.field));!1!==b.sortable&&f&&"_item"!=f&&(d.sortable=!0,d.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[k.id=this.id+"-header"]=this.columns;g.appendChild(k);this._sortListener&&this._sortListener.remove();this._sortListener=l(k,"click,keydown",function(a){if("click"==
a.type||32==a.keyCode||!h("opera")&&13==a.keyCode){var b=a.target,c,d,e;do if(b.sortable){e=[{attribute:c=b.field||b.columnId,descending:(d=f._sort[0])&&d.attribute==c&&!d.descending}];c={bubbles:!0,cancelable:!0,grid:f,parentType:a.type,sort:e};l.emit(a.target,"dgrid-sort",c)&&(f._sortNode=b,f.set("sort",e));break}while((b=b.parentNode)&&b!=g)}})},resize:function(){var a=this.headerNode.firstChild,c=this.contentNode,d;this.inherited(arguments);if(!h("ie")||7<h("ie")&&!h("quirks"))c.style.width="",
c&&a&&(d=a.offsetWidth)!=c.offsetWidth&&(c.style.width=d+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(a,c){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(a){var c=this.columns,d;for(d in c){var e=c[d];if(e.field==a)return e.headerNode}},updateSortArrow:function(a,c){this._lastSortedArrow&&(d(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),d(this._lastSortedArrow,
"!"),delete this._lastSortedArrow);c&&(this._sort=a);if(a[0]){var f=a[0].attribute,e=a[0].descending,f=this._sortNode||this._findSortArrowParent(f),b;delete this._sortNode;f&&(f=f.contents||f,b=this._lastSortedArrow=d("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),b.innerHTML="\x26nbsp;",f.insertBefore(b,f.firstChild),d(f,e?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(a,c){return this.addCssRule("#"+q.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+q.escapeCssIdentifier(a,
"-"),c)},_configColumns:function(a,c){var d=[],e=c instanceof Array;q.each(c,function(b,f){"string"==typeof b&&(c[f]=b={label:b});e||b.field||(b.field=f);f=b.id=b.id||(isNaN(f)?f:a+f);this._configColumn&&(this._configColumn(b,f,c,a),f=b.id);e&&(this.columns[f]=b);b.grid=this;"function"===typeof b.init&&b.init();d.push(b)},this);return e?c:d},_destroyColumns:function(){var a=this.subRows,c=a&&a.length,d,e,b,f;this.cleanup();for(d=0;d<c;d++)for(e=0,f=a[d].length;e<f;e++)b=a[d][e],"function"===typeof b.destroy&&
b.destroy()},configStructure:function(){var a=this.subRows,c=this._columns=this.columns;this.columns=!c||c instanceof Array?{}:c;if(a)for(c=0;c<a.length;c++)a[c]=this._configColumns(c+"-",a[c]);else this.subRows=[this._configColumns("",c)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(a){this._destroyColumns();this.subRows=null;this.columns=a;this._updateColumns()},_setSubRows:function(a){this._destroyColumns();this.subRows=a;this._updateColumns()},setColumns:function(a){n.deprecated("setColumns(...)",
'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",a)},setSubRows:function(a){n.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",a)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});f.appendIfNode=a;f.defaultRenderCell=k;return f})},"put-selector/put":function(){(function(n){var f,
l=/[-+,> ]/;n([],f=function(h,d){function m(d){function f(){t&&q&&t!=q&&(q==d&&(p||(p=l.test(z)&&h.createDocumentFragment()))?p:q).insertBefore(t,b||null)}for(var p,e,b,q,t,r=arguments,w=r[0],y=0;y<r.length;y++){var z=r[y];if("object"==typeof z){e=!1;if(z instanceof Array){t=h.createDocumentFragment();for(var x=0;x<z.length;x++)t.appendChild(m(z[x]));z=t}if(z.nodeType)t=z,f(),q=z,b=0;else for(x in z)t[x]=z[x]}else if(e)e=!1,t.appendChild(h.createTextNode(z));else{1>y&&(d=null);e=!0;if(w=z.replace(n,
function(e,g,l,p,n,u){g&&(f(),"-"==g||"+"==g?(q=(b=t||q).parentNode,t=null,"+"==g&&(b=b.nextSibling)):("\x3c"==g?q=t=(t||q).parentNode:(","==g?q=d:t&&(q=t),t=null),b=0),t&&(q=t));if((e=!l&&p)||!t&&(l||n))"$"==e?(e=r[++y],q.appendChild(h.createTextNode(e))):(e=e||m.defaultTag,(g=c&&r[y+1]&&r[y+1].name)&&(e="\x3c"+e+' name\x3d"'+g+'"\x3e'),t=k&&~(a=e.indexOf("|"))?h.createElementNS(k[e.slice(0,a)],e.slice(a+1)):h.createElement(e));if(l)if("$"==p&&(p=r[++y]),"#"==l)t.id=p;else if(g=(e=t.className)&&
(" "+e+" ").replace(" "+p+" "," "),"."==l)t.className=e?(g+p).substring(1):p;else if("!"==z){var v;c?m("div",t,"\x3c").innerHTML="":(v=t.parentNode)&&v.removeChild(t)}else g=g.substring(1,g.length-1),g!=e&&(t.className=g);n&&("$"==u&&(u=r[++y]),"style"==n?t.style.cssText=u:(l="!"==n.charAt(0)?(n=n.substring(1))&&"removeAttribute":"setAttribute",u=""===u?n:u,k&&~(a=n.indexOf("|"))?t[l+"NS"](k[n.slice(0,a)],n.slice(a+1),u):t[l](n,u)));return""}))throw new SyntaxError("Unexpected char "+w+" in "+z);
f();q=w=t||q}}d&&p&&d.appendChild(p);return w}l=d||l;var n=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,a,k=!1;h=h||document;var c="object"==typeof h.createElement;m.addNamespace=function(a,c){h.createElementNS?(k||(k={}))[a]=c:h.namespaces.add(a,c)};m.defaultTag="div";m.forDocument=f;return m})})(function(n,f,l){l=l||f;"function"===typeof define?define([],function(){return l()}):"undefined"==typeof window?require("./node-html")(module,l):put=
l()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),function(n,f,l,h,d,m,q,a,k){function c(a,b){k(document.body,a,".dgrid-scrollbar-measure");var c=a["offset"+b]-a["client"+b];a.className="";document.body.removeChild(a);return c}function r(a){var b=a?"."+a.replace(v,"."):"";this._class&&(b="!"+this._class.replace(v,"!")+
b);k(this.domNode,b);this._class=a}function g(){return this._class}function p(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function e(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)}a("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var b,u;d.add("dom-scrollbar-width",function(a,b,d){return c(d,"Width")});d.add("dom-scrollbar-height",function(a,b,d){return c(d,"Height")});d.add("dom-rtl-scrollbar-left",
function(a,b,c){a=k("div");k(document.body,c,".dgrid-scrollbar-measure[dir\x3drtl]");k(c,a);b=!!d("ie")||!!d("trident")||a.offsetLeft>=d("dom-scrollbar-width");c.className="";document.body.removeChild(c);k(a,"!");c.removeAttribute("dir");return b});var t=0,v=/ +/g,w=7>d("ie")&&!d("quirks")?function(){var a,b,c;this._started&&(a=document.documentElement,b=a.clientWidth,a=a.clientHeight,c=this._prevWinDims||[],c[0]!==b||c[1]!==a)&&(this.resize(),this._prevWinDims=[b,a])}:function(){this._started&&this.resize()};
return f("dgrid.List",d("touch")?q:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){var c=
this.domNode=b||k("div"),e;a?(this.params=a,f.safeMixin(this,a),e=a["class"]||a.className||c.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=c.id=c.id||this.id||"dgrid_"+t++;null===this.useTouchScroll&&(this.useTouchScroll=!d("dom-scrollbar-width"));this.buildRendering();e&&r.call(this,e);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&
this.startup()},buildRendering:function(){var a=this.domNode,b=this.addUiClasses,c=this,e,f,g,l;l=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className="";k(a,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(b?".ui-widget":""));e=this.headerNode=k(a,"div.dgrid-header.dgrid-header-row"+(b?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));(d("quirks")||8>d("ie"))&&k(a,"div.dgrid-spacer");f=this.bodyNode=k(a,"div.dgrid-scroller");
d("ff")&&(f.tabIndex=-1);this.headerScrollNode=k(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(b?".ui-widget-header":""));g=this.footerNode=k("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));k(a,g);l&&(a.className+=" dgrid-rtl"+(d("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));h(f,"scroll",function(b){c.showHeader&&(e.scrollLeft=b.scrollLeft||f.scrollLeft);b.stopPropagation();h.emit(a,"scroll",{scrollTarget:f})});this.configStructure();this.renderHeader();this.contentNode=
this.touchNode=k(this.bodyNode,"div.dgrid-content"+(b?".ui-widget-content":""));this._listeners.push(this._resizeHandle=h(window,"resize",m.throttleDelayed(w,this)))},postCreate:d("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},resize:function(){var a=this.bodyNode,c=this.headerNode,e=this.footerNode,f=c.offsetHeight,
g=this.showFooter?e.offsetHeight:0,h=d("quirks")||7>d("ie");this.headerScrollNode.style.height=a.style.marginTop=f+"px";a.style.marginBottom=g+"px";h&&(a.style.height="",a.style.height=Math.max(this.domNode.offsetHeight-f-g,0)+"px",g&&(e.style.bottom="1px",setTimeout(function(){e.style.bottom=""},0)));b||(b=d("dom-scrollbar-width"),u=d("dom-scrollbar-height"),d("ie")&&(b++,u++),m.addCssRule(".dgrid-scrollbar-width","width: "+b+"px"),m.addCssRule(".dgrid-scrollbar-height","height: "+u+"px"),17==b||
h||(m.addCssRule(".dgrid-header-row","right: "+b+"px"),m.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+b+"px")));h&&(c.style.width=a.clientWidth+"px",setTimeout(function(){c.scrollLeft=a.scrollLeft},0))},addCssRule:function(a,b){var c=m.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(c);return c},on:function(a,b){var c=h(this.domNode,a,b);d("dom-addeventlistener")||this._listeners.push(c);return c},cleanup:function(){var a=this.observers,b;for(b in this._rowIdToObject)if(this._rowIdToObject[b]!=
this.columns){var c=document.getElementById(b);c&&this.removeRow(c,!0)}for(b=0;b<a.length;b++)(c=a[b])&&c.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();delete this._listeners}this._started=!1;this.cleanup();k(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";
this.scrollTo({x:0,y:0})},newRow:function(a,b,c,d,e){if(b){var f=this.insertRow(a,b,c,d,e);k(f,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){k(f,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return f}},adjustRowIndices:function(a){var b=a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&k(a,"."+(1==b%2?"dgrid-row-odd":"dgrid-row-even")+"!"+(0==b%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=
b++);while((a=a.nextSibling)&&a.rowIndex!=b)}},renderArray:function(a,b,c){function d(){var b=arguments;if(-1<q)for(var d=0;d<b.length;d++){var f=b[d],g=m[f?0:m.length-1];if(g=g&&e(g)){var k=g[f?"previousSibling":"nextSibling"];k&&(k=h.row(k));k&&k.element!=g&&(f=f?"unshift":"push",a[f](k.data),m[f](k.element),c.count++)}}}function e(a){return!l.isDescendant(a,h.domNode)&&document.getElementById(a.id)?h.row(a.id.slice(h.id.length+5)).element:a}function f(a){u=h.insertRow(a,r,null,k++,c);u.observerIndex=
q;return u}function g(a){v=a.slice(0);(n=b?b.parentNode:h.contentNode)&&n.parentNode&&(n!==h.contentNode||a.length)?(n.insertBefore(r,b||null),(u=a[a.length-1])&&h.adjustRowIndices(u)):p[q]&&h.cleanEmptyObservers&&"undefined"!==typeof q&&(p[q].cancel(),p[q]=0,h._numObservers--);m=a;t&&(t.rows=m)}c=c||{};var h=this,k=c.start||0,p=this.observers,m,n,q;b||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){h._numObservers++;var t=a.observe(function(f,g,k){var l,p,t;-1<g&&m[g]&&(l=m.splice(g,
1)[0],l.parentNode==n&&((p=l.nextSibling)&&g!=k&&p.rowIndex--,h.removeRow(l)),c.count--,h._processScroll&&h._processScroll());if(-1<k){if(m.length)if(0===k)t=(t=m[k])&&e(t);else{if(t=m[k-1])t=e(t),t=(t.connected||t).nextSibling}else t=h._getFirstRowSibling&&h._getFirstRowSibling(n);l&&t&&l.id===t.id&&(t=(t.connected||t).nextSibling);t&&!t.parentNode&&(t=document.getElementById(t.id));l=b&&b.parentNode||t&&t.parentNode||h.contentNode;if(l=h.newRow(f,l,t,c.start+k,c))if(l.observerIndex=q,m.splice(k,
0,l),!p||k<g)p=(p=l.previousSibling)&&p.rowIndex+1!=l.rowIndex&&0!=l.rowIndex?p:l;c.count++}0===g?d(1,1):g===a.length-(-1===k?0:1)&&d(0,0);g!=k&&p&&h.adjustRowIndices(p);h._onNotification(m,f,g,k)},!0);q=p.push(t)-1}var r=document.createDocumentFragment(),u,v;if(a.map){if(m=a.map(f,console.error),m.then)return a.then(function(b){a=b;return m.then(function(a){g(a);d(1,1,0,0);return v})})}else{m=[];for(var w=0,y=a.length;w<y;w++)m[w]=f(a[w])}g(m);d(1,1,0,0);return v},_onNotification:function(a,b,c,
d){},renderHeader:function(){},_autoId:0,insertRow:function(a,b,c,d,e){var f=e.parentId,f=this.id+"-row-"+(f?f+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),g=document.getElementById(f),h=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g));g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1==d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,
c||null);h&&this.adjustRowIndices(h);g.rowIndex=d;return g},renderRow:function(a,b){return k("div",""+a)},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||k(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!=this.domNode)}else return"object"==typeof a?b=this.store.getIdentity(a):
(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){f=e;b+=0>b?1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||e===this.headerNode)break;while(b);return f},up:function(a,b,c){a.element||
(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:d("touch")?function(a){return this.useTouchScroll?this.inherited(arguments):e.call(this,a)}:e,getScrollPosition:d("touch")?function(){return this.useTouchScroll?this.inherited(arguments):p.call(this)}:p,get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,
1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:g,_setClass:r,_getClassName:g,_setClassName:r,_setSort:function(a,b){this._sort="string"!=typeof a?a:[{attribute:a,descending:b}];this.refresh();this._lastCollection&&(a.length&&("string"!=typeof a&&(b=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(c,
d){var e=c[a],f=d[a];void 0===e&&(e="");void 0===f&&(f="");return e==f?0:e>f==!b?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,b){n.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",a,b)},_getSort:function(){return this._sort},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a;k(b,(a?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();a&&(b.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){n.deprecated("setShowHeader(...)",
'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;k(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has","put-selector/put"],function(n,f){n.add("dom-contains",function(a,c,d){return!!d.contains});var l=[],h,d,m,q=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,a={defaultDelay:15,throttle:function(d,c,f){var g=!1;f=f||a.defaultDelay;return function(){g||(g=!0,d.apply(c,arguments),
setTimeout(function(){g=!1},f))}},throttleDelayed:function(d,c,f){var g=!1;f=f||a.defaultDelay;return function(){if(!g){g=!0;var a=arguments;setTimeout(function(){g=!1;d.apply(c,a)},f)}}},debounce:function(d,c,f){var g;f=f||a.defaultDelay;return function(){g&&(clearTimeout(g),g=null);var a=arguments;g=setTimeout(function(){d.apply(c,a)},f)}},each:function(a,c,d){var f,h;if(a)if("number"===typeof a.length)for(f=0,h=a.length;f<h;f++)c.call(d,a[f],f,a);else for(f in a)c.call(d,a[f],f,a)},contains:function(a,
c){return n("dom-contains")?a.contains(c):a.compareDocumentPosition(c)&8},addCssRule:function(a,c){h||(h=f(document.getElementsByTagName("head")[0],"style"),h=h.sheet||h.styleSheet,d=h.deleteRule?"deleteRule":"removeRule",m=h.cssRules?"cssRules":"rules");var k=l.length;l[k]=(h.cssRules||h.rules).length;h.addRule?h.addRule(a,c):h.insertRule(a+"{"+c+"}",l[k]);return{get:function(a){return h[m][l[k]].style[a]},set:function(a,c){"undefined"!==typeof l[k]&&(h[m][l[k]].style[a]=c)},remove:function(){var a=
l[k],c,e;if(void 0!==a)for(h[d](a),l[k]=void 0,c=k+1,e=l.length;c<e;c++)l[c]>a&&l[c]--}}},escapeCssIdentifier:function(a,c){return"string"===typeof a?a.replace(q,c||"\\$1"):a}};return a})},"xstyle/has-class":function(){define(["dojo/has"],function(n){var f={};return function(){for(var l,h=arguments,d=0;d<h.length;d++)if(l=h[d],!f[l]){f[l]=!0;var m=l.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),q=n(m[2]),a=-m[4];(0<a?a<=q&&(-m[5]||a)>=q:!!q)==!m[1]&&(document.documentElement.className+=" has-"+l)}}})},
"xstyle/css":function(){define(["require"],function(n){function f(f,h,d){var l=document.documentElement;f=l.insertBefore(document.createElement(f),l.firstChild);f.id=h;h=(f.currentStyle||getComputedStyle(f,null)||{})[d];l.removeChild(f);return h}return{load:function(l,h,d,m){function q(a){var c=f("x-parse",null,"content"),k=a&&(a.sheet||a.styleSheet);c&&"none"!=c&&"normal"!=c?h([eval(c)],function(c){a?c.process(a,d):(c.processAll(),d(k))}):d(k)}var a=h.toUrl(l),k;a.match(/!$/)&&(k={wait:!1},a=a.slice(0,
-1));var c=h.cache&&h.cache["url:"+a];if(c)c.xCss&&(c=c.cssText),n(["./core/load-css"],function(a){q(a.insertCss(c))});else{if("none"==f("div",l.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return q();n(["./core/load-css"],function(c){c(a,q,k)})}}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(n,f,l,h,d,m,q,a,k){return l("dgrid.OnDemandList",[n,
f],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:a.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);var c=this;q(this.bodyNode,"scroll",a[this.pagingMethod](function(a){c._processScroll(a)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(a,f){function c(a){k(y,
"!");if(a)throw l._refreshDeferred&&(l._refreshDeferred.reject(a),delete l._refreshDeferred),a;}var l=this,e=f&&f.container||this.contentNode,b={query:a,count:0,options:f},m,n=this.preload,q,r={node:k(e,"div.dgrid-preload",{rowIndex:0}),count:0,query:a,next:b,options:f};r.node.style.height="0";b.node=m=k(e,"div.dgrid-preload");b.previous=r;m.rowIndex=this.minRowsPerPage;n?((b.next=n.next)&&m.offsetTop>=n.node.offsetTop?b.previous=n:(b.next=n,b.previous=n.previous),b.previous.next=b,b.next.previous=
b):this.preload=b;var y=k(m,"-div.dgrid-loading");k(y,"div.dgrid-below").innerHTML=this.loadingMessage;f=h.mixin(this.get("queryOptions"),f,{start:0,count:this.minRowsPerPage},"level"in a?{queryLevel:a.level}:null);this._trackError(function(){return q=a(f)});if("undefined"===typeof q)c();else return d.when(l.renderArray(q,m,f),function(a){return d.when("undefined"===typeof q.total?q.length:q.total,function(c){var d=a.length,e=m.parentNode,g=l.noDataNode;k(y,"!");"queryLevel"in f||(l._total=c);0===
c&&e&&(g&&(k(g,"!"),delete l.noDataNode),l.noDataNode=g=k("div.dgrid-no-data"),e.insertBefore(g,l._getFirstRowSibling(e)),g.innerHTML=l.noDataMessage);for(g=e=0;g<d;g++)e+=l._calcRowHeight(a[g]);d&&e&&(l.rowHeight=e/d);e=l.rowHeight*l.bufferRows;e>l.farOffRemoval&&(l.farOffRemoval=e);c-=d;b.count=c;m.rowIndex=d;c?m.style.height=Math.min(c*l.rowHeight,l.maxEmptySpace)+"px":(m.style.display="none",f.count++);l._previousScrollPosition&&(l.scrollTo(l._previousScrollPosition),delete l._previousScrollPosition);
l._processScroll();l._refreshDeferred&&(l._refreshDeferred.resolve(q),delete l._refreshDeferred);return a},c)},c),q},refresh:function(a){var c=this,f=a&&a.keepScrollPosition,h;"undefined"===typeof f&&(f=this.keepScrollPosition);f&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store)return f=this._refreshDeferred=new d,h=c.renderQuery(function(a){return c.store.query(c.query,a)}),"undefined"===typeof h&&f.reject(),f.then(function(a){c._refreshTimeout=setTimeout(function(){q.emit(c.domNode,
"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:c,results:a});c._refreshTimeout=null},0);delete c._refreshDeferred;return a},function(a){delete c._refreshDeferred;throw a;})},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var c=a.nextSibling;return c&&!/\bdgrid-preload\b/.test(c.className)?c.offsetTop-a.offsetTop:a.offsetHeight},lastScrollTop:0,_processScroll:function(a){function c(a,b,c,d){var g=
e.farOffRemoval,h=a.node;if(b>2*g){for(var l,m=h[c],p=0,n=0,q=[];l=m;){var t=e._calcRowHeight(l);if(p+t+g>b||0>m.className.indexOf("dgrid-row")&&0>m.className.indexOf("dgrid-loading"))break;m=l[c];p+=t;n+=l.count||1;e.removeRow(l,!0);q.push(l)}a.count+=n;d?(h.rowIndex-=n,f(a)):h.style.height=h.offsetHeight+p+"px";var r=k("div",q);setTimeout(function(){k(r,"!")},1)}}function f(a,b){a.node.style.height=Math.min(a.count*e.rowHeight,b?Infinity:e.maxEmptySpace)+"px"}function l(a,b){do a=b?a.next:a.previous;
while(a&&!a.node.offsetWidth);return a}var e=this,b=e.bodyNode;a=a&&a.scrollTop||this.getScrollPosition().y;var b=b.offsetHeight+a,m,n,q=e.preload,w=e.lastScrollTop,y=e.bufferRows*e.rowHeight,z=y-e.rowHeight,x,A,B,F=!0;for(e.lastScrollTop=a;q&&!q.node.offsetWidth;)q=q.previous;for(;q&&q!=m;){m=e.preload;e.preload=q;n=q.node;var E=n.offsetTop;if(b+1+z<E)q=l(q,F=!1);else if(a-1-z>E+n.offsetHeight)q=l(q,F=!0);else{var C=((n.rowIndex?a-y:b)-E)/e.rowHeight,E=(b-a+2*y)/e.rowHeight,E=E+Math.min(Math.abs(Math.max(Math.min((a-
w)*e.rowHeight,e.maxRowsPerPage/2),e.maxRowsPerPage/-2)),10);0==n.rowIndex&&(C-=E);C=Math.max(C,0);10>C&&0<C&&E+C<e.maxRowsPerPage&&(E+=Math.max(0,C),C=0);E=Math.min(Math.max(E,e.minRowsPerPage),e.maxRowsPerPage,q.count);if(0==E)q=l(q,F);else{var E=Math.ceil(E),C=Math.min(Math.floor(C),q.count-E),G=h.mixin(e.get("queryOptions"),q.options);q.count-=E;var H=n,I,K=e.queryRowsOverlap,Q=(0<n.rowIndex||n.offsetTop>a)&&q;if(Q){var O=q.previous;O&&(c(O,a-(O.node.offsetTop+O.node.offsetHeight),"nextSibling"),
0<C&&O.node==n.previousSibling?(C=Math.min(q.count,C),q.previous.count+=C,f(q.previous,!0),n.rowIndex+=C,K=0):E+=C,q.count-=C);G.start=n.rowIndex-K;G.count=Math.min(E+K,e.maxRowsPerPage);n.rowIndex=G.start+G.count}else q.next&&(c(q.next,q.next.node.offsetTop-b,"previousSibling",!0),H=n.nextSibling,H==q.next.node?(q.next.count+=q.count-C,q.next.node.rowIndex=C+E,f(q.next),q.count=C,K=0):I=!0),G.start=q.count,G.count=Math.min(E+K,e.maxRowsPerPage);I&&H&&H.offsetWidth&&(I=H.offsetTop);f(q);"level"in
q.query&&(G.queryLevel=q.query.level);if("queryLevel"in G||!(G.start>e._total||0>G.count)){n=k(H,"-div.dgrid-loading[style\x3dheight:"+E*e.rowHeight+"px]");k(n,"div.dgrid-"+(Q?"below":"above")).innerHTML=e.loadingMessage;n.count=E;var L=q.query(G);if(void 0===e._trackError(function(){return L})){k(n,"!");return}(function(a,b,c,g){B=d.when(e.renderArray(g,a,G),function(h){A=g;H=a.nextSibling;k(a,"!");if(c&&H&&H.offsetWidth){var l=e.getScrollPosition();e.scrollTo({x:l.x,y:l.y+H.offsetTop-c,preserveMomentum:!0})}d.when(g.total||
g.length,function(a){"queryLevel"in G||(e._total=a);b&&(b.count=a-b.node.rowIndex,0===b.count&&G.count++,f(b))});e._processScroll();return h},function(b){k(a,"!");throw b;})}).call(this,n,Q,I,L);q=q.previous}}}}B&&(x=this._refreshDeferred)&&(delete this._refreshDeferred,d.when(B,function(){x.resolve(A)}))},removeRow:function(a,d){if(a){var c=a.previousSibling,f=a.nextSibling,e;if(e=c)e=c.observerIndex,e=null!=e?e:c.previousObserverIndex;c=e;if(e=f)e=f.observerIndex,e=null!=e?e:f.nextObserverIndex;
f=a.observerIndex;a.observerIndex=void 0;d&&(a.nextObserverIndex=e,a.previousObserverIndex=c);if(this.cleanEmptyObservers&&-1<f&&f!==c&&f!==e&&(c=this.observers,e=c[f])){if(!d)for(var b=e.rows,h=0;h<b.length;h++)if(b[h]!=a&&m.isDescendant(b[h],this.domNode))return this.inherited(arguments);e.cancel();this._numObservers--;c[f]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),
function(n,f,l,h,d,m,q){function a(a){return a}function k(a){if("object"!==typeof a)a=Error(a);else if("cancel"===a.dojoType)return;a.grid=this;d.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return f("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};m.before(this,"configStructure",
l.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a);this.inherited(arguments)},_updateNotifyHandle:function(a){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);a&&"function"===typeof a.notify&&this.shouldObserveStore&&
(this._notifyHandle=m.after(a,"notify",l.hitch(this,"_onNotify"),!0),(a=this.get("sort"))&&a.length||console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},_setStore:function(a,d,f){this._updateNotifyHandle(a);this.store=a;this.dirty={};this.set("query",d,f)},_setQuery:function(a,d){var c=d&&d.sort;this.query=void 0!==a?a:this.query;this.queryOptions=d||this.queryOptions;
this._started&&(c?this.set("sort",c):this.refresh())},setStore:function(a,d,f){n.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",a,d,f)},setQuery:function(a,d){n.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",a,d)},_getQueryOptions:function(){var a=l.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)a.sort=this._sort;return a},_getQuery:function(){var a=this.query;return"object"==typeof a&&
null!=a?l.delegate(a,{}):a},_setSort:function(a,d){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(a,d){this.inherited(arguments);a&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var a=this.inherited(arguments);this.store||(this.noDataNode=q(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return a},renderArray:function(){var a=this,d=this.inherited(arguments);this.store||h.when(d,function(c){c.length&&
a.noDataNode&&q(a.noDataNode,"!")});return d},insertRow:function(a,d,f,h,e){var b=this.store,c=this.dirty,b=b&&b.getIdentity(a),g;b in c&&!(b in this._updating)&&(g=c[b]);g&&(a=l.delegate(a,g));return this.inherited(arguments)},updateDirty:function(a,d,f){var c=this.dirty,e=c[a];e||(e=c[a]={});e[d]=f},setDirty:function(a,d,f){n.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(a,d,f)},save:function(){function a(a,b){return function(c){var e=d._columnsWithSet,g=d._updating,
l,m;if("function"===typeof c.set)c.set(b);else for(l in b)c[l]=b[l];for(l in e)m=e[l].set(c),void 0!==m&&(c[l]=m);g[a]=!0;return h.when(f.put(c),function(){delete k[a];delete g[a]})}}var d=this,f=this.store,k=this.dirty,e=new h,b=e.promise,l=function(a){var b;return d.getBeforePut||!(b=d.row(a).data)?function(){return f.get(a)}:function(){return b}},m;for(m in k)var n=a(m,k[m]),b=b.then(l(m)).then(n);e.resolve();return b},revert:function(){this.dirty={};this.refresh()},_trackError:function(c){var d;
"string"==typeof c&&(c=l.hitch(this,c));try{d=c()}catch(g){k.call(this,g)}return h.when(d,a,l.hitch(this,k))},newRow:function(){var a=this.inherited(arguments);this.noDataNode&&(q(this.noDataNode,"!"),delete this.noDataNode);return a},removeRow:function(a,d){var c={element:a};!d&&this.noDataMessage&&this.up(c).element===a&&this.down(c).element===a&&(this.noDataNode=q(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),
function(n,f,l,h,d,m,q,a,k){function c(a,b){for(var c=a.unselectable=b?"on":"",d=a.getElementsByTagName("*"),e=d.length;--e;)"INPUT"!==d[e].tagName&&"TEXTAREA"!==d[e].tagName&&(d[e].unselectable=c)}function r(a,b){var e=a.bodyNode,f=b?"text":21>d("ff")?"-moz-none":"none";p&&"msUserSelect"!==p?e.style[p]=f:d("dom-selectstart")?b||a._selectstartHandle?b&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=h(e,"selectstart",function(a){var b=a.target&&
a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):(c(e,!b),b||a._unselectableHandle)?b&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=m.after(a,"renderRow",function(a){c(a,!0);return a})}d.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});d.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});d.add("css-user-select",function(a,b,c){a=c.style;
b=["Khtml","O","ms","Moz","Webkit"];c=b.length;var d="userSelect";do if("undefined"!==typeof a[d])return d;while(c--&&(d=b[c]+"UserSelect"));return!1});d.add("dom-selectstart","undefined"!==typeof document.onselectstart);var g=d("mac")?"metaKey":"ctrlKey",p=d("css-user-select"),e=(q=d("pointer"))&&"MS"===q.slice(0,2),b=q?q+(e?"Down":"down"):"mousedown",u=q?q+(e?"Up":"up"):"mouseup";"WebkitUserSelect"===p&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(p=!1);return f("dgrid.Selection",
null,{selectionDelegate:".dgrid-row",selectionEvents:b+","+u+",dgrid-cellfocusin",selectionTouchEvents:d("touch")?a.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);
this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){n.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");
this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?r(this,a):r(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,c){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(c))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==a.parentType)&&(a.type!==u||c==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&a.type===b&&this.isSelected(c))this._waitForMouseUp=
c;else this[this._selectionHandlerName](a,c);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){var c=a.keyCode?a.ctrlKey:a[g];this._lastSelected===b?this.select(b,null,!c||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var c=this._lastSelected,d=a.keyCode?a.ctrlKey:a[g],e;a.shiftKey||(e=d?null:!0,c=null);this.select(b,c,e);c||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?
this.isSelected(b):a.keyCode?a.ctrlKey:a[g])||this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var b=this,c=this.contentNode,e=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};d("touch")&&!d("pointer")&&this.selectionTouchEvents?(h(c,a.selector(e,this.selectionTouchEvents),function(a){b._handleSelect(a,this);b._ignoreMouseSelect=this}),h(c,h.selector(e,this.selectionEvents),
function(a){b._ignoreMouseSelect!==this?b._handleSelect(a,this):a.type===u&&(b._ignoreMouseSelect=null)})):h(c,h.selector(e,this.selectionEvents),function(a){b._handleSelect(a,this)});this.addKeyHandler&&this.addKeyHandler(32,function(a){b._handleSelect(a,a.target)});if(this.allowSelectAll)this.on("keydown",function(a){a[g]&&65==a.keyCode&&!/\bdgrid-input\b/.test(a.target.className)&&(a.preventDefault(),b[b.allSelected?"clearSelection":"selectAll"]())});this._setStore&&m.after(this,"_setStore",function(){b._updateDeselectionAspect()});
this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(a,c,d){a=c||a&&a[b.idProperty||"id"];if(null!=a&&(c=(a=b.row(a))&&b.selection[a.id]))b[d](a,null,c)}var b=this,c=this.store,d,e;this._removeDeselectSignals&&this._removeDeselectSignals();c&&c.notify?(d=m.before(c,"notify",function(b,c){b||a(b,c,"deselect")}),e=m.after(c,"notify",function(b,c){a(b,c,"select")},!0),this._removeDeselectSignals=function(){d.remove();e.remove()}):(d=m.before(this,"removeRow",function(a,b){var c;
b||(c=this.row(a))&&c.id in this.selection&&this.deselect(c)}),this._removeDeselectSignals=function(){d.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};c&&(d.parentType=c.type);d[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];h.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},
_select:function(a,b,c){var d,e,f;"undefined"===typeof c&&(c=!0);a.element||(a=this.row(a));if(!1===c||this.allowSelect(a))if(d=this.selection,e=!!d[a.id],null===c&&(c=!e),f=a.element,c||this.allSelected?d[a.id]=c:delete this.selection[a.id],f&&(c?k(f,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):k(f,"!dgrid-selected!ui-state-active")),c!==e&&f&&this._selectionEventQueues[(c?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element)for(d=this._determineSelectionDirection(f,
b),d||(b=document.getElementById(b.id),d=this._determineSelectionDirection(f,b));a.element!=b&&(a=this[d](a));)this._select(a,null,c)}else this._lastSelected=f,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:d("dom-comparedocumentposition")?function(a,
b){var c=b.compareDocumentPosition(a);return c&1?!1:2===c?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=
this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);l.when(b,function(b){var c=a.selection,
d,e,f;for(d=0;d<b.length;d++)e=a.row(b[d]),(f=e.id in c?c[e.id]:a.allSelected)&&a._select(e,null,f);a._fireSelectionEvents()});return b}})})},"xstyle/main":function(){define("xstyle/main",["require","xstyle/core/parser","xstyle/core/base","xstyle/core/elemental","xstyle/core/generate"],function(n,f,l,h,d){function m(c){c=document.getElementsByTagName(c);for(var d=0;d<c.length;d++)a(c[d])}function q(){m("link");m("style")}function a(c,d,f){function g(){n(["xstyle/core/load-imports"],function(b){b(c,
function(){a(c,d,!0)})})}function e(a){for(var b=a.cssRules,c=0;c<b.length;c++){var e=b[c];if(e.selectorText&&"x-"==e.selectorText.substring(0,2)&&(h=!0,/^'/.test(e.style.content)))return k(eval(e.style.content),a,d),!0}}var b=c.sheet||c.styleSheet;if(b&&(!b.processed||f)){b.processed=!0;var h=b.needsParsing,l=b.rules||b.cssRules;if((b.href||b.imports&&b.imports.length)&&!f)return g();if(!h)for(var m=0;m<l.length;m++){var q=l[m];if(q.href&&!f){if(!e(q.styleSheet))return g();return}}k(b.localSource||
(b.ownerNode||b.owningElement).innerHTML,b,d)}}function k(a,d,g){d.addRule||(d.addRule=function(a,b,c){return this.insertRule(a+"{"+b+"}",0<=c?c:this.cssRules.length)});d.deleteRule||(d.deleteRule=d.removeRule);var c=1;(d.href||location.href).replace(/[^\/]+$/,"");l.css=a;f(l,a,d);0==--c&&g&&g(d);return l}h.ready(q);f.getStyleSheet=function(a,d){return a.styleSheet||a};return{process:a,processAll:q,parse:k,generate:d,update:h.update,load:function(c,d,f,h){d(["xstyle/css"],function(e){e.load(c,d,function(b){b?
a({sheet:b},f):(q(),f())},h)})}}})},"xstyle/core/parser":function(){define("xstyle/core/parser",[],function(){function n(){this.push.apply(this,arguments)}function f(a){this.value=a}function l(){var a,c=this.args[0];if("string"==typeof c)a=c.split(/\s*,\s*/);else if(c){a=[];for(var d=0,b=0;b<c.length+1;b++){var f=c[b];if("string"==typeof f||void 0===f)if(f=f&&f.split(/\s*,\s*/),1<a.length||void 0===f){var h=c.slice(d,b);0<d&&h.unshift(a.pop());d=b+1;a.push(h);f&&a.push.apply(a,f.slice(1))}}}else return[];
return a}function h(g,p,e){function b(e,p){function u(a){F=!1;var b=t.lastIndex;a.then(function(){F=!0;c&&(t.lastIndex=b,w())});var c=!0}function w(){function g(a){a&&"string"==typeof a&&z&&(a=z+a);J?J.push?"string"==typeof J[J.length-1]&&"string"==typeof a?J[J.length-1]+=a:a&&J.push(a):"string"==typeof J&&"string"==typeof a?J+=a:J=new n(J,a):J=a}for(F=!0;F;){var q=t.exec(e);if(!q)break;var w=q[5],z=q[1],x=q[2],A=q[3],P=q[4],M,N,J,R,P=P&&c(P),x=x&&c(x);H?(A?(N=x,M=A.charAt(0),R="?"==A.charAt(1),-1<
A.indexOf("\n")&&(P=A.slice(1))):P=x,J=P,H=!1):(P=A?x+A:x,g(P));"{"!=w&&(G+=q[0]);switch(w){case "'":case '"':var X="'"==w?d:m;X.lastIndex=t.lastIndex;(w=X.exec(e))||y("unterminated string");x=w[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(a,b){if(b)return String.fromCharCode(parseInt(b,16))});t.lastIndex=X.lastIndex;g(new f(x));G+=w[0];continue;case "\\":w=X.lastIndex++;g(e.charAt(w));continue;case "(":case "{":case "[":if("{"==w){H=!0;":"==M&&A&&(x+=A);G=c((G+x).replace(/\s+/g," "));g(A=
B.newRule(G));"\x3d"==M&&(C=!1,J.creating=!0);var D=null,W=E;q[6]&&(P=p.cssRules||p.rules,A.cssRule=D=P[q[6].slice(1)])&&(G=D.selectorText);if(B.root&&C)for(P=p.cssRules||p.rules;D=P[E++];)if(D.selectorText==G||D.selectorText&&D.selectorText.replace(/::/g,":").replace(/'/g,'"')==G.replace(/::/g,":").replace(/'/g,'"')){A.cssRule=D;break}D||(A.ruleIndex=E=W);A.styleSheet=p;J.creating?(A.selector="."+("\x3d"==M?x.match(/[\w-]*$/g,"")[0]:"")+"-x-"+k++,A.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(G)?
A.setMediaSelector(G):A.selector=B.root?G:B.selector+" "+G;G=""}else x=P.match(/(.*?)([\w-]*)$/),g(A=B.newCall(x[2],J,B)),A.ref=B.getDefinition(x[2]),A.getArgs=l,(J.calls||(J.calls=[])).push(A);B.currentName=N;B.currentSequence=J;B.assignmentOperator=M;var V;"{"==w&&(V=A.selector.match(/[@:]\w+/))&&(V=V[0],(N=B.getDefinition(V))&&N.selector&&N.selector(A));v.push(B=A);B.operator=w;B.start=t.lastIndex;J=N=null;continue}if(J)if(x="string"==typeof J?J:J[0],x.charAt&&"@"==x.charAt(0))if(q=x.match(/\w+/)[0],
"import"==q)x=h.getStyleSheet((p.cssRules||p.imports)[E++],J,p),q=t.lastIndex,b(x.localSource,x),t.lastIndex=q;else{if("xstyle"==q){if("start"==x.slice(8,13))A=B?B.newRule(""):Z,A.root=B.root,v.push(B=A);else{var Z=B||Z;v.pop();B=v[v.length-1]}t=B?r:/(@[\w\s])/g}}else if("\x3d"===M)try{var T=B.declareDefinition(N,J,R);T&&T.then&&u(T)}catch(U){y(U)}switch(w){case ":":"\x3d"==M?(H=!0,M=":"):g(":");break;case "}":if(N&&!B.root&&!B.isMediaBlock)try{B[":"==M?"setValue":"declareDefinition"](N,J,R)}catch(U){y(U)}case ")":case "]":a[B.operator]!=
w&&y("Incorrect opening operator "+B.operator+" with closing operator "+w);N=null;N=e.slice(B.start,t.lastIndex-1);B.cssText=B.cssText?B.cssText+";"+N:N;if("}"==w){"}"==aa&&(aa=B.parent.selector)&&"@"==!aa.charAt(0)&&y("A nested rule must end with a semicolon");if(B.root)y("Unmatched "+w);else{try{B.onRule(B.selector,B)}catch(U){y(U)}C=!0}G=""}if(")"==w||"]"==w)B.args=[J];if(")"==w&&!M){try{T=v[v.length-2].onArguments(B)}catch(U){y(U)}T&&T.then&&u(T)}v.pop();B=v[v.length-1];J=B.currentSequence;N=
B.currentName;M=B.assignmentOperator;if(B.root&&"}"==w){if(M)try{B[":"==M?"setValue":"declareDefinition"](N,J,R)}catch(U){y(U)}H=!0;M=!1}break;case "":case void 0:return;case ";":if(B&&N){try{(T=B[":"==M?"setValue":"declareDefinition"](N,J,R))&&T.then&&u(T)}catch(U){y(U)}N}J=null;H=!0;M=C=!1;G=""}var aa=w}}function y(a){var c=e.slice(0,t.lastIndex).split("\n"),d=c[c.length-1],c=(p.href||"in-page stylesheet")+":"+c.length+":"+d.length+" near:\n"+d.slice(-40);if(b.onerror)b.onerror(a,c);console.error(a.message||
a,c);a.stack&&console.error(a.stack)}e=e.replace(q,function(a){return a.replace(/[^\n]/g,"")});var B=g;t.lastIndex=0;var F,E=0,C=!0,G="",H=!0;w()}e=e||{addRule:function(){},cssRules:[]};var r,t=r=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,v=[g];g.parse=b;b(p,e)}var d=/((?:\\.|[^'])*)'/g,m=/((?:\\.|[^"])*)"/g,q=/\/\*[\w\W]*?\*\//g,a={"{":"}","[":"]","(":")"},k=0,c="".trim?function(a){return a.trim()}:
function(a){return a.replace(/^\s+|\s+$/g,"")},r=n.prototype=[];r.toString=function(){return this.join("")};r.isSequence=!0;f.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};f.prototype.isLiteralString=!0;return h})},"xstyle/core/base":function(){define("xstyle/core/base","xstyle/core/elemental xstyle/core/expression xstyle/core/Definition xstyle/core/utils put-selector/put xstyle/core/Rule xstyle/core/es6".split(" "),function(n,f,l,h,d,m,q){function a(b,c,
d){function e(a){return{selectElement:function(c){d.newElement&&(c=c.parentNode);if(a&&a.selector)for(;!t(c,a);)if(c=c.parentNode,!c)throw Error("Rule not found");if(d.inherit)for(;!(b in c);)if(c=c.parentNode,!c)throw Error(b?b+" not found":"Property was never defined");return c},forElement:function(c){var e=c;c=this.selectElement(c);d.newElement&&(c["_"+b+"Node"]=e);c=d.get?d.get(c,b):c[b];return void 0===c&&a?g(b).valueOf().forRule(a):c},forRule:d.inherit&&function(a){return e(a)}}}var f=new l(function(){return e(c)});
f.define=function(c,e){return a(b||e,c,d)};f.keepCSSValue=!0;f.put=d.inherit?function(a,c){return g(b).put(a,c,b)}:function(a){return{forElement:function(e){if(c&&c.selector)for(;!t(e,c);)if(e=e.parentNode,!e)throw Error("Rule not found");d.set?d.set(e,b,a):e[b]=a;f.invalidate({elements:[e]})}}};return f}function k(a,b,c,d){return h.when(f.evaluate(a,c),function(b){b.forElement?n.addRenderer(a,function(a){d(b.forElement(a),a)}):d(b)})}function c(a,b){return{apply:function(c,d,e){k(c,e,d[0],function(d,
f){d.observe(function(d){d=d?a:b;value.toString().replace(new RegExp(a+"\\([^)]+\\)","g"),d);f?f.style[e]=d:c.setStyle(e,d)})})}}}function r(a,b){var c=a.variables;if(c&&b in c)return c[b];if(c=a.bases)for(var d=0;d<c.length;d++){var e=r(c[d],b);if(void 0!==e)return e}}function g(a){var b=v[a];b||(b=v[a]=new l(function(){return{forRule:function(b){a:{do{var c=r(b,a);if(void 0!==c){b=c;break a}b=b.parent}while(b);b=void 0}return b}}}),b.put=function(a,c,d){return{forRule:function(c){function e(a){f.push(a);
for(var b in a.rules)e(a.rules[b])}(c.variables||(c.variables={}))[d]=a;for(var f=[];c;)e(c),c=c.parent;b.invalidate({rules:f})}}});return b}var p=d("div"),e=navigator.userAgent,b=-1<e.indexOf("WebKit")?"-webkit-":-1<e.indexOf("Firefox")?"-moz-":-1<e.indexOf("MSIE")?"-ms-":-1<e.indexOf("Opera")?"-o-":"",u;m=new m;var t=n.matchesRule;m.root=!0;var v={};m.definitions={Math:Math,window:window,global:window,module:f.selfResolving(function(a,b){a[0].value&&(a=a[0].value);b||require([a]);return{then:function(b){return(new q.Promise(function(b){require([a],
function(a){b(a)})})).then(b)}}}),item:a("item",null,{inherit:!0}),pageContent:new l,content:a("content",null,{inherit:!0,newElement:function(){return this.element}}),elementProperty:a(null,null,{}),elementClass:a(null,null,{get:function(a,b){return-1<(" "+a.className+" ").indexOf(" "+b+" ")},set:function(a,b,c){this.get(a,b)!=c&&(a.className=c?a.className+(" "+b):(" "+a.className+" ").replace(" "+b+" ","").replace(/^ +| +$/g,""))}}),element:{forElement:function(a){return a},define:function(a){return{forElement:function(b){for(;!t(b,
a);)if(b=b.parentNode,!b)throw Error("Rule not found");return b}}}},event:{observe:function(a){a(u)},valueOf:function(){return u}},each:{put:function(a){return{forRule:function(b){b.each=a}}}},prefix:{put:function(a,c,d){return{forRule:function(c){if("string"==typeof p.style[b+d])return c._setStyleFromValue(b+d,a),!0}}}},"var":{define:function(a,b){return g(b)},selfResolving:!0,apply:function(a,b){return g(h.convertCssNameToJs(b[0]))}},inline:c("inline","none"),block:c("block","none"),visible:c("visible",
"hidden"),"extends":{apply:function(a,b){for(;0<b.length;)return h.extend(a,b[0],console.error)}},set:{selfExecuting:!0,apply:function(a,b){return b[0].put(b[1].valueOf())}},get:{apply:function(a,b){return b[0]},put:function(a,b){f.evaluate(b,a)}},toggle:{selfExecuting:!0,apply:function(a,b){return b[0].put(!b[0].valueOf())}},on:{put:function(a,b,c){return{forRule:function(b){n.on(document,c.charAt(2).toLowerCase()+c.slice(3),b,function(d){u=d;try{h.when(f.evaluate(b,a).valueOf(),function(a){a&&a.forRule&&
(a=a.forRule(b));a&&a.forElement&&(a=a.forElement(d.target));u=null},function(b){console.error("Error in "+c+" event handler, executing "+a,b)})}catch(B){console.error("Error in "+c+" event handler, executing "+a,B)}})}}}},title:{put:function(a){return{forRule:function(b){f.observe(f.evaluate(b,a),function(a){document.title=a})}}}},"@supports":{selector:function(a){function b(a){var c;if(c=a.match(/^\s*not(.*)/))return!b(c[1]);if(c=a.match(/\((.*)\)/))return b(c[1]);if(c=a.match(/([^:]*):(.*)/))return a=
h.convertCssNameToJs(c[1]),c=p.style[a]=c[2],p.style[a]==c;if(c=a.match(/\w+\[(.*)=(.*)\]/))return d(c[0])[c[1]]==c[2];if(c=a.match(/\w+/))return h.isTagSupported(c);throw Error("can't parse @supports string");}b(a.selector.slice(10))?a.selector="":a.disabled=!0}},"true":!0,"false":!1,"null":null};m.elementProperty=a;return m})},"xstyle/core/elemental":function(){define("xstyle/core/elemental",["put-selector/put","xstyle/core/utils"],function(n,f){function l(a,b,c,d){function e(a){if(!c)return d(a);
var b=a.target;do if(x(b,c))return d(a);while((b=b.parentNode)&&1===b.nodeType)}g?a.addEventListener(b,e,!!p[b]):h(a,p[b]||b,e)}function h(a,b,c){b="on"+b;var d=a[b];a[b]=function(a){a=a||window.event;a.target=a.target||a.srcElement;d&&d(a);c(a)}}function d(a){/e/.test(c.readyState||"")?a():c.addEventListener("DOMContentLoaded",a)}function m(a){for(var b=c.querySelectorAll(a.selector),d=a.name,e=0,f=b.length;e<f;e++){var g=b[e],h=g.elementalStyle;h||(h=g.elementalStyle={},g.elementalSpecificities=
{});var k=g.renderings;k||(k=g.renderings=[],w.push(g));k.push({name:d,rendered:h[d]==a.propertyValue,renderer:a});h[d]=a.propertyValue}}function q(){for(;w.length;){for(var a=w.shift(),b=a.renderings,c=a.elementalStyle;b.length;){var d=b.shift(),e=d.renderer,f=e.rendered;z=c[d.name]==e.propertyValue;if(!f&&z)try{e.render(a)}catch(H){console.error(H,H.stack),n(a,"div.error",H.toString())}f&&!z&&e.unrender&&e.unrender(a)}a.renderings=void 0}}function a(a,b){for(var c=0,d=t.length;c<d;c++){var e=t[c];
b&&b!=e.selector||!x(a,e.rule)||e.render(a)}}function k(a,b){var c={selector:a.selector,rule:a,render:b};t.push(c);y&&m(c);q();return{remove:function(){t.splice(t.indexOf(c),1)}}}var c=document,r=1,g=!!c.addEventListener,p={blur:"focusout",focus:"focusin"};l(c,"change",null,function(a){a=a.target;for(var b=0,c=v.length;b<c;b++){var d=v[b];if(-1<(" "+a.className+" ").indexOf(d.rule.selector.slice(1))){var e=d.definition.valueOf();e&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&(e=e.forElement(a));
var f="checkbox"===a.type?a.checked:a.value;"number"===typeof e&&isFinite(f)&&(f=+f);(e=d.definition.put(f))&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&e.forElement(a)}}});navigator.userAgent.match(/MSIE|Trident/)&&l(c,"keydown",null,function(a){if(13==a.keyCode){var b=a.target;if(document.createEvent)a=document.createEvent("Events"),a.initEvent("change",!0,!0),b.dispatchEvent(a);else document.onchange({target:b})}});var e=c.createElement("div"),b={"dom-qsa2.1":!!e.querySelectorAll},u=e.matches||
e.matchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector,t=[],v=[],w=[],y;d(function(){if(!y)if(y=!0,b["dom-qsa2.1"]){for(var d=0,e=t.length;d<e;d++)m(t[d]);q()}else for(var f=c.all,d=0,e=f.length;d<e;d++)a(f[d])});var z,x=u?function(a,b){return u.call(a,b.selector)}:function(a,b){b.ieId||b.setStyle(b.ieId="x-ie-"+r++,"true");return!!a.currentStyle[b.ieId]};return{ready:d,on:l,matchesRule:x,addRenderer:k,addInputConnector:function(a,b){v.push({rule:a,
definition:b})},update:a,clearRenderers:function(){t=[]},observeForElement:function(a,b,c){return f.when(a,function(a){function d(a){a.observe?a.observe(c):c(a)}a.forElement?k(b,function(b){d(a.forElement(b))}):d(a)})}}})},"xstyle/core/utils":function(){define("xstyle/core/utils",[],function(){function n(d,f){for(var h=0,a=d.length;h<a;h++){var k=d[h];if(k&&"object"==typeof k&&f in k)return!0}}function f(d,f){return f.toUpperCase()}var l="div"==document.createElement("div").tagName,h={};return{when:function(d,
f,h){return d&&d.then?d.then(f,h)||d:f(d)},whenAll:function(d,f){return n(d,"then")?{then:function(h,a){function k(){c--;c||h(f(l))}for(var c=1,l=[],g=0;g<d.length;g++){var m=d[g];c++;m&&m.then?function(c){m.then(function(a){l[c]=a;k()},a)}(g):(l[g]=m,k())}k()},inputs:d}:f(d)},convertCssNameToJs:function(d){return d.replace(/-(\w)/g,f)},isTagSupported:function(d){if(d in h)return h[d];var f=document.createElement(d);l?(f=f.toString(),f=!("[object HTMLUnknownElement]"==f||"[object]"==f)):f=f.tagName==
d.toUpperCase();return h[d]=f},extend:function(d,f){var h=f.split(".");f=h[0];var a=d.getDefinition(f,"rules");h[0]="";d.selector+=d.extraSelector=h.join(".");if(a)return this.when(a,function(a){if(a.extend)a.extend(d,!0);else for(var c in a)d[c]=a[c]});d.tagName=f;if(!this.isTagSupported(f))throw Error("Extending undefined definition "+f);},someHasProperty:n}})},"xstyle/core/expression":function(){define("xstyle/core/expression",["xstyle/core/utils","xstyle/core/Definition"],function(n,f){function l(a,
b){var c=b[0];return c&&a?(c=k(c),l(a.property?a.property(c):a[c],b.slice(1))):a}function h(a,b,d){if(c(b,a)){var e={};e[a]=function(c){for(var e=[],f=0,g=b.length;f<g;f++){var h=b[f];h&&"function"==typeof h[a]&&(h=h[a](c));e[f]=h}return d(e)};return e}return d(b)}function d(a,b){return{apply:function(c,d,e){for(var f=0,g=d.length;f<g;f++){var k=d[f];k.dependencyOf&&k.dependencyOf(e)}f=function(){var b=[];if(a.selfExecuting)return a.apply(c,d,e);for(var f=0,g=d.length;f<g;f++)b[f]=d[f].valueOf();
if(a.selfWaiting)return a.apply(c,b,e);b.push(c);return n.whenAll(b,function(b){var c=b.pop();return h("forRule",b,function(b){return h("forElement",b,function(b){return a.apply(c,b,e)})})})};f.reverse=function(a){return b(a,d)};return f}}}function m(a){return g[a]||(g[a]=new Function("a","b","return "+a))}function q(a,b,c,f,g){function e(a){a.skipResolve=!0;a.precedence=b;a.infix=!1!==g}var h=function(a,b){var c=b[0],d=b[1];if(c&&c.put)d=f(a,d&&d.valueOf()),d!==r&&c.put(d);else if(d&&d.put)d.put(g(a,
c&&c.valueOf()));else throw new TypeError("Can not put");},k={apply:function(b,k,l){var n;c=m(c);f=f&&m(f);g=g&&m(g);p[a]=n=d(c,h);e(n);return n.apply(b,k,l)}};e(k);p[a]=k}function a(c,b){function e(a){for(;m<=a.precedence;){var b=q.pop(),c=p[q.pop()],d=new f;d.setCompute(c.apply(null,c.infix?[q.pop(),b]:[b],d));r=q.length?q[q.length-1]:void 0;q.push(d);m=r&&p[r]&&p[r].precedence}}var g,h;b=b.join?b.slice():[b];for(g=0;g<b.length;g++)if(h=b[g],"string"==typeof h){var k=h.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g);
h=[g,1];k&&h.push.apply(h,k);b.splice.apply(b,h);g+=h.length-3}var m,q=[],r,k={};for(g=0;g<b.length;g++){h=b[g];if("("==h.operator){var A=q[q.length-1];void 0===A||p.hasOwnProperty(A)?h=a(c,h.getArgs()[0]):(q.pop(),h=function(b,e){function g(f){return n.when(b.valueOf(),function(g){var m=b.parent&&b.parent.valueOf();if(!g.selfResolving){if(!h){h=[];for(var p=0,n=e.length;p<n;p++)h[p]=a(c,e[p]);k=g.selfReacting?g.apply(m,h,l):d(g).apply(m,h,l)}return k()}g=g.apply(m,e,l);return f?g:g.valueOf()})}var h,
k,l=new f(g);l.setReverseCompute(function(){var a=arguments;return n.when(g(!0),function(b){return b.put.apply(b,a)})});return l}(A,h.getArgs()))}else if(p.hasOwnProperty(h))A=p[h],e(A),m=(r||A).precedence;else if(-1<h)h=+h;else if(h.isLiteralString)h=h.value;else{h=h.split(/\s*\/\s*/);var A=h[0],B=c.getDefinition(A);if("string"==typeof B||B instanceof Array)B=a(c,B);else if(void 0===B)throw Error('Could not find reference "'+A+'"');k[A]=B;1<h.length&&(B=l(B,h.slice(1)));h=B}q.push(h)}e({precedence:100});
if(1<q.length)throw Error("Could not reduce expression");h=q[0];h.inputs=k;return h}var k=n.convertCssNameToJs,c=n.someHasProperty,r={},g={},p={};q("+",6,"a+b","a-b","a-b");q("-",6,"a-b","a+b","b-a");q("*",5,"a*b","a/b","a/b");q("/",5,"a/b","a*b","b/a");q("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");q(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");q("!",4,"!a","!a",!1);q("%",5,"a%b");q("\x3e",8,"a\x3eb");q("\x3e\x3d",8,"a\x3e\x3db");q("\x3c",8,"a\x3cb");q("\x3c\x3d",8,"a\x3c\x3db");
q("\x3d\x3d",9,"a\x3d\x3d\x3db");q("\x26",8,"a\x26\x26b");q("|",8,"a||b");return{react:d,evaluate:a,selfResolving:function(a){a.selfResolving=!0;return a}}})},"xstyle/core/Definition":function(){define(["xstyle/core/utils","xstyle/core/es6"],function(n,f){function l(a){(this.computeValue=a)&&a.reverse&&this.setReverseCompute(a.reverse)}function h(a,h,c){if(h&&h.forElement)return{forElement:function(k){k=h.selectElement?h.selectElement(k):k;var g=["_cache_"+a.id];if(g in k){var l=k[g+"observe"];l.addKey&&
l.addKey(c);return k[g][c]}var e=k[g]=h.forElement(k),b=k[g+"observe"]=d(a,e,c,{elements:[k]});k.xcleanup=function(a){a&&f.unobserve(e,b)};return e[c]}}}function d(a,d,c,h){var g=a._properties,k;"object"==typeof d&&(k=function(a){for(var b=0;b<a.length;b++){var c=g[a[b].name];c&&c.invalidate&&c.invalidate(h)}},f.observe(d,k),k.addKey&&k.addKey(c));return k}var m={},q=1;l.prototype={id:"x-variable-"+q++,cache:m,valueOf:function(){if((this.dependents||this._properties)&&this.cache!==m)return this.cache;
var a=this,d=this.computeValue;if(d.then)return this.cache=d.then(function(c){a.computeValue=c;(c=a.cache=c())&&c.then&&c.then(function(c){a.cache=c});return c});(d=a.cache=d())&&d.then&&d.then(function(c){a.cache=c});return d},property:function(a){var f=this._properties||(this._properties={}),c=f[a];if(!c){var m=this,c=f[a]=new l(function(){return n.when(m.valueOf(),function(c){if(c&&c.forRule)return{forRule:function(e){e=c.selectRule?c.selectRule(e):e;var b=["_cache_"+m.id],f;if((f=b in e?e[b]:
e[b]=c.forRule(e))&&f.forElement)return h(m,f,a);var g=e[b+"observe"];g&&(g.addKey?g.addKey(a):e[b+"observe"]=d(m,f,a,{rules:[e]}));return f[a]}};if(c&&c.forElement)return h(m,c,a);var f=m.cacheObserve;f?f.addKey&&f.addKey(a):f=m.cacheObserve=d(m,c,a);return c[a]})});c.key=a;c.parent=this;c.put=function(c){return n.when(m.valueOf(),function(d){function e(b){if(b.forElement)return{forElement:function(d){b.forElement(d)[a]=c}};b[a]=c}if(d.forRule)return{forRule:function(a){return e(d.forRule(a))}};
e(d)})};c.id=this.id+"-"+a}return c},invalidate:function(a){var d=this.cacheObserve;d&&(f.unobserve(this.cache,d),this.cacheObserve=null);this.cache=m;var c,d=this._properties;for(c in d)d[c].invalidate(a);var h=this.dependents||0;c=0;for(d=h.length;c<d;c++)try{h[c].invalidate(a)}catch(g){console.error(g,"invalidating a definition")}},dependencyOf:function(a){(this.dependents||(this.dependents=[])).push(a)},notDependencyOf:function(a){for(var d=this.dependents||0,c=0;c<d.length;c++)d[c]===a&&d.splice(c--,
1)},setReverseCompute:function(a){this.put=function(){var d=a.apply(this,arguments);this.invalidate();return d}},setCompute:function(a){(this.computeValue=a)&&a.reverse&&this.setReverseCompute(a.reverse);this.invalidate()},setSource:function(a){this.computeValue=function(){return a};this.invalidate()},observe:function(a){this.computeValue&&a(this.valueOf());var d=this;return this.dependencyOf({invalidate:function(){a(d.valueOf())}})},newElement:function(){return n.when(this.valueOf(),function(a){return a&&
a.newElement&&a.newElement()})}};return l})},"xstyle/core/es6":function(){define("xstyle/core/es6",[],function(){function n(a,c,b){m?-1===m.indexOf(a)&&m.push(a):(m=[a],setTimeout(function(){m.forEach(function(a){var b=[];a.properties.forEach(function(c){b.push({target:a.object,name:c})});a(b);a.object=null;a.properties=null});m=null},0));a.object=c;a=a.properties||(a.properties=[]);-1===a.indexOf(b)&&a.push(b)}function f(){return f}var l=Object.observe,h;if(h=Object.defineProperty)a:{try{Object.defineProperty({},
"t",{});h=!0;break a}catch(p){}h=void 0}var d={observe:l,defineProperty:h,promise:"undefined"!==typeof Promise,WeakMap:"function"===typeof WeakMap},l=d.observe?Object.observe:d.defineProperty?function(a,c){c.addKey=function(b){var d="key"+b;if(!this[d]){this[d]=!0;var e=a[b];if((d=Object.getOwnPropertyDescriptor(a,b))&&d.set){var f=d.set,g=d.get;Object.defineProperty(a,b,{get:function(){return e=g.call(this)},set:function(a){f.call(this,a);e!==a&&(e=a,c&&n(c,this,b))}})}else Object.defineProperty(a,
b,{get:function(){return e},set:function(a){e!==a&&(e=a,c&&n(c,this,b))}})}};c.remove=function(){c=null}}:function(d,e){c||(c=!0,setInterval(function(){for(var b=0,c=q.length;b<c;b++){var d=a[b],e=q[b],f=k[b],g=void 0,h=void 0;for(h in d)d.hasOwnProperty(h)&&d[h]!==e[h]&&(d[h]=e[h],(g||(g=[])).push({name:h}));for(h in e)e.hasOwnProperty(h)&&!d.hasOwnProperty(h)&&(d[h]=e[h],(g||(g=[])).push({name:h}));g&&f(g)}},20));var b={},f;for(f in d)d.hasOwnProperty(f)&&(b[f]=d[f]);q.push(d);a.push(b);k.push(e)},
m;h=d.observe?Object.unobserve:function(c,d){d.remove&&d.remove();for(var b=0,e=q.length;b<e;b++)if(q[b]===c&&k[b]===d){q.splice(b,1);a.splice(b,1);k.splice(b,1);break}};var q=[],a=[],k=[],c=!1,r=1,g=function(){};g.prototype.toJSON=f;return{Promise:d.promise?Promise:function(){function a(c){function b(a){a&&a.then?a.then(b,d):(g=a,e())}function d(a){h=a;e()}function e(){f=!0;for(var a=0,b=k.length;a<b;a++)k[a]();k=0}var f,g,h,k=0;c(b,d);return{then:function(b,c){return new a(function(a,d){function e(){try{h&&
!c?d(h):a(h?c(h):b?b(g):g)}catch(C){d(C)}}f?e():(k||(k=[])).push(e)})}}}return a}(),WeakMap:d.WeakMap?WeakMap:function(a,c){var b="__"+(c||"")+r++;return d.defineProperty?{get:function(a){return a[b]},set:function(a,c){Object.defineProperty(a,b,{value:c,enumerable:!1})}}:{get:function(a){return(a=a[b])&&a.value},set:function(a,c){(a[b]||(a[b]=new g)).value=c}}},observe:l,unobserve:h,copy:function(a,c){for(var b in c)a[b]=c[b];return a}}})},"xstyle/core/Rule":function(){define("xstyle/core/Rule",["xstyle/core/expression",
"xstyle/core/Definition","put-selector/put","xstyle/core/es6","xstyle/core/utils"],function(n,f,l,h,d){function m(a,b,c){try{a[b]=c}catch(y){}}function q(){}function a(a,b,c,d){if(a.calls){var e;for(c=0;c<a.length;c++){var h=a[c];if(h instanceof k){a.hasOwnProperty(c)||(a[c]=h=g(h));var l=h.ref&&(h.ref.selfResolving?h.ref.apply(b,h.getArgs(),b):n.evaluate(b,[h.caller,h]));void 0!==l&&((e||(e=[])).push(l),h.evaluated=!0)}}}if(e)return b=n.react(function(){for(var b=0,c=a.slice(),d=0;d<a.length;d++){var e=
a[d];e instanceof k&&e.evaluated&&(c[d-1]=a[d-1].slice(0,-e.caller.length),c[d]=arguments[b++])}return c.join("")}),b.skipResolve=!0,d=new f,d.setCompute(b.apply(d,e,d)),d;if(!d)return a.toString()}function k(a){this.caller=a;this.args=[]}function c(a,b,c,e){return d.when(b,function(b){var d=b;b&&b.forRule&&((a._subRuleListeners||(a._subRuleListeners=[])).push(function(a){var b=d.forRule(a,!0);b&&b.forElement?r(a,b,e):c&&c(b)}),b=b.forRule(a));if(b&&b.forElement)return r(a,b,e);c&&c(b)})}function r(a,
b,c){return require(["xstyle/core/elemental"],function(d){d.addRenderer(a,function(a){var d=b.forElement(a);c&&c(d,a)})})}var g=Object.create||function(a){function b(){}b.prototype=a;return new b},p=d.convertCssNameToJs,e={"{":"}","[":"]","(":")"},b=l("div").style;q.prototype={property:function(a){return(this._properties||(this._properties={}))[a]||(this._properties[a]=new Proxy(this.get(a)))},eachProperty:function(a){for(var b=this.values||0,c=0;c<b.length;c++){var d=b[c];a.call(this,d||"unnamed",
b[d])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){a=(this.rules||(this.rules={}))[a]=new q;a.disabled=this.disabled;a.parent=this;return a},newCall:function(a){a=new k(a);a.parent=this;return a},addSheetRule:function(a,b){if("@"!=a.charAt(0)){var c=this.styleSheet,d=c.cssRules||c.rules,e=-1<this.ruleIndex?this.ruleIndex:d.length;try{c.addRule(a,b||" ",e)}catch(x){a.match(/-(moz|webkit|ie)-/)||console.warn("Unable to add rule",
a,b)}return d[e]}},onRule:function(){var a=this.getCssRule();if(this.installStyles)for(var b=0;b<this.installStyles.length;b++){var c=this.installStyles[b];m(a.style,c[0],c[1])}},setMediaSelector:function(a){this.isMediaBlock=!0;this.selector=a},setStyle:function(a,b){this.cssRule?m(this.cssRule.style,a,b):(this.installStyles||(this.installStyles=[])).push([a,b])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},
elements:function(a){var b=this;require(["xstyle/core/elemental"],function(c){c.addRenderer(b,function(b){a(b)})})},declareDefinition:function(a,c,e){a=a&&p(a);if(!this.disabled){var f=this;if(c.length)if("\x3e"==c[0].toString().charAt(0))a||(this.generator=c,require(["xstyle/core/generate","xstyle/core/elemental"],function(a,b){c=a.forSelector(c,f);b.addRenderer(f,c)}));else{var g=a in b||this.getDefinition(a);if(!e||!g){e=this.definitions||(this.definitions={});var h=c[0];if(h.indexOf&&-1<h.indexOf(","))for(var h=
c.join("").split(/\s*,\s*/),k=[],l=0;l<h.length;l++)k[l]=n.evaluate(this,h[l]);c[0]&&"{"==c[0].operator?k=c[0]:c[1]&&"{"==c[1].operator&&(k=c[1],d.extend(k,c[0]));k=k||n.evaluate(this,c);if(k.then)var m=k,k={then:function(a){return m.then(function(b){return a(q(b))})}};var q=function(b){b.define&&(b=b.define(f,a));return b};g&&console.warn('Overriding existing property "'+a+'"');return e[a]=q(k)}}else return e=this.definitions||(this.definitions={}),e[a]=c}},onArguments:function(a){var b=a.ref;return b&&
b.apply(this,a.getArgs(),this)},setValue:function(a,d,e){var f=p(a);if(!this.disabled){var g=this.values||(this.values=[]);g.push(a);g[a]=d;if(a){do{g=(e||this).getDefinition(a);if(void 0!==g){if(this.cssRule&&(!g||!g.keepCSSValue)){var h=this.cssRule.style;f in h&&m(h,f,"")}c(this,g.put(d,this,f))}a=a.substring(0,a.lastIndexOf("-"))}while(a)}f in b&&this._setStyleFromValue(f,d,!0)}},_setStyleFromValue:function(b,c,e){var f=c[0];if(f instanceof q)for(e=f.values,f=0;f<e.length;f++){var g=e[f];this._setStyleFromValue(b+
("main"==g?"":g.charAt(0).toUpperCase()+g.slice(1)),e[g])}else{if(c.calls){var h=this;if(c.expression=a(c,this,b,!0)){var k=c.expression&&c.expression.valueOf(),l=function(a,c){var d=k&&k.forRule?k.forRule(a,!0):k;if(d&&d.forElement){var e=c&&c.elements;if(e)for(var f=0;f<e.length;f++)for(var g=e[f].querySelectorAll(a.selector),h=0;h<g.length;h++){var l=g[h];m(l.style,b,d.forElement(l))}else r(a,d,function(a,c){m(c.style,b,a)})}else a.setStyle(b,d)},n=[h];d.when(k,function(a){(k=a)&&k.forRule&&(h._subRuleListeners||
(h._subRuleListeners=[])).push(function(a){n.push(a);l(a)});l(h)});c.expression.dependencyOf({invalidate:function(a){d.when(c.expression.valueOf(),function(b){k=b;for(b=0;b<n.length;b++){var c=!0,d=n[b];if(a&&a.rules)for(var c=!1,e=0;e<a.rules.length;e++)if(a.rules[e]===d){c=!0;break}c&&l(d,a)}})}})}}e||this.setStyle(b,c)}},put:function(a){var b=this;return{forRule:function(c){b.extend(c);if("defaults"!=a&&a&&"string"==typeof a&&b.values)for(var d=a.toString().split(/,\s*/),e=0;e<d.length;e++){var f=
b.values[e];f&&c.setValue(f,d[e],b)}}}},extend:function(a,c){(this.derivatives||(this.derivatives=[])).push(a);var d=this.extraSelector;d&&(a.selector+=d);for(var e=this.cssRule.style,f=a.getCssRule().style,k=a.inheritedStyles||(a.inheritedStyles={}),d=0;d<e.length;d++){var l=p(e[d]);if(!f[l]||k[l])f[l]=e[l],k[l]=!0}if(d=this.values){var d=g(d),m=a.values;a.values=m?h.copy(d,m):d}if(c){if(d=this.definitions){var d=g(d),n=a.definitions;a.definitions=n?h.copy(d,n):d}a.tagName=this.tagName||a.tagName}(a.bases||
(a.bases=[])).push(this);l=this._subRuleListeners||0;for(d=0;d<l.length;d++)l[d](a);var q=a.getCssRule().style;this.eachProperty(function(c,d){var e=p(c);"object"==typeof d&&(d=g(d));e in b&&!q[e]&&a._setStyleFromValue(e,d)});if(m&&a.definitions)for(d=0,e=m.length;d<e;d++)l=m[d],f=p(l),a.definitions[f]!==(n&&n[f])&&a.setValue(l,m[f]);if(m=this.generator){if(m instanceof Array)for(m=m.slice(0),d=0;d<m.length;d++)n=m[d],"{"===n.operator&&(l=a.newRule(),l.selector=n.selector+a.selector.slice(1),l.styleSheet=
a.styleSheet||a.cssRule.parentStyleSheet,n.extend(l,!0),m[d]=l);a.declareDefinition(null,m)}},getDefinition:function(a,b){a=p(a);var c=this;do{var d=c.definitions&&c.definitions[a];void 0===d&&b&&c[b]&&(d=c[b][a]);c=c.parent}while(void 0===d&&c);return d},newElement:function(){return l((this.tagName||"span")+(this.selector||""))},cssText:""};n.evaluateText=a;var u=k.prototype=new q;u.declareDefinition=u.setValue=function(a,b){this.args.push(b)};u.toString=function(){var a=this.operator;return a+this.args+
e[a]};q.updateStaleProperties=function(){};return q})},"xstyle/core/generate":function(){define("xstyle/core/generate",["xstyle/core/elemental","put-selector/put","xstyle/core/utils","xstyle/core/expression","xstyle/core/base"],function(n,f,l,h,d){function m(a,d){a=a.sort?a:[a];return function(e,g,h){var m=e,p;"content"in e||(e.content=void 0);if(void 0===h){var r=(e._contentNode||e).childNodes||0,u=r[0];if(u){var t=b.createDocumentFragment();do t.appendChild(u);while(u=r[0]);e.content=t}if(e._contentNode){e._contentNode=
void 0;try{e.innerHTML=""}catch(J){}}}for(var v=0,w=[e],z=[],r=0,u=a.length;r<u;r++){var y=K,K=a[r];try{if(K.eachProperty){if(K.args)if("("==K.operator){var Q=a[r+1];q(K,Q,m,function(a,b,e){c(a,b,e,d)})}else{var O=K.args[0];if("string"===typeof O){var L=O.split("\x3d");try{m.setAttribute(L[0],L[1])}catch(J){console.error(J)}}else{var S=O[0].replace(/=$/,""),P=O[1];"("==P.operator?q(O[1],S,m,function(a,b,c){k(a,b,c,d)}):m.setAttribute(S,P.value)}}}else if("string"==typeof K){"\x3d"==K.charAt(0)&&(K=
K.slice(1));var M=m,Q=a[r+1],L=[];K.replace(/([,\n]+)?([\t ]*)?(\.|#)?([-\w%$|\.\#]+)(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,function(){L.push(arguments)});for(var N=0;N<L.length;N++)(function(a,b,c,k,n,q,r){function u(){var a=M._contentNode;a&&(a.innerHTML="",M=a)}b?(a=c?c.length:0,a>v?(u(),w[a]=M):M=w[a]||M,v=a):u();var t;if(k)t=(y&&y.args?"":"span")+k+n;else{k=n.match(/^[-\w]+/);if(!k)throw new SyntaxError("Unable to parse selector",n);k=k[0];var x;N===L.length-1&&Q&&Q.selector?(Q.bases||l.extend(Q,
k),x=Q):x=d.getDefinition(k);x&&(x.then||x.newElement)?M=function(a,b,c,d){var e,g;l.when(x&&x.newElement&&x.newElement(),function(a){(e=a)?(c=c.slice(d.length))&&f(e,c):e=f(c);if(g){g.parentNode.replaceChild(e,g);a=g.childNodes;var b;for(e=e._contentNode||e;b=a[0];)e.appendChild(b)}});if(e)return a.insertBefore(e,b||null);g=f("span");return a.insertBefore(g,b||null)}(M,h,n,k):t=n}t&&(M=f(h||M,(h?"-":"")+t));h=null;q&&M.setAttribute(q,""===r?q:r);g&&(M.item=g);p=p||M;(N<L.length-1||M!=m&&M!=e)&&z.push(N==
L.length-1&&Q&&Q.selector,M);m=M}).apply(this,L[N])}else m.appendChild(b.createTextNode(K.value))}catch(J){console.error(J,J.stack),m.innerHTML&&(m.innerHTML=""),m.appendChild(b.createTextNode(J))}}for(;K=z.pop();)n.update(K,z.pop());return p}}function q(a,b,c,d){var e,g;b&&b.eachProperty?(f(c,e=b.selector),g=b):(f(c,e=a.selector||(a.selector=".-xbind-"+u++)),g=a);var k=a.getArgs()[0],l=a.expressionResult,m=a.expressionDefinition;m||(m=a.expressionDefinition=h.evaluate(a.parent,k),l=m.valueOf(),n.addInputConnector(g,
m),function(b,c,e){a.expressionResult=l;e.dependencyOf&&e.dependencyOf({invalidate:function(a){a=a?n.matchesRule(a.elements[0],g)?a.elements:a.elements[0].querySelectorAll(c):document.querySelectorAll(c);for(var f=0,h=a.length;f<h;f++)d(a[f],b,e.valueOf())}})}(b,e,m));d(c,b,l)}function a(a,b,c,d){return l.when(a,function(a){a&&a.forRule&&(a=a.forRule(b));a&&a.forElement&&(a=a.forElement(c));d(a)})}function k(b,c,d,e){a(d,e,b,function(a){b.setAttribute(c,a)})}function c(c,d,g,h){c._defaultBinding=
!0;if(g&&g.then&&"INPUT"!==c.tagName)try{c.appendChild(b.createTextNode("Loading"))}catch(z){}a(g,h,c,function(a){if(c._defaultBinding)if(r(c),c.childNodes.length&&(c.innerHTML=""),a&&a.sort)if(a.isSequence)m(a,h)(c);else{var g=d&&d.definitions&&d.definitions.each,k=h.newRule(),g=g?m(g,k):function(a,b,c){return f(c||a,(c?"-":"")+(p[a.tagName]||"span"),""+b)},l=[],n;a.track&&(a=a.track(),n=a.tracking);a.forEach(function(a){l.push(g(c,a,null))});if(a.on)var q=a.on("add,delete,update",function(a){var b=
a.target,d=a.previousIndex;a=a.index;if(-1<d){var e=l[d];r(e,!0);e.parentNode.removeChild(e);l.splice(d,1)}-1<a&&l.splice(a,0,g(c,b,l[a]||null))});if(n=n||q)c.xcleanup=function(){n.remove()}}else a&&a.nodeType?c.appendChild(a):(a=void 0===a?"":a,c.tagName in e?"checkbox"===c.type?c.checked=a:c.value=a:c.appendChild(b.createTextNode(a)))})}function r(a,b){a.xcleanup&&a.xcleanup(b);for(var c=a.getElementsByTagName("*"),d=0,e=c.length;d<e;d++){var f=c[d];f.xcleanup&&f.xcleanup(!0)}}function g(a,b){return m(b,
d)(a)}var p={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},e={INPUT:1,TEXTAREA:1,SELECT:1},b=document,u=1;g.forSelector=m;return g})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g){l.isAsync||a(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var p=f("dojo.dnd.Source",r,{isSource:!0,
horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){h.mixin(this,h.mixin({},b));var c=this.accept;if(c.length){this.accept={};for(var e=0;e<c.length;++e)this.accept[c[e]]=1}this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&d.add(this.node,"dojoDndSource");this.targetState="";this.accept&&d.add(this.node,
"dojoDndTarget");this.horizontal&&d.add(this.node,"dojoDndHorizontal");this.topics=[k.subscribe("/dnd/source/over",h.hitch(this,"onDndSourceOver")),k.subscribe("/dnd/start",h.hitch(this,"onDndStart")),k.subscribe("/dnd/drop",h.hitch(this,"onDndDrop")),k.subscribe("/dnd/cancel",h.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var c=0;c<b.length;++c){for(var d=a.getItem(b[c].id).type,e=!1,f=0;f<d.length;++f)if(d[f]in this.accept){e=!0;
break}if(!e)return!1}return!0},copyState:function(a,b){if(a)return!0;2>arguments.length&&(b=this==g.manager().target);if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){p.superclass.destroy.call(this);n.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!this.isDragging||"Disabled"!=this.targetState){p.superclass.onMouseMove.call(this,a);var b=g.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&
(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var d=this.getSelectedNodes();d.length&&b.startDrag(this,d,this.copyState(c.getCopyKeyState(a),!0))}this.isDragging&&(d=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=m.position(this.current,!0)),d=this.horizontal?a.pageX-this.targetBox.x<this.targetBox.w/2==m.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||d!=
this.before)&&(this._markTargetAnchor(d),b.canDrop(!this.current||b.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(a){this.mouseDown||!this._legalMouseDown(a)||this.skipForm&&c.isFormElement(a)||(this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,p.superclass.onMouseDown.call(this,a))},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,p.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):
this.isDragging&&(a=g.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,b,c){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?c?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(a,b);this._changeState("Target",b?"":"Disabled");this==a&&g.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,c,d){if(this==d)this.onDrop(a,b,c);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&
(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,c){if(this!=a)this.onDropExternal(a,b,c);else this.onDropInternal(b,c)},onDropExternal:function(a,b,d){var e=this._normalizedCreator;this._normalizedCreator=this.creator?function(b,c){return e.call(this,a.getItem(b.id).data,c)}:d?function(b){var d=a.getItem(b.id);b=b.cloneNode(!0);b.id=c.getUniqueId();return{node:b,
data:d.data,type:d.type}}:function(b){var c=a.getItem(b.id);a.delItem(b.id);return{node:b,data:c.data,type:c.type}};this.selectNone();d||this.creator||a.selectNone();this.insertNodes(!0,b,this.before,this.current);!d&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=e},onDropInternal:function(a,b){var d=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=this.creator?function(a,b){return d.call(this,this.getItem(a.id).data,b)}:function(a){var b=
this.getItem(a.id);a=a.cloneNode(!0);a.id=c.getUniqueId();return{node:a,data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=d}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){p.superclass.onOverEvent.call(this);g.manager().overSource(this);if(this.isDragging&&"Disabled"!=
this.targetState)this.onDraggingOver()},onOutEvent:function(){p.superclass.onOutEvent.call(this);g.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){if(this.current!=this.targetAnchor||this.before!=a)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":
"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!q.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(d.contains(a,"dojoDndHandle"))return!0;if(d.contains(a,"dojoDndItem")||d.contains(a,
"dojoDndIgnore"))break}return!1}});return p})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g){var p=f("dojo.dnd.Selector",g,{constructor:function(a,b){b||(b={});this.singular=b.singular;this.autoSync=b.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(k(this.node,c.press,h.hitch(this,
"onMouseDown")),k(this.node,c.release,h.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var c=new a,b=r._empty,f;for(f in this.selection)f in b||c.push(d.byId(f));return c},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(a,b){this._addItemClass(d.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=r._empty,b;for(b in this.selection)if(!(b in a)){var c=
d.byId(b);this.delItem(b);m.destroy(c)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||l.global;var c=this.selection,d=r._empty,e;for(e in c)e in d||a.call(b,this.getItem(e),e,this)},sync:function(){p.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],b=r._empty,c;for(c in this.selection)c in b||this.getItem(c)||a.push(c);n.forEach(a,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,
b,c,d){var e=this._normalizedCreator;this._normalizedCreator=function(b,c){var d=e.call(this,b,c);a?(this.anchor?this.anchor!=d.node&&(this._removeItemClass(d.node,"Anchor"),this._addItemClass(d.node,"Selected")):(this.anchor=d.node,this._removeItemClass(d.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[d.node.id]=1):(this._removeItemClass(d.node,"Selected"),this._removeItemClass(d.node,"Anchor"));return d};p.superclass.insertNodes.call(this,b,c,d);this._normalizedCreator=
e;return this},destroy:function(){p.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!r.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,q.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){r.getCopyKeyState(a)||this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=b[0],this._addItemClass(this.anchor,
"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var c=0,d;c<b.length&&(d=b[c],d!=this.anchor&&d!=this.current);++c);for(++c;c<b.length;++c){d=b[c];if(d==this.anchor||d==this.current)break;this._addItemClass(d,"Selected");this.selection[d.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?r.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,
"Anchor"),this.selection[this.current.id]=1):r.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||
(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=k(this.node,c.move,h.hitch(this,"onMouseMove"))},
onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=r._empty,b;for(b in this.selection)if(!(b in a)){var c=d.byId(b);c&&this._removeItemClass(c,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return p})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r,g,p,e){f=f("dojo.dnd.Container",k,{skipForm:!1,allowNested:!1,constructor:function(a,c){this.node=m.byId(a);c||(c={});this.creator=c.creator||null;this.skipForm=c.skipForm;this.parent=c.dropParent&&m.byId(c.dropParent);this.map={};this.current=null;this.containerState="";q.add(this.node,"dojoDndContainer");c&&c._skipStartup||this.startup();this.events=[r(this.node,p.over,h.hitch(this,"onMouseOver")),r(this.node,p.out,h.hitch(this,"onMouseOut")),r(this.node,"dragstart",
h.hitch(this,"onSelectStart")),r(this.node,"selectstart",h.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,c){this.map[a]=c},delItem:function(a){delete this.map[a]},forInItems:function(a,c){c=c||l.global;var b=this.map,d=e._empty,f;for(f in b)f in d||a.call(c,b[f],f,this);return c},clearItems:function(){this.map={}},getAllNodes:function(){return g((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var c=
this.getItem(b.id);if(c){a[b.id]=c;return}}else b.id=e.getUniqueId();var c=b.getAttribute("dndType"),d=b.getAttribute("dndData");a[b.id]={data:d||b.innerHTML,type:c?c.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,c,d){this.parent.firstChild?c?d||(d=this.parent.firstChild):d&&(d=d.nextSibling):d=null;var b;if(d)for(c=0;c<a.length;++c)b=this._normalizedCreator(a[c]),this.setItem(b.node.id,{data:b.data,type:b.type}),d.parentNode.insertBefore(b.node,d);else for(c=0;c<
a.length;++c)b=this._normalizedCreator(a[c]),this.setItem(b.node.id,{data:b.data,type:b.type}),this.parent.appendChild(b.node);return this},destroy:function(){n.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,c,d){a._skipStartup=!0;return new d(c,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=
a[0])}this.defaultCreator=e._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&b!=this.node;)try{b=b.parentNode}catch(t){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(u){a=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){this.skipForm&&e.isFormElement(a)||(a.stopPropagation(),a.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,c){var b="dojoDnd"+a,d=a.toLowerCase()+"State";q.replace(this.node,b+c,b+this[d]);this[d]=c},_addItemClass:function(a,c){q.add(a,"dojoDndItem"+c)},_removeItemClass:function(a,c){q.remove(a,"dojoDndItem"+c)},_getChildByEvent:function(a){if(a=
a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&q.contains(a,"dojoDndItem"))return a;return null},_normalizedCreator:function(a,c){var b=(this.creator||this.defaultCreator).call(this,a,c);h.isArray(b.type)||(b.type=["text"]);b.node.id||(b.node.id=e.getUniqueId());q.add(b.node,"dojoDndItem");return b}});e._createNode=function(b){return b?function(c){return a.create(b,{innerHTML:c})}:e._createSpan};e._createTrTd=function(b){var c=a.create("tr");a.create("td",
{innerHTML:b},c);return c};e._createSpan=function(b){return a.create("span",{innerHTML:b})};e._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};e._defaultCreator=function(a){a=a.tagName.toLowerCase();var b="tbody"==a||"thead"==a?e._createTrTd:e._createNode(e._defaultCreatorNodes[a]);return function(a,c){var d=a&&h.isObject(a),f,g;d&&a.tagName&&a.nodeType&&a.getAttribute?(f=a.getAttribute("dndData")||a.innerHTML,d=(d=a.getAttribute("dndType"))?d.split(/\s*,\s*/):["text"],g=a):(f=d&&a.data?a.data:
a,d=d&&a.type?a.type:["text"],g=("avatar"==c?e._createSpan:b)(String(f)));g.id||(g.id=e.getUniqueId());return{node:g,data:f,type:d}}};return f})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g,p,e){var b=f("dojo.dnd.Manager",[m],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;
this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:q("touch")?4:16,OFFSET_Y:q("touch")?4:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());c.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),c.publish("/dnd/source/over",null)):c.publish("/dnd/source/over",null)},startDrag:function(a,b,e){function f(a){a.preventDefault();
a.stopPropagation()}p.autoScrollStart(h.doc);this.source=a;this.nodes=b;this.copy=!!e;this.avatar=this.makeAvatar();h.body().appendChild(this.avatar.node);c.publish("/dnd/start",a,b,this.copy);this.events=[k(h.doc,r.move,l.hitch(this,"onMouseMove")),k(h.doc,r.release,l.hitch(this,"onMouseUp")),k(h.doc,"keydown",l.hitch(this,"onKeyDown")),k(h.doc,"keyup",l.hitch(this,"onKeyUp")),k(h.doc,"dragstart",f),k(h.body(),"selectstart",f)];a="dojoDnd"+(e?"Copy":"Move");d.add(h.body(),a)},canDrop:function(a){a=
!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){d.remove(h.body(),["dojoDndCopy","dojoDndMove"]);n.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new e(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var b=this.avatar;b&&(p.autoScrollNodes(a),b=b.node.style,b.left=a.pageX+this.OFFSET_X+"px",b.top=
a.pageY+this.OFFSET_Y+"px",b=!!this.source.copyState(g.getCopyKeyState(a)),this.copy!=b&&this._setCopyStatus(b));q("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var b=!!this.source.copyState(g.getCopyKeyState(a));c.publish("/dnd/drop/before",this.source,this.nodes,b,this.target,a);c.publish("/dnd/drop",this.source,this.nodes,b,this.target,a)}else c.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(b){if(this.avatar)switch(b.keyCode){case a.CTRL:b=
!!this.source.copyState(!0);this.copy!=b&&this._setCopyStatus(b);break;case a.ESCAPE:c.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(b){this.avatar&&b.keyCode==a.CTRL&&(b=!!this.source.copyState(!1),this.copy!=b&&this._setCopyStatus(b))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();d.replace(h.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});g._manager=null;b.manager=g.manager=function(){g._manager||
(g._manager=new b);return g._manager};return b})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(n,f,l,h,d,m,q,a){return n("dojo.dnd.Avatar",null,{constructor:function(a){this.manager=a;this.construct()},construct:function(){var a=m.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),c=this.manager.source,d,f=m.create("tbody",null,a),l=m.create("tr",
null,f),e=m.create("td",null,l),b=Math.min(5,this.manager.nodes.length),n=0;q("highcontrast")&&m.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},e);m.create("span",{innerHTML:c.generateText?this._generateText():""},e);for(h.set(l,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});n<b;++n)c.creator?d=c._normalizedCreator(c.getItem(this.manager.nodes[n].id).data,"avatar").node:(d=this.manager.nodes[n].cloneNode(!0),"tr"==d.tagName.toLowerCase()&&(l=m.create("table"),m.create("tbody",
null,l).appendChild(d),d=l)),d.id="",l=m.create("tr",null,f),e=m.create("td",null,l),e.appendChild(d),h.set(l,{"class":"dojoDndAvatarItem",style:{opacity:(9-n)/10}});this.node=a},destroy:function(){m.destroy(this.node);this.node=!1},update:function(){d.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(q("highcontrast")){var f=l.byId("a11yIcon"),c="+";this.manager.canDropFlag&&!this.manager.copy?c="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(c="x"):
c="o";f.innerHTML=c}a("tr.dojoDndAvatarHeader td span"+(q("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(n,f,l,h){return n("dijit.CheckedMenuItem",l,{baseClass:"dijitMenuItem dijitCheckedMenuItem",
templateString:h,checked:!1,_setCheckedAttr:function(d){this.domNode.setAttribute("aria-checked",d?"true":"false");this._set("checked",d)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(d){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(d)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(n,f,l,h,d,m,q,a,k,c,r){var g=k("dijit.ColorPalette",[l,h,d],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:f,baseClass:"dijitColorPalette",_dyeFactory:function(a,c,b,d){return new this._dyeClass(a,
c,b,d)},buildRendering:function(){this.inherited(arguments);this._dyeClass=k(g._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],q.getLocalization("dojo","colors",this.lang))}});g._Color=k("dijit._Color",a,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":n.toUrl("./themes/a11y/colors7x10.png"),"3x4":n.toUrl("./themes/a11y/colors3x4.png")},constructor:function(c,d,b,f){this._title=f;this._row=d;this._col=b;this.setColor(a.named[c])},getValue:function(){return this.toHex()},fillCell:function(a,d){var b=r.substitute(m("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:d,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});c.place(b,a)}});return g})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(n,f,l,h,d,m,q,a,k,c,r){return n("dijit._PaletteMixin",a,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?m.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(a,c){this._cells=[];var e=this._blankGif;this.own(q(this.gridNode,k,m.hitch(this,"_onCellClick")));for(var b=0;b<a.length;b++)for(var f=h.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),g=0;g<a[b].length;g++){var l=a[b][g];if(l){var n=this._dyeFactory(l,b,g,c[l]),l=h.create("td",{"class":this.cellClass,tabIndex:"-1",title:c[l],role:"gridcell"},f);n.fillCell(l,e);l.idx=this._cells.length;this._cells.push({node:l,
dye:n})}}this._xDim=a[0].length;this._yDim=a.length;var p={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},z;for(z in p)this.own(r.addKeyListener(this.domNode,{keyCode:d[z],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=p[z];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){c.focus(this._currentFocus)},
_onCellClick:function(a){for(var d=a.target;"TD"!=d.tagName;){if(!d.parentNode||d==this.gridNode)return;d=d.parentNode}var e=this._getDye(d).getValue();this._setCurrent(d);c.focus(d);this._setValueAttr(e,!0);a.stopPropagation();a.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&f.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&f.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,c){0<=this._selectedCell&&l.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var d=0;d<this._cells.length;d++)if(a==this._cells[d].dye.getValue()){this._selectedCell=d;l.add(this._cells[d].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(c||void 0===c)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,d){if(-1!=d){var e=this._currentFocus.idx+a;e<this._cells.length&&-1<e&&(e=this._cells[e].node,this._setCurrent(e),this.defer(m.hitch(c,"focus",e)))}},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(n){return n})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(n,f,l,h,d,m,q,a,k){h("dijit-legacy-requires")&&m(0,function(){n(["dijit/form/RadioButton"])});return f("dijit.form.CheckBox",[q,a],{templateString:k,baseClass:"dijitCheckBox",_setValueAttr:function(a,
d){"string"==typeof a&&(this.inherited(arguments),a=!0);this._created&&this.set("checked",a,d)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&d("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&d("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");
this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(n,f){return n("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(l){this._set("readOnly",l);f.set(this.focusNode,"readOnly",l)},_setLabelAttr:void 0,_getSubmitValue:function(f){return null==f||""===f?"on":f},_setValueAttr:function(l){l=this._getSubmitValue(l);this._set("value",l);f.set(this.focusNode,
"value",l)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));f.set(this.focusNode,"value",this.value)},_onClick:function(f){return this.readOnly?(f.stopPropagation(),f.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(n,f,l){return n("dijit.form.ComboBox",[f,l],{})})},"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n        \x3cimg data-dojo-attach-point\x3d"loadingImg"/\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/AddItemForm.html":'\x3cdiv style\x3d"width: 100%" class\x3d"jimu-item-form"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"itemForm" encType\x3d"multipart/form-data" action\x3d"" method\x3d""\x3e\r\n    \x3cdiv class\x3d"line"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.title}\x3c/div\x3e\r\n      \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"itemName"\r\n      required\x3d"true" class\x3d"input-item"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"line line-margin"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.folder}\x3c/div\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"itemFolder" data-dojo-type\x3d"dijit/form/FilteringSelect" trim\x3d"true" class\x3d"input-item"\x3e\x3c/input\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'0\' selected\x3d"selected"\x3e${nls.basic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'1\'\x3eA-Z\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'2\'\x3e${nls.arrows}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'3\'\x3e${nls.business}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'4\'\x3e${nls.cartographic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'5\'\x3e${nls.nationalParkService}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'6\'\x3e${nls.outdoorRecreation}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'7\'\x3e${nls.peoplePlaces}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'8\'\x3e${nls.safetyHealth}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'9\'\x3e${nls.shapes}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'10\'\x3e${nls.transportation}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d"custom"\x3e${nls.customImage}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointCustomImageTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"customImageTd" class\x3d"custom-image-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"image-file-tip jimu-ellipsis jimu-leading-margin1" data-dojo-attach-point\x3d"imageNameNode"\x3e${nls.noFileChoosen}\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr" data-dojo-attach-point\x3d"pointIconTablesTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e${nls.outlineWidth}:\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput class\x3d"text-input" data-dojo-attach-point\x3d"inputText" type\x3d"text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ImageChooser.html":'\x3cdiv class\x3d"jimu-image-chooser js-fileapi-wrapper"\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintText"\x3e\r\n\t\t\x3cspan class\x3d"display-text" data-dojo-attach-point\x3d"displayText"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintImage"\x3e\r\n\t\t\x3cimg class\x3d"display-image" data-dojo-attach-point\x3d"selfImg"\x3e\r\n  \x3c/div\x3e\r\n  \x3cform data-dojo-attach-point\x3d"fileForm"\x3e\r\n    \x3clabel data-dojo-attach-point\x3d"mask"\x3e\x3c/label\x3e\r\n    \x3cinput type\x3d"file" data-dojo-attach-point\x3d"fileInput"\x3e\r\n  \x3c/form\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_CropImage.html":'\x3cdiv class\x3d"jimu-crop-image"\x3e\r\n\t\x3cdiv class\x3d"crop-section" data-dojo-attach-point\x3d"cropSection"\x3e\r\n\t\t\x3cdiv class\x3d"viewer-box hide-status" data-dojo-attach-point\x3d"viewerBox"\x3e\r\n\t\t\t\x3cdiv class\x3d"viewer-content" data-dojo-attach-point\x3d"viewerContent"\x3e\r\n\t\t\t\t\x3cimg class\x3d"viewer-image hide-status" data-dojo-attach-point\x3d"viewerImage" src\x3d""\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cimg class\x3d"base-image hide-status" data-dojo-attach-point\x3d"baseImage" data-dojo-attach-event\x3d"mousedown:_onViewerMouseDown,mouseup:_onViewerMouseUp"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cimg class\x3d"loading-image" data-dojo-attach-point\x3d"loadingImg" src\x3d""\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"controller hide-status" data-dojo-attach-point\x3d"zoomController"\x3e\r\n\t\t\x3cdiv class\x3d"zoom-out" data-dojo-attach-point\x3d"zoomOutBtn" data-dojo-attach-event\x3d"click:_onZoomOutClick"\x3e-\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"slider" data-dojo-attach-point\x3d"sliderNode"\x3e\r\n\t\t\t\x3cdiv class\x3d"button" data-dojo-attach-point\x3d"sliderButton" data-dojo-attach-event\x3d"mousedown:_onSliderMouseDown,mouseup:_onSliderMouseUp"\x3e\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"horizontal"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"zoom-in" data-dojo-attach-point\x3d"zoomInBtn" data-dojo-attach-event\x3d"click:_onZoomInClick"\x3e+\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e0%\x3c/li\x3e\r\n      \x3cli\x3e50%\x3c/li\x3e\r\n      \x3cli\x3e100%\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon" data-dojo-attach-point\x3d"pointIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon" data-dojo-attach-point\x3d"lineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon" data-dojo-attach-point\x3d"polylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon" data-dojo-attach-point\x3d"freehandPolylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon" data-dojo-attach-point\x3d"triangleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon" data-dojo-attach-point\x3d"extentIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon" data-dojo-attach-point\x3d"circleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon" data-dojo-attach-point\x3d"ellipseIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon" data-dojo-attach-point\x3d"polygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon" data-dojo-attach-point\x3d"freehandPolygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"TEXT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"drawings-clear" data-dojo-attach-point\x3d"btnClear" title\x3d"${nls.clear}"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ColorRecords.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\t\t\x3ctr tabindex\x3d"0" role\x3d"row" data-dojo-attach-point\x3d"container"\x3e\r\n\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',
"*now":function(n){n(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("./ConfigManager ./LayoutManager ./DataManager ./WidgetManager ./FeatureActionManager ./SelectionManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query esri/config esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main".split(" "),function(n,f,l,h,d,m,q,a,k,c,r,g,p,e,b,u,t,v,w,y,z,x,A,B,F){function E(a){C=a}e={};var C;t.defaults.io.timeout=18E4;
"function"!==typeof p.getAll&&(p.getAll=function(a){var b=[];(a=p(a))&&b.push(a);return b});window.jimuNls=F;y.setProtocolErrorHandler(function(){return!0});y=x.getAncestorWindow();var G=!1;try{G=0===y.location.href.indexOf("https://")}catch(H){console.log(H),G="https:"===window.location.protocol}v.setRequestPreCallback(function(a){a.content&&a.content.printFlag&&(a.timeout=3E5);G&&(a.url=a.url.replace(/^http(s?):\/\//gi,"//"));if(-1!==a.url.indexOf("/queryRelatedRecords?")){var b=a.url,c=t.defaults.io.proxyUrl;
c&&0===a.url.indexOf(c+"?")&&(b=a.url.replace(c+"?",""));x.isHostedService(b)||(a.url=a.url.replace("FeatureServer","MapServer"))}/GPServer\/.+\/jobs/.test(a.url)&&(a.preventCache=(new Date).getTime());!window.isBuilder&&C&&!C.mode&&C.appProxies&&0<C.appProxies.length&&k.some(C.appProxies,function(b){if(0<=a.url.indexOf(b.sourceUrl))return a.url=a.url.replace(b.sourceUrl,b.proxyUrl),!0});return a});c(window,"mousedown",function(a){if(r.isMiddle(a))return a.preventDefault(),a.stopPropagation(),a.returnValue=
!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=a.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.4";window.productVersion="Online 5.1";
window.isBuilder?(g.subscribe("app/appConfigLoaded",E),g.subscribe("app/appConfigChanged",E)):(g.subscribe("appConfigLoaded",E),g.subscribe("appConfigChanged",E));e.initApp=function(){var a,b;console.log("jimu.js init...");a=window.location.search;a=""===a?{}:u.queryToObject(a.substr(1));if(a.mobileBreakPoint)try{b=parseInt(a.mobileBreakPoint,10),jimuConfig.breakPoints[0]=b}catch(K){console.error("mobileBreakPoint URL parameter must be a number.",K)}l.getInstance(h.getInstance());d.getInstance();
m.getInstance();q.setStyle(jimuConfig.loadingId,"display","none");q.setStyle(jimuConfig.mainPageId,"display","block");b=f.getInstance({mapId:jimuConfig.mapId,urlParams:a},jimuConfig.layoutId);a=n.getInstance(a);b.startup();a.loadConfig();A(["dynamic-modules/preload"])};return e});