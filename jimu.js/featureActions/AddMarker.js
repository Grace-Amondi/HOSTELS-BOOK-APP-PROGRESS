// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare ../BaseFeatureAction esri/graphic esri/layers/GraphicsLayer esri/symbols/PictureMarkerSymbol esri/InfoTemplate jimu/shareUtils".split(" "),function(k,l,m,n,p,q,g){return k(l,{name:"AddMarker",iconClass:"icon-add",_markerLayer:null,isFeatureSupported:function(a){this._getMarkerLayer();return this._isSupportType(a)&&0<a.features.length&&a.features[0]&&a.features[0].geometry&&!1===this._isFeatureInMarkerFeatureActionLayer(a,this._markerLayer)},onExecute:function(a,e){this._addMarker(a,
e)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new n({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var a=this.map.snappingManager.layerInfos;a.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(a)}},_addMarker:function(a,e){var b=a.features[0].geometry,d={},c=e.displayField||a.displayFieldName||e.objectIdField;
d.title="";a.features[0].attributes&&c&&(d.title=a.features[0].attributes[c],d.title||(d.title=""));c={};if("point"===b.type)c=b;else if("polygon"===b.type||"polyline"===b.type||"multipoint"===b.type)c=b.getExtent().getCenter();c.getLongitude()&&c.getLatitude()?(d.longitude=c.getLongitude(),d.latitude=c.getLatitude()):c.x&&c.y&&(d.x=c.x,d.y=c.y);var f="";b&&b.spatialReference&&b.spatialReference.wkid&&(f=b.spatialReference.wkid);d.spatialReference={wkid:f};b=g.getXyContent(d);d=g.getShareUrl(this.map,
d,b,!0);d=g.getShareUrlContent(d);d=b+d;b=new p(require.toUrl("jimu")+"/images/EsriBluePinCircle26.png");b.width=26;b.height=26;b.setOffset(0,b.height/2);c=new m(c,b,null,null);c._markerFeatureactionGraphic=a.features[0];c.infoTemplate=this._setInfoTemplate(d);this._markerLayer.add(c);this._closePopupWindow()},_setInfoTemplate:function(a){var e=new q;e.setContent(a);return e},_closePopupWindow:function(){this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(a,
e){if(a.features[0]&&a.features[0]._graphicsLayer&&a.features[0]._graphicsLayer.id&&"marker-feature-action-layer"===a.features[0]._graphicsLayer.id)return!0;for(var b=0,d=a.features.length;b<d;b++){var c=a.features[b];if(e&&"undefined"!==typeof e.graphics)for(var f=0,g=e.graphics.length;f<g;f++){var h=e.graphics[f];if(h._markerFeatureactionGraphic&&(c===h||c===h._markerFeatureactionGraphic))return!0}}return!1},_isSupportType:function(a){return a&&a.geometryType?(a=a.geometryType,"point"===a||"polygon"===
a||"polyline"===a||"multipoint"===a):!1}})});