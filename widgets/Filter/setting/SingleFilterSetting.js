// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Filter/setting/SingleFilterSetting.html":'\x3cdiv\x3e\r\n\t\x3ctable\x3e\r\n\t\t\x3ccolgroup\x3e\r\n\t\t\t\x3ccol width\x3d"100"\x3e\x3c/col\x3e\r\n\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\x3c/colgroup\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e${jimuNls.common.layer}\x3c/td\x3e\r\n\t\t\t\t\x3ctd data-dojo-attach-point\x3d"layerTd"\x3e\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e${jimuNls.common.title}\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"nameTextBox" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-event\x3d"change:_onNameTextBoxChanged" data-dojo-props\x3d\'required:true,trim:true\' style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e${jimuNls.common.icon}\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"click-picker" data-dojo-attach-event\x3d"click:_onImageChooserDivClicked"\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/ImageChooser" data-dojo-attach-point\x3d"imageChooser" data-dojo-props\x3d"cropImage:true,showSelfImg:true,goldenWidth:16,goldenHeight:16,format:[\'image/gif\',\'image/png\',\'image/jpeg\']" class\x3d"jimu-float-leading" style\x3d"width:16px;height:16px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"separator jimu-float-leading"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8 jimu-float-leading"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"tdUseMapFilter"\x3e\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv style\x3d"margin-top:10px;"\x3e\r\n\t\t\x3cdiv\x3e${nls.filterExpression}\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"filterDiv"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/on dojo/query dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./SingleFilterSetting.html jimu/utils jimu/dijit/Filter jimu/dijit/Message jimu/dijit/CheckBox jimu/dijit/LayerChooserFromMapWithDropbox ./CustomFeaturelayerChooserFromMap jimu/dijit/ImageChooser dijit/form/ValidationTextBox".split(" "),function(e,h,k,c,f,l,m,n,p,q,d,r,t,u,v,w){return l([m,n,p,k],{baseClass:"jimu-widget-singlefilter-setting",
templateString:q,jimuNls:null,_defaultTaskIcon:null,map:null,nls:null,target:null,layerInfosObj:null,folderUrl:"",appConfig:null,postMixInProperties:function(){this.inherited(arguments);this._defaultTaskIcon=this.folderUrl+"css/images/default_task_icon.png";this.jimuNls=window.jimuNls},postCreate:function(){this.inherited(arguments);this.cbxRemoveMapFilter=new u({label:this.nls.enableMapFilter||""});this.cbxRemoveMapFilter.placeAt(this.tdUseMapFilter);this.cbxRemoveMapFilter.setValue(!1);this._recreateLayerChooserSelect(!0);
this.filter=new r({enableAskForValues:!0,noFilterTip:this.nls.noFilterTip,style:"width:100%;"});this.filter.placeAt(this.filterDiv);this._setDefaultTaskIcon();this.own(e(this.filter,"filter-number-change",c.hitch(this,this.calculateExpsBoxMaxHeight)));this.calculateExpsBoxMaxHeight()},_recreateLayerChooserSelect:function(a){this.layerChooserSelect&&this.layerChooserSelect.destroy();this.layerChooserSelect=null;var b=new w({showLayerFromFeatureSet:!1,showTable:!1,onlyShowVisible:!1,createMapResponse:this.map.webMapResponse});
this.layerChooserSelect=new v({layerChooser:b});this.layerChooserSelect.placeAt(this.layerTd);a&&this._bindEventForLayerChooserSelect(this.layerChooserSelect)},showLayerChooserPopup:function(){this.layerChooserSelect.showLayerChooser()},destroy:function(){this.target=null;this.emit("before-destroy");this.inherited(arguments)},setConfig:function(a){var b=c.clone(a);this._showLoading();this.reset();this._recreateLayerChooserSelect(!1);var g=c.hitch(this,function(){this.domNode&&(this._bindEventForLayerChooserSelect(this.layerChooserSelect),
this._hideLoading())});this.layerInfosObj.getLayerInfoById(b.layerId).getLayerObject().then(c.hitch(this,function(a){this.domNode&&this.layerChooserSelect.setSelectedLayer(a).then(c.hitch(this,function(c){this.domNode&&(this._hideLoading(),c&&(b.icon?this.imageChooser.setDefaultSelfSrc(d.processUrlInWidgetConfig(b.icon,this.folderUrl)):this._setDefaultTaskIcon(),this.cbxRemoveMapFilter.setValue(!b.enableMapFilter),this.nameTextBox.set("value",b.name),c=this._getLayerDefinitionForFilterDijit(a),this.filter.buildByFilterObj(a.url,
b.filter,c),this._bindEventForLayerChooserSelect(this.layerChooserSelect)))}),c.hitch(this,function(a){console.error(a);g()}))}),c.hitch(this,function(a){console.error(a);g()}))},getConfig:function(){var a={layerId:null,url:null,name:null,filter:null,icon:null,enableMapFilter:!this.cbxRemoveMapFilter.getValue()},b=this.layerChooserSelect.getSelectedItem();if(!b)return this._showMessage(this.nls.selectLayerTip),!1;b=b.layerInfo.layerObject;a.layerId=b.id;a.url=b.url;a.name=this.nameTextBox.get("value");
if(!a.name)return this._showMessage(this.nls.setTitleTip),!1;b=this.imageChooser.getImageData();b===this._defaultTaskIcon&&(b="");a.icon=b;a.filter=this.filter.toJson();return a.filter?this.target.singleConfig=a:(this._showMessage(window.jimuNls.filterBuilder.setFilterTip),!1)},calculateExpsBoxMaxHeight:function(){setTimeout(c.hitch(this,function(){if(this.domNode){var a=this.filter.allExpsBox,b=f.position(this.domNode),c=f.position(a),b=b.h-(c.y-b.y);0<b&&(a.style.maxHeight=b+"px")}}),100)},reset:function(){this._setDefaultTaskIcon();
this.cbxRemoveMapFilter.setValue(!1);this.nameTextBox.set("value","");this.filter.reset()},_setDefaultTaskIcon:function(){this.imageChooser.setDefaultSelfSrc(this._defaultTaskIcon)},_onNameTextBoxChanged:function(){var a=h(".label",this.target)[0],b=this.nameTextBox.get("value");a.innerHTML=b;a.title=b},_bindEventForLayerChooserSelect:function(a){a.isBindEvent||(this.own(e(a,"selection-change",c.hitch(this,this._onLayerChanged))),a.isBindEvent=!0)},_showMessage:function(a){new t({message:a})},_onLayerChanged:function(){this.reset();
var a=this.layerChooserSelect.getSelectedItem();if(a){var b=a.layerInfo,a=b.layerObject;this.nameTextBox.set("value",b.title);b=this._getLayerDefinitionForFilterDijit(a);this.filter.buildByExpr(a.url,"1\x3d1",b)}},_getLayerDefinitionForFilterDijit:function(a){var b=null;"esri.layers.FeatureLayer"===a.declaredClass&&(b=d.getFeatureLayerDefinition(a));b||(b={currentVersion:a.currentVersion,fields:c.clone(a.fields)});return b},_showLoading:function(){this.emit("loading")},_hideLoading:function(){this.emit("unloading")},
_onImageChooserDivClicked:function(a){this.imageChooser.mask&&(a=a.target||a.srcElement,a!==this.imageChooser.mask&&a!==this.imageChooser.fileInput&&d.simulateClickEvent(this.imageChooser.mask))}})});