// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dijit/layout/TabContainer":function(){define(["dojo/_base/lang","dojo/_base/declare","./_TabContainerBase","./TabController","./ScrollingTabController"],function(k,e,n,t,l){return e("dijit.layout.TabContainer",n,{useMenu:!0,useSlider:!0,controllerWidget:"",_makeController:function(e){var h=this.baseClass+"-tabs"+(this.doLayout?"":" dijitTabNoLayout");return new ("string"==typeof this.controllerWidget?k.getObject(this.controllerWidget):this.controllerWidget)({id:this.id+"_tablist",
ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,tabPosition:this.tabPosition,doLayout:this.doLayout,containerId:this.id,"class":h,nested:this.nested,useMenu:this.useMenu,useSlider:this.useSlider,tabStripClass:this.tabStrip?this.baseClass+(this.tabStrip?"":"No")+"Strip":null},e)},postMixInProperties:function(){this.inherited(arguments);this.controllerWidget||(this.controllerWidget="top"!=this.tabPosition&&"bottom"!=this.tabPosition||this.nested?t:l)}})})},"dijit/layout/_TabContainerBase":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style ./StackContainer ./utils ../_TemplatedMixin dojo/text!./templates/TabContainer.html".split(" "),
function(k,e,n,t,l,m,h,v){return k("dijit.layout._TabContainerBase",[l,h],{tabPosition:"top",baseClass:"dijitTabContainer",tabStrip:!1,nested:!1,templateString:v,postMixInProperties:function(){this.baseClass+=this.tabPosition.charAt(0).toUpperCase()+this.tabPosition.substr(1).replace(/-.*/,"");this.srcNodeRef&&t.set(this.srcNodeRef,"visibility","hidden");this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.tablist=this._makeController(this.tablistNode);this.doLayout||
e.add(this.domNode,"dijitTabContainerNoLayout");this.nested?(e.add(this.domNode,"dijitTabContainerNested"),e.add(this.tablist.containerNode,"dijitTabContainerTabListNested"),e.add(this.tablistSpacer,"dijitTabContainerSpacerNested"),e.add(this.containerNode,"dijitTabPaneWrapperNested")):e.add(this.domNode,"tabStrip-"+(this.tabStrip?"enabled":"disabled"))},_setupChild:function(q){e.add(q.domNode,"dijitTabPane");this.inherited(arguments)},removeChild:function(q){e.remove(q.domNode,"dijitTabPane");this.inherited(arguments)},
startup:function(){this._started||(this.tablist.startup(),this.inherited(arguments))},layout:function(){if(this._contentBox&&"undefined"!=typeof this._contentBox.l){var e=this.selectedChildWidget;if(this.doLayout){var f=this.tabPosition.replace(/-h/,"");this.tablist.region=f;f=[this.tablist,{domNode:this.tablistSpacer,region:f},{domNode:this.containerNode,region:"center"}];m.layoutChildren(this.domNode,this._contentBox,f);this._containerContentBox=m.marginBox2contentBox(this.containerNode,f[2]);e&&
e.resize&&e.resize(this._containerContentBox)}else{if(this.tablist.resize){f=this.tablist.domNode.style;f.width="0";var p=n.getContentBox(this.domNode).w;f.width="";this.tablist.resize({w:p})}e&&e.resize&&e.resize()}}},destroy:function(e){this.tablist&&this.tablist.destroy(e);this.inherited(arguments)}})})},"dijit/layout/StackContainer":function(){define("dojo/_base/array dojo/cookie dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/ready dojo/topic dojo/when ../registry ../_WidgetBase ./_LayoutWidget".split(" "),
function(k,e,n,t,l,m,h,v,q,f,p,d,b,c){m("dijit-legacy-requires")&&q(0,function(){require(["dijit/layout/StackController"])});n=n("dijit.layout.StackContainer",c,{doLayout:!0,persist:!1,baseClass:"dijitStackContainer",buildRendering:function(){this.inherited(arguments);t.add(this.domNode,"dijitLayoutContainer")},postCreate:function(){this.inherited(arguments);this.own(v(this.domNode,"keydown",h.hitch(this,"_onKeyDown")))},startup:function(){if(!this._started){var a=this.getChildren();k.forEach(a,this._setupChild,
this);this.persist?this.selectedChildWidget=d.byId(e(this.id+"_selectedChild")):k.some(a,function(a){a.selected&&(this.selectedChildWidget=a);return a.selected},this);var b=this.selectedChildWidget;!b&&a[0]&&(b=this.selectedChildWidget=a[0],b.selected=!0);f.publish(this.id+"-startup",{children:a,selected:b,textDir:this.textDir});this.inherited(arguments)}},resize:function(){if(!this._hasBeenShown){this._hasBeenShown=!0;var a=this.selectedChildWidget;a&&this._showChild(a)}this.inherited(arguments)},
_setupChild:function(a){var b=a.domNode,g=l.place("\x3cdiv role\x3d'tabpanel' class\x3d'"+this.baseClass+"ChildWrapper dijitHidden'\x3e",a.domNode,"replace"),c=a["aria-label"]||a.title||a.label;c&&g.setAttribute("aria-label",c);l.place(b,g);a._wrapper=g;this.inherited(arguments);"none"==b.style.display&&(b.style.display="block");a.domNode.removeAttribute("title")},addChild:function(a,b){this.inherited(arguments);this._started&&(f.publish(this.id+"-addChild",a,b),this.layout(),this.selectedChildWidget||
this.selectChild(a))},removeChild:function(a){var b=k.indexOf(this.getChildren(),a);this.inherited(arguments);l.destroy(a._wrapper);delete a._wrapper;this._started&&f.publish(this.id+"-removeChild",a);if(!this._descendantsBeingDestroyed){if(this.selectedChildWidget===a&&(this.selectedChildWidget=void 0,this._started)){var g=this.getChildren();g.length&&this.selectChild(g[Math.max(b-1,0)])}this._started&&this.layout()}},selectChild:function(a,b){var g;a=d.byId(a);this.selectedChildWidget!=a&&(g=this._transition(a,
this.selectedChildWidget,b),this._set("selectedChildWidget",a),f.publish(this.id+"-selectChild",a,this._focused),this.persist&&e(this.id+"_selectedChild",this.selectedChildWidget.id));return p(g||!0)},_transition:function(a,b){b&&this._hideChild(b);var g=this._showChild(a);a.resize&&(this.doLayout?a.resize(this._containerContentBox||this._contentBox):a.resize());return g},_adjacent:function(a){var b=this.getChildren(),g=k.indexOf(b,this.selectedChildWidget),g=g+(a?1:b.length-1);return b[g%b.length]},
forward:function(){return this.selectChild(this._adjacent(!0),!0)},back:function(){return this.selectChild(this._adjacent(!1),!0)},_onKeyDown:function(a){f.publish(this.id+"-containerKeyDown",{e:a,page:this})},layout:function(){var a=this.selectedChildWidget;a&&a.resize&&(this.doLayout?a.resize(this._containerContentBox||this._contentBox):a.resize())},_showChild:function(a){var b=this.getChildren();a.isFirstChild=a==b[0];a.isLastChild=a==b[b.length-1];a._set("selected",!0);a._wrapper&&t.replace(a._wrapper,
"dijitVisible","dijitHidden");return a._onShow&&a._onShow()||!0},_hideChild:function(a){a._set("selected",!1);a._wrapper&&t.replace(a._wrapper,"dijitHidden","dijitVisible");a.onHide&&a.onHide()},closeChild:function(a){if(!a.onClose||a.onClose(this,a))this.removeChild(a),a.destroyRecursive()},destroyDescendants:function(a){this._descendantsBeingDestroyed=!0;this.selectedChildWidget=void 0;k.forEach(this.getChildren(),function(b){a||this.removeChild(b);b.destroyRecursive(a)},this);this._descendantsBeingDestroyed=
!1}});n.ChildWidgetProperties={selected:!1,disabled:!1,closable:!1,iconClass:"dijitNoIcon",showTitle:!0};h.extend(b,n.ChildWidgetProperties);return n})},"dijit/layout/TabController":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/has dojo/i18n dojo/_base/lang ./StackController ../registry ../Menu ../MenuItem dojo/text!./templates/_TabButton.html dojo/i18n!../nls/common".split(" "),function(k,e,n,t,l,m,h,v,q,f,p,d){d=k("dijit.layout._TabButton"+(l("dojo-bidi")?"_NoBidi":
""),v.StackButton,{baseClass:"dijitTab",cssStateNodes:{closeNode:"dijitTabCloseButton"},templateString:d,_setNameAttr:"focusNode",scrollOnFocus:!1,buildRendering:function(){this.inherited(arguments);e.setSelectable(this.containerNode,!1)},startup:function(){this.inherited(arguments);var b=this.domNode;this.defer(function(){b.className=b.className},1)},_setCloseButtonAttr:function(b){this._set("closeButton",b);t.toggle(this.domNode,"dijitClosable",b);this.closeNode.style.display=b?"":"none";b&&(b=
m.getLocalization("dijit","common"),this.closeNode&&n.set(this.closeNode,"title",b.itemClose))},_setDisabledAttr:function(b){this.inherited(arguments);if(this.closeNode)if(b)n.remove(this.closeNode,"title");else{var c=m.getLocalization("dijit","common");n.set(this.closeNode,"title",c.itemClose)}},_setLabelAttr:function(b){this.inherited(arguments);this.showLabel||this.params.title||(this.iconNode.alt=h.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});l("dojo-bidi")&&(d=k("dijit.layout._TabButton",
d,{_setLabelAttr:function(b){this.inherited(arguments);this.applyTextDir(this.iconNode,this.iconNode.alt)}}));k=k("dijit.layout.TabController",v,{baseClass:"dijitTabController",templateString:"\x3cdiv role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown:onkeydown'\x3e\x3c/div\x3e",tabPosition:"top",buttonWidget:d,buttonWidgetCloseClass:"dijitTabCloseButton",postCreate:function(){this.inherited(arguments);var b=new f({id:this.id+"_Menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,
textDir:this.textDir,targetNodeIds:[this.domNode],selector:function(a){return t.contains(a,"dijitClosable")&&!t.contains(a,"dijitTabDisabled")}});this.own(b);var c=m.getLocalization("dijit","common"),a=this;b.addChild(new p({label:c.itemClose,ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,onClick:function(b){b=q.byNode(this.getParent().currentTarget);a.onCloseButtonClick(b.page)}}))}});k.TabButton=d;return k})},"dijit/layout/StackController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/topic ../focus ../registry ../_Widget ../_TemplatedMixin ../_Container ../form/ToggleButton dojo/touch".split(" "),
function(k,e,n,t,l,m,h,v,q,f,p,d,b,c){t=e("dijit.layout._StackButton",c,{tabIndex:"-1",closeButton:!1,_aria_attr:"aria-selected",buildRendering:function(a){this.inherited(arguments);(this.focusNode||this.domNode).setAttribute("role","tab")}});e=e("dijit.layout.StackController",[p,d,b],{baseClass:"dijitStackController",templateString:"\x3cspan role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown'\x3e\x3c/span\x3e",containerId:"",buttonWidget:t,buttonWidgetCloseClass:"dijitStackCloseButton",pane2button:function(a){return f.byId(this.id+
"_"+a)},postCreate:function(){this.inherited(arguments);this.own(v.subscribe(this.containerId+"-startup",m.hitch(this,"onStartup")),v.subscribe(this.containerId+"-addChild",m.hitch(this,"onAddChild")),v.subscribe(this.containerId+"-removeChild",m.hitch(this,"onRemoveChild")),v.subscribe(this.containerId+"-selectChild",m.hitch(this,"onSelectChild")),v.subscribe(this.containerId+"-containerKeyDown",m.hitch(this,"onContainerKeyDown")));this.containerNode.dojoClick=!0;this.own(h(this.containerNode,"click",
m.hitch(this,function(a){var b=f.getEnclosingWidget(a.target);if(b!=this.containerNode&&!b.disabled&&b.page)for(a=a.target;a!==this.containerNode;a=a.parentNode)if(n.contains(a,this.buttonWidgetCloseClass)){this.onCloseButtonClick(b.page);break}else if(a==b.domNode){this.onButtonClick(b.page);break}})))},onStartup:function(a){this.textDir=a.textDir;k.forEach(a.children,this.onAddChild,this);if(a.selected)this.onSelectChild(a.selected);var b=f.byId(this.containerId).containerNode,g=m.hitch(this,"pane2button");
a={title:"label",showtitle:"showLabel",iconclass:"iconClass",closable:"closeButton",tooltip:"title",disabled:"disabled",textdir:"textdir"};var c=function(a,c){return h(b,"attrmodified-"+a,function(a){var b=g(a.detail&&a.detail.widget&&a.detail.widget.id);b&&b.set(c,a.detail.newValue)})},d;for(d in a)this.own(c(d,a[d]))},destroy:function(a){this.destroyDescendants(a);this.inherited(arguments)},onAddChild:function(a,b){var g=new (m.isString(this.buttonWidget)?m.getObject(this.buttonWidget):this.buttonWidget)({id:this.id+
"_"+a.id,name:this.id+"_"+a.id,label:a.title,disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||this.textDir,showLabel:a.showTitle,iconClass:a.iconClass,closeButton:a.closable,title:a.tooltip,page:a});this.addChild(g,b);a.controlButton=g;if(!this._currentChild)this.onSelectChild(a);g=a._wrapper.getAttribute("aria-labelledby")?a._wrapper.getAttribute("aria-labelledby")+" "+g.id:g.id;a._wrapper.removeAttribute("aria-label");a._wrapper.setAttribute("aria-labelledby",
g)},onRemoveChild:function(a){this._currentChild===a&&(this._currentChild=null);var b=this.pane2button(a.id);b&&(this.removeChild(b),b.destroy());delete a.controlButton},onSelectChild:function(a){if(a){if(this._currentChild){var b=this.pane2button(this._currentChild.id);b.set("checked",!1);b.focusNode.setAttribute("tabIndex","-1")}b=this.pane2button(a.id);b.set("checked",!0);this._currentChild=a;b.focusNode.setAttribute("tabIndex","0");f.byId(this.containerId)}},onButtonClick:function(a){var b=this.pane2button(a.id);
q.focus(b.focusNode);this._currentChild&&this._currentChild.id===a.id&&b.set("checked",!0);f.byId(this.containerId).selectChild(a)},onCloseButtonClick:function(a){f.byId(this.containerId).closeChild(a);this._currentChild&&(a=this.pane2button(this._currentChild.id))&&q.focus(a.focusNode||a.domNode)},adjacent:function(a){this.isLeftToRight()||this.tabPosition&&!/top|bottom/.test(this.tabPosition)||(a=!a);var b=this.getChildren(),g=k.indexOf(b,this.pane2button(this._currentChild.id)),c=b[g],d;do g=(g+
(a?1:b.length-1))%b.length,d=b[g];while(d.disabled&&d!=c);return d},onkeydown:function(a,b){if(!this.disabled&&!a.altKey){var g=null;if(a.ctrlKey||!a._djpage){switch(a.keyCode){case l.LEFT_ARROW:case l.UP_ARROW:a._djpage||(g=!1);break;case l.PAGE_UP:a.ctrlKey&&(g=!1);break;case l.RIGHT_ARROW:case l.DOWN_ARROW:a._djpage||(g=!0);break;case l.PAGE_DOWN:a.ctrlKey&&(g=!0);break;case l.HOME:for(var c=this.getChildren(),d=0;d<c.length;d++){var f=c[d];if(!f.disabled){this.onButtonClick(f.page);break}}a.stopPropagation();
a.preventDefault();break;case l.END:c=this.getChildren();for(d=c.length-1;0<=d;d--)if(f=c[d],!f.disabled){this.onButtonClick(f.page);break}a.stopPropagation();a.preventDefault();break;case l.DELETE:case 87:this._currentChild.closable&&(a.keyCode==l.DELETE||a.ctrlKey)&&(this.onCloseButtonClick(this._currentChild),a.stopPropagation(),a.preventDefault());break;case l.TAB:a.ctrlKey&&(this.onButtonClick(this.adjacent(!a.shiftKey).page),a.stopPropagation(),a.preventDefault())}null!==g&&(this.onButtonClick(this.adjacent(g).page),
a.stopPropagation(),a.preventDefault())}}},onContainerKeyDown:function(a){a.e._djpage=a.page;this.onkeydown(a.e)}});e.StackButton=t;return e})},"dijit/layout/ScrollingTabController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/_base/lang dojo/on dojo/query dojo/sniff ../registry dojo/text!./templates/ScrollingTabController.html dojo/text!./templates/_ScrollingTabControllerButton.html ./TabController ./utils ../_WidgetsInTemplateMixin ../Menu ../MenuItem ../form/Button ../_HasDropDown dojo/NodeList-dom ../a11yclick".split(" "),
function(k,e,n,t,l,m,h,v,q,f,p,d,b,c,a,x,g,u,w,D){d=e("dijit.layout.ScrollingTabController",[c,x],{baseClass:"dijitTabController dijitScrollingTabController",templateString:d,useMenu:!0,useSlider:!0,tabStripClass:"",_minScroll:5,_setClassAttr:{node:"containerNode",type:"class"},buildRendering:function(){this.inherited(arguments);var a=this.domNode;this.scrollNode=this.tablistWrapper;this._initButtons();this.tabStripClass||(this.tabStripClass="dijitTabContainer"+this.tabPosition.charAt(0).toUpperCase()+
this.tabPosition.substr(1).replace(/-.*/,"")+"None",n.add(a,"tabStrip-disabled"));n.add(this.tablistWrapper,this.tabStripClass)},onStartup:function(){this.inherited(arguments);l.set(this.domNode,"visibility","");this._postStartup=!0;this.own(v(this.containerNode,"attrmodified-label, attrmodified-iconclass",h.hitch(this,function(a){this._dim&&this.resize(this._dim)})))},onAddChild:function(a,b){this.inherited(arguments);l.set(this.containerNode,"width",l.get(this.containerNode,"width")+200+"px")},
onRemoveChild:function(a,b){var c=this.pane2button(a.id);this._selectedTab===c.domNode&&(this._selectedTab=null);this.inherited(arguments)},_initButtons:function(){this._btnWidth=0;this._buttons=q("\x3e .tabStripButton",this.domNode).filter(function(a){if(this.useMenu&&a==this._menuBtn.domNode||this.useSlider&&(a==this._rightBtn.domNode||a==this._leftBtn.domNode))return this._btnWidth+=t.getMarginSize(a).w,!0;l.set(a,"display","none");return!1},this)},_getTabsWidth:function(){var a=this.getChildren();
if(a.length){var b=a[this.isLeftToRight()?0:a.length-1].domNode,a=a[this.isLeftToRight()?a.length-1:0].domNode;return a.offsetLeft+a.offsetWidth-b.offsetLeft}return 0},_enableBtn:function(a){var b=this._getTabsWidth();a=a||l.get(this.scrollNode,"width");return 0<b&&a<b},resize:function(b){this._dim=b;this.scrollNode.style.height="auto";var c=this._contentBox=a.marginBox2contentBox(this.domNode,{h:0,w:b.w});c.h=this.scrollNode.offsetHeight;t.setContentSize(this.domNode,c);c=this._enableBtn(this._contentBox.w);
this._buttons.style("display",c?"":"none");this._leftBtn.region="left";this._rightBtn.region="right";this._menuBtn.region=this.isLeftToRight()?"right":"left";a.layoutChildren(this.domNode,this._contentBox,[this._menuBtn,this._leftBtn,this._rightBtn,{domNode:this.scrollNode,region:"center"}]);this._selectedTab&&(this._anim&&"playing"==this._anim.status()&&this._anim.stop(),this.scrollNode.scrollLeft=this._convertToScrollLeft(this._getScrollForSelectedTab()));this._setButtonClass(this._getScroll());
this._postResize=!0;return{h:this._contentBox.h,w:b.w}},_getScroll:function(){return this.isLeftToRight()||8>f("ie")||f("trident")&&f("quirks")||f("webkit")?this.scrollNode.scrollLeft:l.get(this.containerNode,"width")-l.get(this.scrollNode,"width")+(f("trident")||f("edge")?-1:1)*this.scrollNode.scrollLeft},_convertToScrollLeft:function(a){if(this.isLeftToRight()||8>f("ie")||f("trident")&&f("quirks")||f("webkit"))return a;var b=l.get(this.containerNode,"width")-l.get(this.scrollNode,"width");return(f("trident")||
f("edge")?-1:1)*(a-b)},onSelectChild:function(a,b){var c=this.pane2button(a.id);if(c){var g=c.domNode;if(g!=this._selectedTab&&(this._selectedTab=g,this._postResize)){var d=this._getScroll();d>g.offsetLeft||d+l.get(this.scrollNode,"width")<g.offsetLeft+l.get(g,"width")?(g=this.createSmoothScroll(),b&&(g.onEnd=function(){c.focus()}),g.play()):b&&c.focus()}this.inherited(arguments)}},_getScrollBounds:function(){var a=this.getChildren(),b=l.get(this.scrollNode,"width"),c=l.get(this.containerNode,"width")-
b,g=this._getTabsWidth();if(a.length&&g>b)return{min:this.isLeftToRight()?0:a[a.length-1].domNode.offsetLeft,max:this.isLeftToRight()?a[a.length-1].domNode.offsetLeft+a[a.length-1].domNode.offsetWidth-b:c};a=this.isLeftToRight()?0:c;return{min:a,max:a}},_getScrollForSelectedTab:function(){var a=this._selectedTab,b=l.get(this.scrollNode,"width"),c=this._getScrollBounds(),a=a.offsetLeft+l.get(a,"width")/2-b/2;return a=Math.min(Math.max(a,c.min),c.max)},createSmoothScroll:function(a){if(0<arguments.length){var b=
this._getScrollBounds();a=Math.min(Math.max(a,b.min),b.max)}else a=this._getScrollForSelectedTab();this._anim&&"playing"==this._anim.status()&&this._anim.stop();var c=this,g=this.scrollNode,d=new m.Animation({beforeBegin:function(){this.curve&&delete this.curve;var b=g.scrollLeft,u=c._convertToScrollLeft(a);d.curve=new m._Line(b,u)},onAnimate:function(a){g.scrollLeft=a}});this._anim=d;this._setButtonClass(a);return d},_getBtnNode:function(a){for(a=a.target;a&&!n.contains(a,"tabStripButton");)a=a.parentNode;
return a},doSlideRight:function(a){this.doSlide(1,this._getBtnNode(a))},doSlideLeft:function(a){this.doSlide(-1,this._getBtnNode(a))},doSlide:function(a,b){if(!b||!n.contains(b,"dijitTabDisabled")){var c=.75*l.get(this.scrollNode,"width")*a,c=this._getScroll()+c;this._setButtonClass(c);this.createSmoothScroll(c).play()}},_setButtonClass:function(a){var b=this._getScrollBounds();this._leftBtn.set("disabled",a<=b.min);this._rightBtn.set("disabled",a>=b.max)}});b=e("dijit.layout._ScrollingTabControllerButtonMixin",
null,{baseClass:"dijitTab tabStripButton",templateString:b,tabIndex:"",isFocusable:function(){return!1}});e("dijit.layout._ScrollingTabControllerButton",[w,b]);e("dijit.layout._ScrollingTabControllerMenuButton",[w,D,b],{containerId:"",tabIndex:"-1",isLoaded:function(){return!1},loadDropDown:function(a){this.dropDown=new g({id:this.containerId+"_menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir});var b=p.byId(this.containerId);k.forEach(b.getChildren(),function(a){var c=
new u({id:a.id+"_stcMi",label:a.title,iconClass:a.iconClass,disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||b.textDir,onClick:function(){b.selectChild(a)}});this.dropDown.addChild(c)},this);a()},closeDropDown:function(a){this.inherited(arguments);this.dropDown&&(this._popupStateNode.removeAttribute("aria-owns"),this.dropDown.destroyRecursive(),delete this.dropDown)}});return d})},"widgets/AttributeTable/_ResourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all esri/lang jimu/portalUrlUtils ./table/_FeatureTable ./utils".split(" "),
function(k,e,n,t,l,m,h,v,q){return k(null,{_activeLayerInfoId:null,_activeRelationshipKey:null,nls:null,config:null,map:null,_delayedLayerInfos:[],_layerInfosFromMap:[],featureTableSet:{},relationshipsSet:{},relationshipTableSet:{},currentRelationshipKey:null,constructor:function(f){this.map=f&&f.map;this.nls=f&&f.nls;this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};this.relationshipsSet={};this.relationshipTableSet={};this.currentRelationshipKey=null},setConfig:function(f){this.config=
e.clone(f||{})},setMap:function(f){this.map=f},updateLayerInfoResources:function(f){var p=new t;q.readConfigLayerInfosFromMap(this.map,!1,!0).then(e.hitch(this,function(d){this._layerInfosFromMap=d;this._processDelayedLayerInfos();f&&(0===this.config.layerInfos.length?(d=q.getConfigInfosFromLayerInfos(d),this.config.layerInfos=n.filter(d,function(b){return b.show})):this.config.layerInfos=n.filter(e.delegate(this.config.layerInfos),e.hitch(this,function(b){var c=this._getLayerInfoById(b.id);return b.show&&
c&&(b.name=c.name||c.title)})));p.resolve()}),function(d){p.reject(d)});return p},isEmpty:function(){return this.config&&this.config.layerInfos&&0>=this.config.layerInfos.length},getConfigInfos:function(){return e.clone(this.config.layerInfos)},addLayerInfo:function(f){0===this._layerInfosFromMap.length?this._delayedLayerInfos.push(f):0<this._layerInfosFromMap.length&&!this._getLayerInfoById(f.id)&&this._layerInfosFromMap.push(f)},addConfigInfo:function(f){this._getConfigInfoById(f.id)||(f=q.getConfigInfoFromLayerInfo(f),
this.config.layerInfos.push({id:f.id,name:f.name,layer:{url:f.layer.url,fields:f.layer.fields}}))},removeLayerInfo:function(f){f=this._getLayerInfoById(f);f=this._layerInfosFromMap.indexOf(f);this._layerInfosFromMap.splice(f,1)},removeConfigInfo:function(f){if(e.getObject("config.layerInfos",!1,this))for(var p=this.config.layerInfos.length,d=0;d<p;d++)if(this.config.layerInfos[d].id===f){this.featureTableSet[f]&&(this.featureTableSet[f].destroy(),delete this.featureTableSet[f]);this.config.layerInfos.splice(d,
1);break}},getQueryTable:function(f,p,d){var b=new t;this._activeLayerInfoId=f;this.featureTableSet[f]?b.resolve({isSupportQuery:!0,table:this.featureTableSet[f]}):this._getQueryTableInfo(f).then(e.hitch(this,function(c){if(c){var a=c.layerInfo,x=c.layerObject;c=c.tableInfo;if(this.featureTableSet[f])b.resolve({isSupportQuery:c.isSupportQuery,table:this.featureTableSet[f]});else if(e.getObject("isSupportQuery",!1,c)){var g=this._getConfigInfoById(f);g||(this.addConfigInfo(a),g=this._getConfigInfoById(f));
var u=e.getObject("layer.fields",!1,g);g.layer.fields=this._clipValidFields(u,x&&x.fields);a=new v({map:this.map,matchingMap:p,hideExportButton:d,layerInfo:a,configedInfo:g,nls:this.nls});this.featureTableSet[f]=a;b.resolve({isSupportQuery:c.isSupportQuery,table:a})}else b.resolve({isSupportQuery:!1})}else b.resolve(null)}),function(c){b.reject(c)});return b},getRelationTable:function(f,p,d,b){var c=new t,a=this.relationshipsSet[p];this._activeRelationshipKey=p;if(a){var x=this._getLayerInfoById(f);
f=e.getObject("shipInfo.id",!1,a);this.getQueryTable(f,d,b).then(e.hitch(this,function(b){if(b&&b.table){var g=b.table;g.set("relatedOriginalInfo",x);g.set("relationship",a)}c.resolve(b)}),e.hitch(function(){c.resolve(null)}))}else c.resolve(null);return c},removeRelationTable:function(f){this.relationshipTableSet[f]&&(this.relationshipTableSet[f].destroy(),this.relationshipTableSet[f]=null)},getCurrentTable:function(f){return this.featureTableSet[f]||this.relationshipTableSet[f]},collectRelationShips:function(f,
e){this._collectRelationShips(f,f.layerObject,e)},getConfigInfoById:function(f){return this._getConfigInfoById(f)},getLayerInfoById:function(f){return this._getLayerInfoById(f)},getRelationshipsByInfoId:function(f){var e=[],d;for(d in this.relationshipsSet){var b=this.relationshipsSet[d];b._layerInfoId===f&&e.push(b)}return e},empty:function(){this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};for(var f in this.relationshipsSet)this.relationshipsSet[f].shipInfo=null;this.relationshipsSet=
{};this.relationshipTableSet={};this.nls=this.map=this.config=this.currentRelationshipKey=null},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(n.forEach(this._delayedLayerInfos,e.hitch(this,function(f){!this._getLayerInfoById(f&&f.id)&&this.map&&this.map.getLayer(f.id)&&this._layerInfosFromMap.push(f)})),this._delayedLayerInfos=[])},_getLayerInfoById:function(f){for(var e=0,d=this._layerInfosFromMap.length;e<d;e++)if(this._layerInfosFromMap[e]&&this._layerInfosFromMap[e].id===
f)return this._layerInfosFromMap[e]},_getConfigInfoById:function(f){if(!e.getObject("layerInfos.length",!1,this.config))return null;for(var h=0,d=this.config.layerInfos.length;h<d;h++){var b=this.config.layerInfos[h];if(b&&b.id===f)return b}return null},_getQueryTableInfo:function(f){var h=new t,d=this._getLayerInfoById(f);if(d){var b=[],c=d.getUrl();b.push(d.getLayerObject());b.push(d.getSupportTableInfo());c&&b.push(d.getRelatedTableInfoArray());l(b).then(e.hitch(this,function(a){if(this._activeLayerInfoId===
f&&a){var b=a[0],g=a[1];a=c?a[2]:[];m.isDefined(a)&&m.isDefined(b)&&0<a.length&&this._collectRelationShips(d,b,a);h.resolve({layerInfo:d,layerObject:b,tableInfo:g})}else h.resolve(null)}),function(a){h.reject(a)})}else console.error("no activeLayerInfo!"),h.reject(Error());return h},_collectRelationShips:function(f,q,d){var b=q.relationships;if(b&&0<b.length&&q&&q.url){var c=q.url.split("/");n.forEach(b,e.hitch(this,function(a){c[c.length-1]=a.relatedTableId;var b=c.join("/"),g=n.filter(d,e.hitch(this,
function(a){a=a.getUrl();return m.isDefined(a)&&m.isDefined(b)&&h.removeProtocol(a.toString().toLowerCase())===h.removeProtocol(b.toString().toLowerCase())}));g&&0<g.length&&(a.shipInfo=g[0]);g=f.id+"_"+a.name+"_"+a.id;a._relKey=g;a._layerInfoId=f.id;this.relationshipsSet[g]||(this.relationshipsSet[g]=a,this.relationshipsSet[g].objectIdField=q.objectIdField)}))}},_getLayerInfoLabel:function(f){return f.name||f.title},_getLayerInfoId:function(f){return f&&f.id||""},_clipValidFields:function(f,h){if(!f||
!f.length)return h||[];if(!h||!h.length)return f;for(var d=[],b=0,c=f.length;b<c;b++)for(var a=f[b],x=0,g=h.length;x<g;x++)if(h[x].name===a.name){d.push(a);break}0===d.length&&0<f.length&&(b=e.clone(h),n.forEach(b,e.hitch(this,function(a){"esriFieldTypeGeometry"!==a.type&&(a.show=!0,d.push(a))})));return d}})})},"widgets/AttributeTable/table/_FeatureTable":function(){define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase jimu/dijit/Popup jimu/dijit/Message jimu/dijit/Filter dgrid/OnDemandGrid ../dgrid/Selection dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer dgrid/extensions/ColumnReorder dijit/Menu dijit/MenuItem dijit/Toolbar dijit/form/Button dijit/DropDownMenu dijit/form/ToggleButton dijit/form/DropDownButton dojo/Deferred dojo/when dojo/Evented dojo/touch dojo/store/Memory esri/config esri/lang esri/request esri/tasks/RelationParameters esri/tasks/RelationshipQuery esri/layers/FeatureLayer esri/tasks/QueryTask esri/tasks/query esri/tasks/ProjectParameters esri/geometry/Multipoint esri/geometry/normalizeUtils esri/IdentityManager dojo/_base/lang dojo/on dojo/aspect dojo/_base/array jimu/dijit/LoadingIndicator jimu/dijit/FieldStatistics jimu/SelectionManager jimu/CSVUtils jimu/utils ../utils dojo/query".split(" "),
function(k,e,n,t,l,m,h,v,q,f,p,d,b,c,a,x,g,u,w,D,J,B,F,y,E,O,L,P,M,H,C,G,Q,R,S,r,A,T,z,U,V,W,X,Y,K,I){return k([n,J],{baseClass:"jimu-widget-attributetable-feature-table",_defaultFeatureCount:2E3,_defaultBatchCount:25,_batchCount:0,_filterObj:null,_currentDef:null,_requestStatus:"initial",map:null,matchingMap:!1,layerInfo:null,configedInfo:null,footerHeight:25,layer:null,loading:null,grid:null,footer:null,selectedRowsLabel:null,selectionRows:null,nls:null,_dblClickResult:null,actived:!1,showSelected:!1,
tableCreated:!1,_relatedQuery:!1,_relatedQueryIds:null,_selectionHandles:null,_selectionResults:null,constructor:function(a){a=a||{};this.set("map",a.map||null);this.set("matchingMap",!!a.matchingMap);this.set("layerInfo",a.layerInfo||null);this.set("layer",a.layer||null);this.set("configedInfo",a.configedInfo||null);this.set("relatedOriginalInfo",a.relatedOriginalInfo||null);this.set("relationship",a.relationship||null);this.set("syncSelection",!!a.syncSelection||!0)},postCreate:function(){this.inherited(arguments);
this._relatedQueryIds=[];this.createToolbar();this.loading=new U;this.loading.placeAt(this.domNode);this.selectionManager=W.getInstance();this._selectionResults=[];this.selectionRows=[];e.setAttr(this.domNode,"data-layerinfoid",r.getObject("layerInfo.id",!1,this));this.get("map")&&(this.own(A(this.map.root,B.release,r.hitch(this,function(){this._clickMap=!0}))),this.own(A(this.map,"extent-change",r.hitch(this,"_onExtentChange"))))},startup:function(){this.inherited(arguments);this.toolbarHeight=parseInt(e.getStyle(this.toolbar.domNode,
"height"),10)||0},setLayerDefinition:function(a){this._layerDefinition=a},getLayerDefinition:function(){return this._getLayerDifinition()},getFilterableFields:function(){if(this._layerDefinition&&this.configedInfo){var a=r.clone(this._layerDefinition);return this._getFilterableFields(a.fields,this.configedInfo.layer.fields)}return[]},getFilterObj:function(){return this._filterObj},setFilterObj:function(a){this._filterObj=a},showRefreshing:function(a){a?this.loading.show():this.loading.hide()},active:function(){this.actived=
!0},deactive:function(){this.actived=!1},cancelThread:function(){"fulfilled"!==this._requestStatus&&this._currentDef&&(this._currentDef.cancel({canceledBySelf:!0}),this._requestStatus="canceled")},isCanceled:function(){return"canceled"===this._requestStatus},createToolbar:function(){var d=new c({},e.create("div")),f=new x;this.showSelectedRecordsMenuItem=new b({label:this.nls.showSelectedRecords,iconClass:"esriAttributeTableSelectPageImage",onClick:r.hitch(this,this.toggleSelectedRecords)});f.addChild(this.showSelectedRecordsMenuItem);
this.showRelatedRecordsMenuItem=new b({label:this.nls.showRelatedRecords,iconClass:"esriAttributeTableSelectAllImage",onClick:r.hitch(this,this.onShowRelatedRecordsClick)});f.addChild(this.showRelatedRecordsMenuItem);this.filterMenuItem=new b({label:this.nls.filter,iconClass:"esriAttributeTableFilterImage",onClick:r.hitch(this,this.onFilterMenuItemClick)});f.addChild(this.filterMenuItem);this.toggleColumnsMenuItem=new b({label:this.nls.columns,iconClass:"esriAttributeTableColumnsImage",onClick:r.hitch(this,
this.onToggleColumnsClick)});f.addChild(this.toggleColumnsMenuItem);this.hideExportButton||(this.exportCSVMenuItem=new b({label:this.nls.exportFiles,showLabel:!0,iconClass:"esriAttributeTableExportImage",onClick:r.hitch(this,this.onExportCSVClick)}),f.addChild(this.exportCSVMenuItem));this.selectionMenu=new u({label:this.nls.options,iconClass:"esriAttributeTableOptionsImage",dropDown:f});d.addChild(this.selectionMenu);this.matchingCheckBox=new g({checked:this.matchingMap?!0:!1,showLabel:!0,label:this.nls.filterByExtent,
onChange:r.hitch(this,function(a){this.set("matchingMap",a);this._onMatchingCheckBoxChange(a)})});d.addChild(this.matchingCheckBox);this.zoomButton=new a({label:this.nls.zoomto,iconClass:"esriAttributeTableZoomImage",onClick:r.hitch(this,this.zoomTo)});d.addChild(this.zoomButton);this.clearSelectionButton=new a({label:this.nls.clearSelection,iconClass:"esriAttributeTableClearImage",onClick:r.hitch(this,this.clearSelection,!0,!0)});d.addChild(this.clearSelectionButton);this.refreshButton=new a({label:this.nls.refresh,
showLabel:!0,iconClass:"esriAttributeTableRefreshImage",onClick:r.hitch(this,this.refresh)});d.addChild(this.refreshButton);e.place(d.domNode,this.domNode);this.toolbar=d;this.own(A(this,"data-loaded,row-click,clear-selection",r.hitch(this,"changeToolbarStatus")))},startQuery:function(a){this.cancelThread();this._requestStatus="processing";this.loading.show();a&&a.length?this.queryByStoreObjectIds=a:(this._relatedQuery=!1,this._relatedQueryIds=[],this.queryByStoreObjectIds=null);this._currentDef=
this._getLayerObject();this._currentDef.then(r.hitch(this,function(b){this.domNode&&(this.layer=b,(b=!this.layerInfo.isTable&&this.matchingMap&&this.map.extent||null)&&b.spatialReference&&b.spatialReference.isWebMercator()?(this._currentDef=R.normalizeCentralMeridian([b],null,r.hitch(this,function(a){return a[0]}))).then(r.hitch(this,function(b){this._doQuery(b,a)}),r.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this.loading.hide()})):this._doQuery(b,
a))}),r.hitch(this,function(a){console.error(a);this.changeToolbarStatus();this.loading.hide()}))},queryRecordsByRelationship:function(a){var b=a&&a.layer,c=a&&a.selectedIds;a&&a.relationship&&this.set("relationship",a.relationship);a&&a.relatedOriginalInfo&&this.set("relatedOriginalInfo",a.relatedOriginalInfo);var g=this.relationship;b&&g&&c&&0<c.length&&!Y.isEqual(this._relatedQueryIds,c)&&r.getObject("relatedOriginalInfo.layerObject.url",!1,this)?(this.loading.show(),this._requestStatus="processing",
this._relatedQuery=!0,this.matchingCheckBox.set("checked",!1),this.cancelThread(),this._currentDef=this._getLayerObject(),this._currentDef.then(r.hitch(this,function(a){if(this.domNode){this.layer=a;var d=[],u=this.layer;z.forEach(u.fields,function(a){(!E.isDefined(a.show)||!0===a.show||"esriFieldTypeOID"===a.type||E.isDefined(u.objectIdField)&&a.name===u.objectIdField)&&d.push(a.name)});a=new P;a.objectIds=c;a.outFields=d.length?d:["*"];a.relationshipId=g.id;a.returnGeometry="esriGeometryPoint"===
this.layer.geometryType;(this._currentDef=b.queryRelatedFeatures(a,function(a){return a})).then(r.hitch(this,function(a){if(this.domNode){var b={displayFieldName:g.objectIdField,fields:u.fields,features:[],fieldAliases:null},d={},f=function(a){var c=a.attributes[this.layer.objectIdField];d[c]||(d[c]=!0,b.features.push(a))},w;for(w in a){var N=a[w];z.forEach(N&&N.features,f,this)}e.destroy(this.tipNode);0<b.features.length?(this.grid||(this._removeTable(),e.place(this.loading.domNode,this.domNode)),
a=this._getOutFieldsFromLayerInfos(this.layer.objectIdField),this.queryExecute(a,b.features.length,!1,b)):(this.tipNode=e.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e"),this._removeTable(),e.place(this.tipNode,this.domNode),e.place(this.loading.domNode,this.domNode));this._relatedQueryIds=c;this.emit("data-loaded");this.loading.hide()}}),r.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);e.destroy(this.tipNode);this.tipNode=e.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+
"\x3c/div\x3e");this._removeTable();e.place(this.tipNode,this.domNode);e.place(this.loading.domNode,this.domNode);this.loading.hide();this.changeToolbarStatus()}))}}),r.hitch(this,function(a){console.error(a);this.loading.hide();this.changeToolbarStatus()}))):this.loading.hide()},getSelectedRows:function(){return this.tableCreated?this.selectionRows:[]},zoomTo:function(){this._zoomToSelected()},toggleSelectedRecords:function(){this._relatedQuery&&!this.showSelected&&0===this.getSelectedRows().length?
(this._relatedQuery=!1,this._relatedQueryIds=[],this.layerInfo&&!this.layerInfo.isTable&&this.matchingCheckBox.set("checked",!0),this.startQuery(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):this.tableCreated&&(this.showSelected?(this.showAllSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):
(this.showSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords),this.showSelected=!0,this.emit("show-selected-records",{layerInfoId:this.layerInfo.id})))},onShowRelatedRecordsClick:function(){this.emit("show-related-records",{layerInfoId:this.layerInfo.id,objectIds:this.getSelectedRows()})},onFilterMenuItemClick:function(){this.showRefreshing(!0);this.getLayerDefinition().then(r.hitch(this,function(a){if(this.domNode){a=r.clone(a);var b=this.getFilterableFields();
a.fields=b;var c=new m({noFilterTip:this.nls.noFilterTip,style:"width:100%;margin-top:22px;"});this._filterPopup=new t({titleLabel:this.nls.filter,width:720,height:485,content:c,buttons:[{label:this.nls.ok,onClick:r.hitch(this,function(){var a=c.toJson();a&&a.expr?(this.setFilterObj(a),this.clearSelection(!1),this.startQuery(),this._filterPopup.close(),this._filterPopup=null,this.emit("apply-filter",{layerInfoId:this.layerInfo.id,expr:a.expr})):new l({message:this.nls.setFilterTip})})},{label:this.nls.cancel}]});
(b=this.getFilterObj())?c.buildByFilterObj(this.layer.url,b,a):c.buildByExpr(this.layer.url,null,a)}}),r.hitch(this,function(a){this.domNode&&console.error(a)})).always(r.hitch(this,function(){this.showRefreshing(!1)}));this.emit("show-filter",{layerInfoId:this.layerInfo.id})},onToggleColumnsClick:function(){this.toggleColumns();this.emit("toggle-columns",{layerInfoId:this.layerInfo.id})},onExportCSVClick:function(){var a=new l({message:this.nls.exportMessage,titleLabel:this.nls.exportFiles,autoHeight:!0,
buttons:[{label:this.nls.ok,onClick:r.hitch(this,function(){this.exportToCSV();a.close()})},{label:this.nls.cancel}]});this.emit("export-csv",{layerInfoId:this.layerInfo.id})},onSelectionComplete:function(a){var b=a.features;b&&(0===b.length?this.clearSelection(!1):this._selectBySelf(b)||(this.clearSelection(!1),this._updateSelectRowsByFeatures(a.features)))},changeToolbarStatus:function(){if(this.tableCreated){var a=this.getSelectedRows();this.showSelected?this.showSelectedRecordsMenuItem.set("label",
this.nls.showAllRecords):this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords);this.tableCreated&&a&&0<a.length&&this.layer&&this.layer.objectIdField?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.clearSelectionButton.set("disabled",!1)):(this.showSelectedRecordsMenuItem.set("disabled",!0),this.clearSelectionButton.set("disabled",!0));this._relatedQuery&&(this.showSelectedRecordsMenuItem.set("disabled",!1),this.tableCreated&&a&&0===a.length&&this.showSelectedRecordsMenuItem.set("label",
this.nls.showAllRecords));this.showRelatedRecordsMenuItem.set("disabled",!0);if(this.layerInfo&&this.isSupportQueryToServer()&&a&&0<a.length&&this.layer&&this.layer.objectIdField){this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel();var b=this.layerInfo.getRelatedTableInfoArray();this._relatedDef=b;b.then(r.hitch(this,function(a){if(this.domNode){var b=this.getSelectedRows();this.tableCreated&&a&&0<a.length&&b&&0<b.length&&this.showRelatedRecordsMenuItem.set("disabled",!1)}}))}this.tableCreated&&
this.isSupportQueryToServer()&&!this._relatedQuery?this.filterMenuItem.set("disabled",!1):this.filterMenuItem.set("disabled",!0);this.matchingCheckBox.set("disabled",!1);this.tableCreated?this.toggleColumnsMenuItem.set("disabled",!1):this.toggleColumnsMenuItem.set("disabled",!0);this.hideExportButton||(a&&0<a.length?this.exportCSVMenuItem.set("label",this.nls.exportSelected):this.exportCSVMenuItem.set("label",this.nls.exportAll),this.tableCreated?this.exportCSVMenuItem.set("disabled",!1):this.exportCSVMenuItem.set("disabled",
!0));this.layerInfo.isShowInMap()?this.tableCreated&&a&&0<a.length?this.zoomButton.set("disabled",!1):this.zoomButton.set("disabled",!0):this.zoomButton.set("disabled",!0);this.layerInfo.isTable&&(this.matchingCheckBox.set("disabled",!0),this.zoomButton.set("disabled",!0))}else this._relatedQuery?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords)):this.showSelectedRecordsMenuItem.set("disabled",!0),this.showRelatedRecordsMenuItem.set("disabled",
!0),this.matchingCheckBox.set("disabled",!0),this.filterMenuItem.set("disabled",!0),this.toggleColumnsMenuItem.set("disabled",!0),this.hideExportButton||this.exportCSVMenuItem.set("disabled",!0),this.zoomButton.set("disabled",!0)},showSelectedRecords:function(){if(this.tableCreated){var a=this.layer.objectIdField,b=this.getSelectedRows();0<b.length&&this.grid&&(this.grid.store instanceof F?this.grid.set("query",r.hitch(this,function(c){return"number"===typeof c&&-1<b.indexOf(c)||-1<b.indexOf(c[a])?
!0:!1})):this.grid.set("query",function(){return b}))}},showAllSelectedRecords:function(){if(this.tableCreated&&this.showSelected){this.grid.set("query",{});var a=this.getSelectedRows();this._updateSelectRowsByIds(a)}},clearSelection:function(a,b){this.tableCreated&&(this.grid.clearSelection(),this.selectionRows=[],a&&this.grid.set("query",{}),b&&(this.selectionManager.clearSelection(this.layer),this._selectionResults=[]),this._closePopup(),this.setSelectedNumber(),this.showSelected=!1,this.emit("clear-selection"))},
refresh:function(){this.grid&&this.grid.clearSelection();this._relatedQuery||this.startQuery();this.emit("refresh",{layerInfoId:this.layerInfo.id})},exportToCSV:function(a){if(this.layerInfo&&this.layer&&this.tableCreated){var b=null,b=this.layer.objectIdField,c=this.getSelectedRowsData(),b=this._getOutFieldsFromLayerInfos(b),b=this._processExecuteFields(this.layer.fields,b),g={};c&&0<c.length?g.datas=c:this.grid.store instanceof F&&(c=this.grid.store.data,g.datas=c);"datas"in g&&"esriGeometryPoint"===
this.layer.geometryType&&(c=r.clone(g.datas),z.forEach(c,function(a){var b=a.geometry;b&&"point"===b.type&&("x"in a?a._x=b.x:a.x=b.x,"y"in a?a._y=b.y:a.y=b.y);delete a.geometry}),g.datas=c,b=r.clone(b),c="",c=-1!==b.indexOf("x")?"_x":"x",b.push({name:c,alias:c,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}),c=-1!==b.indexOf("y")?"_y":"y",b.push({name:c,alias:c,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}));g.fromClient=!1;g.withGeometry="esriGeometryPoint"===
this.layer.geometryType;g.outFields=b;g.formatNumber=!1;g.formatDate=!0;g.formatCodedValue=!0;g.popupInfo=this.layerInfo.getPopupInfo();return X.exportCSVFromFeatureLayer(a||this.configedInfo.name,this.layer,g)}},toggleColumns:function(){this.tableCreated&&this.grid._toggleColumnHiderMenu()},changeHeight:function(a){this.grid&&0<=a-this.toolbarHeight-this.footerHeight&&e.setStyle(this.grid.domNode,"height",a-this.toolbarHeight-this.footerHeight+"px")},isSupportQueryToServer:function(){var a=this.layer&&
"esri.layers.CSVLayer"===this.layer.declaredClass,b=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return this.layer&&this.layer.url&&this.configedInfo.layer.url&&!a&&!b},isSupportQueryOnClient:function(){var a=this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,b=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return!(this.layer&&this.layer.url&&this.configedInfo.layer.url)||a||b},destroy:function(){this._destroyed||(this.layer=this.configedInfo=this.layerInfo=
null,this._selectionHandles&&z.forEach(this._selectionHandles,function(a){a&&a.remove&&a.remove()}),this._closePopup(),this._filterPopup&&this._filterPopup.domNode&&(this._filterPopup.close(),this._filterPopup=null),this._dblClickResult=null,this.grid&&this.grid.destroy(),this.relationship=this.nls=this.map=null,this._currentDef&&!this._currentDef.isFulfilled()&&this._currentDef.cancel({canceledBySelf:!0}),this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel({canceledBySelf:!0}),
this.inherited(arguments))},_selectBySelf:function(a){a=a||[];return a.length!==this._selectionResults.length?!1:z.every(this._selectionResults,function(b){return-1<a.indexOf(b)})},_updateSelectRowsByFeatures:function(a){a=z.map(a,r.hitch(this,function(a){return a.attributes[this.layer.objectIdField]}));this._updateSelectRowsByIds(a)},_updateSelectRowsByIds:function(a){this.grid&&this.tableCreated&&(this.selectionRows=a,z.forEach(a,r.hitch(this,function(a){this.grid.select(a)})),this.setSelectedNumber(),
this.changeToolbarStatus())},_removeTable:function(){this.grid&&this.grid.domNode&&(this.grid.destroy(),this.grid=null);this.footer&&(e.destroy(this.footer),this.selectedRowsLabel=this.footer=null);this.tableCreated=!1},_onMatchingCheckBoxChange:function(a){this.tableCreated&&!this._relatedQuery&&(this.cancelThread(),this.queryByStoreObjectIds=null,this.startQuery());if("fulfilled"===this._requestStatus&&this.tableCreated&&this._relatedQuery)if(a)this.queryByStoreObjectIds=z.map(this.grid.store.data,
r.hitch(this,function(a){return a[this.layer.objectIdField]})),this.startQuery(this.queryByStoreObjectIds);else{var b=this._relatedQueryIds;this._relatedQueryIds=[];this.queryRecordsByRelationship({layer:this.relatedOriginalInfo.layerObject,selectedIds:b})}a||(this._currentExtent=null)},_closePopup:function(){var a=this.map.infoWindow.getSelectedFeature(),b=a&&this._dblClickResult&&a===this._dblClickResult,a=a&&a._layer===this.layer;this.domNode&&(b||a)&&(this.map.infoWindow.hide(),this._dblClickResult=
null)},_getLayerObject:function(){function a(a){this._selectionHandles&&z.forEach(this._selectionHandles,function(a){a&&a.remove&&a.remove()});this._selectionHandles=[];this._selectionHandles.push(A(a,"selection-complete",r.hitch(this,"onSelectionComplete")))}return(this._currentDef=this.layerInfo.getLayerObject()).then(r.hitch(this,function(b){var c=new w;"esri.layers.ArcGISImageServiceLayer"===b.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass?(b=new M(b.url),this.own(A(b,
"load",r.hitch(this,function(b){r.hitch(this,a)(b.layer);c.resolve(b.layer)})))):(r.hitch(this,a)(b),c.resolve(b));return c}))},_getLayerDifinition:function(){return this._layerDefinition?D(r.clone(this._layerDefinition)):O({url:this.layer.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(r.hitch(this,function(a){this.setLayerDefinition(a);return this.getLayerDefinition()}))},_getFilterableFields:function(a,b){return z.filter(a,function(a){return z.some(b,function(b){return a.name===
b.name&&(b.show||!E.isDefined(b.show))&&r.mixin(a,b)})})},_doQuery:function(a,b){if(this.layer){var c=this.layer.objectIdField;this.isSupportQueryToServer()?this._queryToServer(a,c,b):this.isSupportQueryOnClient()&&this._queryOnClient(a,c,b)}},_queryOnClient:function(a,b,c){var g={};g.features="esri.layers.StreamLayer"===this.layer.declaredClass?this.layer.getLatestObservations():z.filter(this.layer.graphics,r.hitch(this,function(a){return!a.wabIsTemp}));c&&0<c.length&&(g.features=z.filter(g.features,
function(a){return-1<c.indexOf(a.attributes[this.layer.objectIdField])},this));var d=this.layer.fields,u=this.configedInfo.layer.fields;g.fields=u?z.filter(u,r.hitch(this,function(a){E.isDefined(a.show)||(a.show=!0);a.name!==b||"esriFieldTypeOID"!==a.type&&"esriFieldTypeInteger"!==a.type||(a._pk=!0);for(var c=0,g=d.length;c<g;c++)d[c].name!==a.name||a.type||(a.type=d[c].type);return a.show||a._pk})):z.filter(d,r.hitch(this,function(a){E.isDefined(a.show)||(a.show=!0);a.name!==b||"esriFieldTypeOID"!==
a.type&&"esriFieldTypeInteger"!==a.type||(a._pk=!0);return a.show||a._pk}));for(var u=[],f=g.features.length,w=0;w<f;w++)g&&g.features&&g.features[w]&&g.features[w].geometry&&u.push(g.features[w].geometry);a&&y.defaults.geometryService&&0<u.length?(f=new L,f.geometries1=u,f.geometries2=[a],f.relation=L.SPATIAL_REL_INTERSECTION,(this._currentDef=y.defaults.geometryService.relation(f,r.hitch(this,function(a){return a}))).then(r.hitch(this,function(b,c){for(var g=c.length,d=[],u=0;u<g;u++)d.push(b.features[c[u].geometry1Index]);
b.features=d;this.queryExecute(b.fields,b.features.length,!1,b,a)},g),r.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this.loading.hide()}))):this.queryExecute(g.fields,g.features.length,!1,g,a)},_queryToServer:function(a,b,c){this._getFeatureCount(a,c).then(r.hitch(this,function(g){if(this.domNode)if(c)this._queryFeatureLayer(a,b,g,!1,c);else{var d=this.layer,u=E.isDefined(d.maxRecordCount)?d.maxRecordCount:1E3;this._batchCount=Math.min(u,this._defaultBatchCount);
if(g<=u||!this.layer.objectIdField)this._queryFeatureLayer(a,b,g,!1);else{var f=this._getOutFieldsFromLayerInfos(b),w={fields:this.layer.fields};this.layer._recordCounts=g;d.advancedQueryCapabilities&&d.advancedQueryCapabilities.supportsPagination?this.queryExecute(f,g,!0,w,a):this._getFeatureIds(b,a).then(r.hitch(this,function(b){this.domNode&&(this.layer._objectIds=b,this.queryExecute(f,g,!0,w,a))}),r.hitch(this,function(a){console.error(a);this.changeToolbarStatus()}))}}}),r.hitch(this,function(a){console.error(a);
this.changeToolbarStatus()}))},_getFeatureCount:function(a,b){var c=new w,g=new H(this.configedInfo.layer.url),d=new C;d.returnGeometry=!1;d.where=this._getLayerFilterExpression();b&&(d.where+=" AND "+this.layer.objectIdField+" IN ("+b.join()+")");a&&(d.geometry=a);(this._currentDef=g.executeForCount(d,r.hitch(this,function(a){return a}))).then(r.hitch(this,function(a){c.resolve(a)}),r.hitch(this,function(a){a&&"Request canceled"!==a.message&&(console.error(a),console.log("Could not get feature count."));
this.loading.hide();c.reject(a)}));return c},_queryFeatureLayer:function(a,b,c,g,d){var u=new H(this.configedInfo.layer.url),f=new C;f.where=this._getLayerFilterExpression();d&&b&&(f.where+=" AND "+b+" IN ("+d.join()+")");var w=this._getOutFieldsFromLayerInfos(b);0<w.length?(d=z.map(w,function(a){return a.name}),f.outFields=d):f.outFields=["*"];a&&(f.geometry=a,f.spatialRelationship=C.SPATIAL_REL_INTERSECTS);f.outSpatialReference=r.clone(this.map.spatialReference);f.returnGeometry="esriGeometryPoint"===
this.layer.geometryType;b&&(f.orderByFields=[b+" ASC"]);(this._currentDef=u.execute(f,r.hitch(this,function(a){return a}))).then(r.hitch(this,function(b){this.queryExecute(w,c,g,b,a)}),r.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this.loading.hide()}))},_getFeatureIds:function(a,b){var c=new w,g=new H(this.configedInfo.layer.url),d=new C;d.returnGeometry=!1;d.returnIdsOnly=!0;d.where=this._getLayerFilterExpression();if(this.layer._orderByFields||
a)d.orderByFields=this.layer._orderByFields||[a+" ASC"];b&&(d.geometry=b);(this._currentDef=g.executeForIds(d,r.hitch(this,function(a){return a}))).then(r.hitch(this,function(a){c.resolve(a)}),r.hitch(this,function(a){a&&"Request canceled"!==a.message&&(console.error(a),console.log("Could not get feature Ids"));c.resolve([])}));return c},queryExecute:function(a,b,c,g,d){var u=[],u=null,f={};if(this.domNode){g.fields=this._processExecuteFields(this.layer.fields,a);c?u=K.generateCacheStore(this.layer,
b,this._batchCount,this._getLayerFilterExpression(),d):(u=z.map(g.features,r.hitch(this,function(a){var b=r.clone(a.attributes);return r.mixin(b,{geometry:a.geometry})})),u=K.generateMemoryStore(u,this.layer.objectIdField));a=this.layer.typeIdField;var f=this.layer.types,w=r.getObject("advancedQueryCapabilities.supportsOrderBy",!1,this.layer),D=r.getObject("advancedQueryCapabilities.supportsPagination",!1,this.layer),y=r.getObject("advancedQueryCapabilities.supportsStatistics",!1,this.layer),f=K.generateColumnsFromFields(this.layerInfo.getPopupInfo(),
g.fields,a,f,w&&D||!c,y);this.layer.hasAttachments&&this.layer.objectIdField&&this.configedInfo.showAttachments&&(f.attachmentsColumn=this.formatAttachmentsColumn());c=20+100*g.fields.length<e.getMarginBox(this.domNode).w;this.createTable(f,u,b,c);this._currentExtent=d;b=this.layer.getSelectedFeatures();this.selectionRows&&0<this.selectionRows.length?this._updateSelectRowsByIds(this.selectionRows):b&&0<b.length?this._updateSelectRowsByFeatures(b):this.grid.clearSelection();this.changeToolbarStatus();
this.emit("data-loaded")}},formatAttachmentsColumn:function(){var a={label:this.nls.attachments,className:"attachments-column",hidden:!1,unhidable:!0,field:"at-show-attachments",sortable:!1,_cache:{sortable:!1,statistics:!1}};a.renderCell=r.hitch(this,function(a,b,c){var g=a[this.layer.objectIdField];this.layer.queryAttachmentInfos(g,r.hitch(this,function(a){var b=z.map(a,r.hitch(this,function(a){var b=a.name&&/\.(png|jpg|jpeg|gif)$/gi.test(a.name)?"image-type":"file-type",c=S.findCredential(this.layer.url);
return'\x3cli class\x3d"'+b+'"\x3e\x3ca class\x3d"jimu-ellipsis" target\x3d"_blank" href\x3d"'+(this.layer.url+"/"+g+"/attachments/"+a.id+(c?"?token\x3d"+c.token:""))+'"\x3e'+a.name+"\x3c/a\x3e\x3c/li\x3e"})),d="";0<a.length&&(d=" "+this.nls.files);d='\x3cdiv class\x3d"attachment-infos"\x3e\x3cdiv class\x3d"show-attachments-div"\x3e\x3cspan class\x3d"show-attachments"\x3e'+a.length+d+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"attachment-popup"\x3e\x3cdiv class\x3d"attachment-popup-header"\x3e\x3cspan\x3e'+
b.length+"\x26nbsp;"+this.nls.files+'\x3c/span\x3e\x3cspan class\x3d"close jimu-float-trailing"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"attachment-popup-content"\x3e'+b.join("")+"\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e";d=e.toDom(d);0<a.length&&(a=I(".show-attachments-div",d)[0],e.addClass(a,"has-attachments"));c.appendChild(d);this.own(A(c,"click",r.hitch(this,function(a){a=a&&a.target;if(e.hasClass(a,"show-attachments-div")||e.hasClass(a,"show-attachments")||e.hasClass(a,"close")){a=this._visibleAttachmentPopup;
var g=I(".attachment-popup",c)[0];g&&0<b.length&&e.toggleClass(g,"show");e.hasClass(g,"show")?this._visibleAttachmentPopup=g:this._visibleAttachmentPopup=null;a&&a!==g&&e.toggleClass(a,"show")}})))}),r.hitch(this,function(a){console.error(a)}))});return a},createTable:function(a,b,c,g){if(this.grid)this.grid.set("store",b),this.grid.set("columns",a),this.grid.refresh();else{var d={};d.columns=a;d.store=b;d.keepScrollPosition=!0;d.pagingDelay=1E3;d.allowTextSelection=!0;d.deselectOnRefresh=!1;this.layer.objectIdField||
(d.minRowsPerPage=this.layer.maxRecordCount||1E3,d.maxRowsPerPage=this.layer.maxRecordCount||1E3,d.selectionMode="none");this.grid=new (k([h,v,q,f,p]))(d,e.create("div"));e.place(this.grid.domNode,this.domNode);this.grid.startup();this.tipNode&&e.destroy(this.tipNode);this.own(A(this.ownerDocument,"keydown",r.hitch(this,function(a){this.grid&&this.grid.allowTextSelection&&a.shiftKey&&this.grid._setAllowTextSelection(!1)})));this.own(A(this.ownerDocument,"keyup",r.hitch(this,function(){this.grid&&
!this.grid.allowTextSelection&&this.grid._setAllowTextSelection(!0)})));this.layer.objectIdField&&(this.own(A(this.grid,".dgrid-header .dgrid-cell:click",r.hitch(this,this._onHeaderClick))),this.own(A(this.grid,"dgrid-columnstatechange",r.hitch(this,this._onColumnStateChange))),this.own(A(this.grid,".selection-handle-column:click",r.hitch(this,this._onSelectionHandleClick))),this.own(A(this.grid,".dgrid-row:dblclick",r.hitch(this,this._onDblclickRow))),this.own(A(this.grid,"dgrid-sort",r.hitch(this,
function(a){this.emit("sort",a)}))),a=this.map.getLayer(this.layer.id),this.syncSelection&&a&&this.own(A(a,"click",r.hitch(this,this._onFeaturelayerClick))))}this.layer.objectIdField&&this.grid.set("sort",this.layer.objectIdField,!1);this.getParent()&&(a=I(".dgrid-scroller",this.grid.domNode)[0],d=I(".dgrid-header",this.grid.domNode)[0],b=e.getComputedStyle(a),d=e.getMarginBox(d),b=parseInt(b.marginTop,10),isFinite(b)&&d&&b<d.h&&e.setStyle(a,"marginTop",d.h+"px"));g?e.addClass(this.domNode,"auto-width"):
e.removeClass(this.domNode,"auto-width");this.footer?e.empty(this.footer):this.footer=e.create("div",{"class":"jimu-widget-attributetable-feature-table-footer"},this.domNode);c=e.create("div",{"class":"dgrid-status self-footer",innerHTML:c+"\x26nbsp;"+(this.layerInfo.isTable?this.nls.records:this.nls.features)+"\x26nbsp;"},this.footer);this.selectedRowsLabel=e.create("div",{"class":"dgrid-status self-footer",innerHTML:"0\x26nbsp;"+this.nls.selected+"\x26nbsp;",style:{display:this.layer.objectIdField?
"":"none"}},c,"after");c=e.getStyle(this.domNode,"height");this.changeHeight(c);this._requestStatus="fulfilled";this.tableCreated=!0;e.place(this.loading.domNode,this.grid.domNode);this.loading.hide()},getSelectedRowsData:function(){if(!this.grid)return null;var a=this.layer.objectIdField,b=this.grid.store,c=b._entityData||b.data,b=this.getSelectedRows();return z.map(b,r.hitch(this,function(b){for(var g=0,d=c.length;g<d;g++)if(c[g]&&c[g][a]===b)return c[g];return{}}))||[]},setSelectedNumber:function(){if(this.selectedRowsLabel&&
this.grid){var a=this.getSelectedRows(),b=0;if(this.grid.store instanceof F){var c=z.map(this.grid.store.data,function(a){return a[this.layer.objectIdField]},this);z.forEach(a,function(a){-1<c.indexOf(a)&&b++})}else b=a.length;this.selectedRowsLabel.innerHTML="\x26nbsp;\x26nbsp;"+b+" "+this.nls.selected+"\x26nbsp;\x26nbsp;"}},_setSelection:function(a){this._selectionResults=a=a||[];this.selectionManager.setSelection(this.layer,a)},_zoomToExtentByFeatures:function(a){return this.getExtent(a).then(r.hitch(this,
function(a){if(a&&this.domNode){var b=null;"point"===a.type?(b=15,b=-1<this.map.getMaxZoom()?this.map.getMaxZoom():.1,b=this.map.centerAndZoom(a,b)):b=this.map.setExtent(a.expand(1.1));return b.then(function(){return a})}}))},_showMapInfoWindowByFeatures:function(a,b){if(b&&0!==b.length&&this.domNode){var c=this.map.infoWindow,g=this.layerInfo.isPopupEnabled()&&this.layerInfo.getInfoTemplate();if(c&&c.setFeatures&&1===b.length&&g){z.forEach(b,r.hitch(this,function(a){a._layer=this.layerInfo.layerObject;
a.setInfoTemplate(g)}));c.setFeatures(b);var d=null,d="point"===a.type?b[0].geometry:a.getCenter();c.show(d,{closetFirst:!0});this._dblClickResult=b[0];this.syncWithMapInfowindow(this._dblClickResult)}}},selectFeatures:function(a,b){b&&0<b.length?("rowclick"===a||"selectall"===a?this._setSelection(b):"zoom"!==a&&"row-dblclick"!==a||this._zoomToExtentByFeatures(b).then(r.hitch(this,function(c){"row-dblclick"===a&&this.domNode&&this._showMapInfoWindowByFeatures(c,b)}),r.hitch(this,function(a){a&&"Request canceled"!==
a.message&&console.error(a)})),this.setSelectedNumber()):this._popupMessage(this.nls.dataNotAvailable)},syncWithMapInfowindow:function(a){var b=this.map.infoWindow,c=r.isArray(a)?a:[a];A.once(b,"hide",r.hitch(this,function(){g&&g.remove&&(g.remove(),g=null)}));var g=T.after(b,"show",r.hitch(this,function(){var a=b.getSelectedFeature(),a=a&&c[0]===a,d=b.features.indexOf(c[0]);!a&&-1<d?b.select(d):this.domNode&&!a&&g&&g.remove&&(g.remove(),g=null)}))},getGraphicsFromLocalFeatureLayer:function(a){for(var b=
[],c,g,d=a.length,u=this.layer.graphics.length,f=this.layer.objectIdField,w=0;w<d;w++)for(var e=0;e<u;e++)if(c=this.layer.graphics[e].attributes[f]+"",g=a[w]+"",c===g){b.push(this.layer.graphics[e]);break}return b},getExtent:function(a){var b=new w,c,g,d=a.length;if(1===d&&a[0].geometry&&"point"===a[0].geometry.type)c=a[0].geometry;else if(1!==d||a[0].geometry)for(var u=0;u<d;u++)a[u].geometry?"point"===a[u].geometry.type?(g||(g=new Q(a[u].geometry.spatialReference)),g.addPoint(a[u].geometry),u===
d-1&&(c=g.getExtent())):c=c?c.union(a[u].geometry.getExtent()):a[u].geometry.getExtent():console.error("unable to get geometry of the reocord: ",a[u]);else return b.reject(Error("AttributeTable.getExtent:: extent was not projected.")),b;if(!c||!c.spatialReference)return b.reject(Error("AttributeTable.getExtent:: extent was not projected.")),b;a=this.map.spatialReference;c.spatialReference.equals(a)?b.resolve(c):(g=new G,g.geometries=[c],g.outSR=a,y.defaults.geometryService.project(g,r.hitch(this,
function(a){this.domNode&&(a&&a.length?b.resolve(a[0]):b.reject(Error("AttributeTable.getExtent:: extent was not projected.")))}),r.hitch(this,function(a){a||(a=Error("AttributeTable.getExtent:: extent was not projected."));b.reject(a)})));return b},_onFeaturelayerClick:function(a,b){if(this.actived){var c=r.getObject("graphic",!1,a),g=r.getObject("graphic.attributes",!1,a);g&&c&&c._layer===this.layer&&((c=this.map.infoWindow.getSelectedFeature())&&c._layer===this.layer&&!b&&this.map.infoWindow.hide(),
g=g[this.layer.objectIdField],this.showSelected&&this.toggleSelectedRecords(),this._getIndexOfIdInGrid(g).then(r.hitch(this,function(b){-1!==b&&(this.grid.scrollTo({x:0,y:this.grid.rowHeight*b}),this.map.infoWindow.features&&(b=this.map.infoWindow.features.indexOf(a.graphic),this.map.infoWindow.select(b)),A.once(this.map.infoWindow,"selection-change",r.hitch(this,function(){var b=this.map.infoWindow.getSelectedFeature(),c=r.getObject("_layer",!1,b);b!==a.graphic&&c===this.layer&&this._onFeaturelayerClick({graphic:b},
!0)})),this.syncWithMapInfowindow(a.graphic))})))}},_getIndexOfIdInGrid:function(a){var b=new w,c=-1,g=r.getObject("store.objectIds",!1,this.grid),c=null,c=this.grid.get("sort")[0];if(this._relatedQuery)return b.resolve(-1),b;if(this.grid.store instanceof F)a=this.grid.store.get(a),g=this.grid.store.data,a?c&&c.attribute&&E.isDefined(c.descending)?(g=r.clone(g),c=function(a,b){return function(c,g){return c[a]===g[a]?0:c[a]<g[a]?b?1:-1:b?-1:1}}(c.attribute,c.descending),g.sort(c),g=z.map(g,function(a){return a[this.layer.objectIdField]},
this),c=g.indexOf(a[this.layer.objectIdField])):c=g.indexOf(a):c=-1,b.resolve(c);else if(g&&0<g.length)c=g.indexOf(a),b.resolve(c);else{g=new C;g.returnGeometry=!1;g.where=this._getLayerFilterExpression()+" AND "+this.layer.objectIdField+" \x3c "+a;if(c&&(c.attribute!==this.layer.objectIdField||c.descending))return b.resolve(-1),b;this.matchingMap&&!this._relatedQuery&&this._currentExtent&&(g.geometry=this._currentExtent);(this._currentDef=this.layer.queryCount(g)).then(r.hitch(this,function(a){b.resolve(a)}),
r.hitch(this,function(a){b.reject(a)}))}return b},_zoomToSelected:function(){if(this.configedInfo&&this.tableCreated){var a=this.getSelectedRows();this._goToFeatures(a,"zoom")}},_goToFeatures:function(a,b){if(0!==a.length){var c=this.getGraphicsFromLocalFeatureLayer(a);this.isSupportQueryToServer()&&a.length!==c.length?this._queryFeaturesByIds(a,b):this.selectFeatures(b,c)}},_onDblclickRow:function(a){this.layerInfo&&this.layerInfo.isShowInMap()&&(a=[this.grid.row(a).id],this._goToFeatures(a,"row-dblclick"))},
_queryFeaturesByIds:function(a,b){var c=new C;c.objectIds=a;c.returnGeometry=!0;c.outSpatialReference=r.clone(this.map.spatialReference);c.outFields=["*"];var g=this.layer,d="esri.layers.CSVLayer"===g.declaredClass;g.url&&!d?(new H(g.url)).execute(c,r.hitch(this,function(a){this.selectFeatures(b,a.features)}),r.hitch(this,this._errorSelectFeatures)):g.selectFeatures(c,M.SELECTION_NEW,r.hitch(this,this.selectFeatures,b),r.hitch(this,this._errorSelectFeatures))},_onHeaderClick:function(a){var b=this.grid.cell(a);
this._showColumnMenu(b.column,b,a.target,{x:a.pageX,y:a.pageY})},_showColumnMenu:function(a,c,g,u){var f=r.getObject("_cache",!1,a);if(f){var w=new d({});e.addClass(w.domNode,"jimu-widget-attributetable-feature-menu");var D=this;if(f.sortable){var y=["iconSortAscending","iconSortDescending"];z.forEach([this.nls.sortAsc,this.nls.sortDes],function(c,g){var d=new b({label:c,iconClass:y[g],baseClass:"menuItemClass",onClick:function(){0===g?D.grid.set("sort",a.field,!1):1===g&&D.grid.set("sort",a.field,
!0)}});w.addChild(d)})}f.statistics&&(f=new b({label:this.nls.statistics,iconClass:"iconTableStatistics",baseClass:"menuItemClass",onClick:r.hitch(this,function(){var b={layer:this.layer,filterExpression:this._getLayerFilterExpression(),fieldNames:[a.field]};this.matchingMap&&(b.geometry=this._currentExtent);if(this.showSelected){var c=this._getSelectedIds();b.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+c.join()+")"}else this.queryByStoreObjectIds&&0<this.queryByStoreObjectIds.length&&
(b.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+this.queryByStoreObjectIds.join()+")");this.fieldStatistics=new V;this.fieldStatistics.showContentAsPopup(b)})}),w.addChild(f));f=w.getChildren();w.startup();w._openMyself({target:g,delegatedTarget:c,iframe:null,coords:u});this.own(A(w,"Close",r.hitch(this,function(){var a=this.get("columnMenu");a&&(a.destroyRecursive(),this.set("columnMenu",null))})));this.set("columnMenu",w);1>f.length&&A.emit(w,"Close")}},_onColumnStateChange:function(a){if(a&&
a.grid&&a.grid.columns){var b=0,c;for(c in a.grid.columns)a.grid.columns[c].hidden||b++;20+100*b-1<e.getMarginBox(this.domNode).w?e.addClass(this.domNode,"auto-width"):e.removeClass(this.domNode,"auto-width")}},_onSelectionHandleClick:function(){var a=this._getSelectedIds();this.selectionRows=a;this._closePopup();this.layerInfo.isTable||(0<a.length?this._goToFeatures(a,"rowclick"):this._setSelection([]));this.setSelectedNumber();this.emit("row-click",{table:this,selectedIds:a})},_onExtentChange:function(a){var b=
r.getObject("delta.x",!1,a),c=r.getObject("delta.y",!1,a);a=this._clickMap&&!a.levelChange?isFinite(b)&&isFinite(c)&&(0<Math.abs(b)||0<Math.abs(c)):!0;this._clickMap=!1;a&&this.matchingMap&&this.actived&&this.layerInfo&&!this.layerInfo.isTable&&this.startQuery(this.queryByStoreObjectIds)},_getLayerFilterExpression:function(){var a=this.layerInfo.getFilter();return a?a:"1\x3d1"},_getOutFieldsFromLayerInfos:function(a){var b=this.configedInfo.layer.fields,c=[];b&&z.forEach(b,r.hitch(this,function(b){E.isDefined(b.show)||
(b.show=!0);b.name!==a||"esriFieldTypeOID"!==b.type&&"esriFieldTypeInteger"!==b.type&&b.type||(b._pk=!0);(b.show||b._pk)&&c.push(b)}));return c},_processExecuteFields:function(a,b){if(a&&0<a.length){var c=[];if(!b.length)return a;for(var g=0,d=b.length;g<d;g++)for(var u=0;u<a.length;u++)b[g].name!==a[u].name||b[g].type!==a[u].type&&b[g].type||(a[u]=r.mixin(a[u],b[g]),c.push(a[u]));return c}return b},_getSelectedIds:function(){var a=[],b=this.grid.selection,c;for(c in b)b[c]&&(isFinite(c)?a.push(parseInt(c,
10)):a.push(c));return a},_errorSelectFeatures:function(a){console.error(a)},_popupMessage:function(a){var b=new l({message:a,buttons:[{label:this.nls.ok,onClick:r.hitch(this,function(){b.close()})}]});this.loading.hide()}})})},"jimu/dijit/Filter":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/Filter.html jimu/filterUtils jimu/utils jimu/dijit/_filter/ValueProviderFactory dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/aspect dojo/query dojo/Deferred esri/request ./_SingleFilter ./_FilterSet ./LoadingIndicator".split(" "),
function(k,e,n,t,l,m,h,v,q,f,p,d,b,c,a,x,g,u,w){return e([n,t,l,h,k],{templateString:m,baseClass:"jimu-filter",declaredClass:"jimu.dijit.Filter",nls:null,_validOptions:!1,_layerDefinition:null,_def:null,valueProviderFactory:null,noFilterTip:"",enableAskForValues:!1,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;var a=this.nls.matchMsg.split("${any_or_all}");this.nls.strMatchMsgPart1=a[0]||"";this.nls.strMatchMsgPart2=a[1]||"";this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this.noFilterTip&&"string"===typeof this.noFilterTip&&(this.noFilterTipSection.innerHTML=this.noFilterTip)},reset:function(){this.isBuilding()||(this.removeAllFilters(),this.url=null,this.isHosted=!1,this.valueProviderFactory=this.partsObj=this.expr=this._layerDefinition=null)},isBuilding:function(){return this._def&&!this._def.isFulfilled()},buildByExpr:function(a,b,c){var g=new x;this.isBuilding()?g.reject("Filter is already building."):(this._def=null,this.reset(),this.url=a,this.isHosted=v.isHostedService(this.url),
this.expr=b||"1\x3d1",this._layerDefinition=c,g=this._def=this._init("expr"));return g},buildByFilterObj:function(a,b,c){var g=new x;this.isBuilding()?g.reject("Filter is already building."):(this._def=null,this.reset(),this.url=a,this.isHosted=v.isHostedService(this.url),this.partsObj=this._updatePartsObj(b),this._layerDefinition=c,g=this._def=this._init("partsObj"));return g},_updatePartsObj:function(a){b.forEach(a,p.hitch(this,function(a){a.parts?b.forEach(a.parts,p.hitch(this,function(a){a.interactiveObj&&
!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")})):a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")}));return a},removeAllFilters:function(){this._destroyAllFilters()},_getLayerDefinitionRaw:function(a,b){var c=new x;b?c.resolve(b):(this.loading.show(),g({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(p.hitch(this,
function(a){this.domNode?(this.loading.hide(),c.resolve(a)):c.reject()}),p.hitch(this,function(a){console.error(a);c.reject();this.domNode&&this.loading.hide()})));return c},_validateLayerDefinition:function(a){return this._isObject(a)},_init:function(a){var c=new x;if(!this._isString(this.url))return c.reject(),c;var u=p.hitch(this,function(){setTimeout(p.hitch(this,function(){c.resolve()}),1500)}),f=p.hitch(this,function(){d.setStyle(this.contentSection,"display","block");d.setStyle(this.errorSection,
"display","none");this.removeAllFilters();var g=this._layerDefinition.fields;g&&0<g.length?(g=b.filter(g,p.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)})))&&0<g.length?(this._validOptions=!0,d.removeClass(this.btnAddSet,"jimu-state-disabled"),d.removeClass(this.btnAddExp,"jimu-state-disabled"),d.removeClass(this.iconAddExp,"jimu-state-disabled"),d.removeClass(this.iconAddSet,"jimu-state-disabled"),this.createFieldsStore(),this.valueProviderFactory=new q({url:this.url,layerDefinition:this._layerDefinition}),
"expr"===a?this._isString(this.expr)?("1\x3d1"===this.expr.replace(/\s/gi,"")&&this.removeAllFilters(),this._parseExpr(this.expr)?u():c.reject()):c.reject():"partsObj"===a?this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),u()):c.reject():this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),u()):this._isString(this.expr)?this._parseExpr(this.expr)?u():c.reject():(this.removeAllFilters(),u())):(this._showErrorOptions(this.nls.error.noFilterFields),c.reject()):
c.reject()});this._validateLayerDefinition(this._layerDefinition)?f():(this.loading.show(),g({url:this.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(p.hitch(this,function(a){this.domNode?(this.loading.hide(),this._layerDefinition=a,f()):c.reject()}),p.hitch(this,function(a){console.error(a);c.reject();this.domNode&&this.loading.hide()})));return c},toJson:function(){var a={logicalOperator:this.allAnySelect.value,parts:[]},c=this._getAllSingleFiltersAndFilterSets();if(0===
c.length)return a.expr="1\x3d1",a;b.forEach(c,p.hitch(this,function(b){b=b.toJson();a.parts.push(b)}));return b.every(a.parts,p.hitch(this,function(a){return!!a}))&&0<a.parts.length?(a.expr=this.getExprByFilterObj(a),a):null},createFieldsStore:function(){if(this._layerDefinition.fields&&0!==this._layerDefinition.fields.length){var a=p.clone(this._layerDefinition).fields;0===this.setFieldsStoreByFieldInfos(a)&&this._showErrorOptions(this.nls.error.noFilterFields)}else this._showErrorOptions(this.nls.error.noFilterFields)},
_parsePartsObj:function(a){this._validatePartsObj(a)&&(this.removeAllFilters(),this._buildEditUIByPartsObj(a))},_parseExpr:function(a){this._destroyAllFilters();var b=null;if(!this._validateLayerDefinition(this._layerDefinition))return b;if(!a||"string"!==typeof a)return this._showErrorOptions(this.nls.error.invalidSQL),b;if("1\x3d1"===this.expr.replace(/\s/gi,""))return b={expr:"1\x3d1",parts:[],logicalOperator:"AND"};try{b=this.getFilterObjByExpr(a)}catch(B){b=null,console.error(B)}b?this._buildEditUIByPartsObj(b):
this._showErrorOptions(this.nls.error.cantParseSQL);return b},_buildEditUIByPartsObj:function(a){a&&(this._destroyAllFilters(),this.allAnySelect.value=a.logicalOperator,b.forEach(a.parts,p.hitch(this,function(a){a.parts?this._addFilterSet(a):a.fieldObj&&a.operator&&a.valueObj&&this._addSingleFilter(a)})))},_addSingleFilter:function(a){a={url:this.url,layerInfo:this._layerDefinition,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,part:a,
OPERATORS:p.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory};a=new u(a);a.placeAt(this.allExpsBox);a.startup();this.own(c.after(a,"_destroySelf",p.hitch(this,this._checkFilterNumbers)));this._checkFilterNumbers()},_addFilterSet:function(a){a={url:this.url,layerInfo:this._layerDefinition,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,partsObj:a,
OPERATORS:p.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory};a=new w(a);a.placeAt(this.allExpsBox);a.startup();this.own(c.after(a,"_destroySelf",p.hitch(this,this._checkFilterNumbers)));this._checkFilterNumbers()},_destroyAllFilters:function(){for(var a=this._getAllSingleFiltersAndFilterSets();0<a.length;)a[0].destroy(),a.splice(0,1);this._checkFilterNumbers()},_getAllSingleFiltersAndFilterSetsDoms:function(){return a(".allExpsBox\x3e.jimu-single-filter,.allExpsBox\x3e.jimu-filter-set",
this.contentSection)},_getAllSingleFiltersAndFilterSets:function(){var a=this._getAllSingleFiltersAndFilterSetsDoms();return b.map(a,p.hitch(this,function(a){return f.byNode(a)}))},_checkFilterNumbers:function(){var a=this._getAllSingleFiltersAndFilterSetsDoms();1<a.length?d.setStyle(this.matchMsg,"display","block"):d.setStyle(this.matchMsg,"display","none");0<a.length?d.setStyle(this.noFilterTipSection,"display","none"):d.setStyle(this.noFilterTipSection,"display","block");b.forEach(a,p.hitch(this,
function(a,b){d.removeClass(a,"even-filter");d.removeClass(a,"odd-filter");d.addClass(a,0===(b+1)%2?"even-filter":"odd-filter")}));this.emit("filter-number-change")},_showErrorOptions:function(a){console.error(a);d.setStyle(this.errorSection,"display","none");this.errorTip.innerHTML=a;this.loading.hide()},_onBtnAddSetClick:function(){this._layerDefinition&&this._validOptions&&this._addFilterSet()},_onBtnAddExpClick:function(){this._layerDefinition&&this._validOptions&&this._addSingleFilter()}})})},
"jimu/dijit/_filter/ValueProviderFactory":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare ./BlankValueProvider ./SimpleValueProvider ./TwoNumbersValueProvider ./TwoDatesValueProvider ./ListValueProvider jimu/LayerInfos/LayerInfos".split(" "),function(k,e,n,t,l,m,h,v,q){var f={stringOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",
supportAskForValue:!0,filterCodedValueIfPossible:!0}},stringOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},stringOperatorStartsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorEndsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,
supportCaseSensitive:!0}},stringOperatorContains:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorDoesNotContain:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},stringOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",
supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsAtLeast:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},
field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsLessThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsAtMost:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},
unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsGreaterThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNotBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},dateOperatorIsOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsNotOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsNotBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},dateOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}}},
p=n([],{nls:null,url:null,layerDefinition:null,layerInfo:null,featureLayerId:null,constructor:function(d){k.mixin(this,d);this.nls=window.jimuNls.filterBuilder;d=q.getInstanceSync();this.featureLayerId&&(this.layerInfo=d.getLayerOrTableInfoById(this.featureLayerId))},getSupportedValueTypes:function(d,b){var c=[],a=f[b];a&&(a.value&&c.push("value"),a.field&&0<this._getSameShortTypeFieldNames(d).length&&c.push("field"),a.unique&&this.url&&(this._isStreamServer(this.url)||10.1<=parseFloat(this.layerDefinition.currentVersion)&&
c.push("unique")));return c},_isStreamServer:function(d){d=(d||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(d)},_getSameShortTypeFieldNames:function(d){var b=[],c=this._getFieldInfo(this.layerDefinition,d),a=p.getShortTypeByEsriType(c.type);e.forEach(this.layerDefinition.fields,k.hitch(this,function(c){c.name!==d&&p.getShortTypeByEsriType(c.type)===a&&b.push(c.name)}));return b},getValueProvider:function(d,b){var c=null,a=k.clone(f[d.operator]);if(a){var x=d.valueObj.type,g=d.fieldObj.name,
u=this._getFieldInfo(this.layerDefinition,g),w=a[x],q=w.normalProviderType,p=null,B=this._getCodedValues(u);B||this.layerDefinition.typeIdField&&this.layerDefinition.typeIdField.toUpperCase()===g.toUpperCase()&&(B=this._getSubTypes(this.layerDefinition));"field"===x?(x=this._getSameShortTypeFieldNames(g),0<x.length&&(p=e.map(x,k.hitch(this,function(a){return{value:a,label:a}})))):B&&0<B.length&&w.codedValueProviderType&&(q=w.codedValueProviderType);a={nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,
partObj:d,fieldInfo:u,codedValues:B,staticValues:p,layerInfo:this.layerInfo,operatorInfo:a,filterCodedValueIfPossible:!!w.filterCodedValueIfPossible,runtime:b};"BLANK_VALUE_PROVIDER"===q?c=new t(a):"SIMPLE_VALUE_PROVIDER"===q?c=new l(a):"TWO_NUMBERS_VALUE_PROVIDER"===q?c=new m(a):"TWO_DATES_VALUE_PROVIDER"===q?c=new h(a):"LIST_VALUE_PROVIDER"===q&&(a.showNullValues=!1,c=new v(a))}return c},_getFieldInfo:function(d,b){for(var c=d.fields,a=0;a<c.length;a++){var f=c[a];if(b===f.name)return f}return null},
_getCodedValues:function(d){var b=null;(d=d.domain)&&"codedValue"===d.type&&d.codedValues&&0<d.codedValues.length&&(b=d.codedValues,b=e.map(b,k.hitch(this,function(b){return{value:b.code,label:b.name}})));return b},_getSubTypes:function(d){var b=null;d.typeIdField&&d.types&&0<d.types.length&&(b=e.map(d.types,k.hitch(this,function(b){return{value:b.id,label:b.name}})));return b}});p.getOperatorInfo=function(d){return k.clone(f[d])};p.getOperatorsByShortType=function(d){var b=[];"string"===d?b="stringOperatorIs stringOperatorIsNot stringOperatorStartsWith stringOperatorEndsWith stringOperatorContains stringOperatorDoesNotContain stringOperatorIsBlank stringOperatorIsNotBlank".split(" "):
"number"===d?b="numberOperatorIs numberOperatorIsNot numberOperatorIsAtLeast numberOperatorIsLessThan numberOperatorIsAtMost numberOperatorIsGreaterThan numberOperatorIsBetween numberOperatorIsNotBetween numberOperatorIsBlank numberOperatorIsNotBlank".split(" "):"date"===d&&(b="dateOperatorIsOn dateOperatorIsNotOn dateOperatorIsBefore dateOperatorIsAfter dateOperatorIsBetween dateOperatorIsNotBetween dateOperatorIsBlank dateOperatorIsNotBlank".split(" "));return b};p.getShortTypeByEsriType=function(d){var b=
null;"esriFieldTypeString"===d?b="string":"esriFieldTypeDate"===d?b="date":0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(d)&&(b="number");return b};return p})},"jimu/dijit/_filter/BlankValueProvider":function(){define(["dojo/_base/html","dojo/_base/declare","./ValueProvider"],function(k,e,n){return e([n],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments);k.addClass(this.domNode,
"jimu-filter-blank-value-provider")},getDijits:function(){return[]},getStatus:function(){return 1},setValueObject:function(){},getValueObject:function(){return{isValid:!0,type:this.partObj.valueObj.type,value:null}},isBlankValueProvider:function(){return!0}})})},"jimu/dijit/_filter/ValueProvider":function(){define("dojo/on dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils esri/lang".split(" "),function(k,e,n,t,l,m,h,
v,q,f){return m([h,v,e],{baseClass:"jimu-filter-value-provider",fieldName:null,shortType:null,_enabled:!1,cascade:"none",filterCodedValue:!1,nls:null,url:null,layerDefinition:null,fieldInfo:null,partObj:null,runtime:!0,staticValues:null,codedValues:null,layerInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,postMixInProperties:function(){this.inherited(arguments);this.shortType=this.partObj.fieldObj.shortType;this.fieldName=this.partObj.fieldObj.name;this.cascade=this.partObj.interactiveObj&&
this.partObj.interactiveObj.cascade;this.runtime&&this.codedValues&&this.filterCodedValueIfPossible&&q.isCodedValuesSupportFilter(this.layerDefinition,this.codedValues.length)?this.filterCodedValue=!0:this.filterCodedValue=!1},getDijits:function(){return[]},bindChangeEvents:function(){var f=this.getDijits();l.forEach(f,n.hitch(this,function(d){d.declaredClass&&0===d.declaredClass.indexOf("dijit.")&&t.addClass(d.domNode,d.declaredClass.replace(/\./g,"-"));this.own(k(d,"change",n.hitch(this,this._onChanged)))}))},
_onChanged:function(){this.emit("change")},tryLocaleNumber:function(f){var d=q.localizeNumber(f);if(null===d||void 0===d)d=f;return d},getPartObject:function(){var f=this.getValueObject();if(!f)return null;var d=n.clone(this.partObj);d.valueObj=f;return d},setValueObject:function(){},getValueObject:function(){},tryGetValueObject:function(){return this.getValueObject()},setRequired:function(){},getStatus:function(){var f=1,d=this.getDijits();0<d.length&&(f=l.map(d,n.hitch(this,function(b){return this.getStatusForDijit(b)})),
f=Math.min.apply(f,f));return f},getStatusForDijit:function(f){return f.validate()?f.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},isBlankValueProvider:function(){return!1},getFilterExpr:function(){var f="1\x3d1",f=this.getLayerFilterExpr();if("all"===this.cascade||"previous"===this.cascade)var d=this.getCascadeFilterExpr(),f="("+f+") AND ("+d+")";return f},
getLayerFilterExpr:function(){var f="1\x3d1";this.layerInfo&&(f=this.layerInfo.getFilter());f||(f="1\x3d1");return f},getCascadeFilterExpr:function(){return"1\x3d1"},isDefined:function(e){return f.isDefined(e)},disable:function(){this._enabled=!1},enable:function(){this._enabled=!0},isEnabled:function(){return this._enabled}})})},"jimu/dijit/_filter/SimpleValueProvider":function(){define("dojo/_base/html dojo/_base/declare ./ValueProvider dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/NumberTextBox".split(" "),
function(k,e,n,t,l,m){return e([n],{templateString:"\x3cdiv\x3e\x3c/div\x3e",_dijit:null,postCreate:function(){this.inherited(arguments);k.addClass(this.domNode,"jimu-filter-simple-value-provider");this._dijit="string"===this.shortType?new t({required:!1,trim:!0}):"number"===this.shortType?new m({required:!1,intermediateChanges:!0,constraints:{pattern:"#####0.##########"}}):new l({required:!1,trim:!0,value:new Date});k.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(this.domNode)},
getDijits:function(){return[this._dijit]},setValueObject:function(e){this.isDefined(e.value)&&("date"===this.shortType?this._dijit.set("value",new Date(e.value)):this._dijit.set("value",e.value))},getValueObject:function(){if(this.isValidValue()){var e=this._dijit.get("value");"date"===this.shortType?e=e.toDateString():"number"===this.shortType&&(e=parseFloat(e));return{isValid:!0,type:this.partObj.valueObj.type,value:e}}return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():
this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:"string"===this.shortType?"":null}:null},setRequired:function(e){this._dijit.set("required",e)}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(k,e,n){return k("dijit.form.DateTextBox",n,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:e,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),
function(k,e,n,t,l,m,h,v,q,f,p,d,b,c,a,x,g){var u=t("dijit.Calendar",[b,c,a],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(a){v.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_createMonthWidget:function(){return new u._MonthDropDownButton({id:this.id+"_mddb",
tabIndex:-1,onMonthSelect:f.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(p(this.domNode,"keydown",f.hitch(this,"_onKeyDown")),p(this.dateRowsNode,"mouseover",f.hitch(this,"_onDayMouseOver")),p(this.dateRowsNode,"mouseout",f.hitch(this,"_onDayMouseOut")),p(this.dateRowsNode,"mousedown",f.hitch(this,"_onDayMouseDown")),p(this.dateRowsNode,"mouseup",f.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(a){var b=
new this.dateClassObj(this.currentFocus);b.setDate(1);b.setMonth(a);a=this.dateModule.getDaysInMonth(b);var c=this.currentFocus.getDate();b.setDate(Math.min(c,a));this._setCurrentFocusAttr(b)},_onDayMouseOver:function(a){(a=m.contains(a.target,"dijitCalendarDateLabel")?a.target.parentNode:a.target)&&(a.dijitDateValue&&!m.contains(a,"dijitCalendarDisabledDate")||a==this.previousYearLabelNode||a==this.nextYearLabelNode)&&(m.add(a,"dijitCalendarHoveredDate"),this._currentNode=a)},_onDayMouseOut:function(a){!this._currentNode||
a.relatedTarget&&a.relatedTarget.parentNode==this._currentNode||(a="dijitCalendarHoveredDate",m.contains(this._currentNode,"dijitCalendarActiveDate")&&(a+=" dijitCalendarActiveDate"),m.remove(this._currentNode,a),this._currentNode=null)},_onDayMouseDown:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&!m.contains(a,"dijitCalendarDisabledDate")&&(m.add(a,"dijitCalendarActiveDate"),this._currentNode=a)},_onDayMouseUp:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&m.remove(a,"dijitCalendarActiveDate")},
handleKey:function(a){var b=-1,c,g=this.currentFocus;switch(a.keyCode){case q.RIGHT_ARROW:b=1;case q.LEFT_ARROW:c="day";this.isLeftToRight()||(b*=-1);break;case q.DOWN_ARROW:b=1;case q.UP_ARROW:c="week";break;case q.PAGE_DOWN:b=1;case q.PAGE_UP:c=a.ctrlKey||a.altKey?"year":"month";break;case q.END:g=this.dateModule.add(g,"month",1),c="day";case q.HOME:g=new this.dateClassObj(g);g.setDate(1);break;default:return!0}c&&(g=this.dateModule.add(g,c,b));this._setCurrentFocusAttr(g);return!1},_onKeyDown:function(a){this.handleKey(a)||
(a.stopPropagation(),a.preventDefault())},onValueSelected:function(){},onChange:function(a){this.onValueSelected(a)},getClassForDate:function(){}});u._MonthDropDownButton=t("dijit.Calendar._MonthDropDownButton",g,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new u._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(a){var b=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.dropDown.set("months",
b);this.containerNode.innerHTML=(6==d("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+b[a.getMonth()]+"\x3c/div\x3e"}});u._MonthDropDown=t("dijit.Calendar._MonthDropDown",[c,x,a],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(a){this.domNode.innerHTML=
"";k.forEach(a,function(a,b){h.create("div",{className:"dijitCalendarMonthLabel",month:b,innerHTML:a},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(a){this.onChange(l.get(a.target,"month"))},onChange:function(){}});return u})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(k,e,n,t,l,m,h,v,q,f,p,d,b,c,a,x){var g=e("dijit.CalendarLite",[c,a],{templateString:x,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(a){return a&&!isNaN(a)&&"object"==typeof a&&a.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var a=this._get("value");if(a&&!isNaN(a)){var b=
new this.dateClassObj(a);b.setHours(0,0,0,0);b.getDate()<a.getDate()&&(b=this.dateModule.add(b,"hour",1));return b}return null},_setValueAttr:function(a,b){"string"==typeof a&&(a=m.fromISOString(a));a=this._patchDate(a);if(this._isValidDate(a)&&!this.isDisabledDate(a,this.lang)){if(this._set("value",a),this.set("currentFocus",a),this._markSelectedDates([a]),this._created&&(b||"undefined"==typeof b))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(a){if(a||
0===a)a=new this.dateClassObj(a),a.setHours(1,0,0,0);return a},_setText:function(a,b){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(a.ownerDocument.createTextNode(b))},_populateGrid:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);var a=this._patchDate(a),b=a.getDay(),c=this.dateModule.getDaysInMonth(a),g=this.dateModule.getDaysInMonth(this.dateModule.add(a,"month",-1)),d=new this.dateClassObj,f=0<=this.dayOffset?this.dayOffset:n.getFirstDayOfWeek(this.lang);f>
b&&(f-=7);if(!this.summary){var e=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.gridNode.setAttribute("summary",e[a.getMonth()])}this._date2cell={};k.forEach(this.dateCells,function(u,e){var y=e+f,x=new this.dateClassObj(a),w="dijitCalendar",h=0;y<b?(y=g-b+y+1,h=-1,w+="Previous"):y>=b+c?(y=y-b-c+1,h=1,w+="Next"):(y=y-b+1,w+="Current");h&&(x=this.dateModule.add(x,"month",h));x.setDate(y);this.dateModule.compare(x,d,"date")||(w="dijitCalendarCurrentDate "+w);this.isDisabledDate(x,
this.lang)?(w="dijitCalendarDisabledDate "+w,u.setAttribute("aria-disabled","true")):(w="dijitCalendarEnabledDate "+w,u.removeAttribute("aria-disabled"),u.setAttribute("aria-selected","false"));(h=this.getClassForDate(x,this.lang))&&(w=h+" "+w);u.className=w+"Month dijitCalendarDateTemplate";w=x.valueOf();this._date2cell[w]=u;u.dijitDateValue=w;w=x.getDateLocalized?x.getDateLocalized(this.lang):x.getDate();this._setText(this.dateLabels[e],w);q.set(u,"aria-label",l.format(x,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);this.monthWidget.set("month",a);var b=a.getFullYear()-1,c=new this.dateClassObj;k.forEach(["previous","current","next"],function(a){c.setFullYear(b++);this._setText(this[a+"YearLabelNode"],this.dateLocaleModule.format(c,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(a){this.dateModule=a.datePackage?f.getObject(a.datePackage,
!1):t;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=a.datePackage?f.getObject(a.datePackage+".locale",!1):l},_createMonthWidget:function(){return g._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var a=this.dowTemplateString,c=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),g=0<=this.dayOffset?this.dayOffset:n.getFirstDayOfWeek(this.lang);this.dayCellsHtml=b.substitute([a,
a,a,a,a,a,a].join(""),{d:""},function(){return c[g++%7]});a=b.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[a,a,a,a,a,a].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);h.setSelectable(this.domNode,!1);a=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",a,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var a=f.hitch(this,function(a,
b,c){this[a].dojoClick=!0;return p(this[a],"click",f.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,b,c))}))});this.own(a("incrementMonth","month",1),a("decrementMonth","month",-1),a("nextYearLabelNode","year",1),a("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(a,b){var c=this.currentFocus,g=this._getNodeByDate(c);a=this._patchDate(a);this._set("currentFocus",a);this._date2cell&&0==this.dateModule.difference(c,a,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));c=this._getNodeByDate(a);c.setAttribute("tabIndex",this.tabIndex);(this.focused||b)&&c.focus();g&&g!=c&&(d("webkit")?g.setAttribute("tabIndex","-1"):g.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(a){a.stopPropagation();a.preventDefault();for(a=a.target;a&&!a.dijitDateValue&&0!==a.dijitDateValue;a=a.parentNode);a&&!v.contains(a,"dijitCalendarDisabledDate")&&this.set("value",
a.dijitDateValue)},_getNodeByDate:function(a){return(a=this._patchDate(a))&&this._date2cell?this._date2cell[a.valueOf()]:null},_markSelectedDates:function(a){function b(a,b){v.toggle(b,"dijitCalendarSelectedDate",a);b.setAttribute("aria-selected",a?"true":"false")}k.forEach(this._selectedCells||[],f.partial(b,!1));this._selectedCells=k.filter(k.map(a,this._getNodeByDate,this),function(a){return a});k.forEach(this._selectedCells,f.partial(b,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
g._MonthWidget=e("dijit.CalendarLite._MonthWidget",c,{_setMonthAttr:function(a){var b=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a),c=6==d("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+k.map(b,function(a){return"\x3cdiv\x3e"+a+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=c+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+b[a.getMonth()]+"\x3c/div\x3e"}});return g})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(k,e,n,t,l,m,h,v){new Date("X");return t("dijit.form._DateTimeTextBox",[m,h],{templateString:v,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:e.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(e,f){var h=this._isInvalidDate(e),d=this._isInvalidDate(f);if(h||d)return h&&d?0:h?-1:1;var h=this.format(e,this._unboundedConstraints),d=this.format(f,this._unboundedConstraints),
b=this.parse(h,this._unboundedConstraints),c=this.parse(d,this._unboundedConstraints);return h==d?0:k.compare(b,c,this._selector)},autoWidth:!0,format:function(e,f){return e?this.dateLocaleModule.format(e,f):""},parse:function(e,f){return this.dateLocaleModule.parse(e,f)||(this._isEmpty(e)?null:void 0)},serialize:function(e,f){e.toGregorian&&(e=e.toGregorian());return n.toISOString(e,f)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(h){h=
h||{};this.dateModule=h.datePackage?l.getObject(h.datePackage,!1):k;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=h.datePackage?l.getObject(h.datePackage+".locale",!1):e;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(e){e.selector=this._selector;e.fullYear=!0;var f=n.fromISOString;"string"==typeof e.min&&(e.min=f(e.min),this.dateClassObj instanceof Date||(e.min=new this.dateClassObj(e.min)));"string"==typeof e.max&&(e.max=f(e.max),this.dateClassObj instanceof Date||(e.max=new this.dateClassObj(e.max)));this.inherited(arguments);this._unboundedConstraints=l.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(e){return!e||
isNaN(e)||"object"!=typeof e||e.toString()==this._invalidDate},_setValueAttr:function(e,f,h){void 0!==e&&("string"==typeof e&&(e=n.fromISOString(e)),this._isInvalidDate(e)&&(e=null),e instanceof Date&&!(this.dateClassObj instanceof Date)&&(e=new this.dateClassObj(e)));this.inherited(arguments,[e,f,h]);this.value instanceof Date&&(this.filterString="");!1!==f&&this.dropDown&&this.dropDown.set("value",e,!1)},_set:function(e,f){if("value"==e){f instanceof Date&&!(this.dateClassObj instanceof Date)&&
(f=new this.dateClassObj(f));var h=this._get("value");if(h instanceof this.dateClassObj&&0==this.compare(f,h))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(e){this._isInvalidDate(e)&&(e=new this.dateClassObj);this._set("dropDownDefaultValue",e)},openDropDown:function(e){this.dropDown&&this.dropDown.destroy();var f=l.isString(this.popupClass)?l.getObject(this.popupClass,!1):this.popupClass,h=this,d=this.get("value");this.dropDown=new f({onChange:function(b){h.set("value",
b,!0)},id:this.id+"_popup",dir:h.dir,lang:h.lang,value:d,textDir:h.textDir,currentFocus:this._isInvalidDate(d)?this.dropDownDefaultValue:d,constraints:h.constraints,filterString:h.filterString,datePackage:h.datePackage,isDisabledDate:function(b){return!h.rangeCheck(b,h.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(e,f){this._setValueAttr(this.parse(e,this.constraints),f,e)}})})},"jimu/dijit/_filter/TwoNumbersValueProvider":function(){define("dojo/_base/html dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./TwoNumbersValueProvider.html dijit/form/NumberTextBox".split(" "),
function(k,e,n,t,l,m){return e([n,t,l],{templateString:m,postCreate:function(){this.inherited(arguments);k.addClass(this.domNode,"jimu-two-numbers-filter-value-provider")},_onRangeNumberBlur:function(){if(this._dijit1.validate()&&this._dijit2.validate()){var e=parseFloat(this._dijit1.get("value")),k=parseFloat(this._dijit2.get("value"));e>k&&(this._dijit1.set("value",k),this._dijit2.set("value",e))}},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(e){this.isDefined(e.value1)&&
this._dijit1.set("value",e.value1);this.isDefined(e.value2)&&this._dijit2.set("value",e.value2)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))}:null},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var e={isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))};
isNaN(e.value1)&&(e.value1=null);isNaN(e.value2)&&(e.value2=null);return e}return null},setRequired:function(e){this._dijit1.set("required",e);this._dijit2.set("required",e)}})})},"jimu/dijit/_filter/TwoDatesValueProvider":function(){define("dojo/_base/html dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./TwoDatesValueProvider.html dijit/form/DateTextBox".split(" "),function(k,e,n,t,l,m){return e([n,t,l],{templateString:m,postCreate:function(){this.inherited(arguments);
k.addClass(this.domNode,"jimu-two-dates-filter-value-provider")},_onRangeDateBlur:function(){if(this._dijit1.validate()&&this._dijit2.validate()){var e=this._dijit1.get("value"),k=e.getTime(),m=this._dijit2.get("value"),f=m.getTime();k>f&&(this._dijit1.set("value",m),this._dijit2.set("value",e))}},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(e){this.isDefined(e.value1)&&this._dijit1.set("value",new Date(e.value1));this.isDefined(e.value2)&&this._dijit2.set("value",
new Date(e.value2))},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:this._dijit1.get("value").toDateString(),value2:this._dijit2.get("value").toDateString()}:null},setRequired:function(e){this._dijit1.set("required",e);this._dijit2.set("required",e)}})})},"jimu/dijit/_filter/ListValueProvider":function(){define("dojo/aspect dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./ListValueProvider.html dojo/store/Memory jimu/utils dijit/form/FilteringSelect".split(" "),
function(k,e,n,t,l,m,h,v,q,f,p,d){return m([h,v,q],{templateString:f,codedValues:null,staticValues:null,showNullValues:!1,postCreate:function(){this.inherited(arguments);t.addClass(this.domNode,"jimu-filter-list-value-provider");this._uniqueValueCache={};var b=new p({idProperty:"id",data:[]});this.valuesSelect.set("store",b);this.staticValues||"function"!==typeof this.valuesSelect._onDropDownMouseDown||(!this.codedValues||this.codedValues&&this.filterCodedValue)&&this.own(k.before(this.valuesSelect,
"_onDropDownMouseDown",n.hitch(this,this._onBeforeDropDownMouseDown)))},_onFilteringSelectInput:function(){this.emit("change")},_onBeforeDropDownMouseDown:function(){this._tryUpdatingUniqueValues(void 0,!0);return arguments},getDijits:function(){return[this.valuesSelect]},setValueObject:function(b){return this.staticValues?this._setValueForStaticValues(b.value,this.staticValues):this.codedValues?this.filterCodedValue?this._tryUpdatingUniqueValues(b.value,!1):this._setValueForStaticValues(b.value,
this.codedValues):this._tryUpdatingUniqueValues(b.value,!1)},getValueObject:function(){if(this.isValidValue()){var b=this.valuesSelect.get("item").value;return{isValid:!0,type:this.partObj.valueObj.type,value:b}}return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:"string"===this.shortType?"":null}:null},setRequired:function(b){this.valuesSelect.set("required",b)},_setValueForStaticValues:function(b,
c){var a=null,d=-1,a=null;c&&(a=l.map(c,n.hitch(this,function(a,c){var g={id:c,value:a.value,label:a.label};g.value===b&&(d=c);return g})),this.valuesSelect.store.setData(a),0<=d&&(a=this.valuesSelect.store.get(d))&&this.valuesSelect.set("item",a))},_uniqueValueLoadingDef:null,_uniqueValueLoadingExpr:"",_uniqueValueCache:null,_tryUpdatingUniqueValues:function(b,c){var a=new e;if(this.valuesSelect._opened)a.resolve();else{var d=this.getFilterExpr();d!==this._uniqueValueLoadingExpr?(this.valuesSelect.readOnly=
!0,this._uniqueValueLoadingDef&&(this._uniqueValueLoadingDef.reject(),this._uniqueValueLoadingDef=null),this._uniqueValueLoadingExpr=d,this._uniqueValueLoadingDef=this._getUniqueValues(d),this._uniqueValueLoadingDef.then(n.hitch(this,function(g){this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._setValueForUniqueValues(b,g),this._hideLoadingIcon(),c&&this.valuesSelect.toggleDropDown(),a.resolve())}),n.hitch(this,function(b){console.error(b);this.domNode&&(this._uniqueValueLoadingDef=
null,this.valuesSelect.readOnly=!1,this._hideLoadingIcon(),a.reject(b))}))):a.resolve()}return a},_setValueForUniqueValues:function(b,c){c.sort(function(a,b){return a.value<b.value?-1:a.value===b.value?0:1});this.showNullValues||(c=l.filter(c,n.hitch(this,function(a){return"\x3cNull\x3e"!==a.value&&null!==a.value})));if(void 0===b){var a=this.getValueObject();a&&(b=a.value)}var d=-1,a=null,g=l.map(c,n.hitch(this,function(a,c){var g={id:c,value:a.value,label:a.label};a.value===b&&(d=c);return g}));
this.valuesSelect.store.setData(g);0<=d&&(a=this.valuesSelect.store.get(d));this.valuesSelect.set("item",a)},_showLoadingIcon:function(){t.addClass(this.valuesSelect.domNode,"loading")},_hideLoadingIcon:function(){t.removeClass(this.valuesSelect.domNode,"loading")},_getUniqueValues:function(b){var c=new e;this._uniqueValueCache[b]?c.resolve(this._uniqueValueCache[b]):(this._showLoadingIcon(),d.getUniqueValues(this.url,this.fieldName,b,this.layerDefinition).then(n.hitch(this,function(a){this.domNode&&
(this._uniqueValueCache[b]=a,c.resolve(a),this._hideLoadingIcon())}),n.hitch(this,function(a){this.domNode&&(c.reject(a),this._hideLoadingIcon())})));return c}})})},"jimu/dijit/_SingleFilter":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilter.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/store/Memory jimu/utils jimu/dijit/_filter/ValueProviderFactory jimu/dijit/CheckBox dijit/form/Select dijit/form/FilteringSelect dijit/form/ValidationTextBox".split(" "),
function(k,e,n,t,l,m,h,v,q,f,p,d){return k([e,n,t],{templateString:l,baseClass:"jimu-single-filter",declaredClass:"jimu.dijit._SingleFilter",nls:null,url:null,layerInfo:null,stringFieldType:"",dateFieldType:"",numberFieldTypes:[],supportFieldTypes:[],part:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,valueProvider:null,postMixInProperties:function(){this.supportFieldTypes=[];this.supportFieldTypes.push(this.stringFieldType);this.supportFieldTypes.push(this.dateFieldType);
this.supportFieldTypes=this.supportFieldTypes.concat(this.numberFieldTypes);this.nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);this._initSelf()},toJson:function(){var b={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",caseSensitive:!1},c=this._getFieldObjByUI();if(!c)return null;b.fieldObj=c;c=this._getOperatorByUI();if(!c)return null;b.operator=c;b.caseSensitive=this.cbxCaseSensitive.getStatus()&&this.cbxCaseSensitive.getValue();if(c=this._isUseAskForValues()){if(!this.promptTB.validate())return this._showValidationErrorTip(this.promptTB),
null;b.interactiveObj={prompt:this.promptTB.get("value"),hint:this.hintTB.get("value"),cascade:"none"};this.uniqueRadio&&this.uniqueRadio.checked&&(b.interactiveObj.cascade=this.cascadeSelect.get("value"))}b.valueObj={isValid:!0,type:""};c=c?this.valueProvider.tryGetValueObject():this.valueProvider.getValueObject();if(!c)return null;this.valueRadio.checked?c.type="value":this.fieldRadio.checked?c.type="field":this.uniqueRadio.checked&&(c.type="unique");b.valueObj=c;return b},_getFieldObjByUI:function(){var b=
this._getSelectedFilteringItem(this.fieldsSelect);return b?{name:b.name,label:b.name,shortType:b.shortType,type:b.type}:null},_getOperatorByUI:function(){var b=this.operatorsSelect.get("value");"none"===b&&(b=null);return b},showDelteIcon:function(){h.setStyle(this.btnDelete,"display","inline-block")},hideDeleteIcon:function(){h.setStyle(this.btnDelete,"display","none")},_showAndEnableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!0);h.setStyle(this.cbxCaseSensitive.domNode,"display","inline-block")},
_hideAndDisableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!1);h.setStyle(this.cbxCaseSensitive.domNode,"display","none")},_initSelf:function(){this.layerInfo=m.mixin({},this.layerInfo);this.isHosted&&(this.cbxCaseSensitive.setValue(!1),this.cbxCaseSensitive.setStatus(!1),this.cbxCaseSensitive.domNode.title=this.nls.notSupportCaseSensitiveTip);this.own(q(this.fieldsSelect,"MouseEnter",m.hitch(this,this._updateFieldsSelectTitle)));this.own(q(this.operatorsSelect,"MouseEnter",m.hitch(this,
this._updateOperatorsSelectTitle)));this.enableAskForValues?(h.setStyle(this.cbxAskValues.domNode,"display","inline-block"),h.setStyle(this.promptSection,"display","block"),this.own(q(this.cbxAskValues,"status-change",m.hitch(this,this._onCbxAskValuesStatusChanged))),this.cbxAskValues.onChange=m.hitch(this,this._onCbxAskValuesClicked)):(h.setStyle(this.cbxAskValues.domNode,"display","none"),h.setStyle(this.promptSection,"display","none"));this._initValueTypeRadios();var b=this.layerInfo.fields;b&&
0<b.length&&(b=v.filter(b,m.hitch(this,function(b){return 0<=this.supportFieldTypes.indexOf(b.type)})),0<b.length&&(this._enableRadios(),this._initFieldsSelect(b),this.part?this._showPart(this.part):this._resetByFieldAndOperator(),setTimeout(m.hitch(this,function(){this._bindFieldsSelectChangeAndOperatorChangeEvents()}),10)))},_bindFieldsSelectChangeAndOperatorChangeEvents:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this._handle1=q(this.fieldsSelect,"change",m.hitch(this,this._onFieldsSelectChange));
this._handle2=q(this.operatorsSelect,"change",m.hitch(this,this._onOperatorsSelectChange))},_removeFieldsSelectChangeAndOperatorChangeEvents:function(){this._handle1&&this._handle1.remove();this._handle2&&this._handle2.remove();this._handle2=this._handle1=null},_isServiceSupportDistinctValues:function(b,c){return this._isStreamServer(b)?!1:10.1<=parseFloat(c.currentVersion)},_isStreamServer:function(b){b=(b||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(b)},_updateFieldsSelectTitle:function(){this.fieldsSelect.domNode.title=
"";var b=this._getSelectedFilteringItem(this.fieldsSelect);b&&(this.fieldsSelect.domNode.title=b.displayName||b.alias||b.name)},_updateOperatorsSelectTitle:function(){this.operatorsSelect.domNode.title="";var b=this.operatorsSelect.get("value");b&&(b=this.operatorsSelect.getOptions(b),this.operatorsSelect.domNode.title=b.label)},_showValidationErrorTip:function(b){try{!b.validate()&&b.domNode&&b.focusNode&&(b.focusNode.focus(),b.focusNode.blur())}catch(c){console.error(c)}},_getSelectedFilteringItem:function(b){if(b.validate()){var c=
b.get("item");if(c)return c}this._showValidationErrorTip(b);return null},_getShortTypeByFieldType:function(b){return b===this.stringFieldType?"string":b===this.dateFieldType?"date":0<=this.numberFieldTypes.indexOf(b)?"number":null},_initFieldsSelect:function(b){b=v.map(b,m.hitch(this,function(a,b){var c=m.mixin({},a);c.id=b;c.shortType=this._getShortTypeByFieldType(a.type);c.alias||(c.alias=c.name);var d="";"string"===c.shortType?d=this.nls.string:"number"===c.shortType?d=this.nls.number:"date"===
c.shortType&&(d=this.nls.date);c.displayName=c.alias+" ("+d+")";return c}));if(0<b.length){var c=new f({data:b});this.fieldsSelect.set("store",c);this.fieldsSelect.set("value",b[0].id)}this._updateOperatorsByFieldsSelect()},_showPart:function(b){if((this.part=b)&&this.part.fieldObj&&this.part.operator&&this.part.valueObj){this._removeFieldsSelectChangeAndOperatorChangeEvents();var c=this.part.fieldObj.name;b=this.part.operator;this.part.caseSensitive=!!this.part.caseSensitive;c=this.fieldsSelect.store.query({name:c});
0!==c.length&&(c=c[0])&&(this.fieldsSelect.set("value",c.id),this._updateOperatorsByFieldsSelect(),this.operatorsSelect.set("value",b),this._resetByFieldAndOperator(this.part),b=this.part.interactiveObj)&&(this.cbxAskValues.check(),this._updatePrompt(),this.promptTB.set("value",b.prompt||""),this.hintTB.set("value",b.hint||""),"unique"===this.part.valueObj.type?this.cascadeSelect.set("value",b.cascade):this.cascadeSelect.set("value","none"))}},_onFieldsSelectChange:function(){this._updateOperatorsByFieldsSelect();
this._resetByFieldAndOperator()},_updateOperatorsByFieldsSelect:function(){this._updateFieldsSelectTitle();this.operatorsSelect.removeOption(this.operatorsSelect.getOptions());this.operatorsSelect.addOption({value:"none",label:this.nls.none});var b=this._getSelectedFilteringItem(this.fieldsSelect);b&&(this.operatorsSelect.shortType=b.shortType,b=d.getOperatorsByShortType(b.shortType),this.operatorsSelect.removeOption(this.operatorsSelect.getOptions()),v.forEach(b,m.hitch(this,function(b){this.operatorsSelect.addOption({value:b,
label:this.nls[b]})})))},_onOperatorsSelectChange:function(){this._resetByFieldAndOperator()},_initValueTypeRadios:function(){var b="radio_"+p.getRandomString();this.valueRadio.name=b;this.fieldRadio.name=b;this.uniqueRadio.name=b;this.valueRadio.valueType="value";this.fieldRadio.valueType="field";this.uniqueRadio.valueType="unique";p.combineRadioCheckBoxWithLabel(this.valueRadio,this.valueLabel);p.combineRadioCheckBoxWithLabel(this.fieldRadio,this.fieldLabel);p.combineRadioCheckBoxWithLabel(this.uniqueRadio,
this.uniqueLabel);this.own(q(this.valueRadio,"click",m.hitch(this,function(){this._resetByFieldAndOperator(null,"value")})));this.own(q(this.fieldRadio,"click",m.hitch(this,function(){this._resetByFieldAndOperator(null,"field")})));this.own(q(this.uniqueRadio,"click",m.hitch(this,function(){this._resetByFieldAndOperator(null,"unique")})));this._isServiceSupportDistinctValues(this.url,this.layerInfo)||(this.uniqueTd.style.display="none")},_updateValueTypeClass:function(){h.removeClass(this.domNode,
"value-type");h.removeClass(this.domNode,"field-type");h.removeClass(this.domNode,"unique-type");h.removeClass(this.domNode,"support-cascade");if(this.valueRadio.checked)h.addClass(this.domNode,"value-type"),this.cascadeSelect.set("value","none");else if(this.fieldRadio.checked)h.addClass(this.domNode,"field-type"),this.cascadeSelect.set("value","none");else{h.addClass(this.domNode,"unique-type");this.cascadeSelect.set("value","previous");var b=!0,b=this._getSelectedFilteringItem(this.fieldsSelect),
b=this._getCodedValuesOrTypesCount(b);(b=0<b?p.isCodedValuesSupportFilter(this.layerInfo,b):!0)?(this.cascadeSelect.set("value","previous"),h.addClass(this.domNode,"support-cascade")):this.cascadeSelect.set("value","none")}},_getCodedValuesOrTypesCount:function(b){if(b){if(b.domain&&"codedValue"===b.domain.type&&b.domain.codedValues)return b.domain.codedValues.length;if(this.layerInfo.typeIdField===b.name&&this.layerInfo.types)return this.layerInfo.types.length}return 0},_enableRadios:function(){this.valueRadio.disabled=
!1;this.fieldRadio.disabled=!1;this.uniqueRadio.disabled=!1},_disableAndUncheckRadios:function(){this._enableRadios();this.valueRadio.checked=!1;this.fieldRadio.checked=!1;this.uniqueRadio.checked=!1;this.valueRadio.disabled=!0;this.fieldRadio.disabled=!0;this.uniqueRadio.disabled=!0},_resetByFieldAndOperator:function(b,c){this._updateOperatorsSelectTitle();this.valueProvider&&this.valueProvider.destroy();this._hideAndDisableCaseSensitive();this._disableAndUncheckRadios();b||(b={fieldObj:"",operator:"",
valueObj:"",interactiveObj:"",caseSensitive:!1},b.fieldObj=this._getFieldObjByUI(),b.operator=this._getOperatorByUI());var a=[],e=null;if(b.fieldObj&&b.operator){var a=this.valueProviderFactory.getSupportedValueTypes(b.fieldObj.name,b.operator),g=null;b.valueObj?e=b.valueObj.type:(e=c&&0<=a.indexOf(c)?c:a[0],b.valueObj={type:e});0<=a.indexOf("value")&&(this.valueRadio.disabled=!1);0<=a.indexOf("field")&&(this.fieldRadio.disabled=!1);0<=a.indexOf("unique")&&(this.uniqueRadio.disabled=!1);"value"===
e?g=this.valueRadio:"field"===e?g=this.fieldRadio:"unique"===e&&(g=this.uniqueRadio);g&&(g.disabled=!1,g.checked=!0)}0<a.length?(this.valueProvider=this.valueProviderFactory.getValueProvider(b,!1),this.valueProvider.placeAt(this.attributeValueContainer,"first"),this.valueProvider.setValueObject(b.valueObj),this.valueProvider.isBlankValueProvider()?(h.addClass(this.valueProvider.domNode,"hidden"),h.addClass(this.attributeValueContainer,"hidden")):h.removeClass(this.attributeValueContainer,"hidden"),
(a=d.getOperatorInfo(b.operator))&&e&&(a[e]&&a[e].supportCaseSensitive&&this._showAndEnableCaseSensitive(),b&&this.cbxCaseSensitive.setValue(b.caseSensitive))):h.addClass(this.attributeValueContainer,"hidden");this._updateWhenValueRadioChanged()},_updateWhenValueRadioChanged:function(){this._updatePrompt();this._updateValueTypeClass()},_getRadioByValueType:function(b){return"value"===b?this.valueRadio:"field"===b?this.fieldRadio:"unique"===b?this.uniqueRadio:null},_onCbxAskValuesClicked:function(){this._updateRequiredProperty();
this._updatePrompt()},_onCbxAskValuesStatusChanged:function(){this._updateRequiredProperty()},_isUseAskForValues:function(){return this.cbxAskValues.status&&this.cbxAskValues.checked},_isValueRequired:function(){return!this._isUseAskForValues()},_updateRequiredProperty:function(){var b=this._isValueRequired();this.valueProvider.setRequired(b)},_getValueTypeByUI:function(){return!this.valueRadio.disabled&&this.valueRadio.checked?"value":!this.fieldRadio.disabled&&this.fieldRadio.checked?"field":!this.uniqueRadio.disabled&&
this.uniqueRadio.checked?"unique":null},_updatePrompt:function(){this.promptTB.set("value","");this.hintTB.set("value","");this.cbxAskValues.setStatus(!0);h.setStyle(this.promptTable,"display","table");var b=this.operatorsSelect.get("value"),c=this.nls[b],a=!1,e=this._getValueTypeByUI(),g=d.getOperatorInfo(b);g&&e&&(e=g[e])&&e.supportAskForValue&&(a=!0);a||this.cbxAskValues.setStatus(!1);this.cbxAskValues.status&&this.cbxAskValues.checked?(h.setStyle(this.promptTable,"display","table"),(a=this._getSelectedFilteringItem(this.fieldsSelect))&&
"none"!==b&&this.promptTB.set("value",(a.alias||a.name)+" "+c)):h.setStyle(this.promptTable,"display","none")},_destroySelf:function(){this.destroy()},destroy:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this.inherited(arguments)}})})},"jimu/dijit/_FilterSet":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_FilterSet.html dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/aspect dojo/query ./_SingleFilter".split(" "),
function(k,e,n,t,l,m,h,v,q,f,p,d,b){return k([e,n,t],{templateString:l,baseClass:"jimu-filter-set",nls:null,url:null,layerInfo:null,stringFieldType:"",dateFieldType:"",numberFieldTypes:[],partsObj:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;var b=this.nls.matchMsgSet.split("${any_or_all}");this.nls.strMatchMsgPart1=b[0]||"";this.nls.strMatchMsgPart2=b[1]||"";this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._initSelf()},toJson:function(){var b=d(".jimu-single-filter",this.allExpsBox),b=q.map(b,h.hitch(this,function(a){return m.byNode(a).toJson()}));return q.every(b,h.hitch(this,function(a){return!!a}))&&0<b.length?{logicalOperator:this.allAnySelect.value,parts:b}:null},showDelteIcon:function(){v.setStyle(this.btnDelete,"display","block")},hideDeleteIcon:function(){v.setStyle(this.btnDelete,"display","none")},_initSelf:function(){this.own(f(this.btnAdd,"click",h.hitch(this,this._addSingleFilter)));
if(this.partsObj){this.allAnySelect.value=this.partsObj.logicalOperator;var b=this.partsObj.parts||[];0===b.length?(this._addSingleFilter(),this._addSingleFilter()):1===b.length?(this._addSingleFilter(b[0]),this._addSingleFilter()):q.forEach(b,h.hitch(this,function(a){this._addSingleFilter(a)}))}else this._addSingleFilter(),this._addSingleFilter()},_addSingleFilter:function(c){c=new b({url:this.url,layerInfo:this.layerInfo,stringFieldType:this.stringFieldType,dateFieldType:this.dateFieldType,numberFieldTypes:this.numberFieldTypes,
part:c,OPERATORS:this.OPERATORS,enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,style:{margin:"15px auto 0 auto",border:0,background:"inherit"}});c.placeAt(this.allExpsBox);c.startup();this.own(p.after(c,"_destroySelf",h.hitch(this,this._checkFilterNumbers)));this._checkFilterNumbers()},_checkFilterNumbers:function(){var b=d(".jimu-single-filter",this.allExpsBox),a=2<b.length;q.forEach(b,h.hitch(this,function(b){b=m.byNode(b);a?b.showDelteIcon():
b.hideDeleteIcon()}))},_destroySelf:function(){this.destroy()}})})},"widgets/AttributeTable/dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect dgrid/List dojo/has!touch?dgrid/util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),function(k,e,n,t,l,m,h,v,q){function f(a,b){for(var c=a.unselectable=b?"on":"",g=a.getElementsByTagName("*"),d=g.length;--d;)"INPUT"!==g[d].tagName&&"TEXTAREA"!==g[d].tagName&&(g[d].unselectable=
c)}function p(a,c){var g=a.bodyNode,d=c?"text":21>l("ff")?"-moz-none":"none";b&&"msUserSelect"!==b?g.style[b]=d:l("dom-selectstart")?c||a._selectstartHandle?c&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=t(g,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):(f(g,!c),c||a._unselectableHandle)?c&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=
m.after(a,"renderRow",function(a){f(a,!0);return a})}l.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});l.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});l.add("css-user-select",function(a,b,c){a=c.style;b=["Khtml","O","ms","Moz","Webkit"];c=b.length;var g="userSelect";do if("undefined"!==typeof a[g])return g;while(c--&&(g=b[c]+"UserSelect"));return!1});l.add("dom-selectstart","undefined"!==typeof document.onselectstart);
var d=l("mac")?"metaKey":"ctrlKey",b=l("css-user-select"),c=(h=l("pointer"))&&"MS"===h.slice(0,2),a=h?h+(c?"Down":"down"):"mousedown",x=h?h+(c?"Up":"up"):"mouseup";"WebkitUserSelect"===b&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(b=!1);return e("dgrid.Selection",null,{selectionDelegate:".dgrid-cell.dgrid-cell-padding.dgrid-column-selectionHandle.field-selectionHandle.selection-handle-column",selectionEvents:a+","+x+",dgrid-cellfocusin",selectionTouchEvents:l("touch")?v.tap:
null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();
this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){k.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?p(this,a):p(this,"none"===this.selectionMode);
this.allowTextSelection=a},_handleSelect:function(b,c){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(c))&&("dgrid-cellfocusin"!==b.type||"mousedown"!==b.parentType)&&(b.type!==x||c==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=b;if(!b.keyCode||!b.ctrlKey||32==b.keyCode)if(!b.shiftKey&&b.type===a&&this.isSelected(c))this._waitForMouseUp=c;else this[this._selectionHandlerName](b,c);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,
b){var c=a.keyCode?a.ctrlKey:a[d];this._lastSelected===b?this.select(b,null,!c||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var c=this._lastSelected,g=a.keyCode?a.ctrlKey:a[d],e;a.shiftKey||(e=g?null:!0,c=null);this.select(b,c,e);c||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?this.isSelected(b):a.keyCode?a.ctrlKey:a[d])||this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},
_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var a=this,b=this.contentNode,c=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};l("touch")&&!l("pointer")&&this.selectionTouchEvents?(t(b,v.selector(c,this.selectionTouchEvents),function(b){a._handleSelect(b,this);a._ignoreMouseSelect=this}),t(b,t.selector(c,this.selectionEvents),function(b){a._ignoreMouseSelect!==this?a._handleSelect(b,this):b.type===x&&(a._ignoreMouseSelect=
null)})):t(b,t.selector(c,this.selectionEvents),function(b){a._handleSelect(b,this)});this.addKeyHandler&&this.addKeyHandler(32,function(b){a._handleSelect(b,b.target)});if(this.allowSelectAll)this.on("keydown",function(b){b[d]&&65==b.keyCode&&!/\bdgrid-input\b/.test(b.target.className)&&(b.preventDefault(),a[a.allSelected?"clearSelection":"selectAll"]())});this._setStore&&m.after(this,"_setStore",function(){a._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(a,
c,g){a=c||a&&a[b.idProperty||"id"];if(null!=a&&(c=(a=b.row(a))&&b.selection[a.id]))b[g](a,null,c)}var b=this,c=this.store,d,e;this._removeDeselectSignals&&this._removeDeselectSignals();c&&c.notify?(d=m.before(c,"notify",function(b,c){b||a(b,c,"deselect")}),e=m.after(c,"notify",function(b,c){a(b,c,"select")},!0),this._removeDeselectSignals=function(){d.remove();e.remove()}):(d=m.before(this,"removeRow",function(a,b){var c;b||(c=this.row(a))&&c.id in this.selection&&this.deselect(c)}),this._removeDeselectSignals=
function(){d.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,g;g={bubbles:!0,grid:this};c&&(g.parentType=c.type);g[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];t.emit(this.contentNode,"dgrid-"+a,g)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(a,b,c){var d,g,e;"undefined"===typeof c&&(c=!0);a.element||
(a=this.row(a));if(!1===c||this.allowSelect(a))if(d=this.selection,g=!!d[a.id],null===c&&(c=!g),e=a.element,c||this.allSelected?d[a.id]=c:delete this.selection[a.id],e&&(c?q(e,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):q(e,"!dgrid-selected!ui-state-active")),c!==g&&e&&this._selectionEventQueues[(c?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element)for(d=this._determineSelectionDirection(e,b),d||(b=document.getElementById(b.id),d=this._determineSelectionDirection(e,
b));a.element!=b&&(a=this[d](a));)this._select(a,null,c)}else this._lastSelected=e,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:l("dom-comparedocumentposition")?function(a,b){var c=b.compareDocumentPosition(a);return c&1?!1:2===c?"down":"up"}:function(a,
b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=this.row(this._rowIdToObject[a]);this._select(b.id,
null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);n.when(b,function(b){var c=a.selection,d,g,e;for(d=0;d<b.length;d++)g=a.row(b[d]),
(e=g.id in c?c[g.id]:a.allSelected)&&a._select(g,null,e);a._fireSelectionEvents()});return b}})})},"dgrid/extensions/ColumnHider":function(){define("dojo/_base/declare dojo/has dojo/on ../util/misc put-selector/put dojo/i18n!./nls/columnHider xstyle/css!../css/extensions/ColumnHider.css".split(" "),function(k,e,n,t,l,m){var h,v,q=e("ie"),f=q&&e("quirks"),p=8>q||f?"htmlFor":"for";return k("dgrid.extensions.ColumnHider",null,{hiderMenuNode:null,hiderToggleNode:null,i18nColumnHider:m,_hiderMenuOpened:!1,
_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var d=this.subRows,b=!0,c,a,e,g;delete this._columnHiderFirstCheckbox;e=0;for(c=d.length;e<c;e++)for(g=0,a=d[e].length;g<a;g++)this._renderHiderMenuEntry(d[e][g]),b&&(b=!1,this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[d[e][g].id])},_renderHiderMenuEntry:function(d){var b=d.id,c=t.escapeCssIdentifier(b,"-"),a,e;d.hidden&&(d.hidden=!1,this._hideColumn(b),d.hidden=!0);d.unhidable||(a=l("div.dgrid-hider-menu-row"),
e=this.domNode.id+"-hider-menu-check-"+c,b=this._columnHiderCheckboxes[b]=l(a,"input.dgrid-hider-menu-check.hider-menu-check-"+c+"[type\x3dcheckbox]"),b.id=e,l(a,"label.dgrid-hider-menu-label.hider-menu-label-"+c+"["+p+"\x3d"+e+"]",d.label||d.field||""),l(this.hiderMenuNode,a),d.hidden||(b.checked=!0))},renderHeader:function(){function d(a){a.stopPropagation()}var b=this,c=this.hiderMenuNode,a=this.hiderToggleNode,e;this.inherited(arguments);if(c){for(e in this._columnHiderRules)this._columnHiderRules[e].remove();
c.innerHTML=""}else a=this.hiderToggleNode=l(this.domNode,"button.ui-icon.dgrid-hider-toggle[type\x3dbutton][aria-label\x3d"+this.i18nColumnHider.popupTriggerLabel+"]"),this._listeners.push(n(a,"click",function(a){b._toggleColumnHiderMenu(a)})),c=this.hiderMenuNode=l("div.dgrid-hider-menu[role\x3ddialog][aria-label\x3d"+this.i18nColumnHider.popupLabel+"]"),c.id=this.id+"-hider-menu",this._listeners.push(n(c,"keyup",function(c){27===(c.charCode||c.keyCode)&&(b._toggleColumnHiderMenu(c),a.focus())})),
c.style.display="none",l(this.domNode,c),this._listeners.push(n(c,".dgrid-hider-menu-check:"+(9>q||f?"click":"change"),function(a){b._updateColumnHiddenState(a.target.id.substr(b.id.length+18),!a.target.checked)})),this._listeners.push(n(c,"mousedown",d),n(a,"mousedown",d)),v||(v=n.pausable(document,"mousedown",function(a){h&&h._toggleColumnHiderMenu(a)}),v.pause());this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries()},destroy:function(){this.inherited(arguments);
for(var d in this._columnHiderRules)this._columnHiderRules[d].remove()},left:function(d,b){return this.right(d,-b)},right:function(d,b){d.element||(d=this.cell(d));for(var c=this.inherited(arguments),a=d;c.column.hidden;){c=this.inherited(arguments,[c,0<b?1:-1]);if(a.element===c.element)return d;a=c}return c},isColumnHidden:function(d){return!!this._columnHiderRules[d]},_toggleColumnHiderMenu:function(){var d=this._hiderMenuOpened,b=this.hiderMenuNode,c=this.domNode,a;b.style.display=d?"none":"";
d?b.style.height="":(b.offsetHeight>c.offsetHeight-12&&(b.style.height=c.offsetHeight-12+"px"),(a=this._columnHiderFirstCheckbox)&&a.focus());v[d?"pause":"resume"]();h=d?null:this;this._hiderMenuOpened=!d},_hideColumn:function(d){var b=this,c="#"+t.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-",a;this._columnHiderRules[d]||(this._columnHiderRules[d]=t.addCssRule(c+t.escapeCssIdentifier(d,"-"),"display: none;"),8!==e("ie")&&10!==e("ie")||e("quirks")||(a=t.addCssRule(".dgrid-row-table","display: inline-table;"),
window.setTimeout(function(){a.remove();b.resize()},0)))},_showColumn:function(d){this._columnHiderRules[d]&&(this._columnHiderRules[d].remove(),delete this._columnHiderRules[d])},_updateColumnHiddenState:function(d,b){this[b?"_hideColumn":"_showColumn"](d);this.columns[d].hidden=b;n.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[d],hidden:b,bubbles:!0});this.resize()},toggleColumnHiddenState:function(d,b){"undefined"===typeof b&&(b=!this._columnHiderRules[d]);this._updateColumnHiddenState(d,
b);this._columnHiderCheckboxes[d].checked=!b}})})},"dgrid/extensions/ColumnResizer":function(){define("dojo/_base/declare dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-geometry dojo/has ../util/misc put-selector/put dojo/_base/html xstyle/css!../css/extensions/ColumnResizer.css".split(" "),function(k,e,n,t,l,m,h,v,q){function f(a){for(var b=a.length,c=b,d=a[0].length,e=Array(b);b--;)e[b]=Array(d);for(var f={},b=0;b<c;b++)for(var h=e[b],k=a[b],m=0,y=0;m<d;m++){var l=k[y],q;if("undefined"==typeof h[m]){h[m]=
l.id;if(l.rowSpan&&1<l.rowSpan){q=e;for(var n=l.rowSpan,p=b,v=m,t=l.id,C=1;C<n;C++)q[p+C][v]=t}if(0<b&&l.colSpan&&1<l.colSpan)for(q=1;q<l.colSpan;q++)if(h[++m]=l.id,l.rowSpan&&1<l.rowSpan)for(var n=e,p=l.rowSpan,v=b,t=m,C=l.id,G=1;G<p;G++)n[v+G][t]=C;f[l.id]=a[0][m].id;y++}}return f}function p(a,b,c,d,f){if(!(0>=c)){var g=a.columns[b],h;if(g&&(h={grid:a,columnId:b,width:c,bubbles:!0,cancelable:!0},d&&(h.parentType=d),!a._resizedColumns||e.emit(a.headerNode,"dgrid-columnresize",h)))return"auto"===
c?delete g.width:(g.width=c,c+="px"),(d=a._columnSizes[b])?d.set("width",c):d=v.addCssRule("#"+v.escapeCssIdentifier(a.domNode.id)+" .dgrid-column-"+v.escapeCssIdentifier(b,"-"),"width: "+c+";"),a._columnSizes[b]=d,!1!==f&&a.resize(),!0}}var d,b=0,c={create:function(){d=q("div.dgrid-column-resizer")},destroy:function(){q(d,"!");d=null},show:function(a){a=m.position(a.domNode,!0);d.style.top=a.y+"px";d.style.height=a.h+"px";q(document.body,d)},move:function(a){d.style.left=a+"px"},hide:function(){d.parentNode.removeChild(d)}};
return k("dgrid.extensions.ColumnResizer",null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments);b++||c.create()},destroy:function(){this.inherited(arguments);for(var a in this._columnSizes)this._columnSizes[a].remove();--b||c.destroy()},resizeColumnWidth:function(a,b){return p(this,a,b)},configStructure:function(){var a=this._oldColumnSizes=t.mixin({},this._columnSizes),b;this._resizedColumns=!1;this._columnSizes={};this.inherited(arguments);
for(b in a)b in this._columnSizes||a[b].remove();delete this._oldColumnSizes},_configColumn:function(a){this.inherited(arguments);var b=a.id,c;"width"in a&&((c=this._oldColumnSizes[b])?c.set("width",a.width+"px"):c=v.addCssRule("#"+v.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+v.escapeCssIdentifier(b,"-"),"width: "+a.width+"px;"),this._columnSizes[b]=c)},renderHeader:function(){this.inherited(arguments);var a=this,b;if(this.columnSets&&this.columnSets.length)for(var c=this.columnSets.length;c--;)b=
t.mixin(b||{},f(this.columnSets[c]));else this.subRows&&1<this.subRows.length&&(b=f(this.subRows));for(var c=n(".dgrid-cell",a.headerNode),d=c.length;d--;){var m=c[d],k=m.columnId,l=a.columns[k],p=m.childNodes;if(l&&!1!==l.resizable){l=q("div.dgrid-resize-header-container");for(m.contents=l;0<p.length;)q(l,p[0]);q(m,l,"div.dgrid-resize-handle.resizeNode-"+v.escapeCssIdentifier(k,"-")).columnId=b&&b[k]||k}}a.mouseMoveListen||(e(a.headerNode,".dgrid-resize-handle:mousedown"+(h("touch")?",.dgrid-resize-handle:touchstart":
""),function(b){a._resizeMouseDown(b,this);a.mouseMoveListen.resume();a.mouseUpListen.resume()}),a._listeners.push(a.mouseMoveListen=e.pausable(document,"mousemove"+(h("touch")?",touchmove":""),v.throttleDelayed(function(b){a._updateResizerPosition(b)}))),a._listeners.push(a.mouseUpListen=e.pausable(document,"mouseup"+(h("touch")?",touchend":""),function(b){a._resizeMouseUp(b);a.mouseMoveListen.pause();a.mouseUpListen.pause()})),a.mouseMoveListen.pause(),a.mouseUpListen.pause())},_resizeMouseDown:function(a,
b){a.preventDefault();l.setSelectable(this.domNode,!1);this._startX=this._getResizeMouseLocation(a);this._targetCell=n(".dgrid-column-"+v.escapeCssIdentifier(b.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(a);c.show(this)},_resizeMouseUp:function(a){var b=this._columnSizes,d,e,f;this.adjustLastColumn&&(f=this.headerNode.clientWidth-1);this._resizedColumns||(d=n(".dgrid-cell",this.headerNode),this.columnSets&&this.columnSets.length?d=d.filter(function(a){return"0"==a.columnId.split("-")[0]&&
!(a.columnId in b)}):this.subRows&&1<this.subRows.length&&(d=d.filter(function(a){return"0"==a.columnId.charAt(0)&&!(a.columnId in b)})),e=d.map(function(a){return a.offsetWidth}),d.forEach(function(a,b){p(this,a.columnId,e[b],null,!1)},this),this._resizedColumns=!0);l.setSelectable(this.domNode,!0);d=this._targetCell;var h=this._getResizeMouseLocation(a)-this._startX,m=d.offsetWidth+h,k=this._getResizedColumnWidths(),q=k.totalWidth,k=k.lastColId,y=n(".dgrid-column-"+v.escapeCssIdentifier(k,"-"),
this.headerNode)[0].offsetWidth;m<this.minWidth&&(m=this.minWidth);p(this,d.columnId,m,a.type)&&d.columnId!=k&&this.adjustLastColumn&&(q+h<f?p(this,k,"auto",a.type):y-h<=this.minWidth&&p(this,k,this.minWidth,a.type));c.hide();delete this._startX;delete this._targetCell},_updateResizerPosition:function(a){if(this._targetCell){a=this._getResizeMouseLocation(a);var b=this._targetCell.offsetWidth,d=a;b+(a-this._startX)<this.minWidth&&(d=this._startX-(b-this.minWidth));c.move(d)}},_getResizeMouseLocation:function(a){var b=
0;a.pageX?b=a.pageX:a.clientX&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft);return b},_getResizedColumnWidths:function(){var a=0,b=n((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),c=b.length;if(!c)return{};for(var d=b[c-1].columnId;c--;)a+=b[c].offsetWidth;return{totalWidth:a,lastColId:d}}})})},"dgrid/extensions/ColumnReorder":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/on dojo/query dojo/dnd/Source put-selector/put xstyle/css!../css/extensions/ColumnReorder.css".split(" "),
function(k,e,n,t,l,m,h){function v(d,b){var c=b[2],a=d[c?"columnSets":"subRows"][b[1]];return c?a[b[2]]:a}function q(d,b,c){b[2]?d.columnSets[b[1]][b[2]]=c:d.subRows[b[1]]=c}function f(d,b){return b.slice(("dgrid-"+d+"-").length)}var p=/(\d+)(?:-(\d+))?$/;k=e(m,{copyState:function(){return!1},checkAcceptance:function(d,b){return d==this},_legalMouseDown:function(d){return-1<d.target.className.indexOf("dgrid-resize-handle")?!1:this.inherited(arguments)},onDropInternal:function(d){var b=this.grid,c=
p.exec(f(b.id,d[0].getAttribute("dndType"))),a=c[2]?"columnSets":"subRows",e=v(b,c),g=b.columns;this.inherited(arguments);c&&setTimeout(function(){var f=n.map(d[0].parentNode.childNodes,function(a){return g[a.columnId]});q(b,c,f);f={grid:b,subRow:f,column:g[d[0].columnId],bubbles:!0,cancelable:!0,parentType:"dnd"};f[a]=b[a];t.emit(b.domNode,"dgrid-columnreorder",f)?b.set(a,b[a]):(q(b,c,e),b.renderHeader(),this._sort&&this._sort.length&&this.updateSortArrow(this._sort))},0)}});e=e("dgrid.extensions.ColumnReorder",
null,{columnDndConstructor:k,_initSubRowDnd:function(d,b){var c,a,e,g;a=0;for(e=d.length;a<e;a++)g=d[a],!1!==g.reorderable&&(g=g.headerNode,"TH"!=g.tagName&&(g=g.parentNode),h(g,".dojoDndItem[dndType\x3d"+b+"]"),c||(c=g.parentNode));c&&this._columnDndSources.push(new this.columnDndConstructor(c,{horizontal:!0,grid:this}))},renderHeader:function(){var d="dgrid-"+this.id+"-",b,c;this.inherited(arguments);this._columnDndSources=[];if(this.columnSets)for(c=0,b=this.columnSets.length;c<b;c++)n.forEach(this.columnSets[c],
function(a,b){this._initSubRowDnd(a,d+c+"-"+b)},this);else n.forEach(this.subRows,function(a,b){this._initSubRowDnd(a,d+b)},this)},_destroyColumns:function(){this._columnDndSources&&n.forEach(this._columnDndSources,function(d){d.destroy()});this.inherited(arguments)}});e.ColumnDndSource=k;return e})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(k,e,n,t,l,m,h,v){n("dijit-legacy-requires")&&
l(0,function(){k(["dijit/ToolbarSeparator"])});return e("dijit.Toolbar",[m,v,h],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(k,e,n,t,l,m,h){k=k(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var e=n.map(this.geometries1,function(d){return d.toJson()}),k=n.map(this.geometries2,function(d){return d.toJson()}),f={},m=this.geometries1;m&&0<m.length&&(f.geometries1=t.toJson({geometryType:h.getJsonType(m[0]),geometries:e}),e=this.geometries1[0].spatialReference,f.sr=e.wkid?e.wkid:t.toJson(e.toJson()));(e=this.geometries2)&&0<e.length&&
(f.geometries2=t.toJson({geometryType:h.getJsonType(e[0]),geometries:k}));this.relation&&(f.relation=this.relation);this.relationParam&&(f.relationParam=this.relationParam);return f}});e.mixin(k,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",
SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});l("extend-esri")&&e.setObject("tasks.RelationParameters",k,m);return k})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query".split(" "),
function(k,e,n,t,l,m,h,v,q,f){function p(d){var b=e.clone(d.attributes);(d=d.geometry)&&"point"===d.type&&("x"in b?b._x=d.x:b.x=d.x,"y"in b?b._y=d.y:b.y=d.y);return b}k.exportCSV=function(d,b,c){return k._createCSVStr(b,c).then(function(a){return k._download(d+".csv",a)})};k.exportCSVFromFeatureLayer=function(d,b,c){c=c||{};return k._getExportData(b,{datas:c.datas,fromClient:c.fromClient,withGeometry:c.withGeometry,outFields:c.outFields,filterExpression:c.filterExpression}).then(function(a){return k._formattedData(b,
a,{formatNumber:c.formatNumber,formatDate:c.formatDate,formatCodedValue:c.formatCodedValue,popupInfo:c.popupInfo}).then(function(a){return k.exportCSV(d,a.datas,a.columns)})})};k.exportCSVByAttributes=function(d,b,c,a){a=e.mixin({},a);a.datas=c;return k.exportCSVFromFeatureLayer(d,b,a)};k.exportCSVByGraphics=function(d,b,c,a){c=n.map(c,function(a){return a.attributes});return k.exportCSVByAttributes(d,b,c,a)};k._createCSVStr=function(d,b){var c=new m,a="",e=0,g=0,f="",h="";try{n.forEach(b,function(b){a=
a+f+b;f=","});for(var a=a+"\r\n",e=d.length,g=b.length,k=0;k<e;k++){for(var f="",l=0;l<g;l++)(h=d[k][b[l]])||"number"===typeof h||(h=""),h&&/[",\r\n]/g.test(h)&&(h='"'+h.replace(/(")/g,'""')+'"'),a=a+f+h,f=",";a+="\r\n"}c.resolve(a)}catch(B){console.error(B),c.resolve("")}return c};k._isIE11=function(){return 11===h.has("ie")};k._isEdge=function(){return h.has("edge")};k._getDownloadUrl=function(d){return window.Blob&&window.URL&&window.URL.createObjectURL?(d=new Blob(["\ufeff"+d],{type:"text/csv"}),
URL.createObjectURL(d)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(d)};k._download=function(d,b){var c=new m;try{if(l("ie")&&10>l("ie")){var a=window.top.open("about:blank","_blank");a.document.write("sep\x3d,\r\n"+b);a.document.close();a.document.execCommand("SaveAs",!0,d);a.close()}else if(10===l("ie")||k._isIE11()||k._isEdge()){var e=new Blob(["\ufeff"+b],{type:"text/csv"});navigator.msSaveBlob(e,d)}else{var g=t.create("a",{href:k._getDownloadUrl(b),target:"_blank",download:d},
document.body);if(l("safari")){var f=document.createEvent("MouseEvents");f.initEvent("click",!0,!0);g.dispatchEvent(f)}else g.click();t.destroy(g)}c.resolve()}catch(w){c.reject(w)}return c};k._getExportData=function(d,b){var c=new m,a=null,f=b.datas,g=b.withGeometry,a=b.outFields;a&&a.length||(a=d.fields);a=e.clone(a);if(g&&!(f&&0<f.length)){var h="",h=-1!==a.indexOf("x")?"_x":"x";a.push({name:h,alias:h,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});h=-1!==a.indexOf("y")?
"_y":"y";a.push({name:h,alias:h,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}f&&0<f.length?c.resolve({data:f||[],outFields:a}):b.fromClient?(f=n.map(d.graphics,function(a){return g?p(a):e.clone(a)}),c.resolve({data:f||[],outFields:a})):k._getExportDataFromServer(d,a,b).then(function(b){c.resolve({data:b||[],outFields:a})});return c};k._getExportDataFromServer=function(d,b,c){var a=new m;if("esri.layers.FeatureLayer"!==d.declaredClass)return a.resolve([]),a;var e=new q(d.url),
g=new f;g.where=c.filterExpression||d.getDefinitionExpression&&d.getDefinitionExpression()||"1\x3d1";0<b.length?(d=n.map(b,function(a){return a.name}),g.outFields=d):g.outFields=["*"];g.returnGeometry=c.withGeometry;e.execute(g,function(b){b=n.map(b.features,function(a){return p(a)});a.resolve(b)},function(b){console.error(b);a.resolve([])});return a};k._formattedData=function(d,b,c){var a=new m,e=[],g=b.data;b=b.outFields;for(var f=0,h=g.length;f<h;f++){for(var l={},q=0;q<b.length;q++){var p=b[q];
l[p.alias||p.name]=k._getExportValue(g[f][p.name],p,d.objectIdField,d.typeIdField,g[f][d.typeIdField],d.types,c)}e.push(l)}d=n.map(b,function(a){return a.alias||a.name});a.resolve({datas:e,columns:d});return a};k._getExportValue=function(d,b,c,a,e,g,f){function k(a){if(m&&v.isDefined(m.fieldInfos))for(var b=0,c=m.fieldInfos.length;b<c;b++){var d=m.fieldInfos[b];if(d.fieldName===a)return d.format}return null}var m=f.popupInfo,l=!!b.domain&&f.formatCodedValue;f="esriFieldTypeDate"===b.type&&f.formatDate;
var q=c&&b.name===c;a=a&&b.name===a;return f?h.fieldFormatter.getFormattedDate(d,k(b.name)):a?h.fieldFormatter.getTypeName(d,g):l?h.fieldFormatter.getCodedValue(b.domain,d):l||f||q||a?d:(l=null,c&&g&&0<g.length&&(c=(c=n.filter(g,function(a){return a.id===e}))&&c[0])&&c.domains&&c.domains[b.name]&&c.domains[b.name].codedValues&&(l=h.fieldFormatter.getCodedValue(c.domains[b.name],d)),null!==l?l:d)}})},"widgets/AttributeTable/utils":function(){define("dojo/_base/lang dojo/_base/array jimu/LayerInfos/LayerInfos dojo/Deferred dojo/promise/all exports dojo/store/Observable dojo/store/Cache dojo/store/Memory esri/lang ./table/FeatureLayerQueryStore jimu/utils".split(" "),
function(k,e,n,t,l,m,h,v,q,f,p,d){function b(b,a){if(!b||!b.length)return a||[];if(!a||!a.length)return b;for(var c=[],d=0,e=b.length;d<e;d++)for(var f=b[d],h=0,k=a.length;h<k;h++)if(a[h].name===f.name){c.push(f);break}return c}m.readLayerInfosObj=function(b){return n.getInstance(b,b.itemInfo)};m.readLayerInfosFromMap=function(b,a,d){var c=new t;n.getInstance(b,b.itemInfo).then(k.hitch(this,function(b){var g=[];a?b.traversalLayerInfosOfWebmap(function(a){g.push(a)}):b.traversal(function(a){g.push(a)});
if(d){var f=[],h=b.getMapNotesLayerInfoArray();e.forEach(h,function(a){f.push(a.id);a.traversal(function(a){f.push(a.id)})});g=e.filter(g,function(a){return-1===f.indexOf(a.id)})}b=b.getTableInfoArray();g=g.concat(b);c.resolve(g)}),k.hitch(this,function(a){console.error(a);c.reject(a)}));return c.promise};m.generateColumnsFromFields=function(b,a,d,g,h,l){function c(a){if(b&&f.isDefined(b.fieldInfos))for(var c=0,d=b.fieldInfos.length;c<d;c++){var e=b.fieldInfos[c];if(e.fieldName===a)return e.format}return null}
var q={selectionHandle:{label:"",className:"selection-handle-column",hidden:!1,unhidable:!0,filed:"selection-handle-column",sortable:!1,_cache:{sortable:!1,statistics:!1}}};e.forEach(a,k.hitch(m,function(a,b,y){b="field"+b;var n=!!a.domain,p="esriFieldTypeDate"===a.type,t=d&&a.name===d,u="esriFieldTypeDouble"===a.type||"esriFieldTypeSingle"===a.type||"esriFieldTypeInteger"===a.type||"esriFieldTypeSmallInteger"===a.type,v="esriFieldTypeString"===a.type;q[b]={label:a.alias||a.name,className:b,hidden:1===
y.length?!1:!a.show&&f.isDefined(a.show),unhidable:1===y.length?!1:!a.show&&f.isDefined(a.show)&&a._pk,field:a.name,sortable:!1,_cache:{sortable:!!h,statistics:l&&!n&&u}};v?q[b].formatter=k.hitch(m,m.urlFormatter):p?q[b].formatter=k.hitch(m,m.dateFormatter,c(a.name)):u&&(q[b].formatter=k.hitch(m,m.numberFormatter,c(a.name)));n?q[b].get=k.hitch(m,function(a,b){return this.getCodeValue(a.domain,b[a.name])},a):t?q[b].get=k.hitch(m,function(a,b,c){return this.getTypeName(c[a.name],b)},a,g):n||p||t||(q[b].get=
k.hitch(m,function(a,b,c,d){var g=null;b&&c&&0<c.length&&(c=(c=e.filter(c,k.hitch(m,function(a){return a.name===d[b]})))&&c[0]||null)&&c.domains&&c.domains[a.name]&&c.domains[a.name].codedValues&&(g=this.getCodeValue(c.domains[a.name],d[a.name]));return(a=null!==g?g:d[a.name])||isFinite(a)?a:""},a,d,g))}));return q};m.getTypeName=function(b,a){return d.fieldFormatter.getTypeName(b,a)};m.getCodeValue=function(b,a){return d.fieldFormatter.getCodedValue(b,a)};m.urlFormatter=function(b){return d.fieldFormatter.getFormattedUrl(b)};
m.dateFormatter=function(b,a){return d.fieldFormatter.getFormattedDate(a,b)};m.numberFormatter=function(b,a){return d.fieldFormatter.getFormattedNumber(a,b)};m.readLayerObjectsFromMap=function(b,a,d){var c=new t,f=[];this.readLayerInfosFromMap(b,a,d).then(k.hitch(this,function(a){e.forEach(a,k.hitch(this,function(a){f.push(a.getLayerObject())}));l(f).then(k.hitch(this,function(a){c.resolve(a)}),k.hitch(this,function(a){c.reject(a);console.error(a)}))}),k.hitch(this,function(a){c.reject(a)}));return c.promise};
m.readSupportTableInfoFromLayerInfos=function(b){var a=new t,c=[];e.forEach(b,k.hitch(this,function(a){c.push(a.getSupportTableInfo())}));l(c).then(k.hitch(this,function(c){c=k.clone(c);e.forEach(c,function(a,c){a.id=b[c].id});a.resolve(c)}),function(b){a.reject(b)});return a.promise};m.readConfigLayerInfosFromMap=function(b,a,d){var c=new t,f=[];this.readLayerInfosFromMap(b,a,d).then(k.hitch(this,function(a){var b=[];e.forEach(a,function(a){f.push(a.getSupportTableInfo())});l(f).then(k.hitch(this,
function(d){e.forEach(d,k.hitch(this,function(c,d){c.isSupportedLayer&&(a[d].name=a[d].title,b.push(a[d]))}));c.resolve(b)}),k.hitch(this,function(a){c.reject(a)}))}),k.hitch(this,function(a){c.reject(a)}));return c.promise};m.getConfigInfosFromLayerInfos=function(b){return e.map(b,function(a){return m.getConfigInfoFromLayerInfo(a)})};m.getConfigInfoFromLayerInfo=function(c){var a={};a.name=c.name||c.title;a.id=c.id;a.show=c.isShowInMap();a.layer={url:c.getUrl()};var d=c.getPopupInfo();d&&!d.description&&
(a.layer.fields=e.map(d.fieldInfos,function(a){return{name:a.fieldName,alias:a.label,show:a.visible,format:a.format}}),c=k.getObject("layerObject.fields",!1,c),a.layer.fields=b(a.layer.fields,c),e.some(a.layer.fields,function(a){return a.show})||(a.layer.fields&&0<a.layer.fields.length?a.layer.fields[0].show=!0:console.warn("We do not get fields info.")));return a};m.generateCacheStore=function(b,a,d,e,f){b=new p({layer:b,objectIds:b._objectIds||null,totalCount:a,batchCount:d,where:e||"1\x3d1",spatialFilter:f});
a=new q;return new v(b,a,{})};m.generateMemoryStore=function(b,a){return new h(new q({data:b||[],idProperty:a}))};m.merge=function(b,a,d,f){for(var c=e.map(a,function(a){return a[d]}),g=0,h=b.length;g<h;g++){var k=c.indexOf(b[g][d]);-1<k&&f(b[g],a[k])}};m.syncOrderWith=function(b,a,d){function c(a,b){return e.map(a,function(a){return a[b]})}if(!k.isArray(a)||!d)return b;for(var f=c(b,d),h=[],l=0,m=a.length;l<m;l++){var q=f.indexOf(a[l][d]);-1<q&&(h=h.concat(b.splice(q,1)),f=c(b,d))}return h.concat(b)}})},
"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(k,e,n,t){k=function(l){function k(e,d){var b=l[e];b&&(l[e]=function(c){var a;"put"===e&&(a=l.getIdentity(c));if(f)return b.apply(this,arguments);f=!0;try{var h=b.apply(this,arguments);n(h,function(b){d("object"==typeof b&&b||c,a)});return h}finally{f=!1}})}var h=[],v=0;l=e.delegate(l);l.notify=function(e,d){v++;for(var b=h.slice(),c=0,a=b.length;c<a;c++)b[c](e,d)};var q=l.query;l.query=
function(f,d){d=d||{};var b=q.apply(this,arguments);if(b&&b.forEach){var c=e.mixin({},d);delete c.start;delete c.count;var a=l.queryEngine&&l.queryEngine(f,c),k=v,g=[],m;b.observe=function(c,e){1==g.push(c)&&h.push(m=function(c,f){n(b,function(b){var h=b.length!=d.count,y,m;if(++k!=v)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var q,n=-1,p=-1;if(void 0!==f){var u=[].concat(b);a&&!c&&(u=a(b));y=0;for(m=b.length;y<m;y++){var w=b[y];if(l.getIdentity(w)==
f&&!(0>u.indexOf(w))){q=w;n=y;!a&&c||b.splice(y,1);break}}}a?c&&(a.matches?a.matches(c):a([c]).length)&&(y=-1<n?n:b.length,b.splice(y,0,c),p=t.indexOf(a(b),c),b.splice(y,1),d.start&&0==p||!h&&p==b.length?p=-1:b.splice(p,0,c)):c&&(void 0!==f?p=n:d.start||(p=l.defaultIndex||0,b.splice(p,0,c)));if((-1<n||-1<p)&&(e||!a||n!=p))for(h=g.slice(),y=0;b=h[y];y++)b(c||q,n,p)})});var f={};f.remove=f.cancel=function(){var a=t.indexOf(g,c);-1<a&&(g.splice(a,1),g.length||h.splice(t.indexOf(h,m),1))};return f}}return b};
var f;k("put",function(e,d){l.notify(e,d)});k("add",function(e){l.notify(e)});k("remove",function(e){l.notify(void 0,e)});return l};e.setObject("dojo.store.Observable",k);return k})},"dojo/store/Cache":function(){define(["../_base/lang","../when"],function(k,e){var n=function(n,l,m){m=m||{};return k.delegate(n,{query:function(e,k){var h=n.query(e,k);h.forEach(function(e){m.isLoaded&&!m.isLoaded(e)||l.put(e)});return h},queryEngine:n.queryEngine||l.queryEngine,get:function(h,k){return e(l.get(h),function(m){return m||
e(n.get(h,k),function(e){e&&l.put(e,{id:h});return e})})},add:function(h,k){return e(n.add(h,k),function(e){l.add(e&&"object"==typeof e?e:h,k);return e})},put:function(h,k){l.remove(k&&k.id||this.getIdentity(h));return e(n.put(h,k),function(e){l.put(e&&"object"==typeof e?e:h,k);return e})},remove:function(h,k){return e(n.remove(h,k),function(e){return l.remove(h,k)})},evict:function(e){return l.remove(e)}})};k.setObject("dojo.store.Cache",n);return n})},"widgets/AttributeTable/table/FeatureLayerQueryStore":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),
function(k,e,n,t,l,m){return k(null,{queryUrl:"",idProperty:"id",data:null,_entityData:null,constructor:function(e){k.safeMixin(this,e);this.data=[];this._entityData=[];this.layer=e.layer;this.objectIds=e.objectIds;this.where=e.where;this.orderByFields=e.orderByFields;this.totalCount=e.totalCount;this.batchCount=e.batchCount||25;this.idProperty=this.layer.objectIdField;this.spatialFilter=e.spatialFilter;this.layer&&this.layer.url&&(this.queryTask=new l(this.layer.url))},get:function(e){return this.data[e]},
getIdentity:function(e){return e[this.idProperty]},query:function(h,k){var l=new t,f=k&&k.start||0,p=this.batchCount,d=null;"function"===typeof h?d=h(this._entityData):"[object Array]"===Object.prototype.toString.call(h)&&(d=h);this.objectIds?(d=d?d:this.objectIds,l.objectIds=d.length>=f+this.batchCount?d.slice(f,f+p):d.slice(f)):(d&&0<d.length?l.objectIds=d.length>=f+this.batchCount?d.slice(f,f+p):d.slice(f):(l.start=f,l.num=p,l.where=this.where,l.geometry=this.spatialFilter,l.spatialRelationship=
t.SPATIAL_REL_INTERSECTS),(f=k.sort)&&0<f.length&&(f=n.map(f,function(b){return b.attribute+" "+(b.descending?"DESC":"ASC")}),l.orderByFields=f));l.returnGeometry="esriGeometryPoint"===this.layer.geometryType;l.outFields=["*"];var b=this.totalCount,f=null,f=!l.where;if(!(l.objectIds&&0<l.objectIds.length)&&f)return new m([]);f=this.queryTask?this.queryTask.execute(l):this.layer.queryFeatures(l);f.total=f.then(e.hitch(this,function(c){var a=0,d=this.layer.objectIdField;if(this.objectIds){if(!d)for(a=
0;a<c.fields.length;a++)if("esriFieldTypeOID"===c.fields[a].type){d=c.fields[a].name;break}for(var f={},a=0;a<c.features.length;a++)f[c.features[a].attributes[d]]=c.features[a];c.features=n.map(l.objectIds,function(a){return f[a]})}for(a=0;a<c.features.length;a++)if(c.features[a]){var h=c.features[a];c.features[a]=e.mixin(e.clone(h.attributes),{geometry:h.geometry});this.data[c.features[a][d]]=c.features[a];this._entityData.push(c.features[a])}c=c.features;return b}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");
return 0});return new m(f)}})})},"widgets/AttributeTable/table/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array".split(" "),function(k,e,n,t){var l=function(m){function h(e){m[e]||(m[e]=function(){var h=arguments;return t.when(m,function(f){Array.prototype.unshift.call(h,f.features||f);return l(n[e].apply(n,h))})})}if(!m)return m;m.then&&(m=e.delegate(m));m.total||(m.total=t.when(m,function(e){return k._isDefined(e.total)?
e.total:e.length||0}));h("forEach");h("filter");h("map");h("some");h("every");return m};return l})},"widgets/AttributeTable/_build-generate_module":function(){define(["dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:dijit/layout/templates/TabContainer.html":'\x3cdiv class\x3d"dijitTabContainer"\x3e\r\n\t\x3cdiv class\x3d"dijitTabListWrapper" data-dojo-attach-point\x3d"tablistNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"tablistSpacer" class\x3d"dijitTabSpacer ${baseClass}-spacer"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTabPaneWrapper ${baseClass}-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/_TabButton.html":'\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"titleNode,innerDiv,tabContent" class\x3d"dijitTabInner dijitTabContent"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTabButtonIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d\'containerNode,focusNode\' class\x3d\'tabLabel\'\x3e\x3c/span\x3e\r\n\t\x3cspan class\x3d"dijitInline dijitTabCloseButton dijitTabCloseIcon" data-dojo-attach-point\x3d\'closeNode\'\r\n\t\t  role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d\'closeText\' class\x3d\'dijitTabCloseText\'\x3e[x]\x3c/span\r\n\t\t\t\t\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/ScrollingTabController.html":'\x3cdiv class\x3d"dijitTabListContainer-${tabPosition}" style\x3d"visibility:hidden"\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerMenuButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_menuBtn"\r\n\t\t data-dojo-props\x3d"containerId: \'${containerId}\', iconClass: \'dijitTabStripMenuIcon\',\r\n\t\t\t\t\tdropDownPosition: [\'below-alt\', \'above-alt\']"\r\n\t\t data-dojo-attach-point\x3d"_menuBtn" showLabel\x3d"false" title\x3d""\x3e\x26#9660;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_leftBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideLeftIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_leftBtn" data-dojo-attach-event\x3d"onClick: doSlideLeft"\x3e\x26#9664;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_rightBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideRightIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_rightBtn" data-dojo-attach-event\x3d"onClick: doSlideRight"\x3e\x26#9654;\x3c/div\x3e\r\n\t\x3cdiv class\x3d\'dijitTabListWrapper\' data-dojo-attach-point\x3d\'tablistWrapper\'\x3e\r\n\t\t\x3cdiv role\x3d\'tablist\' data-dojo-attach-event\x3d\'onkeydown:onkeydown\'\r\n\t\t\t data-dojo-attach-point\x3d\'containerNode\' class\x3d\'nowrapTabStrip\'\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/layout/templates/_ScrollingTabControllerButton.html":'\x3cdiv data-dojo-attach-event\x3d"ondijitclick:_onClick" class\x3d"dijitTabInnerDiv dijitTabContent dijitButtonContents"  data-dojo-attach-point\x3d"focusNode" role\x3d"button"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitTabStripIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d"containerNode,titleNode" class\x3d"dijitButtonText"\x3e\x3c/span\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/Filter.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"contentSection" class\x3d"content-section"\x3e\r\n\t\t\x3cdiv class\x3d"add-btn-section"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnAddExp" data-dojo-attach-event\x3d"click:_onBtnAddExpClick"\r\n\t\t\t class\x3d"add-with-icon jimu-state-disabled add-expression jimu-float-leading"\x3e\r\n\t\t\t\t\x3cspan data-dojo-attach-point\x3d"iconAddExp" class\x3d"jimu-icon jimu-icon-add jimu-state-disabled"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addAnotherExpression}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnAddSet" data-dojo-attach-event\x3d"click:_onBtnAddSetClick"\r\n\t\t\t class\x3d"add-with-icon jimu-state-disabled add-set jimu-float-leading"\x3e\r\n\t\t\t\t\x3cspan data-dojo-attach-point\x3d"iconAddSet" class\x3d"jimu-icon jimu-icon-add jimu-state-disabled"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addSet}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"matchMsg" style\x3d"margin-top:11px;margin-bottom:11px;display:none;"\x3e\r\n\t\t\t\x3cspan\x3e${nls.strMatchMsgPart1}\x3c/span\x3e\r\n\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.all}\x3c/option\x3e\r\n\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.any}\x3c/option\x3e\r\n\t\t\t\x3c/select\x3e\r\n\t\t\t\x3cspan\x3e${nls.strMatchMsgPart2}\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\t\x3cdiv class\x3d"allExpsBox" data-dojo-attach-point\x3d"allExpsBox"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"errorSection" style\x3d"display:none;"\x3e\r\n\t\t\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"errorTip" class\x3d"error-tip"\x3e\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"noFilterTipSection" class\x3d"no-filter-tip" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:jimu/dijit/_filter/TwoNumbersValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"numberRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d\'"required":false,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d\'"required":false,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoDatesValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"dateRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-attach-event\x3d"change:_onRangeDateBlur" data-dojo-props\x3d\'value:new Date(),required:false,trim:true\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-attach-event\x3d"change:_onRangeDateBlur" data-dojo-props\x3d\'value:new Date(),required:false,trim:true\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/ListValueProvider.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"valuesSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"label",required:false,intermediateChanges:true\' style\x3d"width:100%;" data-dojo-attach-event\x3d"input:_onFilteringSelectInput"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/_SingleFilter.html":'\x3cdiv\x3e\r\n\t\x3ctable class\x3d"setting-table" cellpadding\x3d"0" cellspacing\x3d"0" cellpadding\x3d"10px" style\x3d"table-layout:fixed;"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd class\x3d"fields-td" nowrap\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fieldsSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"displayName",required:true,intermediateChanges:true\' class\x3d"dijit-form-FilteringSelect" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"operators-td" nowrap\x3e\r\n\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"operatorsSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"value-td" nowrap data-dojo-attach-point\x3d"valueTd"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"attributeValueContainer" class\x3d"value-container"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"radio-table-container"\x3e\r\n\t\t\t\t\t\t\t\x3ctable class\x3d"radio-table" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\t\t\t\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"valueRadio" checked\x3d"true" disabled  title\x3d"${nls.valueTooltip}" /\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3clabel data-dojo-attach-point\x3d"valueLabel" title\x3d"${nls.valueTooltip}"\x3e${nls.value}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"fieldRadio" disabled title\x3d"${nls.fieldTooltip}" /\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3clabel data-dojo-attach-point\x3d"fieldLabel" title\x3d"${nls.fieldTooltip}"\x3e${nls.field}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctd data-dojo-attach-point\x3d"uniqueTd"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"uniqueRadio" disabled title\x3d"${nls.uniqueValueTooltip}" /\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3clabel data-dojo-attach-point\x3d"uniqueLabel" title\x3d"${nls.uniqueValueTooltip}"\x3e${nls.unique}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\x3c/tbody\x3e\r\n\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"delete-td" nowrap\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"jimu-icon jimu-icon-delete" data-dojo-attach-point\x3d"btnDelete"\r\n\t\t\t\t\t data-dojo-attach-event\x3d"click:_destroySelf"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"askvalues"\x3e\r\n\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxAskValues" label\x3d"${nls.askForValues}" class\x3d"jimu-trailing-margin6"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxCaseSensitive" label\x3d"${nls.caseSensitive}" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"promptSection" class\x3d"prompt"\x3e\r\n\t\t\x3ctable data-dojo-attach-point\x3d"promptTable" cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"prompt-table" style\x3d"width:100%;"\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"first-td"\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.prompt}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"second-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"promptTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"first-td"\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.hint}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"second-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"hintTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"cascadeTr" class\x3d"cascade-tr"\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"first-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv style\x3d"margin-bottom:5px;"\x3e${nls.listValues}:\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"second-td"\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"cascadeSelect" class\x3d"cascade-select restrict-select-width" style\x3d"width:100%;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"none"\x3e${nls.noneCascadeFilterTip}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"previous"\x3e${nls.previousCascadeFilterTip}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"all"\x3e${nls.allCascadeFilterTip}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_FilterSet.html":'\x3cdiv\x3e\r\n\t\x3ctable class\x3d"header-table" cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.strMatchMsgPart1}\x3c/span\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.all}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.any}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.strMatchMsgPart2}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:15px;padding-right:10px;"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnDelete" data-dojo-attach-event\x3d"onclick:_destroySelf"\r\n\t\t\t\t\t class\x3d"jimu-icon jimu-icon-delete"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:15px;padding-right:14px;"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnAdd" class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"allExpsBox"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/AttributeTable/css/style.css":'.jimu-widget-attributetable-main .tabStripButton{height: 24px !important;}.jimu-widget-attributetable,.jimu-widget-attributetable-main{left: 0px; bottom: 0px; background-color: #efefef;}.jimu-widget-attributetable{height: auto;}.jimu-widget-attributetable-main{overflow: hidden; width: 100%; height: 100%;}.jimu-widget-attributetable .jimu-widget-attributetable-main .dijitToolbar {position: relative;}.jimu-widget-attributetable-move{width: 100%; height: 7px; top: 0px; background-color: rgba(0, 0, 0, 0.7);}.jimu-widget-attributetable-move:hover{cursor: n-resize;}.jimu-widget-attributetable-move:hover .jimu-widget-attributetable-thumb{background-color: #fff;}.jimu-widget-attributetable .draging{background-color: gray;}.jimu-widget-attributetable-thumb{background: #B0B0B0 none; height: 1px; width: 19px; margin: 3px auto; position: absolute; left: 0; right: 0;}.jimu-widget-attributetable-indicate-vertical{width: 2px; height: 100%; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-indicate-horizontal{width: 100%; height: 2px; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-switch{width: 63px; height: 17px; left: 0; right: 0; top: -17px; margin: auto; position: absolute; cursor: pointer; border-radius: 8px 8px 0 0; background-position: center; background-repeat: no-repeat; background-color: rgba(0,0,0,0.7); border: 2px solid rgba(255,255,255,0.8); border-bottom-style: none;}.jimu-widget-attributetable-switch.open{background-image: url(images/arrow_down.svg); border-bottom-left-radius: 0; border-bottom-right-radius: 0;}.jimu-widget-attributetable-switch.open:hover{background-image: url(images/arrow_down_hover.svg);}.jimu-widget-attributetable-switch.close{background-image: url(images/arrow_up.svg)}.jimu-widget-attributetable-switch.close:hover{background-image: url(images/arrow_up_hover.svg);}.jimu-widget-attributetable-arrowImage{width: 30px; height: 30px; left: 48%; top: -30px; position: absolute; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; background-position: center center; background-repeat: no-repeat; cursor: ns-resize; background-color: rgba(0, 0, 0, 0.8);}.dijitTabPaneWrapper .dijitTabContainerTop-container .dijitAlignCenter{height: 100%;}.jimu-widget-attributetable .dijitTabContainerTopChildWrapper,.jimu-widget-attributetable .dijitTabContainerTopChildWrapper .dijitContentPane{height: 100% !important; width: 100% !important; padding: 0;}.jimu-widget-attributetable .dijitToggleButton.dijitToggleButtonChecked .dijitButtonText{color: #518dca;}.jimu-widget-attributetable .esriAttributeTable{width: 100%; height: 100%; position: relative;}.jimu-widget-attributetable .dgrid-header .dgrid-column-selectionHandle.selection-handle-column div.dgrid-resize-header-container{display: none;}.jimu-widget-attributetable .dgrid-column-selectionHandle.selection-handle-column{width: 20px !important; background-color: #eee; padding: 0 !important; border-bottom: 1px solid #ccc !important; cursor: pointer;}.dojoDndSource.dojoDndTarget.dojoDndHorizontal.dojoDndContainer .dgrid-column-selectionHandle.selection-handle-column{pointer-events: none;}.jimu-widget-attributetable .dgrid-cell {border-right: solid 1px #ccc; width: 100px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table.auto-width .dgrid-cell{width: auto;}.jimu-widget-attributetable .dgrid-row .dgrid-cell {border:medium none; padding: 7px 3px; border-right: 1px solid #CCCCCC;}.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {right: 0; left: 17px;}.jimu-rtl .jimu-widget-attributetable .dgrid-cell {text-align: right; border-left: solid 1px #ccc;}.jimu-widget-attributetable .dgrid-header {overflow: hidden; background-color: #eee;}.jimu-widget-attributetable .dgrid-cell a{color: #21759B; text-decoration: none;}.jimu-widget-attributetable .dgrid-cell a:hover, a:active{text-decoration: underline;}.jimu-widget-attributetable .dgrid-row {border: medium none;}.jimu-widget-attributetable .dgrid-row:hover {background-color:#E1F0FB;}.jimu-widget-attributetable .dgrid-row-even{background-color: #FFF;}.jimu-widget-attributetable .dgrid-row-odd {background-color: #F7F8F8;}.jimu-widget-attributetable .ui-state-active {background-color: rgb(0, 255, 255) !important;}.jimu-widget-attributetable .dgrid-status {white-space: pre;}.jimu-widget-attributetable .self-footer {display: inline-block;}.jimu-rtl .dgrid-hider-menu-check{right: 2px; left: auto;}.jimu-rtl .dgrid-hider-menu-label {padding-left: 0; padding-right: 20px;}.jimu-rtl .jimu-widget-attributetable .dgrid-pagination .dgrid-status{float: right !important;}.jimu-rtl .dgrid-pagination .dgrid-navigation,.jimu-rtl .dgrid-pagination .dgrid-page-size{float: left !important;}.esriAttributeTableExportImage{background-image: url("../images/export.png"); width: 13px; height: 13px;}.esriAttributeTableZoomImage{background-image: url("../images/zoom.png"); width: 13px; height: 13px;}.esriAttributeTableSelectAllImage{background-image: url("../images/select.png"); width: 13px; height: 13px;}.esriAttributeTableFilterImage{background-image: url("../images/filter.png"); width: 13px; height: 13px;}.esriAttributeTableSelectPageImage{background-image: url("../images/page.png"); width: 13px; height: 13px;}.esriAttributeTableClearImage{background-image: url("../images/clear.png"); width: 13px; height: 13px;}.esriAttributeTableOptionsImage{background-image: url("../images/more.png"); width: 13px; height: 13px;}.esriAttributeTableRefreshImage{background-image: url("../images/refresh.png"); width: 13px; height: 13px;}.esriAttributeTableSymbolImage{background-image: url("../images/symbol.png"); width: 13px; height: 13px;}.esriAttributeTableCloseImage{background-image: url("../images/close.png"); width: 13px; height: 13px; position: absolute; right: 0; top: -13px;}.esriAttributeTableColumnsImage{background-image: url("../images/columns.png"); width: 13px; height: 13px;}.jimu-rtl .jimu-widget-attributetable .close-button {right: auto; left: 0;}.jimu-widget-attributetable .jimu-loading-indicator {z-index: 100;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table{height: 100%; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column{overflow: visible; text-align: center;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos{text-align: center; display: inline-block; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div{display: inline-block; color: #24B5CC; cursor: pointer; padding: 2px 10px; height: 20px; border-radius: 10px; line-height: 16px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments:hover,.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments.selected{background: #24B5CC; color: white;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{display: none; position: absolute; background: #FFFFFF; box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.50); border-radius: 2px; width: 240px; left: -245px; top: 4px; text-align: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{left: auto; right: -245px; text-align: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup.show{display: block;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{background: none; padding-left: 10px; font-size: 14px; color: #000000; font-weight: bold; line-height: 36px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{padding-left: 0; padding-right: 10px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header:hover{background: #fff;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header .close {display: inline-block; width: 36px; height: 36px; background: url(\'../images/close.png\') center no-repeat; cursor: pointer;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{box-sizing: border-box; width: 100%; max-height: 160px; list-style-type: none; margin: 0; padding: 0; overflow-x: hidden; overflow-y: auto; padding-left: 20px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{padding-left: 0; padding-right: 20px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li {vertical-align: middle; background-image: url(\'./images/file.png\'); background-repeat: no-repeat; padding-left: 30px; background-size: 20px; background-position: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li{padding-left: 0; padding-right: 30px; background-position: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li.image-type{background-image: url(\'./images/image.png\');}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a{display: inline-block; width: 176px; height: 36px; line-height: 36px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a:hover{cursor: pointer;}.jimu-widget-attributetable-feature-menu .menuItemClass{cursor: pointer;}.jimu-widget-attributetable-feature-menu.dijitMenu{background-color: #fff !important;}.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected td,.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected{background-color: #f1f1f1 !important; color: #000!important;}.jimu-widget-attributetable-feature-table-footer {position: absolute; bottom: 0; background: white; width: 100%;}',
"*now":function(k){k(['dojo/i18n!*preload*widgets/AttributeTable/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/html dijit/_WidgetsInTemplateMixin jimu/BaseWidget dijit/layout/TabContainer dijit/layout/ContentPane jimu/utils jimu/dijit/Message dojo/Deferred dojo/promise/all esri/layers/FeatureLayer esri/lang dojo/_base/lang dojo/on dojo/touch dojo/topic dojo/aspect dojo/_base/array dojo/query jimu/dijit/LoadingIndicator jimu/FilterManager ./_ResourceManager ./utils".split(" "),function(k,e,n,t,l,m,h,v,q,f,p,d,b,c,a,x,g,u,w,D,J,B,F){k=k([t,n],{name:"AttributeTable",baseClass:"jimu-widget-attributetable",
normalHeight:0,openHeight:0,arrowDivHeight:null,_relatedDef:null,_resourceManager:null,_activeLayerInfoId:null,_layerTypes:{FEATURELAYER:"FeatureLayerTable",RELATIONSHIPTABLE:"RelationshipTable"},postMixInProperties:function(){this.nls.features=this.nls.features||"features"},postCreate:function(){this.inherited(arguments);h.loadStyleLink("dgrid",apiUrl+"dgrid/css/dgrid.css");this.AttributeTableDiv=this._loadInfoDef=null;this._delayedLayerInfos=[];this.layerTabPages=[];this.tabContainer=null;this.moveMode=
!1;this.bottomPosition=this.noGridHeight=this.previousDomHeight=this.moveY=0;this.layerTabPagesIndex=-1;this.showing=!1;this.openHeight=this.normalHeight=this._getNormalHeight();this.arrowDivHeight=0;this._dragingHandlers=[];this._activeTable=null;this._activeTableHandles=[];this.filterManager=J.getInstance();this._createUtilitiesUI();this._resourceManager=new B({map:this.map,nls:this.nls});this._resourceManager.setConfig(this.config);this.own(x.subscribe("changeMapPosition",b.hitch(this,this._onMapPositionChange)));
F.readLayerInfosObj(this.map).then(b.hitch(this,function(a){this.domNode&&a&&(this.own(c(a,"layerInfosIsShowInMapChanged",b.hitch(this,this.onLayerInfosIsShowInMapChanged))),this.own(a.on("layerInfosChanged",b.hitch(this,this.onLayerInfosChanged))),this.own(a.on("layerInfosFilterChanged",b.hitch(this,this.onLayerInfosFilterChanged))))}))},_createUtilitiesUI:function(){this._createSwitchUI();this._createBarUI()},_createBarUI:function(){this.arrowDiv=e.create("div");e.addClass(this.arrowDiv,"jimu-widget-attributetable-move");
e.create("div",{"class":"jimu-widget-attributetable-thumb"},this.arrowDiv);e.place(this.arrowDiv,this.domNode);if(!this.arrowDivHeight){var d=e.getMarginBox(this.arrowDiv);this.arrowDivHeight=d&&d.h?d.h:7}this.own(c(this.arrowDiv,"mousedown",b.hitch(this,this._onDragStart)));this.own(c(this.arrowDiv,a.press,b.hitch(this,this._onDragStart)))},_isOnlyTable:function(){return this.closeable||!this.isOnScreen},_createSwitchUI:function(){this._isOnlyTable()||(this.switchBtn=e.create("div",{className:"jimu-widget-attributetable-switch"},
this.domNode),this.own(c(this.switchBtn,"click",b.hitch(this,this._switchTable))))},_processOpenBarUI:function(){this._isOnlyTable()||(e.removeClass(this.switchBtn,"close"),e.addClass(this.switchBtn,"open"),e.setAttr(this.switchBtn,"title",this.nls.closeTableTip))},_processCloseBarUI:function(){this._isOnlyTable()||(e.removeClass(this.switchBtn,"open"),e.addClass(this.switchBtn,"close"),e.setAttr(this.switchBtn,"title",this.nls.openTableTip))},_switchTable:function(){this.showing?this._closeTable():
this._openTable()},_openTable:function(){this._loadInfoDef?this._loadInfoDef&&this._loadInfoDef.isFulfilled()&&(this.showing=!0,this._processDelayedLayerInfos(),this._activeTable&&this._activeTable.active()):(this._loadInfoDef=new q,this.own(this._loadInfoDef),this.loading||(this.loading=new D),this.loading.placeAt(this.domNode),this.loading.show(),this._resourceManager.updateLayerInfoResources(!0).then(b.hitch(this,function(){this.domNode&&(this._init(),this.showRefreshing(!1),this.showing=!0,this._loadInfoDef.resolve())}),
b.hitch(this,function(a){console.error(a);this._loadInfoDef.reject(a)})));this._changeHeight(this.openHeight);this._processOpenBarUI();return this._loadInfoDef},_onCloseBtnClicked:function(){this.showing&&this._isOnlyTable()?this.widgetManager.closeWidget(this):this.showing&&this._closeTable();this._activeTable&&this._activeTable.deactive()},_closeTable:function(){this._changeHeight(0);this.showRefreshing(!1);this._processCloseBarUI();this._activeTable&&this._activeTable.deactive();this.showing=!1;
e.setStyle(this.arrowDiv,"display","none");e.setStyle(this.domNode,"overflow","hidden");setTimeout(b.hitch(this,function(){this.domNode&&(e.setStyle(this.domNode,"overflow","visible"),e.setStyle(this.arrowDiv,"display","block"))}),10)},_init:function(){this.initDiv();this._changeHeight(this.openHeight);this.resize();this.own(c(window.document,"mouseup",b.hitch(this,this._onDragEnd)));this.own(c(window.document,"mousemove",b.hitch(this,this._onDraging)));this.own(c(window.document,a.move,b.hitch(this,
this._onDraging)));this.own(c(window.document,a.release,b.hitch(this,this._onDragEnd)))},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(u.forEach(this._delayedLayerInfos,b.hitch(this,function(a){this._resourceManager.addLayerInfo(a)})),this._delayedLayerInfos=[])},onLayerInfosIsShowInMapChanged:function(){this._activeTable&&this._activeTable.changeToolbarStatus()},onLayerInfosChanged:function(a,c,d){d&&a&&("added"===c?d.getSupportTableInfo().then(b.hitch(this,function(a){a.isSupportedLayer&&
this._resourceManager.addLayerInfo(d)})):"removed"===c&&(a=d.id,this.getExistLayerTabPage(a)&&this.layerTabPageClose(a,!0),this._resourceManager.getLayerInfoById(a)&&this._resourceManager.removeLayerInfo(a),this._resourceManager.getConfigInfoById(a)&&this._resourceManager.removeConfigInfo(a)))},onLayerInfosFilterChanged:function(a){u.some(a,b.hitch(this,function(a){if(this._activeTable&&a.id===this._activeTable.layerInfo.id)return this._activeTable._relatedQuery||this._activeTable.startQuery(),!0}))},
destroy:function(){if(!this._destroyed){var a,c;if(this.layerTabPages&&0<this.layerTabPages.length){a=this.layerTabPages.length;for(c=0;c<a;c++){var e=this.layerTabPages[c].paneId,f=b.getObject("_resourceManager.featureTableSet."+e,!1,this);f&&(f=f.getFilterObj())&&d.isDefined(f.expr)&&this.filterManager.applyWidgetFilter(e,this.id,"");this.layerTabPages[c].destroy()}this.layerTabPages=null}this.tabContainer&&(this.tabContainer.destroy(),this.tabContainer=null);this._activeLayerInfoId=this._loadInfoDef=
this.AttributeTableDiv=null;this._resourceManager&&this._resourceManager.empty();this.inherited(arguments)}},onOpen:function(){!this.showing&&this._isOnlyTable()&&this._openTable()},onClose:function(){this.showing&&this._closeTable()},_changeHeight:function(a){e.setStyle(this.domNode,"height",a+"px");this.tabContainer&&this.tabContainer.domNode&&0<=a-this.arrowDivHeight&&e.setStyle(this.tabContainer.domNode,"height",a-this.arrowDivHeight+"px");this._activeTable&&this._activeTable.changeHeight(a-this.noGridHeight);
x.publish("changeMapPosition",{bottom:a+this.bottomPosition});this.publishData({changeMapPosition:{bottom:a+this.bottomPosition}});0!==a&&(this.openHeight=a>=this.arrowDivHeight?a:this.normalHeight)},_onMapPositionChange:function(a){isFinite(a.left)&&"number"===typeof a.left&&(window.isRTL?e.setStyle(this.domNode,"right",parseFloat(a.left)+"px"):e.setStyle(this.domNode,"left",parseFloat(a.left)+"px"));isFinite(a.right)&&"number"===typeof a.right&&(window.isRTL?e.setStyle(this.domNode,"left",parseFloat(a.right)+
"px"):e.setStyle(this.domNode,"right",parseFloat(a.right)+"px"));this.tabContainer&&this.tabContainer.resize()},setPosition:function(a){this.position=a;this._isOnlyTable()?this.bottomPosition=0:this.bottomPosition="bottom"in a?parseInt(a.bottom,10):0;this.domNode.parentNode&&this.domNode.parentNode.id===window.jimuConfig.layoutId||(e.place(this.domNode,window.jimuConfig.layoutId),this.setInitialPosition(a),this.showRefreshing(!1));e.setStyle(this.domNode,"bottom",this.bottomPosition+"px");this._resourceManager.isEmpty()||
setTimeout(b.hitch(this,function(){var a=this._getGridTopSectionHeight(),b=e.getStyle(this.domNode,"height");0<a&&(this.noGridHeight=a);0<b&&this._changeHeight(b)}),20)},_startQueryOnLayerTab:function(a,c){var d=this._resourceManager.getLayerInfoById(a),f=this.getExistLayerTabPage(a);d&&f&&(this.showRefreshing(!0),this._resourceManager.getQueryTable(a,this.config.filterByMapExtent,this.config.hideExportButton).then(b.hitch(this,function(b){this._activeLayerInfoId===a&&b&&(f=this.getExistLayerTabPage(a),
b.isSupportQuery?(b=b.table,b.getParent()!==f&&b.placeAt(f),this.setActiveTable(b,{h:this.openHeight-this.noGridHeight,featureSet:c})):(b=e.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),f.set("content",b),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}),b.hitch(this,function(a){new v({message:a.message||a});this.showRefreshing(!1)})))},_startQueryOnRelationTab:function(a,c,d,f){var g=this._resourceManager.getLayerInfoById(f),h=this.getExistLayerTabPage(a);
g&&g.layerObject&&h&&this._resourceManager.getRelationTable(f,c,!1,this.config.hideExportButton).then(b.hitch(this,function(b){this._activeLayerInfoId===a&&b&&(h=this.getExistLayerTabPage(a),b.isSupportQuery?(b=b.table,b.getParent()!==h&&b.placeAt(h),this.setActiveTable(b,{h:this.openHeight-this.noGridHeight,layer:g.layerObject,selectedIds:d})):(b=e.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),h.set("content",b),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}))},
tabChanged:function(){if(this.tabContainer&&this.tabContainer.selectedChildWidget){0>=this.noGridHeight&&(this.noGridHeight=this._getGridTopSectionHeight()+5);var a=this.tabContainer.selectedChildWidget.params,b=a.layerType,c=a.paneId,d=a.relKey;b===this._layerTypes.FEATURELAYER&&(this._activeLayerInfoId!==c||a.oids||a.featureSet)?(this.setActiveTable(null),delete a.oids,this._activeLayerInfoId=c,this._startQueryOnLayerTab(c,a.featureSet)):b===this._layerTypes.RELATIONSHIPTABLE&&(this.setActiveTable(null),
b=a.oids,a=a.originalInfoId,this._activeLayerInfoId=c,this._startQueryOnRelationTab(c,d,b,a))}},showRefreshing:function(a){this.loading&&(a?this.loading.show():this.loading.hide())},_onDragStart:function(a){this.moveMode=!0;this.moveY=a.clientY;this.previousDomHeight=e.getStyle(this.domNode,"height");e.addClass(this.arrowDiv,"draging");this._dragingHandlers=this._dragingHandlers.concat([c(this.ownerDocument,"dragstart",function(a){a.stopPropagation();a.preventDefault()}),c(this.ownerDocumentBody,
"selectstart",function(a){a.stopPropagation();a.preventDefault()})])},_onDraging:function(a){this.moveMode&&125<=a.clientY&&this._changeHeight(this.moveY-a.clientY+this.previousDomHeight)},_onDragEnd:function(){this.moveMode=!1;e.removeClass(this.arrowDiv,"draging");for(var a=this._dragingHandlers.pop();a;)a.remove(),a=this._dragingHandlers.pop()},_getNormalHeight:function(){var a=document.body.clientHeight;return window.appInfo.isRunInMobile?a/2:a/3},setInitialPosition:function(){e.setStyle(this.domNode,
"top","auto");e.setStyle(this.domNode,"left","0px");e.setStyle(this.domNode,"right","0px");e.setStyle(this.domNode,"position","absolute");this._isOnlyTable()||(this.config&&this.config.initiallyExpand?this._openTable():this._closeTable())},_bindActiveTableEvents:function(){var a=this;a._activeTable&&(a._activeTableHandles.push(c(a._activeTable,"show-related-records",function(b){a._showRelatedRecords(b)})),a._activeTableHandles.push(c(a._activeTable,"show-all-records",function(b){a.getExistLayerTabPage(b.layerInfoId).params.layerType=
a._layerTypes.FEATURELAYER})),a._activeTableHandles.push(c(a._activeTable,"refresh",function(b){delete a.getExistLayerTabPage(b.layerInfoId).params.featureSet})),a._activeTableHandles.push(c(a._activeTable,"apply-filter",function(b){a.filterManager.applyWidgetFilter(b.layerInfoId,a.id,b.expr);a._activeTable.startQuery()})))},_unbindActiveTableEvents:function(){for(var a=this._activeTableHandles;0<a.length;){var b=a.pop();b&&b.remove&&b.remove()}},setActiveTable:function(a,c){this._activeTable&&(this._activeTable.cancelThread(),
this._activeTable.deactive(),this._unbindActiveTableEvents(),this._activeTable=null);if(a){this._activeTable=a;this._activeTable.active();this._activeTable.changeHeight(c.h);if(!this._activeTable.tableCreated||this._activeTable.tableCreated&&this._activeTable.matchingMap||this._activeTable.tableCreated&&!this._activeTable.matchingMap&&c.featureSet||c.layer&&c.selectedIds){var d=b.getObject("featureSet.features.length",!1,c);if(c.layer&&c.selectedIds)this._activeTable.queryRecordsByRelationship(c);
else if(d){var e=c.featureSet.displayFieldName,d=u.map(c.featureSet.features,function(a){return a.attributes[e]});this._activeTable.startQuery(d)}else this._activeTable.startQuery()}this._bindActiveTableEvents();this._activeTable.changeToolbarStatus()}},initDiv:function(){this.AttributeTableDiv=e.create("div",{},this.domNode);e.addClass(this.AttributeTableDiv,"jimu-widget-attributetable-main");var a=e.create("div");e.place(a,this.AttributeTableDiv);this.tabContainer=new l({style:"width: 100%;"},a);
e.setStyle(this.tabContainer.domNode,"height",this.normalHeight+"px");this.tabContainer.startup();for(var a=this._resourceManager.getConfigInfos(),c=a.length,d=0;d<c;d++){var f=a[d];if(f.show){var f=b.clone(f),k={};k.paneId=f.id;k.title=f.name;k.name=f.name;k.layerType=this._layerTypes.FEATURELAYER;k.style="height: 100%; width: 100%; overflow: visible;";f=new m(k);this.layerTabPages[d]=f;this.tabContainer.addChild(f)}}0<c&&(this.noGridHeight=this._getGridTopSectionHeight()+5);h.setVerticalCenter(this.tabContainer.domNode);
this.tabChanged();this.own(g.after(this.tabContainer,"selectChild",b.hitch(this,this.tabChanged)))},getLayerInfoLabel:function(a){return a.name||a.title},getLayerInfoId:function(a){return a&&a.id||""},_getGridTopSectionHeight:function(){var a=w(".dijitTabPaneWrapper",this.domNode)[0];if(a){var b=e.position(this.domNode).y;return e.position(a).y-b}return 0},_getLayerInfoByIdFromConfigJSON:function(a){var b=u.filter(this.config.layerInfos,function(b){return b.id===a});return b&&0<b.length&&b[0]},_showRelatedRecords:function(){var a=
this._activeTable;if(a){var b=a.layerInfo;if(b&&b.layerObject)for(var c=b.layerObject.relationships,a=a.getSelectedRows(),d=0,e=c.length;d<e;d++)this.addNewRelationTab(a,c[d],b.id)}},addNewLayerTab:function(a,d){var e=this._resourceManager.getLayerInfoById(a);if(e){var f=this.getExistLayerTabPage(a),g={};g.title=this.getLayerInfoLabel(e);g.name=g.title;g.paneId=this.getLayerInfoId(e);g.closable=!0;g.layerType=this._layerTypes.FEATURELAYER;g.featureSet=d;f?(b.mixin(f.params,g),this.onOpen()):(this._resourceManager.getConfigInfoById(e.id)||
this._resourceManager.addConfigInfo(e),this._resourceManager.getLayerInfoById(e.id)||this._resourceManager.addLayerInfo(e),this.onOpen(),g.style="height: 100%; width: 100%; overflow: visible",f=new m(g),this.layerTabPages.push(f),f.set("title",g.name),this.own(c(f,"close",b.hitch(this,this.layerTabPageClose,g.paneId))),this.tabContainer.addChild(f));this.tabContainer.selectChild(f)}},addNewRelationTab:function(a,d,e){var f=d&&d.shipInfo;if(f){var g=this.getExistLayerTabPage(d.shipInfo.id),h={};h.oids=
a;h.title=f.title||f.name||d.name;h.name=h.title;h.paneId=f.id;h.relKey=d._relKey;h.originalInfoId=e;h.closable=!0;h.layerType=this._layerTypes.RELATIONSHIPTABLE;g?b.mixin(g.params,h):(this._resourceManager.getConfigInfoById(f.id)||this._resourceManager.addConfigInfo(f),this._resourceManager.getLayerInfoById(f.id)||this._resourceManager.addLayerInfo(f),h.style="height: 100%; width: 100%; overflow: visible",g=new m(h),this.layerTabPages.push(g),g.set("title",h.name),this.own(c(g,"close",b.hitch(this,
this.layerTabPageClose,h.paneId))),this.tabContainer.addChild(g));this.tabContainer.selectChild(g)}},onReceiveData:function(a,c,d){d&&"AttributeTable"===d.target&&(this._isOnlyTable()&&"closed"===this.state?console.warn("Please open Attribute Table!"):(d.layer=d.layer||d.layerInfo,this.showing?this._resourceManager.updateLayerInfoResources(!1).then(b.hitch(this,function(){this._addLayerToTable(d)})):this._openTable().then(b.hitch(this,function(){this._resourceManager.getLayerInfoById(d.layer.id)?
this._addLayerToTable(d):this._resourceManager.updateLayerInfoResources(!1).then(b.hitch(this,function(){this._addLayerToTable(d)}))}))))},_addLayerToTable:function(a){var d=null;if(b.getObject("layer.id",!1,a)||b.getObject("layerInfo.id",!1,a)){var e=this._resourceManager.getLayerInfoById(a.layerInfo&&a.layerInfo.id||a.layer&&a.layer.id);e.getLayerObject().then(b.hitch(this,function(f){f?(f.id=a.layer.id,f.loaded?this.addNewLayerTab(e.id,a.featureSet):this.own(c(f,"load",b.hitch(this,this.addNewLayerTab,
e.id,a.featureSet)))):a.url&&(d=new p(a.url),this.own(c(d,"load",b.hitch(this,this.addNewLayerTab,e.id,a.featureSet))))}),b.hitch(this,function(a){new v({message:a.message||a})}))}},getExistLayerTabPage:function(a){for(var b=this.layerTabPages.length,c=0;c<b;c++)if(this.layerTabPages[c]&&this.layerTabPages[c].get("paneId")===a)return this.layerTabPages[c];return null},layerTabPageClose:function(a,c){var e=this.layerTabPages.length;b.getObject("_activeTable.layerInfo.id",!1,this)===a&&this.setActiveTable(null);
for(var f=0;f<e;f++)if(this.layerTabPages[f]&&this.layerTabPages[f].paneId===a){var g=b.getObject("_resourceManager.featureTableSet."+a,!1,this);g&&(g=g.getFilterObj())&&d.isDefined(g.expr)&&this.filterManager.applyWidgetFilter(a,this.id,"");!0===c&&(this.tabContainer.removeChild(this.layerTabPages[f]),this.layerTabPages[f].destroyRecursive());this.layerTabPages&&this.layerTabPages[f]&&this.layerTabPages.splice(f,1);this._resourceManager.removeConfigInfo(a);this._resourceManager.removeLayerInfo(a);
if(1===e){this._activeLayerInfoId=null;this.onClose();break}else a===this._activeLayerInfoId&&this.tabContainer.selectChild(this.layerTabPages[e-2]);break}},_processRelatedRecordsFromPopup:function(a,c){if(a){var d=[];d.push(a.getLayerObject());d.push(a.getRelatedTableInfoArray());f(d).then(b.hitch(this,function(b){if(b){var d=b[0];this._resourceManager.collectRelationShips(a,b[1]);b=d.relationships;for(var d=0,e=b.length;d<e;d++)this.addNewRelationTab(c,b[d],a.id)}}))}},showRelatedRecordsFromPopup:function(a,
c){this.showing?this._resourceManager.updateLayerInfoResources(!1).then(b.hitch(this,function(){this._processRelatedRecordsFromPopup(a,c)})):this._openTable().then(b.hitch(this,function(){this._resourceManager.getLayerInfoById(a.id)?this._processRelatedRecordsFromPopup(a,c):this._resourceManager.updateLayerInfoResources(!1).then(b.hitch(this,function(){this._processRelatedRecordsFromPopup(a,c)}))}))}});k.inPanel=!1;k.hasUIFile=!1;return k});