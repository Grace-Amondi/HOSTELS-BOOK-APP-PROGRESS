// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(t,n,p,v,l,f,d,c,h,y,w){t=t(y,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(c){this._geocodeHandler=
n.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=n.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=n.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(c){this.outSpatialReference=c},_geocodeHandler:function(c,b,d,g,h){try{var a=c.candidates,e;b=[];var m,q=a.length,r=c.spatialReference,f;for(m=0;m<q;m++){e=a[m];if(f=e.location)f.spatialReference=r;b[m]=new w(e)}this._successHandler([b],
"onAddressToLocationsComplete",d,h)}catch(x){this._errorHandler(x,g,h)}},_geocodeAddressesHandler:function(c,b,d,g,h){try{var a=c.locations;b=[];var e,m=a.length,q=c.spatialReference,r;for(e=0;e<m;e++){if(r=a[e].location)r.spatialReference=q;b[e]=new w(a[e])}this._successHandler([b],"onAddressesToLocationsComplete",d,h)}catch(z){this._errorHandler(z,g,h)}},addressToLocations:function(m,b,d,g,r){var a,e,u,q,f,y,x;m.address&&(g=d,d=b,b=m.outFields,r=m.searchExtent,x=m.countryCode,a=m.magicKey,e=m.distance,
y=m.categories,m.location&&this.normalization&&(u=m.location.normalize()),q=m.maxLocations,f=m.forStorage,m=m.address);r&&(r=r.shiftCentralMeridian());var w=this.outSpatialReference;m=this._encode(n.mixin({},this._url.query,m,{f:"json",outSR:w&&l.toJson(w.toJson()),outFields:b&&b.join(",")||null,searchExtent:r&&l.toJson(r.toJson()),category:y&&y.join(",")||null,countryCode:x||null,magicKey:a||null,distance:e||null,location:u||null,maxLocations:q||null,forStorage:f||null}));var p=this._geocodeHandler,
C=this._errorHandler,t=new v(h._dfdCanceller);t._pendingDfd=c({url:this._url.path+"/findAddressCandidates",content:m,callbackParamName:"callback",load:function(a,e){p(a,e,d,g,t)},error:function(a){C(a,g,t)}});return t},suggestLocations:function(m){var b;b=new v(h._dfdCanceller);m.hasOwnProperty("location")&&this.normalization&&(m.location=m.location.normalize());m.searchExtent&&(m.searchExtent=m.searchExtent.shiftCentralMeridian());m=this._encode(n.mixin({},this._url.query,{f:"json",text:m.text,maxSuggestions:m.maxSuggestions,
searchExtent:m.searchExtent&&l.toJson(m.searchExtent.toJson()),category:m.categories&&m.categories.join(",")||null,countryCode:m.countryCode||null,location:m.location||null,distance:m.distance||null},{f:"json"}));m=c({url:this._url.path+"/suggest",content:m,callbackParamName:"callback"});b._pendingDfd=m;m.then(n.hitch(this,function(c){c=c.suggestions||[];this.onSuggestLocationsComplete(c);b.resolve(c)}),n.hitch(this,function(c){this._errorHandler(c);b.reject(c)}));return b},addressesToLocations:function(m,
b,d){var g=this.outSpatialReference,r=[],a=m.categories,e=m.countryCode;p.forEach(m.addresses,function(a,e){r.push({attributes:a})});m=this._encode(n.mixin({},this._url.query,{category:a&&a.join(",")||null,sourceCountry:e||null},{addresses:l.toJson({records:r})},{f:"json",outSR:g&&l.toJson(g.toJson())}));var u=this._geocodeAddressesHandler,q=this._errorHandler,f=new v(h._dfdCanceller);f._pendingDfd=c({url:this._url.path+"/geocodeAddresses",content:m,callbackParamName:"callback",load:function(a,e){u(a,
e,b,d,f)},error:function(a){q(a,d,f)}});return f},_reverseGeocodeHandler:function(c,b,d,g,h){try{var a=new w({address:c.address,location:c.location,score:100});this._successHandler([a],"onLocationToAddressComplete",d,h)}catch(e){this._errorHandler(e,g,h)}},locationToAddress:function(d,b,q,g){d&&this.normalization&&(d=d.normalize());var m=this.outSpatialReference;d=this._encode(n.mixin({},this._url.query,{outSR:m&&l.toJson(m.toJson()),location:d&&l.toJson(d.toJson()),distance:b,f:"json"}));var a=this._reverseGeocodeHandler,
e=this._errorHandler,u=new v(h._dfdCanceller);u._pendingDfd=c({url:this._url.path+"/reverseGeocode",content:d,callbackParamName:"callback",load:function(e,b){a(e,b,q,g,u)},error:function(a){e(a,g,u)}});return u},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});f("extend-esri")&&n.setObject("tasks.Locator",t,d);return t})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(t,n,p,v,l){t=t(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(f){n.mixin(this,f);this.location=new l(this.location)}});p("extend-esri")&&n.setObject("tasks.AddressCandidate",t,v);return t})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(t,n,p,v,l,f,d,c){t=
t(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var h={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},f=this.distances,l=this.outSpatialReference,m=this.bufferSpatialReference,b=p.map(this.geometries,function(b){b="extent"===b.type?d.fromExtent(b):b;return b.toJson()},this),q=this.geometries;if(q&&0<q.length){var g="extent"===q[0].type?
"esriGeometryPolygon":c.getJsonType(q[0]);h.geometries=v.toJson({geometryType:g,geometries:b});h.inSR=q[0].spatialReference.wkid?q[0].spatialReference.wkid:v.toJson(q[0].spatialReference.toJson())}f&&(h.distances=f.join(","));l&&(h.outSR=l.wkid?l.wkid:v.toJson(l.toJson()));m&&(h.bufferSR=m.wkid?m.wkid:v.toJson(m.toJson()));return h}});l("extend-esri")&&n.setObject("tasks.BufferParameters",t,f);return t})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(t,n,p,v,l,f,d,c,h,y,w,m,b,q,g,r,a,e,u,F,E,z,x,N,S,C,G,U,R,D,k,B,A,O,J,P,M,H,I,Q,V){var K=t([x,e,u],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:V,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,_currentFeature:null,
_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",red:"atiRequiredField"},
constructor:function(a,k){n.mixin(this,g.widgets.attributeInspector);a=a||{};a.featureLayer||a.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(a);this._layerInfos=a.layerInfos||[{featureLayer:a.featureLayer,options:a.options||[]}];this._layerInfos=p.filter(this._layerInfos,function(a){return!a.disableAttributeUpdate});this._hideNavButtons=a.hideNavButtons||!1},postCreate:function(){if(p.every(this._layerInfos,
function(a){return a.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var a=this._layerInfos.length;p.forEach(this._layerInfos,function(k){k=k.featureLayer;if(k.loaded)a--;else var e=v.connect(k,"onLoad",this,function(k){v.disconnect(e);e=null;a--;a||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();p.forEach(this._aiConnects,v.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(a,k){k&&(this._createOnlyFirstTime=!0);
this._updateSelection([a],k);this._updateUI()},onLayerSelectionChange:function(a,k,e){this._createOnlyFirstTime=!1;this._featureIdx=e===q.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(a,k,e,b){},onLayerError:function(a,k,e,b){},onLayerEditsError:function(a,
k,e,b){},onLayerEditsComplete:function(a,k,e,b){b=b||[];if(b.length){var c=this._selection,g=a.featureLayer.objectIdField;p.forEach(b,n.hitch(this,function(a){p.some(c,n.hitch(this,function(k,e){if(k.attributes[g]!==a.objectId)return!1;this._selection.splice(e,1);return!0}))}))}k=k||[];k.length&&(this._selection=S.findFeatures(k,a.featureLayer),this._featureIdx=0);b=this._numFeatures=this._selection?this._selection.length:0;if(k.length){if(k=b?this._selection[this._featureIdx]:null)b=k.getLayer().getEditCapabilities(),
b.canCreate&&!b.canUpdate||this._showFeature(k);this._updateUI()}e=e||[];if(e.length){var A=this._rollbackInfo;p.forEach(e,function(k){var b=S.findFeatures(e,a.featureLayer)[0];if(!k.success&&b.attributes[a.featureLayer.objectIdField]===k.objectId&&A){var c=A.field;k=A.graphic.attributes[c.name];var g=p.filter(this._currentLInfo.fieldInfos,function(a){return a.fieldName===c.name},this)[0].dijit;b.attributes[c.name]=k;"esriFieldTypeDate"===c.type&&(k=new Date(k));this._setValue(g,k)}},this)}this._rollbackInfo=
null},onFieldValueChange:function(a,k){var e=a.field,b=a.dijit,c=this._currentFeature,g=this._currentLInfo,A=e.name,d;if(""===b.displayedValue||"dijit.form.ValidationTextBox"!==b.declaredClass||b.isValid())if(""!==b.displayedValue&&b.displayedValue!==k&&b.isValid&&!b.isValid())this._setValue(b,c.attributes[e.name]);else{if(d=!("esriFieldTypeInteger"!==e.type&&"esriFieldTypeSmallInteger"!==e.type&&"esriFieldTypeSingle"!==e.type&&"esriFieldTypeDouble"!==e.type),k=""===k&&d||"undefined"===typeof k?null:
k,d&&null!==k&&(k=Number(k)),"esriFieldTypeDate"===e.type&&(b instanceof Array?(d=b[0].getValue(),b=b[1].getValue(),k=d&&b?new Date(d.getFullYear(),d.getMonth(),d.getDate(),b.getHours(),b.getMinutes(),b.getSeconds(),b.getMilliseconds()):d||b||null):k=b.getValue(),k=k&&k.getTime?k.getTime():k&&k.toGregorian?k.toGregorian().getTime():k),this._currentFeature.attributes[e.name]!==k){if(A===g.typeIdField){var B=this._findFirst(g.types,"id",k);p.forEach(g.fieldInfos,function(a){(e=a.field)&&e.name!==g.typeIdField&&
(a=a.dijit,this._setFieldDomain(a,B,e)&&a&&(this._setValue(a,c.attributes[e.name]+""),!1===a.isValid()&&this._setValue(a,null)))},this)}this.onAttributeChange(c,A,k)}}else this._setValue(b,c.attributes[e.name])},onDeleteBtn:function(a){this._deleteFeature()},onNextFeature:function(a){this._onNextFeature(1)},onPreviousFeature:function(a){this._onNextFeature(-1)},onFirstFeature:function(a){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(a){this._onNextFeature(this._numFeatures-1-this._featureIdx)},
_initLayerInfos:function(){var a=this._layerInfos;this._editorTrackingInfos={};p.forEach(a,this._initLayerInfo,this)},_initLayerInfo:function(a){var k=a.featureLayer,b,e;this._userIds={};e=k.id;k.credential&&(this._userIds[e]=k.credential.userId);a.userId&&(this._userIds[e]=a.userId);this._connect(k,"onSelectionComplete",n.hitch(this,"onLayerSelectionChange",a));this._connect(k,"onSelectionClear",n.hitch(this,"onLayerSelectionClear",a));this._connect(k,"onEditsComplete",n.hitch(this,"onLayerEditsComplete",
a));this._connect(k,"error",n.hitch(this,"onLayerError",a));this._connect(k,"onUpdateEnd",n.hitch(this,"onLayerUpdateEnd",a));a.showAttachments=k.hasAttachments?w.isDefined(a.showAttachments)?a.showAttachments:!0:!1;a.hideFields=a.hideFields||[];a.htmlFields=a.htmlFields||[];a.isEditable=k.isEditable()?w.isDefined(a.isEditable)?a.isEditable:!0:!1;a.typeIdField=k.typeIdField;a.layerId=k.id;a.types=k.types;k.globalIdField&&((b=this._findFirst(a.fieldInfos,"fieldName",k.globalIdField))||a.showGlobalID||
a.hideFields.push(k.globalIdField));(e=this._findFirst(a.fieldInfos,"fieldName",k.objectIdField))||a.showObjectID||a.hideFields.push(k.objectIdField);var c=this._getFields(a.featureLayer);if(c){var g=a.fieldInfos||[],g=p.map(g,function(a){return n.mixin({},a)});g.length?a.fieldInfos=p.filter(p.map(g,n.hitch(this,function(k){var b=k.stringFieldOption||(this._isInFields(k.fieldName,a.htmlFields)?K.STRING_FIELD_OPTION_RICHTEXT:K.STRING_FIELD_OPTION_TEXTBOX);return n.mixin(k,{field:this._findFirst(c,
"name",k.fieldName),stringFieldOption:b})})),"return item.field;"):(c=p.filter(c,n.hitch(this,function(k){return!this._isInFields(k.name,a.hideFields)})),a.fieldInfos=p.map(c,n.hitch(this,function(k){var b=this._isInFields(k.name,a.htmlFields)?K.STRING_FIELD_OPTION_RICHTEXT:K.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:k.name,field:k,stringFieldOption:b}})));a.showGlobalID&&!b&&g.push(this._findFirst(c,"name",k.globalIdField));a.showObjectID&&!e&&g.push(this._findFirst(c,"name",k.objectIdField));
b=[];k.editFieldsInfo&&(k.editFieldsInfo.creatorField&&b.push(k.editFieldsInfo.creatorField),k.editFieldsInfo.creationDateField&&b.push(k.editFieldsInfo.creationDateField),k.editFieldsInfo.editorField&&b.push(k.editFieldsInfo.editorField),k.editFieldsInfo.editDateField&&b.push(k.editFieldsInfo.editDateField));this._editorTrackingInfos[k.id]=b}},_createAttachmentEditor:function(){this._attachmentEditor=null;var a=p.filter(this._layerInfos,function(a){return a.showAttachments});a&&a.length&&(this._attachmentEditor=
new N({"class":this.css.attachmentEditor},this.attachmentEditor),this._attachmentEditor.startup())},_setCurrentLInfo:function(a){var k=this._currentLInfo?this._currentLInfo.featureLayer:null,b=a.featureLayer;if(k&&k.id===b.id&&!k.ownershipBasedAccessControlForFeatures&&(k=b.getEditCapabilities(),!k.canCreate||k.canUpdate))return;this._currentLInfo=a;this._createTable()},_updateSelection:function(a,k){this._selection=a||[];p.forEach(this._layerInfos,this._getSelection,this);var b=this._selection.length;
this._numFeatures=this._selection.length;this._showFeature(b?this._selection[this._featureIdx]:null,k)},_getSelection:function(a){a=a.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(a)},_updateUI:function(){var a=this._numFeatures,k=this._currentLInfo;this.layerName.innerHTML=k&&0!==a?k.featureLayer?k.featureLayer.name:"":this.NLS_noFeaturesSelected;c.set(this.attributeTable,"display",a?"":"none");c.set(this.editButtons,"display",a?"":"none");c.set(this.navButtons,"display",
!this._hideNavButtons&&1<a?"":"none");this.navMessage.innerHTML=w.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&c.set(this._attachmentEditor.domNode,"display",k&&k.showAttachments&&a?"":"none");c.set(this.deleteBtn.domNode,"display",k&&!1===k.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(a){this._featureIdx+=
a;0>this._featureIdx?this._featureIdx=this._numFeatures-1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);a=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(a);this._updateUI();this.onNext(a)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(a,k){if(a){this._currentFeature=a;var b=k?k:a.getLayer(),e=b.getEditCapabilities({feature:a,userId:this._userIds[b.id]});this._canUpdate=e.canUpdate;this._canDelete=e.canDelete;if(e=
this._getLInfoFromFeatureLayer(b)){this._setCurrentLInfo(e);var c=a.attributes,g=this._findFirst(e.types,"id",c[e.typeIdField]),d=null;p.forEach(e.fieldInfos,function(a){d=a.field;var k=[];a.dijit&&1<a.dijit.length?p.forEach(a.dijit,function(a){k.push(a)}):k.push(a.dijit);p.forEach(k,n.hitch(this,function(a){if(a){var k=this._setFieldDomain(a,g,d),b=c[d.name],b=b&&k&&k.codedValues&&k.codedValues.length?k.codedValues[b]?k.codedValues[b].name:b:b;w.isDefined(b)||(b="");"dijit.form.DateTextBox"===a.declaredClass||
"dijit.form.TimeTextBox"===a.declaredClass?b=""===b?null:new Date(b):"dijit.form.FilteringSelect"===a.declaredClass&&(a._lastValueReported=null,b=c[d.name]+"");try{this._setValue(a,b),"dijit.form.FilteringSelect"===a.declaredClass&&!1===a.isValid()&&this._setValue(a,null)}catch(Y){a.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&e.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,b);(b=b.getEditSummary(a))?(this.editorTrackingInfoDiv.innerHTML=
b,m.show(this.editorTrackingInfoDiv)):m.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(a,k,e){if(!a)return null;var c=e.domain;k&&k.domains&&k.domains[e.name]&&!1===k.domains[e.name]instanceof b&&(c=k.domains[e.name]);if(!c)return null;c.codedValues&&0<c.codedValues.length?(a.set("store",this._toStore(p.map(c.codedValues,function(a){return{id:a.code+="",name:a.name}}))),this._setValue(a,c.codedValues[0].code)):(a.constraints={min:w.isDefined(c.minValue)?c.minValue:Number.MIN_VALUE,max:w.isDefined(c.maxValue)?
c.maxValue:Number.MAX_VALUE},this._setValue(a,a.constraints.min));return c},_setValue:function(a,k){a.set&&(a._onChangeActive=!1,a.set("value",k,!0),a._onChangeActive=!0)},_getFields:function(a){var k=a._getOutFields();if(!k)return null;a=a.fields;return"*"==k?a:p.filter(p.map(k,n.hitch(this,"_findFirst",a,"name")),w.isDefined)},_isInFields:function(a,k){return a&&(k||k.length)?p.some(k,function(k){return k.toLowerCase()===a.toLowerCase()}):!1},_isFieldNullable:function(a,k){return!(!1===a.nullable||
k.field&&!1===k.field.nullable)},_isFieldRequired:function(a,k){return!1!==a.editable&&!1!==k.isEditable&&!this._isFieldNullable(a,k)},_findFirst:function(a,k,b){return(a=p.filter(a,function(a){return a.hasOwnProperty(k)&&a[k]===b}))&&a.length?a[0]:null},_getLInfoFromFeatureLayer:function(a){return this._findFirst(this._layerInfos,"layerId",a?a.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML="";this._attributes=h.create("table",{cellspacing:"0",cellpadding:"0"},
this.attributeTable);var a=h.create("tbody",null,this._attributes),k=this._currentLInfo,b=this._findFirst(k.types,"id",this._currentFeature.attributes[k.typeIdField]);p.forEach(k.fieldInfos,n.hitch(this,"_createField",b,a),this);this._createOnlyFirstTime=!1},_createField:function(a,k,b){var e=this._currentLInfo,c=b.field;if(!this._isInFields(c.name,e.hideFields)&&!this._isInFields(c.name,this._editorTrackingInfos[e.featureLayer.id])){var g=!1,d,A,B;k=h.create("tr",null,k);d=h.create("td",{innerHTML:b.label||
c.alias||c.name,"class":this.css.label,"data-fieldname":c.name},k);this._isFieldRequired(c,b)&&h.create("span",{"class":this.css.red,innerHTML:" *"},d);k=h.create("td",null,k);if(b.customField)h.place(b.customField.domNode||b.customField,h.create("div",null,k),"first"),A=b.customField;else if(!1===e.isEditable||!1===c.editable||!1===b.isEditable||"esriFieldTypeOID"===c.type||"esriFieldTypeGlobalID"===c.type||!this._canUpdate&&!this._createOnlyFirstTime)g=!0;e=e.typeIdField&&c.name.toLowerCase()==
e.typeIdField.toLowerCase();d=!!this._getDomainForField(c,a);!A&&e?A=this._createTypeField(c,b,k):!A&&d&&(A=this._createDomainField(c,b,a,k));if(!A)switch(c.type){case "esriFieldTypeString":A=this._createStringField(c,b,k);break;case "esriFieldTypeDate":A=this._createDateField(c,b,k);b.format&&b.format.time&&(B=this._createTimeField(c,b,k));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":A=this._createIntField(c,b,k);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":A=
this._createFltField(c,b,k);break;default:A=this._createStringField(c,b,k)}b.tooltip&&b.tooltip.length&&this._toolTips.push(new P({connectId:[A.id],label:b.tooltip}));A.onChange=n.hitch(this,"onFieldValueChange",b);A.set("disabled",g);B?(b.dijit=[A,B],B.onChange=n.hitch(this,"onFieldValueChange",b),B.set("disabled",g)):b.dijit=A}},_createTypeField:function(a,k,b){b=h.create("div",null,b);var e=a.domain;return e&&"range"===e.type&&e.minValue===e.maxValue?new O({"class":this.css.field,trim:!0,maxLength:a.length,
name:a.alias||a.name,required:this._isFieldRequired(a,k)},b):new D({"class":this.css.field,name:a.alias||a.name,required:this._isFieldRequired(a,k),store:this._toStore(p.map(this._currentLInfo.types,function(a){return{id:a.id,name:a.name}})),searchAttr:"name"},b)},_getDomainForField:function(a,k){var e=a.domain,c=a.name;c&&k&&k.domains&&k.domains[c]&&!1===k.domains[c]instanceof b&&(e=k.domains[c]);return e||null},_createDomainField:function(a,b,e,c){e=this._getDomainForField(a,e);c=h.create("div",
null,c);return e.codedValues?new D({"class":this.css.field,name:a.alias||a.name,searchAttr:"name",required:this._isFieldRequired(a,b)},c):new k({"class":this.css.field},c)},_createStringField:function(a,k,b){b=h.create("div",null,b);var e={trim:!0,maxLength:a.length,required:this._isFieldRequired(a,k)};if(k.stringFieldOption===K.STRING_FIELD_OPTION_TEXTAREA)return e["class"]=this.css.field+" "+this.css.textArea,new A(e,b);if(k.stringFieldOption===K.STRING_FIELD_OPTION_RICHTEXT)return e["class"]=this.css.field+
" "+this.css.richText,e.height="100%",e.width="100%",e.plugins=k.richTextPlugins||this._defaultRichTextPlugins,b=new F(e,b),b.startup(),b;var c=this;e.validator=function(b,e){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return c._isFieldNullable(a,k)||!(""===b||null===b)};return new O(e,b)},_createTimeField:function(a,k,b){b=h.create("div",null,b);a={"class":this.css.field,trim:!0,required:this._isFieldRequired(a,k),constraints:{formatLength:"medium"}};this._datePackage&&(a.datePackage=this._datePackage);
return new J(a,b)},_createDateField:function(a,k,b){b=h.create("div",null,b);a={"class":this.css.field,trim:!0,required:this._isFieldRequired(a,k)};this._datePackage&&(a.datePackage=this._datePackage);return new G(a,b)},_createIntField:function(a,k,b){b=h.create("div",null,b);var e=/\de[-+]?\d/i,c=/^[-+]?\d+$/,g=this;return new O({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===a.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(a,
k),validator:function(b,A){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return""!==b&&null!==b||!g._isFieldNullable(a,k)?e.test(b)?!0:c.test(b)?("min"in A?0<=this.compare(b,A.min):1)&&("max"in A?0>=this.compare(b,A.max):1)?!0:!1:!1:!0}},b)},_createFltField:function(a,k,b){b=h.create("div",null,b);var e=/\de[-+]?\d/i,c=/[0-9]\d{0,2}(\.\d{3})*(,\d+)?$/i,g=this;return new O({"class":this.css.field,constraints:{places:"0,40",min:-Infinity,max:Infinity,exponent:!0},trim:!0,invalidMessage:this.NLS_validationFlt,
required:this._isFieldRequired(a,k),validator:function(b,A){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return""!==b&&null!==b||!g._isFieldNullable(a,k)?e.test(b)?!0:c.test(b)?("min"in A?0<=this.compare(b,A.min):1)&&("max"in A?0>=this.compare(b,A.max):1)?!0:!1:!1:!0}},b)},_toStore:function(a){return new M({data:{identifier:"id",label:"name",items:a}})},_connect:function(a,k,b){this._aiConnects.push(v.connect(a,k,b))},_getDatePackage:function(a){return null===a.datePackage?null:a.datePackage?
a.datePackage:"ar"===f.locale?"dojox.date.islamic":null},_destroyAttributeTable:function(){p.forEach(this._layerInfos,function(a){p.forEach(a.fieldInfos,function(a){var k=a.dijit;if(k){k._onChangeHandle=null;if(a.customField)return;k instanceof Array?p.forEach(k,n.hitch(this,function(a){a.destroyRecursive?a.destroyRecursive():a.destroy&&a.destroy();a._onChangeHandle=null})):k.destroyRecursive?k.destroyRecursive():k.destroy&&k.destroy()}a.dijit=null},this)},this);p.forEach(this._toolTips,function(a){a.destroy()});
this._toolTips=[];this._attributes&&h.destroy(this._attributes)}});n.mixin(K,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});d("extend-esri")&&n.setObject("dijit.AttributeInspector",K,y);return K})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(t,n,p,v,l,f,d,c,h,y,w,m,b,q,g,r,a,e,u,F,E,z,x,N,S){function C(a){return new F({command:a.name})}function G(a){return new F({buttonClass:u,command:a.name})}p=p("dijit.Editor",N,{plugins:null,extraPlugins:null,constructor:function(){w.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",E]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(m("ie")||m("trident")||m("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new v;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);w.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=l.getLocalization("dijit._editor",
"commands",this.lang);m("webkit")&&h.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new r({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));n.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);d.add(this.iframe.parentNode,"dijitEditorIFrameContainer");d.add(this.iframe,"dijitEditorIFrame");f.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){n.forEach(this._plugins,function(a){a&&a.destroy&&a.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(a,b){var e=w.isString(a)?{name:a}:w.isFunction(a)?{ctor:a}:a;if(!e.setEditor){var k={args:e,plugin:null,editor:this};e.name&&(F.registry[e.name]?k.plugin=F.registry[e.name](e):q.publish(S._scopeName+".Editor.getPlugin",k));if(!k.plugin)try{var c=
e.ctor||w.getObject(e.name)||t(e.name);c&&(k.plugin=new c(e))}catch(A){throw Error(this.id+": cannot find plugin ["+e.name+"]");}if(!k.plugin)throw Error(this.id+": cannot find plugin ["+e.name+"]");a=k.plugin}1<arguments.length?this._plugins[b]=a:this._plugins.push(a);a.setEditor(this);w.isFunction(a.setToolbar)&&a.setToolbar(this.toolbar)},resize:function(a){a&&e.prototype.resize.apply(this,arguments)},layout:function(){var a=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+c.getPadBorderExtents(this.iframe.parentNode).h+
c.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=a+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(a){var b,e=this.document.body,k=e.clientWidth,c=e.clientHeight,g=e.clientLeft,d=e.offsetWidth,m=e.offsetHeight,h=e.offsetLeft;/^rtl$/i.test(e.dir||"")?k<d&&a.x>k&&a.x<d&&(b=!0):a.x<g&&a.x>h&&(b=!0);b||c<m&&a.y>c&&a.y<m&&(b=!0);b||(delete this._cursorToStart,delete this._savedSelection,"BODY"==a.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(a){this.customUndo&&this.endEditing(!0);"BODY"!=a.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(a){this._inEditing||(this._inEditing=!0,this._beginEditing(a));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(a){if(!this.customUndo||
"undo"!=a&&"redo"!=a){this.customUndo&&(this.endEditing(),this._beginEditing());var b=this.inherited(arguments);this.customUndo&&this._endEditing();return b}return this[a]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(a){var e;try{if(e=this.document.execCommand(a,!1,null),m("webkit")&&!e)throw{};}catch(D){e=b.substitute,alert(e(this.commands.systemShortcut,
[this.commands[a],e(this.commands[m("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[a]])])),e=!1}return e},queryCommandEnabled:function(a){return!this.customUndo||"undo"!=a&&"redo"!=a?this.inherited(arguments):"undo"==a?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(a){var b=a.mark,e=a.mark;a=a.isCollapsed;var k,c,g;e&&(9>m("ie")||9===m("ie")&&m("quirks")?w.isArray(e)?(b=[],n.forEach(e,function(a){b.push(x.getNode(a,this.editNode))},this),this.selection.moveToBookmark({mark:b,
isCollapsed:a})):e.startContainer&&e.endContainer&&(g=x.getSelection(this.window))&&g.removeAllRanges&&(g.removeAllRanges(),a=x.create(this.window),k=x.getNode(e.startContainer,this.editNode),c=x.getNode(e.endContainer,this.editNode),k&&c&&(a.setStart(k,e.startOffset),a.setEnd(c,e.endOffset),g.addRange(a))):(g=x.getSelection(this.window))&&g.removeAllRanges&&(g.removeAllRanges(),a=x.create(this.window),k=x.getNode(e.startContainer,this.editNode),c=x.getNode(e.endContainer,this.editNode),k&&c&&(a.setStart(k,
e.startOffset),a.setEnd(c,e.endOffset),g.addRange(a))))},_changeToStep:function(a,b){this.setValue(b.text);var e=b.bookmark;e&&this._moveToBookmark(e)},undo:function(){var a=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var b=this._steps.pop();b&&0<this._steps.length&&(this.focus(),this._changeToStep(b,this._steps[this._steps.length-1]),this._undoedSteps.push(b),this.onDisplayChanged(),delete this._undoRedoActive,a=!0);delete this._undoRedoActive}return a},redo:function(){var a=
!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var b=this._undoedSteps.pop();b&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],b),this._steps.push(b),this.onDisplayChanged(),a=!0);delete this._undoRedoActive}return a},endEditing:function(a){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(a),this._inEditing=!1)},_getBookmark:function(){var a=this.selection.getBookmark(),b=[];if(a&&a.mark){var e=
a.mark;if(9>m("ie")||9===m("ie")&&m("quirks")){var k=x.getSelection(this.window);if(w.isArray(e))n.forEach(a.mark,function(a){b.push(x.getIndex(a,this.editNode).o)},this),a.mark=b;else if(k){var c;k.rangeCount&&(c=k.getRangeAt(0));a.mark=c?c.cloneRange():this.selection.getBookmark()}}try{a.mark&&a.mark.startContainer&&(b=x.getIndex(a.mark.startContainer,this.editNode).o,a.mark={startContainer:b,startOffset:a.mark.startOffset,endContainer:a.mark.endContainer===a.mark.startContainer?b:x.getIndex(a.mark.endContainer,
this.editNode).o,endOffset:a.mark.endOffset})}catch(A){a.mark=null}}return a},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:z.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var a=z.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:a,bookmark:this._getBookmark()})},onKeyDown:function(a){m("ie")||this.iframe||a.keyCode!=y.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var b=a.keyCode;if(a.ctrlKey&&
!a.shiftKey&&!a.altKey){if(90==b||122==b){a.stopPropagation();a.preventDefault();this.undo();return}if(89==b||121==b){a.stopPropagation();a.preventDefault();this.redo();return}}this.inherited(arguments);switch(b){case y.ENTER:case y.BACKSPACE:case y.DELETE:this.beginEditing();break;case 88:case 86:if(a.ctrlKey&&!a.altKey&&!a.metaKey){this.endEditing();88==a.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!a.ctrlKey&&!a.altKey&&!a.metaKey&&(a.keyCode<
y.F1||a.keyCode>y.F15)){this.beginEditing();break}case y.ALT:this.endEditing();break;case y.UP_ARROW:case y.DOWN_ARROW:case y.LEFT_ARROW:case y.RIGHT_ARROW:case y.HOME:case y.END:case y.PAGE_UP:case y.PAGE_DOWN:this.endEditing(!0);case y.CTRL:case y.SHIFT:case y.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(U){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(a){this.customUndo?this.isClosed?this.setValue(a):(this.beginEditing(),a||(a="\x26#160;"),this.setValue(a),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(a){this.setValueDeferred.then(w.hitch(this,function(){!this.disabled&&a||!this._buttonEnabledPlugins&&a?
n.forEach(this._plugins,function(a){a.set("disabled",!0)}):this.disabled&&!a&&n.forEach(this._plugins,function(a){a.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&h.set(this.document.body,"color",h.get(this.iframe,"color"))}catch(U){}}});w.mixin(F.registry,{undo:C,redo:C,cut:C,copy:C,paste:C,insertOrderedList:C,insertUnorderedList:C,indent:C,outdent:C,justifyCenter:C,justifyFull:C,justifyLeft:C,justifyRight:C,
"delete":C,selectAll:C,removeFormat:C,unlink:C,insertHorizontalRule:C,bold:G,italic:G,underline:G,strikethrough:G,subscript:G,superscript:G,"|":function(){return new F({setEditor:function(b){this.editor=b;this.button=new a({ownerDocument:b.ownerDocument})}})}});return p})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(t,n,p,v,l,f,d,c){p("dijit-legacy-requires")&&l(0,function(){t(["dijit/ToolbarSeparator"])});
return n("dijit.Toolbar",[f,c,d],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],function(t,n,p,v){return t("dijit.ToolbarSeparator",[p,v],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',
buildRendering:function(){this.inherited(arguments);n.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(t,n,p,v,l){n=n("dijit._editor._Plugin",v,{constructor:function(f){this.params=f||{};p.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:l,
disabled:!1,getLabel:function(f){return this.editor.commands[f]},_initButton:function(){if(this.command.length){var f=this.getLabel(this.command),d=this.editor,c=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(f=p.mixin({label:f,ownerDocument:d.ownerDocument,dir:d.dir,lang:d.lang,showLabel:!1,iconClass:c,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete f.name,this.button=new this.buttonClass(f))}this.get("disabled")&&
this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(f,d,c){this.own(t.connect(f,d,this,c))},updateState:function(){var f=this.editor,d=this.command,c,h;if(f&&f.isLoaded&&d.length){var y=this.get("disabled");if(this.button)try{h=!y&&f.queryCommandEnabled(d),this.enabled!==h&&(this.enabled=h,this.button.set("disabled",!h)),h&&"boolean"==typeof this.button.checked&&(c=f.queryCommandState(d),
this.checked!==c&&(this.checked=c,this.button.set("checked",f.queryCommandState(d))))}catch(w){console.log(w)}}},setEditor:function(f){this.editor=f;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",p.hitch(this.editor,"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",p.hitch(this,"updateState")))},setToolbar:function(f){this.button&&
f.addChild(this.button)},set:function(f,d){if("object"===typeof f){for(var c in f)this.set(c,f[c]);return this}c=this._getAttrNames(f);if(this[c.s])var h=this[c.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(f,d);return h||this},get:function(f){var d=this._getAttrNames(f);return this[d.g]?this[d.g]():this[f]},_setDisabledAttr:function(f){this._set("disabled",f);this.updateState()},_getAttrNames:function(f){var d=this._attrPairNames;if(d[f])return d[f];var c=f.charAt(0).toUpperCase()+
f.substr(1);return d[f]={s:"_set"+c+"Attr",g:"_get"+c+"Attr"}},_set:function(f,d){this[f]=d}});n.registry={};return n})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),function(t,n,p,v,l,f,d,c,h,y,w){return t("dijit._editor.plugins.EnterKeyHandling",h,{blockNodeForEnter:"BR",constructor:function(c){c&&("blockNodeForEnter"in c&&(c.blockNodeForEnter=
c.blockNodeForEnter.toUpperCase()),v.mixin(this,c))},setEditor:function(c){if(this.editor!==c)if(this.editor=c,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,c.onLoadDeferred.then(v.hitch(this,function(b){this.own(l(c.document,"keydown",v.hitch(this,function(b){if(b.keyCode==p.ENTER){var c=v.mixin({},b);c.shiftKey=!0;this.handleEnterKey(c)||(b.stopPropagation(),b.preventDefault())}})));9<=f("ie")&&10>=f("ie")&&this.own(l(c.document,"paste",v.hitch(this,function(b){setTimeout(v.hitch(this,
function(){var b=this.editor.document.selection.createRange();b.move("character",-1);b.select();b.move("character",1);b.select()}),0)})));return b}));else if(this.blockNodeForEnter){var b=v.hitch(this,"handleEnterKey");c.addKeyHandler(13,0,0,b);c.addKeyHandler(13,0,1,b);this.own(this.editor.on("KeyPressed",v.hitch(this,"onKeyPressed")))}},onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var c=this.editor.selection.getAncestorElement("LI");if(c){f("mozilla")&&
"LI"==c.parentNode.parentNode.nodeName&&(c=c.parentNode.parentNode);var b=c.firstChild;!b||1!=b.nodeType||"UL"!=b.nodeName&&"OL"!=b.nodeName||(c.insertBefore(b.ownerDocument.createTextNode("\u00a0"),b),b=w.create(this.editor.window),b.setStart(c.firstChild,0),c=w.getSelection(this.editor.window,!0),c.removeAllRanges(),c.addRange(b))}else y.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter),(c=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?(c.innerHTML=
this.bogusHtmlContent,9>=f("ie")&&(c=this.editor.document.selection.createRange(),c.move("character",-1),c.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(d){var b,h,g,r,a=this.editor.document,
e,u,m;if(d.shiftKey){d=this.editor.selection.getParentElement();if(r=w.getAncestor(d,this.blockNodes)){if("LI"==r.tagName)return!0;d=w.getSelection(this.editor.window);b=d.getRangeAt(0);b.collapsed||(b.deleteContents(),d=w.getSelection(this.editor.window),b=d.getRangeAt(0));if(w.atBeginningOfContainer(r,b.startContainer,b.startOffset))e=a.createElement("br"),b=w.create(this.editor.window),r.insertBefore(e,r.firstChild),b.setStartAfter(e),d.removeAllRanges(),d.addRange(b);else if(w.atEndOfContainer(r,
b.startContainer,b.startOffset))b=w.create(this.editor.window),e=a.createElement("br"),r.appendChild(e),r.appendChild(a.createTextNode("\u00a0")),b.setStart(r.lastChild,0),d.removeAllRanges(),d.addRange(b);else return(u=b.startContainer)&&3==u.nodeType?(m=u.nodeValue,h=a.createTextNode(m.substring(0,b.startOffset)),g=a.createTextNode(m.substring(b.startOffset)),r=a.createElement("br"),""==g.nodeValue&&f("webkit")&&(g=a.createTextNode("\u00a0")),n.place(h,u,"after"),n.place(r,h,"after"),n.place(g,
r,"after"),n.destroy(u),b=w.create(this.editor.window),b.setStart(g,0),d.removeAllRanges(),d.addRange(b),!1):!0}else d=w.getSelection(this.editor.window),d.rangeCount?(b=d.getRangeAt(0))&&b.startContainer&&(b.collapsed||(b.deleteContents(),d=w.getSelection(this.editor.window),b=d.getRangeAt(0)),(u=b.startContainer)&&3==u.nodeType?(r=b.startOffset,u.length<r&&(g=this._adjustNodeAndOffset(u,r),u=g.node,r=g.offset),m=u.nodeValue,h=a.createTextNode(m.substring(0,r)),g=a.createTextNode(m.substring(r)),
r=a.createElement("br"),g.length||(g=a.createTextNode("\u00a0")),h.length?n.place(h,u,"after"):h=u,n.place(r,h,"after"),n.place(g,r,"after"),n.destroy(u)):(0<=b.startOffset&&(e=u.childNodes[b.startOffset]),r=a.createElement("br"),g=a.createTextNode("\u00a0"),e?(n.place(r,e,"before"),n.place(g,r,"after")):(u.appendChild(r),u.appendChild(g))),b=w.create(this.editor.window),b.setStart(g,0),b.setEnd(g,g.length),d.removeAllRanges(),d.addRange(b),this.editor.selection.collapse(!0)):y.prototype.execCommand.call(this.editor,
"inserthtml","\x3cbr\x3e");return!1}var l=!0;d=w.getSelection(this.editor.window);b=d.getRangeAt(0);b.collapsed||(b.deleteContents(),d=w.getSelection(this.editor.window),b=d.getRangeAt(0));e=w.getBlockAncestor(b.endContainer,null,this.editor.editNode);var z=e.blockNode;if(this._checkListLater=z&&("LI"==z.nodeName||"LI"==z.parentNode.nodeName))return f("mozilla")&&(this._pressedEnterInBlock=z),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(z.innerHTML)&&
(z.innerHTML="",f("webkit")&&(b=w.create(this.editor.window),b.setStart(z,0),d.removeAllRanges(),d.addRange(b)),this._checkListLater=!1),!0;if(!e.blockNode||e.blockNode===this.editor.editNode){try{y.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(x){}e={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),blockContainer:this.editor.editNode};if(e.blockNode){if(e.blockNode!=this.editor.editNode&&!(e.blockNode.textContent||e.blockNode.innerHTML).replace(/^\s+|\s+$/g,
"").length)return this.removeTrailingBr(e.blockNode),!1}else e.blockNode=this.editor.editNode;d=w.getSelection(this.editor.window);b=d.getRangeAt(0)}z=a.createElement(this.blockNodeForEnter);z.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(e.blockNode);g=b.endOffset;l=b.endContainer;l.length<g&&(g=this._adjustNodeAndOffset(l,g),l=g.node,g=g.offset);if(w.atEndOfContainer(e.blockNode,l,g))e.blockNode===e.blockContainer?e.blockNode.appendChild(z):n.place(z,e.blockNode,"after"),l=!1,b=w.create(this.editor.window),
b.setStart(z,0),d.removeAllRanges(),d.addRange(b),this.editor.height&&c.scrollIntoView(z);else if(w.atBeginningOfContainer(e.blockNode,b.startContainer,b.startOffset))n.place(z,e.blockNode,e.blockNode===e.blockContainer?"first":"before"),z.nextSibling&&this.editor.height&&(b=w.create(this.editor.window),b.setStart(z.nextSibling,0),d.removeAllRanges(),d.addRange(b),c.scrollIntoView(z.nextSibling)),l=!1;else{e.blockNode===e.blockContainer?e.blockNode.appendChild(z):n.place(z,e.blockNode,"after");l=
!1;e.blockNode.style&&z.style&&e.blockNode.style.cssText&&(z.style.cssText=e.blockNode.style.cssText);if((u=b.startContainer)&&3==u.nodeType){g=b.endOffset;u.length<g&&(g=this._adjustNodeAndOffset(u,g),u=g.node,g=g.offset);m=u.nodeValue;h=a.createTextNode(m.substring(0,g));g=a.createTextNode(m.substring(g,m.length));n.place(h,u,"before");n.place(g,u,"after");n.destroy(u);for(b=h.parentNode;b!==e.blockNode;){m=a.createElement(b.tagName);b.style&&m.style&&b.style.cssText&&(m.style.cssText=b.style.cssText);
"FONT"===b.tagName&&(b.color&&(m.color=b.color),b.face&&(m.face=b.face),b.size&&(m.size=b.size));for(;g;)u=g.nextSibling,m.appendChild(g),g=u;n.place(m,b,"after");h=b;g=m;b=b.parentNode}if(1==g.nodeType||3==g.nodeType&&g.nodeValue)z.innerHTML="";for(h=g;g;)u=g.nextSibling,z.appendChild(g),g=u}b=w.create(this.editor.window);a=h;if("BR"!==this.blockNodeForEnter){for(;a;)r=a,a=u=a.firstChild;r&&r.parentNode?(z=r.parentNode,b.setStart(z,0),d.removeAllRanges(),d.addRange(b),this.editor.height&&c.scrollIntoView(z),
f("mozilla")&&(this._pressedEnterInBlock=e.blockNode)):l=!0}else b.setStart(z,0),d.removeAllRanges(),d.addRange(b),this.editor.height&&c.scrollIntoView(z),f("mozilla")&&(this._pressedEnterInBlock=e.blockNode)}return l},_adjustNodeAndOffset:function(c,b){for(;c.length<b&&c.nextSibling&&3==c.nextSibling.nodeType;)b-=c.length,c=c.nextSibling;return{node:c,offset:b}},removeTrailingBr:function(c){if(c=/P|DIV|LI/i.test(c.tagName)?c:this.editor.selection.getParentOfType(c,["P","DIV","LI"]))c.lastChild&&
(1<c.childNodes.length&&3==c.lastChild.nodeType&&/^[\s\xAD]*$/.test(c.lastChild.nodeValue)||"BR"==c.lastChild.tagName)&&n.destroy(c.lastChild),c.childNodes.length||(c.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(t,n,p,v,l,f,d,c,h,y,w,m,b,q,g,r,a,e,u,F,E,z,x,N,S,C,G,U,R){var D=p("dijit._editor.RichText",[x,N],{constructor:function(a){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};a&&b.isString(a.value)&&(this.value=a.value);this.onLoadDeferred=new v},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[b.trim,b.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);a("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));a("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(a("ie")||a("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[b.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[b.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);u.publish(R._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var k=b.hitch(this,function(a,b){return function(){return!this.execCommand(a,b)}}),e={b:k("bold"),i:k("italic"),u:k("underline"),a:k("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:k("formatblock",
"h1"),2:k("formatblock","h2"),3:k("formatblock","h3"),4:k("formatblock","h4"),"\\":k("insertunorderedlist")};a("ie")||(e.Z=k("redo"));for(var c in e)this.addKeyHandler(c,!0,!1,e[c])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(D._editorCommandsLocalized)this._local2NativeFormatNames=D._local2NativeFormatNames,this._native2LocalFormatNames=D._native2LocalFormatNames;else{D._editorCommandsLocalized=!0;D._local2NativeFormatNames={};
D._native2LocalFormatNames={};this._local2NativeFormatNames=D._local2NativeFormatNames;this._native2LocalFormatNames=D._native2LocalFormatNames;for(var a="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),e="",d,g=0;d=a[g++];)e="l"!==d.charAt(1)?e+("\x3c"+d+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+d+"\x3e\x3cbr/\x3e"):e+("\x3c"+d+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+d+"\x3e\x3cbr/\x3e");var h=c.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:e});this.ownerDocumentBody.appendChild(h);
a=b.hitch(this,function(){for(var a=h.firstChild;a;)try{this.selection.selectElement(a.firstChild);var b=a.tagName.toLowerCase();this._local2NativeFormatNames[b]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[b]]=b;a=a.nextSibling.nextSibling}catch(H){}c.destroy(h)});this.defer(a)}},open:function(k){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new v;this.isClosed||this.close();u.publish(R._scopeName+"._editor.RichText::open",
this);1===arguments.length&&k.nodeName&&(this.domNode=k);var e=this.domNode,g;if(b.isString(this.value))g=this.value,e.innerHTML="";else if(e.nodeName&&"textarea"==e.nodeName.toLowerCase()){var h=this.textarea=e;this.name=h.name;g=h.value;e=this.domNode=this.ownerDocument.createElement("div");e.setAttribute("widgetId",this.id);h.removeAttribute("widgetId");e.cssText=h.cssText;e.className+=" "+h.className;c.place(e,h,"before");var r=b.hitch(this,function(){y.set(h,{display:"block",position:"absolute",
top:"-1000px"});if(a("ie")){var b=h.style;this.__overflow=b.overflow;b.overflow="hidden"}});a("ie")?this.defer(r,10):r();if(h.form){var m=h.value;this.reset=function(){this.getValue()!==m&&this.replaceValue(m)};q(h.form,"submit",b.hitch(this,function(){f.set(h,"disabled",this.disabled);h.value=this.getValue()}))}}else g=G.getChildrenHtml(e),e.innerHTML="";this.value=g;e.nodeName&&"LI"===e.nodeName&&(e.innerHTML=" \x3cbr\x3e");this.header=e.ownerDocument.createElement("div");e.appendChild(this.header);
this.editingArea=e.ownerDocument.createElement("div");e.appendChild(this.editingArea);this.footer=e.ownerDocument.createElement("div");e.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!n.useXDomain||n.allowXdRichTextSave)){if((g=l.byId(R._scopeName+"._editor.RichText.value"))&&""!==g.value)for(var r=g.value.split(this._SEPARATOR),x=0,w;w=r[x++];)if(w=w.split(this._NAME_CONTENT_SEP),w[0]===this.name){this.value=w[1];r=r.splice(x,1);g.value=r.join(this._SEPARATOR);
break}D._globalSaveHandler||(D._globalSaveHandler={},F.addOnUnload(function(){for(var a in D._globalSaveHandler){var k=D._globalSaveHandler[a];b.isFunction(k)&&k()}}));D._globalSaveHandler[this.id]=b.hitch(this,"_saveContent")}this.isClosed=!1;g=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");g.id=this.id+"_iframe";g.style.border="none";g.style.width="100%";this._layoutMode?g.style.height="100%":7<=a("ie")?(this.height&&(g.style.height=this.height),this.minHeight&&(g.style.minHeight=
this.minHeight)):g.style.height=this.height?this.height:this.minHeight;g.frameBorder=0;g._loadFunc=b.hitch(this,function(b){this.window=b;this.document=b.document;this.selection=new S.SelectionManager(b);a("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});r=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");r=11>a("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+r+"');document.close()":"javascript: '"+
r+"'";this.editingArea.appendChild(g);g.src=r;"LI"===e.nodeName&&(e.lastChild.style.marginTop="-1.2em");d.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var k=y.getComputedStyle(this.domNode),c;if(this["aria-label"])c=this["aria-label"];else{var d=g('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||l.byId(this["aria-labelledby"],this.ownerDocument);d&&(c=d.textContent||d.innerHTML||"")}var d="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(c?" aria-label\x3d'"+e.escape(c)+"'":"")+"\x3e\x3c/div\x3e",h=[k.fontWeight,k.fontSize,k.fontFamily].join(" "),u=k.lineHeight,u=0<=u.indexOf("px")?parseFloat(u)/parseFloat(k.fontSize):0<=u.indexOf("em")?parseFloat(u):"normal",r="",f=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(a){a=a.replace(/^;/ig,"")+";";var k=a.split(":")[0];if(k){var k=b.trim(k),k=k.toLowerCase(),e,c="";for(e=0;e<k.length;e++){var g=k.charAt(e);switch(g){case "-":e++,g=k.charAt(e).toUpperCase();default:c+=
g}}y.set(f.domNode,c,"")}r+=a+";"});this.iframe.setAttribute("title",c);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||w.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",c?"\x3ctitle\x3e"+e.escape(c)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",h,";\n",this.height||a("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",u,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",a("ie")||a("trident")||a("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",c?" aria-label\x3d'"+e.escape(c)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+r+"'\x3e",d,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var a=[];this.styleSheets&&(a=this.styleSheets.split(";"),this.styleSheets=
"");a=a.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var b="",e=0,c,g=z.get(this.ownerDocument);c=a[e++];)c=(new E(g.location,c)).toString(),this.editingAreaStyleSheets.push(c),b+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+c+'"/\x3e';return b},addStyleSheet:function(a){var k=a.toString(),e=z.get(this.ownerDocument);if("."===k.charAt(0)||"/"!==k.charAt(0)&&!a.host)k=(new E(e.location,k)).toString();-1<t.indexOf(this.editingAreaStyleSheets,k)||(this.editingAreaStyleSheets.push(k),
this.onLoadDeferred.then(b.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(k);else{var a=this.document.getElementsByTagName("head")[0],b=this.document.createElement("link");b.rel="stylesheet";b.type="text/css";b.href=k;a.appendChild(b)}})))},removeStyleSheet:function(a){var b=a.toString(),k=z.get(this.ownerDocument);if("."===b.charAt(0)||"/"!==b.charAt(0)&&!a.host)b=(new E(k.location,b)).toString();a=t.indexOf(this.editingAreaStyleSheets,b);-1!==a&&(delete this.editingAreaStyleSheets[a],
g('link[href\x3d"'+b+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(b){b=!!b;this._set("disabled",b);if(this.isLoaded){var k=a("ie")&&(this.isLoaded||!this.focusOnLoad);k&&(this.editNode.unselectable="on");this.editNode.contentEditable=!b;this.editNode.tabIndex=b?"-1":this.tabIndex;k&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(a("mozilla")&&!b&&this._mozSettingProps){b=this._mozSettingProps;for(var e in b)if(b.hasOwnProperty(e))try{this.document.execCommand(e,
!1,b[e])}catch(O){}}this._disabledOK=!0}},onLoad:function(k){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=U.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var e=this;this.beforeIframeNode=c.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=c.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){e.editNode.focus()};this.focusNode=
this.editNode;var g=this.events.concat(this.captureEvents),d=this.iframe?this.document:this.editNode;this.own.apply(this,t.map(g,function(a){var k=a.toLowerCase().replace(/^on/,"");return q(d,k,b.hitch(this,a))},this));this.own(q(d,"mouseup",b.hitch(this,"onClick")));a("ie")&&(this.own(q(this.document,"mousedown",b.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);a("webkit")&&(this._webkitListener=this.own(q(this.document,"mouseup",b.hitch(this,"onDisplayChanged")))[0],this.own(q(this.document,
"mousedown",b.hitch(this,function(a){a=a.target;!a||a!==this.document.body&&a!==this.document||this.defer("placeCursorAtEnd")}))));if(a("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(J){}this.isLoaded=!0;this.set("disabled",this.disabled);g=b.hitch(this,function(){this.setValue(k);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&r(b.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(g):g()},onKeyDown:function(b){if(b.keyCode===m.SHIFT||b.keyCode===m.ALT||b.keyCode===m.META||b.keyCode===m.CTRL)return!0;b.keyCode===m.TAB&&this.isTabIndent&&(b.stopPropagation(),b.preventDefault(),this.queryCommandEnabled(b.shiftKey?"outdent":"indent")&&this.execCommand(b.shiftKey?"outdent":"indent"));if(b.keyCode==m.TAB&&!this.isTabIndent&&!b.ctrlKey&&!b.altKey)return b.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>a("ie")&&b.keyCode===m.BACKSPACE&&"Control"===this.document.selection.type&&(b.stopPropagation(),b.preventDefault(),this.execCommand("delete"));a("ff")&&(b.keyCode===m.PAGE_UP||b.keyCode===m.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&b.preventDefault();var e=this._keyHandlers[b.keyCode],k=arguments;e&&!b.altKey&&t.some(e,function(a){if(!(a.shift^b.shiftKey||a.ctrl^(b.ctrlKey||b.metaKey)))return a.handler.apply(this,k)||b.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(a){w.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",a)},_setValueAttr:function(a){this.setValue(a)},_setDisableSpellCheckAttr:function(a){this.document?f.set(this.document.body,"spellcheck",!a):this.onLoadDeferred.then(b.hitch(this,function(){f.set(this.document.body,"spellcheck",!a)}));this._set("disableSpellCheck",a)},addKeyHandler:function(a,e,c,g){"string"==
typeof a&&(a=a.toUpperCase().charCodeAt(0));b.isArray(this._keyHandlers[a])||(this._keyHandlers[a]=[]);this._keyHandlers[a].push({shift:c||!1,ctrl:e||!1,handler:g})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(a){this.onDisplayChanged(a)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(b){(a("ie")||a("trident"))&&this.defer(function(){U.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var e=this.getValue(!0);if(e!==this.value)this.onChange(e);
this._set("value",e)},_onFocus:function(a){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!a("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>a("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(b,e){var k=b.toLowerCase();"formatblock"===k?a("safari")&&void 0===e&&(k="heading"):"hilitecolor"!==k||a("mozilla")||(k="backcolor");return k},_qcaCache:{},queryCommandAvailable:function(a){var b=this._qcaCache[a];return void 0!==
b?b:this._qcaCache[a]=this._queryCommandAvailable(a)},_queryCommandAvailable:function(b){switch(b.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return a("ie")||a("trident")||a("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!a("webkit");default:return!1}},execCommand:function(b,e){var k;this.focused&&this.focus();b=this._normalizeCommand(b,e);if(void 0!==e){if("heading"===b)throw Error("unimplemented");"formatblock"===
b&&(a("ie")||a("trident"))&&(e="\x3c"+e+"\x3e")}var c="_"+b+"Impl";if(this[c])k=this[c](e);else if((e=1<arguments.length?e:null)||"createlink"!==b)k=this.document.execCommand(b,!1,e);this.onDisplayChanged();return k},queryCommandEnabled:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);var b="_"+a+"EnabledImpl";return this[b]?this[b](a):this._browserQueryCommandEnabled(a)},queryCommandState:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);
try{return this.document.queryCommandState(a)}catch(B){return!1}},queryCommandValue:function(b){if(this.disabled||!this._disabledOK)return!1;b=this._normalizeCommand(b);if(a("ie")&&"formatblock"===b)b=this._native2LocalFormatNames[this.document.queryCommandValue(b)];else if(a("mozilla")&&"hilitecolor"===b){var e;try{e=this.document.queryCommandValue("styleWithCSS")}catch(A){e=!1}this.document.execCommand("styleWithCSS",!1,!0);b=this.document.queryCommandValue(b);this.document.execCommand("styleWithCSS",
!1,e)}else b=this.document.queryCommandValue(b);return b},_sCall:function(a,b){return this.selection[a].apply(this.selection,b)},placeCursorAtStart:function(){this.focus();var b=!1;if(a("mozilla"))for(var e=this.editNode.firstChild;e;){if(3===e.nodeType){if(0<e.nodeValue.replace(/^\s+|\s+$/g,"").length){b=!0;this.selection.selectElement(e);break}}else if(1===e.nodeType){var b=!0,c=e.tagName?e.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(c)?this.selection.selectElement(e):
this.selection.selectElementChildren(e);break}e=e.nextSibling}else b=!0,this.selection.selectElementChildren(this.editNode);b&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var b=!1;if(a("mozilla"))for(var e=this.editNode.lastChild;e;){if(3===e.nodeType){if(0<e.nodeValue.replace(/^\s+|\s+$/g,"").length){b=!0;this.selection.selectElement(e);break}}else if(1===e.nodeType){b=!0;this.selection.selectElement(e.lastChild||e);break}e=e.previousSibling}else b=!0,this.selection.selectElementChildren(this.editNode);
b&&this.selection.collapse(!1)},getValue:function(a){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,a):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(a){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){a=this._preFilterContent(a);var e=this.isClosed?this.domNode:this.editNode;e.innerHTML=a;this._preDomFilterContent(e)}else this.textarea.value=a;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(b.hitch(this,function(){this.setValue(a)}))},replaceValue:function(b){this.isClosed?this.setValue(b):this.window&&this.window.getSelection&&!a("mozilla")?this.setValue(b):this.window&&this.window.getSelection?(b=this._preFilterContent(b),this.execCommand("selectall"),this.execCommand("inserthtml",b),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(b);this._set("value",this.getValue(!0))},_preFilterContent:function(a){var b=
a;t.forEach(this.contentPreFilters,function(a){a&&(b=a(b))});return b},_preDomFilterContent:function(a){a=a||this.editNode;t.forEach(this.contentDomPreFilters,function(e){e&&b.isFunction(e)&&e(a)},this)},_postFilterContent:function(a,e){var c;b.isString(a)?c=a:(a=a||this.editNode,this.contentDomPostFilters.length&&(e&&(a=b.clone(a)),t.forEach(this.contentDomPostFilters,function(b){a=b(a)})),c=G.getChildrenHtml(a));b.trim(c.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(c="");t.forEach(this.contentPostFilters,
function(a){c=a(c)});return c},_saveContent:function(){var a=l.byId(R._scopeName+"._editor.RichText.value");a&&(a.value&&(a.value+=this._SEPARATOR),a.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(a,b){a=a.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");b||(a=a.replace(/'/gm,"\x26#39;"));return a},getNodeHtml:function(a){w.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return G.getNodeHtml(a)},getNodeChildrenHtml:function(a){w.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return G.getChildrenHtml(a)},close:function(b){if(!this.isClosed){arguments.length||(b=!0);b&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);a("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var e=this.textarea.style;e.position="";e.left=e.top="";a("ie")&&(e.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;c.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;d.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);D._globalSaveHandler&&delete D._globalSaveHandler[this.id]},_removeMozBogus:function(a){return a.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(a){a=a.replace(/\sclass="webkit-block-placeholder"/gi,"");a=a.replace(/\sclass="apple-style-span"/gi,
"");return a=a.replace(/<meta charset=\"utf-8\" \/>/gi,"")},_normalizeFontStyle:function(a){return a.replace(/<(\/)?strong([ \>])/gi,"\x3c$1b$2").replace(/<(\/)?em([ \>])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(a){return a.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(b){if(!b)return!1;
if(a("ie")||a("trident")||a("edge"))return this.focused&&!this.disabled;var e=9>a("ie")?this.document.selection.createRange():this.document;try{return e.queryCommandEnabled(b)}catch(A){return!1}},_createlinkEnabledImpl:function(){var b=!0;return b=a("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var b=!0;return b=a("mozilla")||a("webkit")||a("ie")||a("trident")||a("edge")?
this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var b=!0;return b=a("mozilla")||a("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var b=!0;a("webkit")?((b=this.window.getSelection())&&(b=b.toString()),b=!!b):b=this._browserQueryCommandEnabled("cut");return b},_copyEnabledImpl:function(){var b=!0;a("webkit")?((b=this.window.getSelection())&&(b=b.toString()),b=!!b):b=this._browserQueryCommandEnabled("copy");
return b},_pasteEnabledImpl:function(){var b=!0;return a("webkit")?!0:b=this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(b){return a("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,b)},_unlinkImpl:function(b){return this.queryCommandEnabled("unlink")&&(a("mozilla")||a("webkit"))?(b=this.selection.getAncestorElement("a"),this.selection.selectElement(b),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",
!1,b)},_hilitecolorImpl:function(b){var e;this._handleTextColorOrProperties("hilitecolor",b)||(a("mozilla")?(this.document.execCommand("styleWithCSS",!1,!0),console.log("Executing color command."),e=this.document.execCommand("hilitecolor",!1,b),this.document.execCommand("styleWithCSS",!1,!1)):e=this.document.execCommand("hilitecolor",!1,b));return e},_backcolorImpl:function(b){a("ie")&&(b=b?b:null);var e=this._handleTextColorOrProperties("backcolor",b);e||(e=this.document.execCommand("backcolor",
!1,b));return e},_forecolorImpl:function(b){a("ie")&&(b=b?b:null);var e=!1;(e=this._handleTextColorOrProperties("forecolor",b))||(e=this.document.execCommand("forecolor",!1,b));return e},_inserthtmlImpl:function(b){b=this._preFilterContent(b);var e=!0;if(9>a("ie")){var g=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var k=g.item(0);g.length;)g.remove(g.item(0));k.outerHTML=b}else g.pasteHTML(b);g.select()}else if(8>a("trident")){var d=C.getSelection(this.window);
if(d&&d.rangeCount&&d.getRangeAt){g=d.getRangeAt(0);g.deleteContents();var h=c.create("div");h.innerHTML=b;for(var u,k=this.document.createDocumentFragment();b=h.firstChild;)u=k.appendChild(b);g.insertNode(k);u&&(g=g.cloneRange(),g.setStartAfter(u),g.collapse(!1),d.removeAllRanges(),d.addRange(g))}}else a("mozilla")&&!b.length?this.selection.remove():e=this.document.execCommand("inserthtml",!1,b);return e},_boldImpl:function(b){var e=!1;if(a("ie")||a("trident"))this._adaptIESelection(),e=this._adaptIEFormatAreaAndExec("bold");
e||(e=this.document.execCommand("bold",!1,b));return e},_italicImpl:function(b){var e=!1;if(a("ie")||a("trident"))this._adaptIESelection(),e=this._adaptIEFormatAreaAndExec("italic");e||(e=this.document.execCommand("italic",!1,b));return e},_underlineImpl:function(b){var e=!1;if(a("ie")||a("trident"))this._adaptIESelection(),e=this._adaptIEFormatAreaAndExec("underline");e||(e=this.document.execCommand("underline",!1,b));return e},_strikethroughImpl:function(b){var e=!1;if(a("ie")||a("trident"))this._adaptIESelection(),
e=this._adaptIEFormatAreaAndExec("strikethrough");e||(e=this.document.execCommand("strikethrough",!1,b));return e},_superscriptImpl:function(b){var e=!1;if(a("ie")||a("trident"))this._adaptIESelection(),e=this._adaptIEFormatAreaAndExec("superscript");e||(e=this.document.execCommand("superscript",!1,b));return e},_subscriptImpl:function(b){var e=!1;if(a("ie")||a("trident"))this._adaptIESelection(),e=this._adaptIEFormatAreaAndExec("subscript");e||(e=this.document.execCommand("subscript",!1,b));return e},
_fontnameImpl:function(b){var e;if(a("ie")||a("trident"))e=this._handleTextColorOrProperties("fontname",b);e||(e=this.document.execCommand("fontname",!1,b));return e},_fontsizeImpl:function(b){var e;if(a("ie")||a("trident"))e=this._handleTextColorOrProperties("fontsize",b);e||(e=this.document.execCommand("fontsize",!1,b));return e},_insertorderedlistImpl:function(b){var e=!1;if(a("ie")||a("trident")||a("edge"))e=this._adaptIEList("insertorderedlist",b);e||(e=this.document.execCommand("insertorderedlist",
!1,b));return e},_insertunorderedlistImpl:function(b){var e=!1;if(a("ie")||a("trident")||a("edge"))e=this._adaptIEList("insertunorderedlist",b);e||(e=this.document.execCommand("insertunorderedlist",!1,b));return e},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(a){var b=0;if(a&&a.childNodes){var e;for(e=0;e<a.childNodes.length;e++)var c=h.position(a.childNodes[e]),
b=b+c.h}return b},_isNodeEmpty:function(a,b){return 1===a.nodeType?0<a.childNodes.length?this._isNodeEmpty(a.childNodes[0],b):!0:3===a.nodeType?""===a.nodeValue.substring(b):!1},_removeStartingRangeFromRange:function(a,b){if(a.nextSibling)b.setStart(a.nextSibling,0);else{for(var e=a.parentNode;e&&null==e.nextSibling;)e=e.parentNode;e&&b.setStart(e.nextSibling,0)}return b},_adaptIESelection:function(){var a=C.getSelection(this.window);if(a&&a.rangeCount&&!a.isCollapsed){for(var b=a.getRangeAt(0),e=
b.startContainer,c=b.startOffset;3===e.nodeType&&c>=e.length&&e.nextSibling;)c-=e.length,e=e.nextSibling;for(var g=null;this._isNodeEmpty(e,c)&&e!==g;)g=e,b=this._removeStartingRangeFromRange(e,b),e=b.startContainer,c=0;a.removeAllRanges();a.addRange(b)}},_adaptIEFormatAreaAndExec:function(a){var b=C.getSelection(this.window),e=this.document,g,d,k,h,u,r,f;if(a&&b&&b.isCollapsed){if(this.queryCommandValue(a)){a=this._tagNamesForCommand(a);k=b.getRangeAt(0);h=k.startContainer;3===h.nodeType&&(d=k.endOffset,
h.length<d&&(d=this._adjustNodeAndOffset(g,d),h=d.node,d=d.offset));for(;h&&h!==this.editNode;){g=h.tagName?h.tagName.toLowerCase():"";if(-1<t.indexOf(a,g)){f=h;break}h=h.parentNode}if(f&&(g=k.startContainer,a=e.createElement(f.tagName),c.place(a,f,"after"),g&&3===g.nodeType)){d=k.endOffset;g.length<d&&(d=this._adjustNodeAndOffset(g,d),g=d.node,d=d.offset);h=g.nodeValue;k=e.createTextNode(h.substring(0,d));var m=h.substring(d,h.length);m&&(u=e.createTextNode(m));c.place(k,g,"before");u&&(r=e.createElement("span"),
r.className="ieFormatBreakerSpan",c.place(r,g,"after"),c.place(u,r,"after"),u=r);c.destroy(g);d=k.parentNode;for(g=[];d!==f;){h=d.tagName;k={tagName:h};g.push(k);h=e.createElement(h);d.style&&h.style&&d.style.cssText&&(h.style.cssText=d.style.cssText,k.cssText=d.style.cssText);"FONT"===d.tagName&&(d.color&&(h.color=d.color,k.color=d.color),d.face&&(h.face=d.face,k.face=d.face),d.size&&(h.size=d.size,k.size=d.size));d.className&&(h.className=d.className,k.className=d.className);if(u)for(;u;)k=u.nextSibling,
h.appendChild(u),u=k;h.tagName==d.tagName?(r=e.createElement("span"),r.className="ieFormatBreakerSpan",c.place(r,d,"after"),c.place(h,r,"after")):c.place(h,d,"after");k=d;u=h;d=d.parentNode}if(u){if(1===u.nodeType||3===u.nodeType&&u.nodeValue)a.innerHTML="";for(;u;)k=u.nextSibling,a.appendChild(u),u=k}if(g.length){k=g.pop();u=e.createElement(k.tagName);k.cssText&&u.style&&(u.style.cssText=k.cssText);k.className&&(u.className=k.className);"FONT"===k.tagName&&(k.color&&(u.color=k.color),k.face&&(u.face=
k.face),k.size&&(u.size=k.size));for(c.place(u,a,"before");g.length;)k=g.pop(),f=e.createElement(k.tagName),k.cssText&&f.style&&(f.style.cssText=k.cssText),k.className&&(f.className=k.className),"FONT"===k.tagName&&(k.color&&(f.color=k.color),k.face&&(f.face=k.face),k.size&&(f.size=k.size)),u.appendChild(f),u=f;f=e.createTextNode(".");r.appendChild(f);u.appendChild(f)}else r=e.createElement("span"),r.className="ieFormatBreakerSpan",f=e.createTextNode("."),r.appendChild(f),c.place(r,a,"before");u=
C.create(this.window);u.setStart(f,0);u.setEnd(f,f.length);b.removeAllRanges();b.addRange(u);this.selection.collapse(!1);f.parentNode.innerHTML="";a.firstChild||c.destroy(a);return!0}return!1}k=b.getRangeAt(0);if((g=k.startContainer)&&3===g.nodeType)return d=k.startOffset,g.length<d&&(d=this._adjustNodeAndOffset(g,d),g=d.node,d=d.offset),h=g.nodeValue,k=e.createTextNode(h.substring(0,d)),m=h.substring(d),""!==m&&(u=e.createTextNode(h.substring(d))),r=e.createElement("span"),f=e.createTextNode("."),
r.appendChild(f),k.length?c.place(k,g,"after"):k=g,c.place(r,k,"after"),u&&c.place(u,r,"after"),c.destroy(g),u=C.create(this.window),u.setStart(f,0),u.setEnd(f,f.length),b.removeAllRanges(),b.addRange(u),e.execCommand(a),c.place(r.firstChild,r,"before"),c.destroy(r),u.setStart(f,0),u.setEnd(f,f.length),b.removeAllRanges(),b.addRange(u),this.selection.collapse(!1),f.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(a){var b=C.getSelection(this.window);if(b.isCollapsed&&b.rangeCount&&
!this.queryCommandValue(a)){var e=b.getRangeAt(0),g=e.startContainer;if(g&&3==g.nodeType&&!e.startOffset)return e="ul","insertorderedlist"===a&&(e="ol"),a=this.document.createElement(e),e=c.create("li",null,a),c.place(a,g,"before"),e.appendChild(g),c.create("br",null,a,"after"),a=C.create(this.window),a.setStart(g,0),a.setEnd(g,g.length),b.removeAllRanges(),b.addRange(a),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(b,e){var g=C.getSelection(this.window),d=this.document,
k,h,u,f,r;e=e||null;if(b&&g&&g.isCollapsed&&g.rangeCount&&(h=g.getRangeAt(0),(k=h.startContainer)&&3===k.nodeType)){r=h.startOffset;k.length<r&&(h=this._adjustNodeAndOffset(k,r),k=h.node,r=h.offset);u=k.nodeValue;h=d.createTextNode(u.substring(0,r));""!==u.substring(r)&&(f=d.createTextNode(u.substring(r)));u=d.createElement("span");r=d.createTextNode(".");u.appendChild(r);d=d.createElement("span");u.appendChild(d);h.length?c.place(h,k,"after"):h=k;c.place(u,h,"after");f&&c.place(f,u,"after");c.destroy(k);
k=C.create(this.window);k.setStart(r,0);k.setEnd(r,r.length);g.removeAllRanges();g.addRange(k);if(a("webkit")){g="color";if("hilitecolor"===b||"backcolor"===b)g="backgroundColor";y.set(u,g,e);this.selection.remove();c.destroy(d);u.innerHTML="\x26#160;";this.selection.selectElement(u);this.focus()}else this.execCommand(b,e),c.place(u.firstChild,u,"before"),c.destroy(u),k.setStart(r,0),k.setEnd(r,r.length),g.removeAllRanges(),g.addRange(k),this.selection.collapse(!1),r.parentNode.removeChild(r);return!0}return!1},
_adjustNodeAndOffset:function(a,b){for(;a.length<b&&a.nextSibling&&3===a.nextSibling.nodeType;)b-=a.length,a=a.nextSibling;return{node:a,offset:b}},_tagNamesForCommand:function(a){return"bold"===a?["b","strong"]:"italic"===a?["i","em"]:"strikethrough"===a?["s","strike"]:"superscript"===a?["sup"]:"subscript"===a?["sub"]:"underline"===a?["u"]:[]},_stripBreakerNodes:function(a){if(this.isLoaded)return g(".ieFormatBreakerSpan",a).forEach(function(a){for(;a.firstChild;)c.place(a.firstChild,a,"before");
c.destroy(a)}),a},_stripTrailingEmptyNodes:function(a){function b(a){return/^(p|div|br)$/i.test(a.nodeName)&&0==a.children.length&&/^[\s\xA0]*$/.test(a.textContent||a.innerText||"")||3===a.nodeType&&/^[\s\xA0]*$/.test(a.nodeValue)}for(;a.lastChild&&b(a.lastChild);)c.destroy(a.lastChild);return a},_setTextDirAttr:function(a){this._set("textDir",a);this.onLoadDeferred.then(b.hitch(this,function(){this.editNode.dir=a}))}});return D})},"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare",
"dojo/_base/lang"],function(t,n,p){var v={getIndex:function(d,c){for(var h=[],f=[],l=d,m,b;d!=c;){var q=0;for(m=d.parentNode;b=m.childNodes[q++];)if(b===d){--q;break}h.unshift(q);f.unshift(q-m.childNodes.length);d=m}if(0<h.length&&3==l.nodeType){for(b=l.previousSibling;b&&3==b.nodeType;)h[h.length-1]--,b=b.previousSibling;for(b=l.nextSibling;b&&3==b.nodeType;)f[f.length-1]++,b=b.nextSibling}return{o:h,r:f}},getNode:function(d,c){if(!p.isArray(d)||0==d.length)return c;var h=c;t.every(d,function(c){if(0<=
c&&c<h.childNodes.length)h=h.childNodes[c];else return h=null,!1;return!0});return h},getCommonAncestor:function(d,c,h){h=h||d.ownerDocument.body;var f=function(b){for(var c=[];b;)if(c.unshift(b),b!==h)b=b.parentNode;else break;return c};d=f(d);c=f(c);for(var f=Math.min(d.length,c.length),l=d[0],m=1;m<f;m++)if(d[m]===c[m])l=d[m];else break;return l},getAncestor:function(d,c,h){for(h=h||d.ownerDocument.body;d&&d!==h;){var f=d.nodeName.toUpperCase();if(c.test(f))return d;d=d.parentNode}return null},
BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(d,c,h){h=h||d.ownerDocument.body;c=c||v.BlockTagNames;for(var f=null,l;d&&d!==h;){var m=d.nodeName.toUpperCase();!f&&c.test(m)&&(f=d);!l&&/^(?:BODY|TD|TH|CAPTION)$/.test(m)&&(l=d);d=d.parentNode}return{blockNode:f,blockContainer:l||d.ownerDocument.body}},atBeginningOfContainer:function(d,c,h){var f=!1,l=0==h;l||3!=c.nodeType||/^[\s\xA0]+$/.test(c.nodeValue.substr(0,h))&&(l=!0);if(l)for(f=!0;c&&c!==d;){if(c.previousSibling){f=
!1;break}c=c.parentNode}return f},atEndOfContainer:function(d,c,h){var f=!1,l=h==(c.length||c.childNodes.length);l||3!=c.nodeType||/^[\s\xA0]+$/.test(c.nodeValue.substr(h))&&(l=!0);if(l)for(f=!0;c&&c!==d;){if(c.nextSibling){f=!1;break}c=c.parentNode}return f},adjacentNoneTextNode:function(d,c){for(var h=d,f=0-d.length||0,l=c?"nextSibling":"previousSibling";h&&3==h.nodeType;)f+=h.length,h=h[l];return[h,f]},create:function(d){d=d||window;return d.getSelection?d.document.createRange():new f},getSelection:function(d,
c){if(d.getSelection)return d.getSelection();var h=new l.selection(d);c||h._getCurrentSelection();return h}};if(!window.getSelection)var l=v.ie={cachedSelection:{},selection:function(d){this._ranges=[];this.addRange=function(c,d){this._ranges.push(c);d||c._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(c){return this._ranges[c]};this._getCurrentSelection=function(){this.removeAllRanges();var c;c=d.document.selection.createRange();
c="CONTROL"==d.document.selection.type.toUpperCase()?new f(l.decomposeControlRange(c)):new f(l.decomposeTextRange(c));this.addRange(c,!0),this.isCollapsed=c.collapsed}},decomposeControlRange:function(d){var c=d.item(0),h=d.item(d.length-1);d=c.parentNode;var f=h.parentNode,c=v.getIndex(c,d).o[0],h=v.getIndex(h,f).o[0]+1;return[d,c,f,h]},getEndPoint:function(d,c){var h=d.duplicate();h.collapse(!c);var f="EndTo"+(c?"End":"Start"),l=h.parentElement(),m,b,q;0<l.childNodes.length?t.every(l.childNodes,
function(c,a){var e;if(3!=c.nodeType)if(h.moveToElementText(c),0<h.compareEndPoints(f,d))if(q&&3==q.nodeType)m=q,e=!0;else return m=l,b=a,!1;else{if(a==l.childNodes.length-1)return m=l,b=l.childNodes.length,!1}else a==l.childNodes.length-1&&(m=c,e=!0);if(e&&m){m=(e=v.adjacentNoneTextNode(m)[0])?e.nextSibling:l.firstChild;var g=v.adjacentNoneTextNode(m);e=g[0];g=g[1];e?(h.moveToElementText(e),h.collapse(!1)):h.moveToElementText(l);h.setEndPoint(f,d);b=h.text.length-g;return!1}q=c;return!0}):(m=l,b=
0);if(!c&&1==m.nodeType&&b==m.childNodes.length){var g=m.nextSibling;g&&3==g.nodeType&&(m=g,b=0)}return[m,b]},setEndPoint:function(d,c,h){d=d.duplicate();var f;if(3!=c.nodeType)if(0<h){if(f=c.childNodes[h-1])if(3==f.nodeType)c=f,h=f.length;else if(f.nextSibling&&3==f.nextSibling.nodeType)c=f.nextSibling,h=0;else{d.moveToElementText(f.nextSibling?f:c);var l=f.parentNode;f=l.insertBefore(f.ownerDocument.createTextNode(" "),f.nextSibling);d.collapse(!1);l.removeChild(f)}}else d.moveToElementText(c),
d.collapse(!0);3==c.nodeType&&(f=v.adjacentNoneTextNode(c),l=f[0],f=f[1],l?(d.moveToElementText(l),d.collapse(!1),"inherit"!=l.contentEditable&&f++):(d.moveToElementText(c.parentNode),d.collapse(!0),d.move("character",1),d.move("character",-1)),h+=f,0<h&&d.move("character",h)!=h&&console.error("Error when moving!"));return d},decomposeTextRange:function(d){var c=l.getEndPoint(d),h=c[0],f=c[1],w=c[0],c=c[1];d.htmlText.length&&(d.htmlText==d.text?c=f+d.text.length:(c=l.getEndPoint(d,!0),w=c[0],c=c[1]));
return[h,f,w,c]},setRange:function(d,c,h,f,w,m){c=l.setEndPoint(d,c,h);d.setEndPoint("StartToStart",c);if(!m)var b=l.setEndPoint(d,f,w);d.setEndPoint("EndToEnd",b||c);return d}},f=v.W3CRange=n(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=
this.startContainer!==this.endContainer?v.getCommonAncestor(this.startContainer,this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(d,c){c=parseInt(c);if(this.startContainer!==d||this.startOffset!=c)delete this._cachedBookmark,this.startContainer=d,this.startOffset=c,this.endContainer?this._updateInternal():this.setEnd(d,c)},setEnd:function(d,c){c=parseInt(c);if(this.endContainer!==d||this.endOffset!=c)delete this._cachedBookmark,
this.endContainer=d,this.endOffset=c,this.startContainer?this._updateInternal():this.setStart(d,c)},setStartAfter:function(d,c){this._setPoint("setStart",d,c,1)},setStartBefore:function(d,c){this._setPoint("setStart",d,c,0)},setEndAfter:function(d,c){this._setPoint("setEnd",d,c,1)},setEndBefore:function(d,c){this._setPoint("setEnd",d,c,0)},_setPoint:function(d,c,h,f){h=v.getIndex(c,c.parentNode).o;this[d](c.parentNode,h.pop()+f)},_getIERange:function(){var d=(this._body||this.endContainer.ownerDocument.body).createTextRange();
l.setRange(d,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return d},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var d=this.startContainer,c=this._getIERange();3!==d.nodeType||this.startOffset||this.setStartBefore(d);c.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var d=new f([this.startContainer,
this.startOffset,this.endContainer,this.endOffset]);d._body=this._body;return d},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});p.setObject("dijit.range",v);return v})},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],function(t,n,p){var v={};n.setObject("dijit._editor.html",v);var l=v.escapeXml=function(f,d){f=f.replace(/&/gm,"\x26amp;").replace(/</gm,
"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");d||(f=f.replace(/'/gm,"\x26#39;"));return f};v.getNodeHtml=function(f){var d=[];v.getNodeHtmlHelper(f,d);return d.join("")};v.getNodeHtmlHelper=function(f,d){switch(f.nodeType){case 1:var c=f.nodeName.toLowerCase();if(!c||"/"==c.charAt(0))return"";d.push("\x3c",c);var h=[],n={},w;if(p("dom-attributes-explicit")||p("dom-attributes-specified-flag"))for(var m=0;w=f.attributes[m++];){var b=w.name;"_dj"===b.substr(0,3)||p("dom-attributes-specified-flag")&&
!w.specified||b in n||(w=w.value,("src"==b||"href"==b)&&f.getAttribute("_djrealurl")&&(w=f.getAttribute("_djrealurl")),8===p("ie")&&"style"===b&&(w=w.replace("HEIGHT:","height:").replace("WIDTH:","width:")),h.push([b,w]),n[b]=w)}else{var q=(/^input$|^img$/i.test(f.nodeName)?f:f.cloneNode(!1)).outerHTML,n=q.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi),q=q.substr(0,q.indexOf("\x3e"));t.forEach(n,function(b){if(b){var g=b.indexOf("\x3d");if(0<g&&(b=b.substring(0,g),"_dj"!=b.substr(0,3)))if("src"!=b&&"href"!=
b||!f.getAttribute("_djrealurl")){var a;switch(b){case "style":a=f.style.cssText.toLowerCase();break;case "class":a=f.className;break;case "width":if("img"===c){(g=/width=(\S+)/i.exec(q))&&(a=g[1]);break}case "height":if("img"===c){(g=/height=(\S+)/i.exec(q))&&(a=g[1]);break}default:a=f.getAttribute(b)}null!=a&&h.push([b,a.toString()])}else h.push([b,f.getAttribute("_djrealurl")])}},this)}h.sort(function(b,c){return b[0]<c[0]?-1:b[0]==c[0]?0:1});for(n=0;w=h[n++];)d.push(" ",w[0],'\x3d"',"string"===
typeof w[1]?l(w[1],!0):w[1],'"');switch(c){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":d.push(" /\x3e");break;case "script":d.push("\x3e",f.innerHTML,"\x3c/",c,"\x3e");break;default:d.push("\x3e"),f.hasChildNodes()&&v.getChildrenHtmlHelper(f,d),d.push("\x3c/",c,"\x3e")}break;case 4:case 3:d.push(l(f.nodeValue,!0));break;case 8:d.push("\x3c!--",l(f.nodeValue,!0),"--\x3e");break;default:d.push("\x3c!-- Element not recognized - Type: ",f.nodeType," Name: ",
f.nodeName,"--\x3e")}};v.getChildrenHtml=function(f){var d=[];v.getChildrenHtmlHelper(f,d);return d.join("")};v.getChildrenHtmlHelper=function(f,d){if(f)for(var c=f.childNodes||f,h=!p("ie")||c!==f,l,n=0;l=c[n++];)h&&l.parentNode!=f||v.getNodeHtmlHelper(l,d)};return v})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),function(t,
n,p,v,l,f,d,c,h,y,w,m){var b=n("dijit._editor.plugins.LinkDialog",y,{buttonClass:w,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=l.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(b){t("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),l.hitch(this,function(c,a,e){var g=this;this.tag="insertImage"==this.command?"img":"a";c=l.delegate(c.getLocalization("dijit","common",this.lang),c.getLocalization("dijit._editor",
"LinkDialog",this.lang));var d=this.dropDown=this.button.dropDown=new a({title:c[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:l.hitch(this,"setValue"),onOpen:function(){g._onOpenDialog();a.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(l.hitch(g,"_onCloseDialog"),0)}});c.urlRegExp=this.urlRegExp;c.id=e.getUniqueId(this.editor.id);this._uniqueId=c.id;this._setContent(d.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
h.substitute(this.linkDialogTemplate,c));d.startup();this._urlInput=e.byId(this._uniqueId+"_urlInput");this._textInput=e.byId(this._uniqueId+"_textInput");this._setButton=e.byId(this._uniqueId+"_setButton");this.own(e.byId(this._uniqueId+"_cancelButton").on("click",l.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",l.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",l.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=l.hitch(this,function(){var a=this._urlInput.get("value");return this._urlRegExp.test(a)||this._emailRegExp.test(a)});this.own(f(d.domNode,"keydown",l.hitch(this,l.hitch(this,function(a){!a||a.keyCode!=v.ENTER||a.shiftKey||a.metaKey||a.ctrlKey||a.altKey||this._setButton.get("disabled")||(d.onExecute(),d.execute(d.get("value")))}))));b()}))},_checkAndFixInput:function(){var b=this,c=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var a=c,e=!1,d=!1;a&&1<a.length&&(a=l.trim(a),0!==a.indexOf("mailto:")&&(0<a.indexOf("/")?-1===a.indexOf("://")&&"/"!==a.charAt(0)&&a.indexOf("./")&&0!==a.indexOf("../")&&b._hostRxp.test(a)&&(e=!0):b._userAtRxp.test(a)&&(d=!0)));e&&b._urlInput.set("value","http://"+a);d&&b._urlInput.set("value","mailto:"+a);b._setButton.set("disabled",!b._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(l.hitch(this,
function(){this.own(f(this.editor.editNode,"dblclick",l.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(b){this.dropDown.set({parserScope:"dojo",content:b})},_checkValues:function(b){b&&b.urlInput&&(b.urlInput=b.urlInput.replace(/"/g,"\x26quot;"));return b},setValue:function(b){this._onCloseDialog();if(9>d("ie")){var g=m.getSelection(this.editor.window).getRangeAt(0).endContainer;3===g.nodeType&&(g=g.parentNode);
g&&g.nodeName&&g.nodeName.toLowerCase()!==this.tag&&(g=this.editor.selection.getSelectedElement(this.tag));g&&g.nodeName&&g.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(g),this.editor.execCommand("unlink"))}b=this._checkValues(b);this.editor.execCommand("inserthtml",h.substitute(this.htmlTemplate,b));c("a",this.editor.document).forEach(function(a){a.innerHTML||p.has(a,"name")||a.parentNode.removeChild(a)},this)},_onCloseDialog:function(){this.editor.focused&&
this.editor.focus()},_getCurrentValues:function(b){var c,a,e;b&&b.tagName.toLowerCase()===this.tag?(c=b.getAttribute("_djrealurl")||b.getAttribute("href"),e=b.getAttribute("target")||"_self",a=b.textContent||b.innerText,this.editor.selection.selectElement(b,!0)):a=this.editor.selection.getSelectedText();return{urlInput:c||"",textInput:a||"",targetSelect:e||""}},_onOpenDialog:function(){var b,c;if(d("ie")){if(c=m.getSelection(this.editor.window),c.rangeCount){var a=c.getRangeAt(0);b=a.endContainer;
3===b.nodeType&&(b=b.parentNode);b&&b.nodeName&&b.nodeName.toLowerCase()!==this.tag&&(b=this.editor.selection.getSelectedElement(this.tag));if(!b||b.nodeName&&b.nodeName.toLowerCase()!==this.tag)(c=this.editor.selection.getAncestorElement(this.tag))&&c.nodeName&&c.nodeName.toLowerCase()==this.tag?(b=c,this.editor.selection.selectElement(b)):a.startContainer===a.endContainer&&(c=a.startContainer.firstChild)&&c.nodeName&&c.nodeName.toLowerCase()==this.tag&&(b=c,this.editor.selection.selectElement(b))}}else b=
this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(b))},_onDblClick:function(b){if(b&&b.target&&(b=b.target,(b.tagName?b.tagName.toLowerCase():"")===this.tag&&p.get(b,"href"))){var c=this.editor;this.editor.selection.selectElement(b);c.onDisplayChanged();c._updateTimer&&(c._updateTimer.remove(),delete c._updateTimer);c.onNormalizedDisplayChanged();var a=this.button;setTimeout(function(){a.set("disabled",
!1);a.loadAndOpenDropDown().then(function(){a.dropDown.focus&&a.dropDown.focus()})},10)}}}),q=n("dijit._editor.plugins.ImgLinkDialog",[b],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(b){var c,a;b&&b.tagName.toLowerCase()===this.tag?(c=b.getAttribute("_djrealurl")||b.getAttribute("src"),a=b.getAttribute("alt"),this.editor.selection.selectElement(b,!0)):a=this.editor.selection.getSelectedText();return{urlInput:c||"",textInput:a||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);this.editor.onLoadDeferred.then(l.hitch(this,
function(){this.own(f(this.editor.editNode,"mousedown",l.hitch(this,"_selectTag")))}))},_selectTag:function(b){b&&b.target&&(b=b.target,(b.tagName?b.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(b))},_checkValues:function(b){b&&b.urlInput&&(b.urlInput=b.urlInput.replace(/"/g,"\x26quot;"));b&&b.textInput&&(b.textInput=b.textInput.replace(/"/g,"\x26quot;"));return b},_onDblClick:function(b){if(b&&b.target&&(b=b.target,(b.tagName?b.tagName.toLowerCase():"")===this.tag&&p.get(b,
"src"))){var c=this.editor;this.editor.selection.selectElement(b);c.onDisplayChanged();c._updateTimer&&(c._updateTimer.remove(),delete c._updateTimer);c.onNormalizedDisplayChanged();var a=this.button;setTimeout(function(){a.set("disabled",!1);a.loadAndOpenDropDown().then(function(){a.dropDown.focus&&a.dropDown.focus()})},10)}}});y.registry.createLink=function(){return new b({command:"createLink"})};y.registry.insertImage=function(){return new q({command:"insertImage"})};b.ImgLinkDialog=q;return b})},
"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(t,n,p,v,l,f){var d=p("dijit._editor.plugins.TextColor",l,{buttonClass:f,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;this.inherited(arguments);var c=this;this.button.loadDropDown=function(d){function h(h){c.button.dropDown=new h({dir:c.editor.dir,ownerDocument:c.editor.ownerDocument,
value:c.value,onChange:function(d){c.editor.execCommand(c.command,d)},onExecute:function(){c.editor.execCommand(c.command,this.get("value"))}});d()}"string"==typeof c.colorPicker?t([c.colorPicker],h):h(c.colorPicker)}},updateState:function(){var c=this.editor,d=this.command;if(c&&c.isLoaded&&d.length){if(this.button){var f=this.get("disabled");this.button.set("disabled",f);if(f)return;var l;try{l=c.queryCommandValue(d)||""}catch(m){l=""}}""==l&&(l="#000000");"transparent"==l&&(l="#ffffff");"string"==
typeof l?-1<l.indexOf("rgb")&&(l=n.fromRgb(l).toHex()):(l=((l&255)<<16|l&65280|(l&16711680)>>>16).toString(16),l="#000000".slice(0,7-l.length)+l);this.value=l;(c=this.button.dropDown)&&c.get&&l!==c.get("value")&&c.set("value",l,!1)}}});l.registry.foreColor=function(c){return new d(c)};l.registry.hiliteColor=function(c){return new d(c)};return d})},"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),
function(t,n,p,v,l,f,d,c,h,y,w,m,b,q,g,r,a){t=t([y,w],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,templateString:r,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"(\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e)",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},_layerEditingCap:{},
constructor:function(b,c){n.mixin(this,a.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);this._uploadField_connect=p.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=p.connect(this._uploadField,"onfocus",n.hitch(this,function(a){g.hide(this._attachmentError)}))},destroy:function(){v.forEach(this._aeConnects,p.disconnect);p.disconnect(this._uploadField_connect);p.disconnect(this._uploadFieldFocus_connect);
this.inherited(arguments)},showAttachments:function(a,b){this._attachmentList.innerHTML=this.NLS_none;this._uploadField.value="";v.forEach(this.domNode.children,function(a,b){g.show(a)});g.hide(this._attachmentError);a&&(this._featureLayer=a.getLayer()||b)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=
this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=this._featureLayer.getEditCapabilities({feature:a}).canUpdate,this._oid=a.attributes[this._featureLayer.objectIdField],this._getAttachments(a)):b&&b.getEditCapabilities()||(g.hide(this._uploadForm),v.forEach(this.domNode.children,function(a,b){g.hide(a)})))},_getAttachments:function(a){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,
n.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){g.hide(this._attachmentError);this._featureLayer&&this._featureLayer.addAttachment?(g.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,n.hitch(this,"_onAddAttachmentComplete"),n.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(a,b){this._tempUpload&&(g.show(this._attachmentProgress),b.addAttachment(a,this._tempUpload,n.hitch(this,"_onAddAttachmentComplete"),
n.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(a,b){g.show(this._attachmentProgress);this._featureLayer.deleteAttachments(a,[b],n.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(a){var b=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?
(b=this._listHtml+this._endHtml,this._uploadForm.style.display="none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(b=this._listHtml+this._endHtml);var e=this._attachmentList;a=v.map(a,n.hitch(this,function(a){return q.substitute({href:a.url,name:a.name,oid:a.objectId,attid:a.id},b)}));e.innerHTML=a.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(a){g.hide(this._attachmentProgress.domNode);var b=this._attachmentList,
e=this._uploadField,d=e.value,h=d.lastIndexOf("\\");-1<h&&(d=d.substring(h+1,d.length));var d=d.replace(/\ /g,"_"),h=c.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()}),f=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(f=this._listHtml+this._endHtml);a=q.substitute({href:this._featureLayer._url.path+"/"+a.objectId+"/attachments/"+a.attachmentId+
(h?"?"+h:""),name:d,oid:a.objectId,attid:a.attachmentId},f);b.innerHTML=b.innerHTML==this.NLS_none?a:b.innerHTML+a;this._updateConnects();e.value=""},_onAddAttachmentError:function(a){g.hide(this._attachmentProgress.domNode);if(a&&q.isDefined(a.code)){var b=this._attachmentError;h.set(b,"innerHTML",(400===a.code?this.NLS_fileNotSupported:a.message||a.details&&a.details.length&&a.details[0])||this.NLS_error);g.show(b)}},_onDeleteAttachmentComplete:function(a){g.hide(this._attachmentProgress.domNode);
var b=this._attachmentList;v.every(a,function(a){return a.success})&&(l.query("#node_"+a[0].objectId+"_"+a[0].attachmentId).orphan(),b.children&&b.children.length||(b.innerHTML=this.NLS_none))},_updateConnects:function(){v.forEach(this._aeConnects,p.disconnect);l.query(".deleteAttachment").forEach(function(a){this._aeConnects.push(p.connect(a,"onclick",n.hitch(this,"_deleteAttachment",this._oid,a.id)))},this)}});f("extend-esri")&&n.setObject("dijit.editing.AttachmentEditor",t,b);return t})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(t,n,p,v,l,f,d,c){return n("dijit.ProgressBar",[f,d],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:c,_indeterminateHighContrastImagePath:t.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(c){var d="rtl"==c.toLowerCase();p.toggle(this.domNode,"dijitProgressBarRtl",d);p.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&d);this.inherited(arguments)},update:function(c){v.mixin(this,c||{});c=this.internalProgress;var d=this.domNode,h=1;this.indeterminate?d.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(h=Math.min(parseFloat(this.progress)/100,1),this.progress=h*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),h=this.maximum?this.progress/this.maximum:0),d.setAttribute("aria-valuenow",this.progress));d.setAttribute("aria-labelledby",this.labelNode.id);d.setAttribute("aria-valuemin",0);d.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(h);p.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);p.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());c.style.width=100*h+"%";this.onChange()},_setValueAttr:function(c){this._set("value",
c);Infinity==c?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:c})},_setLabelAttr:function(c){this._set("label",c);this.update()},_setIndeterminateAttr:function(c){this._set("indeterminate",c);this.update()},report:function(c){return this.label?this.label:this.indeterminate?"\x26#160;":l.format(c,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(t,n,p,v){var l={},l={findFeatures:function(f,d,c){var h=d.objectIdField;d=n.filter(d.graphics,function(c){return n.some(f,function(d){return c.attributes[h]===d.objectId})});if(c)c(d);else return d},getSelection:function(f){var d=[];n.forEach(f,function(c){c=c.getSelectedFeatures();n.forEach(c,function(c){d.push(c)})});return d}};p("extend-esri")&&t.setObject("dijit.editing.Util.LayerHelper",l,v);return l})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],
function(t,n,p){return t("dijit.form.DateTextBox",p,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:n,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),function(t,n,p,
v,l,f,d,c,h,y,w,m,b,q,g,r,a){var e=v("dijit.Calendar",[b,q,g],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(a){c.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_createMonthWidget:function(){return new e._MonthDropDownButton({id:this.id+"_mddb",tabIndex:-1,
onMonthSelect:y.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(w(this.domNode,"keydown",y.hitch(this,"_onKeyDown")),w(this.dateRowsNode,"mouseover",y.hitch(this,"_onDayMouseOver")),w(this.dateRowsNode,"mouseout",y.hitch(this,"_onDayMouseOut")),w(this.dateRowsNode,"mousedown",y.hitch(this,"_onDayMouseDown")),w(this.dateRowsNode,"mouseup",y.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(a){var b=
new this.dateClassObj(this.currentFocus);b.setDate(1);b.setMonth(a);a=this.dateModule.getDaysInMonth(b);var e=this.currentFocus.getDate();b.setDate(Math.min(e,a));this._setCurrentFocusAttr(b)},_onDayMouseOver:function(a){(a=f.contains(a.target,"dijitCalendarDateLabel")?a.target.parentNode:a.target)&&(a.dijitDateValue&&!f.contains(a,"dijitCalendarDisabledDate")||a==this.previousYearLabelNode||a==this.nextYearLabelNode)&&(f.add(a,"dijitCalendarHoveredDate"),this._currentNode=a)},_onDayMouseOut:function(a){!this._currentNode||
a.relatedTarget&&a.relatedTarget.parentNode==this._currentNode||(a="dijitCalendarHoveredDate",f.contains(this._currentNode,"dijitCalendarActiveDate")&&(a+=" dijitCalendarActiveDate"),f.remove(this._currentNode,a),this._currentNode=null)},_onDayMouseDown:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&!f.contains(a,"dijitCalendarDisabledDate")&&(f.add(a,"dijitCalendarActiveDate"),this._currentNode=a)},_onDayMouseUp:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&f.remove(a,"dijitCalendarActiveDate")},
handleKey:function(a){var b=-1,e,c=this.currentFocus;switch(a.keyCode){case h.RIGHT_ARROW:b=1;case h.LEFT_ARROW:e="day";this.isLeftToRight()||(b*=-1);break;case h.DOWN_ARROW:b=1;case h.UP_ARROW:e="week";break;case h.PAGE_DOWN:b=1;case h.PAGE_UP:e=a.ctrlKey||a.altKey?"year":"month";break;case h.END:c=this.dateModule.add(c,"month",1),e="day";case h.HOME:c=new this.dateClassObj(c);c.setDate(1);break;default:return!0}e&&(c=this.dateModule.add(c,e,b));this._setCurrentFocusAttr(c);return!1},_onKeyDown:function(a){this.handleKey(a)||
(a.stopPropagation(),a.preventDefault())},onValueSelected:function(){},onChange:function(a){this.onValueSelected(a)},getClassForDate:function(){}});e._MonthDropDownButton=v("dijit.Calendar._MonthDropDownButton",a,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new e._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(a){var b=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.dropDown.set("months",
b);this.containerNode.innerHTML=(6==m("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+b[a.getMonth()]+"\x3c/div\x3e"}});e._MonthDropDown=v("dijit.Calendar._MonthDropDown",[q,r,g],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(a){this.domNode.innerHTML=
"";t.forEach(a,function(a,b){d.create("div",{className:"dijitCalendarMonthLabel",month:b,innerHTML:a},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(a){this.onChange(l.get(a.target,"month"))},onChange:function(){}});return e})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(t,n,p,v,l,f,d,c,h,y,w,m,b,q,g,r){var a=n("dijit.CalendarLite",[q,g],{templateString:r,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(a){return a&&!isNaN(a)&&"object"==typeof a&&a.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var a=this._get("value");if(a&&!isNaN(a)){var b=
new this.dateClassObj(a);b.setHours(0,0,0,0);b.getDate()<a.getDate()&&(b=this.dateModule.add(b,"hour",1));return b}return null},_setValueAttr:function(a,b){"string"==typeof a&&(a=f.fromISOString(a));a=this._patchDate(a);if(this._isValidDate(a)&&!this.isDisabledDate(a,this.lang)){if(this._set("value",a),this.set("currentFocus",a),this._markSelectedDates([a]),this._created&&(b||"undefined"==typeof b))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(a){if(a||
0===a)a=new this.dateClassObj(a),a.setHours(1,0,0,0);return a},_setText:function(a,b){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(a.ownerDocument.createTextNode(b))},_populateGrid:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);var a=this._patchDate(a),b=a.getDay(),c=this.dateModule.getDaysInMonth(a),d=this.dateModule.getDaysInMonth(this.dateModule.add(a,"month",-1)),g=new this.dateClassObj,f=0<=this.dayOffset?this.dayOffset:p.getFirstDayOfWeek(this.lang);f>
b&&(f-=7);if(!this.summary){var m=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.gridNode.setAttribute("summary",m[a.getMonth()])}this._date2cell={};t.forEach(this.dateCells,function(e,m){var u=m+f,q=new this.dateClassObj(a),r="dijitCalendar",x=0;u<b?(u=d-b+u+1,x=-1,r+="Previous"):u>=b+c?(u=u-b-c+1,x=1,r+="Next"):(u=u-b+1,r+="Current");x&&(q=this.dateModule.add(q,"month",x));q.setDate(u);this.dateModule.compare(q,g,"date")||(r="dijitCalendarCurrentDate "+r);this.isDisabledDate(q,
this.lang)?(r="dijitCalendarDisabledDate "+r,e.setAttribute("aria-disabled","true")):(r="dijitCalendarEnabledDate "+r,e.removeAttribute("aria-disabled"),e.setAttribute("aria-selected","false"));(x=this.getClassForDate(q,this.lang))&&(r=x+" "+r);e.className=r+"Month dijitCalendarDateTemplate";r=q.valueOf();this._date2cell[r]=e;e.dijitDateValue=r;r=q.getDateLocalized?q.getDateLocalized(this.lang):q.getDate();this._setText(this.dateLabels[m],r);h.set(e,"aria-label",l.format(q,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);this.monthWidget.set("month",a);var b=a.getFullYear()-1,c=new this.dateClassObj;t.forEach(["previous","current","next"],function(a){c.setFullYear(b++);this._setText(this[a+"YearLabelNode"],this.dateLocaleModule.format(c,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(a){this.dateModule=a.datePackage?y.getObject(a.datePackage,
!1):v;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=a.datePackage?y.getObject(a.datePackage+".locale",!1):l},_createMonthWidget:function(){return a._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var a=this.dowTemplateString,c=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),g=0<=this.dayOffset?this.dayOffset:p.getFirstDayOfWeek(this.lang);this.dayCellsHtml=b.substitute([a,
a,a,a,a,a,a].join(""),{d:""},function(){return c[g++%7]});a=b.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[a,a,a,a,a,a].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);d.setSelectable(this.domNode,!1);a=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",a,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var a=y.hitch(this,function(a,
b,e){this[a].dojoClick=!0;return w(this[a],"click",y.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,b,e))}))});this.own(a("incrementMonth","month",1),a("decrementMonth","month",-1),a("nextYearLabelNode","year",1),a("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(a,b){var e=this.currentFocus,c=this._getNodeByDate(e);a=this._patchDate(a);this._set("currentFocus",a);this._date2cell&&0==this.dateModule.difference(e,a,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));e=this._getNodeByDate(a);e.setAttribute("tabIndex",this.tabIndex);(this.focused||b)&&e.focus();c&&c!=e&&(m("webkit")?c.setAttribute("tabIndex","-1"):c.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(a){a.stopPropagation();a.preventDefault();for(a=a.target;a&&!a.dijitDateValue&&0!==a.dijitDateValue;a=a.parentNode);a&&!c.contains(a,"dijitCalendarDisabledDate")&&this.set("value",
a.dijitDateValue)},_getNodeByDate:function(a){return(a=this._patchDate(a))&&this._date2cell?this._date2cell[a.valueOf()]:null},_markSelectedDates:function(a){function b(a,b){c.toggle(b,"dijitCalendarSelectedDate",a);b.setAttribute("aria-selected",a?"true":"false")}t.forEach(this._selectedCells||[],y.partial(b,!1));this._selectedCells=t.filter(t.map(a,this._getNodeByDate,this),function(a){return a});t.forEach(this._selectedCells,y.partial(b,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
a._MonthWidget=n("dijit.CalendarLite._MonthWidget",q,{_setMonthAttr:function(a){var b=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a),e=6==m("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+t.map(b,function(a){return"\x3cdiv\x3e"+a+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=e+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+b[a.getMonth()]+"\x3c/div\x3e"}});return a})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(t,n,p,v,l,f,d,c){new Date("X");return v("dijit.form._DateTimeTextBox",[f,d],{templateString:c,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:n.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(c,d){var f=this._isInvalidDate(c),h=this._isInvalidDate(d);if(f||h)return f&&h?0:f?-1:1;var f=this.format(c,this._unboundedConstraints),h=this.format(d,this._unboundedConstraints),
b=this.parse(f,this._unboundedConstraints),l=this.parse(h,this._unboundedConstraints);return f==h?0:t.compare(b,l,this._selector)},autoWidth:!0,format:function(c,d){return c?this.dateLocaleModule.format(c,d):""},parse:function(c,d){return this.dateLocaleModule.parse(c,d)||(this._isEmpty(c)?null:void 0)},serialize:function(c,d){c.toGregorian&&(c=c.toGregorian());return p.toISOString(c,d)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(c){c=
c||{};this.dateModule=c.datePackage?l.getObject(c.datePackage,!1):t;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=c.datePackage?l.getObject(c.datePackage+".locale",!1):n;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(c){c.selector=this._selector;c.fullYear=!0;var d=p.fromISOString;"string"==typeof c.min&&(c.min=d(c.min),this.dateClassObj instanceof Date||(c.min=new this.dateClassObj(c.min)));"string"==typeof c.max&&(c.max=d(c.max),this.dateClassObj instanceof Date||(c.max=new this.dateClassObj(c.max)));this.inherited(arguments);this._unboundedConstraints=l.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(c){return!c||
isNaN(c)||"object"!=typeof c||c.toString()==this._invalidDate},_setValueAttr:function(c,d,f){void 0!==c&&("string"==typeof c&&(c=p.fromISOString(c)),this._isInvalidDate(c)&&(c=null),c instanceof Date&&!(this.dateClassObj instanceof Date)&&(c=new this.dateClassObj(c)));this.inherited(arguments,[c,d,f]);this.value instanceof Date&&(this.filterString="");!1!==d&&this.dropDown&&this.dropDown.set("value",c,!1)},_set:function(c,d){if("value"==c){d instanceof Date&&!(this.dateClassObj instanceof Date)&&
(d=new this.dateClassObj(d));var f=this._get("value");if(f instanceof this.dateClassObj&&0==this.compare(d,f))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(c){this._isInvalidDate(c)&&(c=new this.dateClassObj);this._set("dropDownDefaultValue",c)},openDropDown:function(c){this.dropDown&&this.dropDown.destroy();var d=l.isString(this.popupClass)?l.getObject(this.popupClass,!1):this.popupClass,f=this,h=this.get("value");this.dropDown=new d({onChange:function(b){f.set("value",
b,!0)},id:this.id+"_popup",dir:f.dir,lang:f.lang,value:h,textDir:f.textDir,currentFocus:this._isInvalidDate(h)?this.dropDownDefaultValue:h,constraints:f.constraints,filterString:f.filterString,datePackage:f.datePackage,isDisabledDate:function(b){return!f.rangeCheck(b,f.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(c,d){this._setValueAttr(this.parse(c,this.constraints),d,c)}})})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare",
"dojo/dom-class","dojo/sniff","./TextBox"],function(t,n,p,v){return t("dijit.form.SimpleTextarea",v,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);p("ie")&&this.cols&&
n.add(this.textbox,"dijitTextAreaCols")},filter:function(l){l&&(l=l.replace(/\r/g,""));return this.inherited(arguments)},_onInput:function(l){if(this.maxLength){var f=parseInt(this.maxLength),d=this.textbox.value.replace(/\r/g,""),f=d.length-f;if(0<f){var c=this.textbox;if(c.selectionStart){var h=c.selectionStart,n=0;p("opera")&&(n=(this.textbox.value.substring(0,h).match(/\r/g)||[]).length);this.textbox.value=d.substring(0,h-f-n)+d.substring(h-n);c.setSelectionRange(h-f,h-f)}else this.ownerDocument.selection&&
(c.focus(),d=this.ownerDocument.selection.createRange(),d.moveStart("character",-f),d.text="",d.select())}}this.inherited(arguments)}})})},"dijit/form/TimeTextBox":function(){define(["dojo/_base/declare","dojo/keys","dojo/_base/lang","../_TimePicker","./_DateTimeTextBox"],function(t,n,p,v,l){return t("dijit.form.TimeTextBox",l,{baseClass:"dijitTextBox dijitComboBox dijitTimeTextBox",popupClass:v,_selector:"time",value:new Date(""),maxHeight:-1,openDropDown:function(f){this.inherited(arguments);this.dropDown.on("input",
p.hitch(this,function(){this.set("value",this.dropDown.get("value"),!1)}))},_onInput:function(){this.inherited(arguments);var f=this.get("displayedValue");this.filterString=f&&!this.parse(f,this.constraints)?f.toLowerCase():"";this._opened&&this.closeDropDown();this.openDropDown()}})})},"dijit/_TimePicker":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/sniff dojo/query dojo/mouse dojo/on ./_WidgetBase ./form/_ListMouseMixin".split(" "),
function(t,n,p,v,l,f,d,c,h,y,w,m,b,q,g,r){return l("dijit._TimePicker",[g,r],{baseClass:"dijitTimePicker",pickerMin:"T00:00:00",pickerMax:"T23:59:59",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:v.toISOString,buildRendering:function(){this.inherited(arguments);this.timeMenu=this.containerNode=this.domNode},setValue:function(a){c.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.",
"","2.0");this.set("value",a)},_setValueAttr:function(a){this._set("value",a);this._showText()},_setFilterStringAttr:function(a){this._set("filterString",a);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(a,b,c,d){a=this.ownerDocument.createDocumentFragment();for(b=0;b<this._maxIncrement;b++)(c=this._createOption(b))&&a.appendChild(c);return a},_showText:function(){var a=v.fromISOString;this.domNode.innerHTML="";this._clickableIncrementDate=a(this.clickableIncrement);
this._visibleIncrementDate=a(this.visibleIncrement);var b=function(a){return 3600*a.getHours()+60*a.getMinutes()+a.getSeconds()},c=b(this._clickableIncrementDate),b=b(this._visibleIncrementDate);(this.value||this.currentFocus).getTime();this._refDate=a(this.pickerMin);this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._visibleIncrement=b/c;a=a(this.pickerMax);a.setFullYear(1970,0,1);a=.001*(a.getTime()-this._refDate.getTime());this._maxIncrement=Math.ceil((a+1)/c);c=this._getFilteredNodes();
!c.firstChild&&this.filterString?(this.filterString="",this._showText()):this.domNode.appendChild(c)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(a){for(var b in{clickableIncrement:1,visibleIncrement:1,pickerMin:1,pickerMax:1})b in a&&(this[b]=a[b]);a.locale||(a.locale=this.lang)},_createOption:function(a){var b=new Date(this._refDate),c=this._clickableIncrementDate;b.setHours(b.getHours()+
c.getHours()*a,b.getMinutes()+c.getMinutes()*a,b.getSeconds()+c.getSeconds()*a);"time"==this.constraints.selector&&b.setFullYear(1970,0,1);var g=p.format(b,this.constraints);if(this.filterString&&0!==g.toLowerCase().indexOf(this.filterString))return null;c=this.ownerDocument.createElement("div");c.className=this.baseClass+"Item";c.date=b;c.idx=a;d.create("div",{"class":this.baseClass+"ItemInner",innerHTML:g},c);g=1>a%this._visibleIncrement&&-1<a%this._visibleIncrement;a=!g&&!(a%this._clickableIncrement);
g?c.className+=" "+this.baseClass+"Marker":a&&(c.className+=" "+this.baseClass+"Tick");this.isDisabledDate(b)&&(c.className+=" "+this.baseClass+"ItemDisabled");this.value&&!n.compare(this.value,b,this.constraints.selector)&&(c.selected=!0,c.className+=" "+this.baseClass+"ItemSelected",this._selectedDiv=c,g?c.className+=" "+this.baseClass+"MarkerSelected":a&&(c.className+=" "+this.baseClass+"TickSelected"),this._highlightOption(c,!0));return c},onOpen:function(){this.inherited(arguments);this.set("selected",
this._selectedDiv)},_onOptionSelected:function(a,b){var c=a.target.date||a.target.parentNode.date;c&&!this.isDisabledDate(c)&&(this._set("value",c),this.emit("input"),b&&(this._highlighted_option=null,this.set("value",c),this.onChange(c)))},onChange:function(){},_highlightOption:function(a,b){if(a){if(b)this._highlighted_option&&this._highlightOption(this._highlighted_option,!1),this._highlighted_option=a;else{if(this._highlighted_option!==a)return;this._highlighted_option=null}f.toggle(a,this.baseClass+
"ItemHover",b);f.contains(a,this.baseClass+"Marker")?f.toggle(a,this.baseClass+"MarkerHover",b):f.toggle(a,this.baseClass+"TickHover",b)}},handleKey:function(a){if(a.keyCode==h.DOWN_ARROW)return this.selectNextNode(),this._onOptionSelected({target:this._highlighted_option},!1),a.stopPropagation(),a.preventDefault(),!1;if(a.keyCode==h.UP_ARROW)return this.selectPreviousNode(),this._onOptionSelected({target:this._highlighted_option},!1),a.stopPropagation(),a.preventDefault(),!1;if(a.keyCode==h.ENTER||
a.keyCode===h.TAB){if(!this._keyboardSelected&&a.keyCode===h.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option},!0);return a.keyCode===h.TAB}},onHover:function(a){this._highlightOption(a,!0)},onUnhover:function(a){this._highlightOption(a,!1)},onSelect:function(a){this._highlightOption(a,!0)},onDeselect:function(a){this._highlightOption(a,!1)},onClick:function(a){this._onOptionSelected({target:a},!0)}})})},"dojox/date/islamic":function(){define(["dojox/main",
"dojo/_base/lang","dojo/date","./islamic/Date"],function(t,n,p,v){var l=n.getObject("date.islamic",!0,t);l.getDaysInMonth=function(f){return f.getDaysInIslamicMonth(f.getMonth(),f.getFullYear())};l.compare=function(f,d,c){f instanceof v&&(f=f.toGregorian());d instanceof v&&(d=d.toGregorian());return p.compare.apply(null,arguments)};l.add=function(f,d,c){var h=new v(f);switch(d){case "day":h.setDate(f.getDate()+c);break;case "weekday":var l=f.getDay();if(5>l+c&&0<l+c)h.setDate(f.getDate()+c);else{var n=
d=0;5==l?(l=4,n=0<c?-1:1):6==l&&(l=4,n=0<c?-2:2);var l=0<c?5-l-1:-l,m=c-l,b=parseInt(m/5);0!=m%5&&(d=0<c?2:-2);d=d+7*b+m%5+l;h.setDate(f.getDate()+d+n)}break;case "year":h.setFullYear(f.getFullYear()+c);break;case "week":c*=7;h.setDate(f.getDate()+c);break;case "month":f=f.getMonth();h.setMonth(f+c);break;case "hour":h.setHours(f.getHours()+c);break;case "minute":h._addMinutes(c);break;case "second":h._addSeconds(c);break;case "millisecond":h._addMilliseconds(c)}return h};l.difference=function(f,
d,c){d=d||new v;c=c||"day";var h=d.getFullYear()-f.getFullYear(),n=1;switch(c){case "weekday":h=Math.round(l.difference(f,d,"day"));n=parseInt(l.difference(f,d,"week"));if(0==h%7)h=5*n;else{c=0;var p=f.getDay(),m=d.getDay(),n=parseInt(h/7);d=h%7;f=new v(f);f.setDate(f.getDate()+7*n);f=f.getDay();if(0<h)switch(!0){case 5==p:c=-1;break;case 6==p:c=0;break;case 5==m:c=-1;break;case 6==m:c=-2;break;case 5<f+d:c=-2}else if(0>h)switch(!0){case 5==p:c=0;break;case 6==p:c=1;break;case 5==m:c=2;break;case 6==
m:c=1;break;case 0>f+d:c=2}h=h+c-2*n}n=h;break;case "year":n=h;break;case "month":c=d.toGregorian()>f.toGregorian()?d:f;p=d.toGregorian()>f.toGregorian()?f:d;n=c.getMonth();m=p.getMonth();if(0==h)n=c.getMonth()-p.getMonth();else for(n=12-m+n,h=p.getFullYear()+1,c=c.getFullYear(),h;h<c;h++)n+=12;d.toGregorian()<f.toGregorian()&&(n=-n);break;case "week":n=parseInt(l.difference(f,d,"day")/7);break;case "day":n/=24;case "hour":n/=60;case "minute":n/=60;case "second":n/=1E3;case "millisecond":n*=d.toGregorian().getTime()-
f.toGregorian().getTime()}return Math.round(n)};return l})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(t,n,p){var v=n("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var l=arguments.length;l?1==l?(l=arguments[0],"number"==typeof l&&(l=new Date(l)),l instanceof Date?this.fromGregorian(l):""==l?this._date=
new Date(""):(this._year=l._year,this._month=l._month,this._date=l._date,this._hours=l._hours,this._minutes=l._minutes,this._seconds=l._seconds,this._milliseconds=l._milliseconds)):3<=l&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},
getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},setDate:function(l){l=parseInt(l);if(!(0<l&&l<=this.getDaysInIslamicMonth(this._month,this._year))){var f;if(0<l)for(f=this.getDaysInIslamicMonth(this._month,this._year);l>f;l-=f,f=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,
this._month-=12);else for(f=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=l;f=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),l+=f}this._date=l;return this},setFullYear:function(l){this._year=+l},setMonth:function(l){this._year+=Math.floor(l/12);this._month=0<l?Math.floor(l%12):Math.floor((l%12+12)%12)},setHours:function(){var l=
arguments.length,f=0;1<=l&&(f=parseInt(arguments[0]));2<=l&&(this._minutes=parseInt(arguments[1]));3<=l&&(this._seconds=parseInt(arguments[2]));4==l&&(this._milliseconds=parseInt(arguments[3]));for(;24<=f;)this._date++,l=this.getDaysInIslamicMonth(this._month,this._year),this._date>l&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=l),f-=24;this._hours=f},_addMinutes:function(l){l+=this._minutes;this.setMinutes(l);this.setHours(this._hours+parseInt(l/60));return this},_addSeconds:function(l){l+=
this._seconds;this.setSeconds(l);this._addMinutes(parseInt(l/60));return this},_addMilliseconds:function(l){l+=this._milliseconds;this.setMilliseconds(l);this._addSeconds(parseInt(l/1E3));return this},setMinutes:function(l){this._minutes=l%60;return this},setSeconds:function(l){this._seconds=l%60;return this},setMilliseconds:function(l){this._milliseconds=l%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";var l=new Date;l.setHours(this._hours);l.setMinutes(this._minutes);
l.setSeconds(this._seconds);l.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+l.toTimeString()},toGregorian:function(){var l=this._year,l=Math.floor(this._date+Math.ceil(29.5*this._month)+354*(l-1)+Math.floor((3+11*l)/30)+this._ISLAMIC_EPOCH-1-.5)+.5,f=l-this._GREGORIAN_EPOCH,d=Math.floor(f/146097),c=this._mod(f,146097),f=Math.floor(c/36524),h=this._mod(c,36524),c=Math.floor(h/1461),h=this._mod(h,1461),h=Math.floor(h/365),d=400*d+100*f+4*c+h;4!=f&&4!=h&&d++;
f=l-(this._GREGORIAN_EPOCH+365*(d-1)+Math.floor((d-1)/4)-Math.floor((d-1)/100)+Math.floor((d-1)/400));c=this._GREGORIAN_EPOCH-1+365*(d-1)+Math.floor((d-1)/4)-Math.floor((d-1)/100)+Math.floor((d-1)/400)+Math.floor(739/12+(p.isLeapYear(new Date(d,3,1))?-1:-2)+1);c=l<c?0:p.isLeapYear(new Date(d,3,1))?1:2;f=Math.floor((12*(f+c)+373)/367);c=this._GREGORIAN_EPOCH-1+365*(d-1)+Math.floor((d-1)/4)-Math.floor((d-1)/100)+Math.floor((d-1)/400)+Math.floor((367*f-362)/12+(2>=f?0:p.isLeapYear(new Date(d,f-1,1))?
-1:-2)+1);return new Date(d,f-1,l-c+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(l){l=new Date(l);var f=l.getFullYear(),d=l.getMonth(),c=l.getDate(),f=this._GREGORIAN_EPOCH-1+365*(f-1)+Math.floor((f-1)/4)+-Math.floor((f-1)/100)+Math.floor((f-1)/400)+Math.floor((367*(d+1)-362)/12+(2>=d+1?0:p.isLeapYear(l)?-1:-2)+c),f=Math.floor(f)+.5,f=f-this._ISLAMIC_EPOCH,d=Math.floor((30*f+10646)/10631),c=Math.ceil((f-29-this._yearStart(d))/29.5),c=Math.min(c,11);this._date=
Math.ceil(f-this._monthStart(d,c))+1;this._month=c;this._year=d;this._hours=l.getHours();this._minutes=l.getMinutes();this._seconds=l.getSeconds();this._milliseconds=l.getMilliseconds();this._day=l.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},_yearStart:function(l){return 354*(l-1)+Math.floor((3+11*l)/30)},_monthStart:function(l,f){return Math.ceil(29.5*f)+354*(l-1)+Math.floor((3+11*l)/30)},_civilLeapYear:function(l){return 11>(14+11*l)%30},getDaysInIslamicMonth:function(l,
f){var d=0,d=29+(l+1)%2;11==l&&this._civilLeapYear(f)&&d++;return d},_mod:function(l,f){return l-f*Math.floor(l/f)}});v.getDaysInIslamicMonth=function(l){return(new v).getDaysInIslamicMonth(l.getMonth(),l.getFullYear())};return v})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),function(t,n,p,v,l,f,d,c,h){function y(b,c,a,e,f){return f.replace(/([a-z])\1*/ig,
function(a){var e,g,h=a.charAt(0);a=a.length;var l=["abbr","wide","narrow"];switch(h){case "G":e=c.eraAbbr[0];break;case "y":e=String(b.getFullYear());break;case "M":e=b.getMonth();3>a?(e+=1,g=!0):(h=["months-format",l[a-3]].join("-"),e=c[h][e]);break;case "d":e=b.getDate(!0);g=!0;break;case "E":e=b.getDay();3>a?(e+=1,g=!0):(h=["days-format",l[a-3]].join("-"),e=c[h][e]);break;case "a":e=12>b.getHours()?"am":"pm";e=c["dayPeriods-format-wide-"+e];break;case "h":case "H":case "K":case "k":g=b.getHours();
switch(h){case "h":e=g%12||12;break;case "H":e=g;break;case "K":e=g%12;break;case "k":e=g||24}g=!0;break;case "m":e=b.getMinutes();g=!0;break;case "s":e=b.getSeconds();g=!0;break;case "S":e=Math.round(b.getMilliseconds()*Math.pow(10,a-3));g=!0;break;case "z":if(e=v.getTimezoneName(b.toGregorian()))break;a=4;case "Z":e=b.toGregorian().getTimezoneOffset();e=[0>=e?"+":"-",d.pad(Math.floor(Math.abs(e)/60),2),d.pad(Math.abs(e)%60,2)];4==a&&(e.splice(0,0,"GMT"),e.splice(3,0,":"));e=e.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+
f);}g&&(e=d.pad(e,a));return e})}function w(b,c,a,e){var d=function(a){return a};c=c||d;a=a||d;e=e||d;var g=b.match(/(''|[^'])+/g),f="'"==b.charAt(0);p.forEach(g,function(b,e){b?(g[e]=(f?a:c)(b),f=!f):g[e]=""});return e(g.join(""))}function m(b,c,a,e){e=f.escapeString(e);l.normalizeLocale(a.locale);return e.replace(/([a-z])\1*/ig,function(e){var d;d=e.charAt(0);var g=e.length,f="";a.strict?1<g&&(f="0{"+(g-1)+"}"):f="0?";switch(d){case "y":d="\\d+";break;case "M":d=2<g?"\\S+ ?\\S+":f+"[1-9]|1[0-2]";
break;case "d":d="[12]\\d|"+f+"[1-9]|3[01]";break;case "E":d="\\S+";break;case "h":d=f+"[1-9]|1[0-2]";break;case "k":d=f+"\\d|1[01]";break;case "H":d=f+"\\d|1\\d|2[0-3]";break;case "K":d=f+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":d=f+"\\d|[0-5]\\d";break;case "S":d="\\d{"+g+"}";break;case "a":g=a.am||c["dayPeriods-format-wide-am"];f=a.pm||c["dayPeriods-format-wide-pm"];a.strict?d=g+"|"+f:(d=g+"|"+f,g!=g.toLowerCase()&&(d+="|"+g.toLowerCase()),f!=f.toLowerCase()&&(d+="|"+f.toLowerCase()));break;
default:d=".*"}b&&b.push(e);return"("+d+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var b=n.getObject("date.islamic.locale",!0,t);b.format=function(c,d){d=d||{};var a=l.normalizeLocale(d.locale),e=d.formatLength||"short",g=b._getIslamicBundle(a),f=[],a=n.hitch(this,y,c,g,a,d.fullYear);if("year"==d.selector)return c.getFullYear();if("time"!=d.selector){var h=d.datePattern||g["dateFormat-"+e];h&&f.push(w(h,a))}"date"!=d.selector&&(e=d.timePattern||g["timeFormat-"+e])&&f.push(w(e,a));return f.join(" ")};
b.regexp=function(c){return b._parseInfo(c).regexp};b._parseInfo=function(c){c=c||{};var d=l.normalizeLocale(c.locale),d=b._getIslamicBundle(d),a=c.formatLength||"short",e=c.datePattern||d["dateFormat-"+a],a=c.timePattern||d["timeFormat-"+a],g=[];return{regexp:w("date"==c.selector?e:"time"==c.selector?a:"undefined"==typeof a?e:e+" "+a,n.hitch(this,m,g,d,c)),tokens:g,bundle:d}};b.parse=function(d,f){d=d.replace(/[\u200E\u200F\u202A\u202E]/g,"");f||(f={});var a=b._parseInfo(f),e=a.tokens,g=a.bundle,
a=a.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,""),a=(new RegExp("^"+a+"$")).exec(d);l.normalizeLocale(f.locale);if(!a)return null;var h=[1389,0,1,0,0,0,0],q="",m=["abbr","wide","narrow"];p.every(a,function(a,b){if(!b)return!0;var c=e[b-1],d=c.length;switch(c.charAt(0)){case "y":h[0]=Number(a);break;case "M":if(2<d){if(c=g["months-format-"+m[d-3]].concat(),f.strict||(a=a.replace(".","").toLowerCase(),c=p.map(c,function(a){return a?a.replace(".","").toLowerCase():a})),a=p.indexOf(c,a),-1==a)return!1}else a--;
h[1]=Number(a);break;case "D":h[1]=0;case "d":h[2]=Number(a);break;case "a":c=f.am||g["dayPeriods-format-wide-am"];d=f.pm||g["dayPeriods-format-wide-pm"];if(!f.strict){var l=/\./g;a=a.replace(l,"").toLowerCase();c=c.replace(l,"").toLowerCase();d=d.replace(l,"").toLowerCase()}if(f.strict&&a!=c&&a!=d)return!1;q=a==d?"p":a==c?"a":"";break;case "K":24==a&&(a=0);case "h":case "H":case "k":h[3]=Number(a);break;case "m":h[4]=Number(a);break;case "s":h[5]=Number(a);break;case "S":h[6]=Number(a)}return!0});
a=+h[3];"p"===q&&12>a?h[3]=a+12:"a"===q&&12==a&&(h[3]=0);return new c(h[0],h[1],h[2],h[3],h[4],h[5],h[6])};var q=[];b.addCustomFormats=function(b,c){q.push({pkg:b,name:c})};b._getIslamicBundle=function(b){var c={};p.forEach(q,function(a){a=l.getLocalization(a.pkg,a.name,b);c=n.mixin(c,a)},this);return c};b.addCustomFormats("dojo.cldr","islamic");b.getNames=function(c,d,a,e,f){var g;e=b._getIslamicBundle(e);c=[c,a,d];"standAlone"==a&&(a=c.join("-"),g=e[a],1==g[0]&&(g=void 0));c[1]="format";return(g||
e[c.join("-")]).concat()};b.weekDays=b.getNames("days","wide","format");b.months=b.getNames("months","wide","format");return b})},"widgets/SituationAwareness/js/SummaryInfo":function(){define("dojo/_base/declare dojo/Evented dojo/_base/array dojo/DeferredList dojo/Deferred dojo/_base/lang dojo/_base/Color dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/number dojo/on dojo/has dijit/form/Button jimu/dijit/Popup jimu/utils jimu/dijit/Message esri/config esri/geometry/geometryEngine esri/geometry/mathUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query ./analysisUtils".split(" "),
function(t,n,p,v,l,f,d,c,h,y,w,m,b,q,g,r,a,e,u,F,E,z,x,N,S,C,G,U,R,D,k,B){return t("SummaryInfo",[n],{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],tabNum:null,symbolField:null,graphicsLayer:null,lyrRenderer:null,lyrSymbol:null,featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,allFields:!1,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.config=c.config;this.graphicsLayer=null;this.baseLabel=""!==a.label?a.label:a.layerTitle?
a.layerTitle:a.layers},queryTabCount:function(a,b,c,e){var d=new l;this.incidentCount=a.length;var g=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(g=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var k;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded?
(this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(a,b,c,e,g).then(function(a){d.resolve(a)})):(k=new C(this.summaryLayer.url),k.infoTemplate=this.tab.tabLayers[0].infoTemplate,g=[k],this.tab.tabLayers=g,q(k,"load",f.hitch(this,function(){this.summaryLayer=k;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(a,b,c,e,g).then(function(a){d.resolve(a)})})))):this.loading||(k=new C(this.tab.tabLayers[0].url),this.loading=!0,q(k,"load",f.hitch(this,function(){this.summaryLayer=
k;this.summaryFields=this._getFields(this.summaryLayer);for(var f=this.tab.tabLayers[0].url.split("MapServer/")[1],h=this.parent.map.itemInfo.itemData.operationalLayers,l=0;l<h.length;l++){var q=h[l];if("undefined"!==typeof q.layerObject)if(q.layerObject.infoTemplates){if(q=q.layerObject.infoTemplates[f]){k.infoTemplate=q.infoTemplate;break}}else if(q.layerObject.infoTemplate){k.infoTemplate=q.layerObject.infoTemplate;break}}g=[k];this.tab.tabLayers=g;this.loading=!1;this._performQuery(a,b,c,e,g).then(function(a){d.resolve(a)})})))}this.mapServiceLayer||
this._performQuery(a,b,c,e,g).then(function(a){d.resolve(a)});return d},_performQuery:function(a,b,c,e,d){var g=new l,k=[],h,q;0<b.length?q=B.getGeoms(b):0<a.length&&(q=B.getGeoms(a));this.summaryGeoms=q;if(0<q.length)for(a=0;a<q.length;a++)k=q[a],b=B.createDefArray(d,k),h=0===a?k=b:k=h.concat(b);(new v(k)).then(f.hitch(this,function(a){for(var b=0,d=0;d<a.length;d++){var k=a[d][1];isNaN(k)?k&&k.features?b+=k.features.length:k&&"undefined"!==typeof k.length&&(b+=k.length):b+=k}this.updateTabCount(b,
c,e);this.queryOnLoad&&f.hitch(this,this._queryFeatures(this.summaryGeoms));g.resolve(b)}));return g},updateTabCount:function(a,b,c){this.featureCount=a;B.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(a,b,c,e,d,g,k){this.incidentCount=a.length;this.allFields="undefined"!==typeof g&&"undefined"!==typeof k?g?!0:k:!1;var m="undefined"!==typeof d,r;this.tabNum=e;m?r=new l:(this.container.innerHTML="",h.add(this.container,"loading"));this.summaryIds=
[];this.summaryFeatures=[];if(0<this.tab.tabLayers.length){var n=this.summaryGeoms,x;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],x=new C(this.summaryLayer.url),x.infoTemplate=this.tab.tabLayers[0].infoTemplate,this.tab.tabLayers[1]=x,this.summaryFields=this._getFields(this.tab.tabLayers[0]),m?this._queryFeatures(n,m).then(function(a){r.resolve(a)}):(this._initGraphicsLayer(c),f.hitch(this,this._queryFeatures(n)))):(x=new C(this.tab.tabLayers[0].url),
q(x,"load",f.hitch(this,function(){this.summaryLayer=x;if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var a=this.tab.tabLayers[0].url.split("MapServer/")[1],b=this.parent.map.itemInfo.itemData.operationalLayers,e=0;e<b.length;e++){var d=b[e];if("undefined"!==typeof d.layerObject&&d.layerObject.infoTemplates&&(d=d.layerObject.infoTemplates[a])){x.infoTemplate=d.infoTemplate;break}}this.tab.tabLayers[1]=x;this.summaryFields=this._getFields(this.tab.tabLayers[1]);m?this._queryFeatures(n,m).then(function(a){r.resolve(a)}):
(this._initGraphicsLayer(c),f.hitch(this,this._queryFeatures(n)))})));if(m)return r}},_initGraphicsLayer:function(a){null!==a&&(this.graphicsLayer=a,this.graphicsLayer.clear(),this.summaryLayer&&this.summaryLayer.renderer&&(this.lyrRenderer=this.summaryLayer.renderer,this.graphicsLayer.renderer=this.lyrRenderer,"undefined"!==typeof this.summaryLayer.renderer.attributeField?this.symbolField=this.summaryLayer.renderer.attributeField:this.lyrSymbol=this.lyrRenderer.symbol))},_queryFeatures:function(a,
b){var c;b&&(c=new l);var e=[],d=this.tab.tabLayers[0].id,g="";this.parent.opLayers.traversal(function(a){if(d===a.id&&a.getFilter())return g=a.getFilter(),!0});for(var h=new k,q=0;q<a.length;q++)h.geometry=a[q],h.where=g,e.push(this.summaryLayer.queryIds(h));(new v(e)).then(f.hitch(this,function(a){for(var e,d,g=0;g<a.length;g++)a[g][0]&&(e=a[g][1],d=e=0===g?e:d.concat(e));e?(this.summaryIds=e,0<this.summaryIds.length?b?this._queryFeaturesByIds(b).then(function(a){c.resolve(a)}):this._queryFeaturesByIds():
b||this._processResults()):b||this._processResults()}),f.hitch(this,function(a){console.error(a);new u({message:a})}));if(b)return c},_queryFeaturesByIds:function(a){var b,c=[];a&&(b=new l);var e=this.summaryLayer.maxRecordCount||1E3,d=this.summaryIds.slice(0,e);this.summaryIds.splice(0,e);var g=new k,q=!1;p.some(this.summaryFields,f.hitch(this,function(a){if("area"===a.type||"length"===a.type||this.graphicsLayer)return q=!0}));a&&(q=!0);g.returnGeometry=q;var m=[];p.forEach(this.summaryFields,function(a){m.push(a.field)});
this.symbolField&&m.push(this.symbolField);g.outFields=!0===this.config.csvAllFields||"true"===this.config.csvAllFields?["*"]:m;g.objectIds=d;for(c.push(this.summaryLayer.queryFeatures(g));0<this.summaryIds.length;)d=this.summaryIds.slice(0,e),this.summaryIds.splice(0,e),g.objectIds=d,c.push(this.summaryLayer.queryFeatures(g));(new v(c)).then(f.hitch(this,function(c){for(var e=0;e<c.length;e++)if(c[e][0]){var d=c[e][1];d.features&&(this.summaryFeatures=this.summaryFeatures.concat(d.features))}a?this._processResults(a).then(f.hitch(this,
function(a){this.SA_SAT_download&&h.replace(this.SA_SAT_download,"download","processing");b.resolve(a)})):(this._processResults(),this.SA_SAT_download&&h.replace(this.SA_SAT_download,"download","processing"));this.SA_SAT_download&&h.replace(this.SA_SAT_download,"download","processing")}),f.hitch(this,function(a){console.error(a);new u({message:a})}));if(a)return b},_prepResults:function(){for(var a=0;a<this.summaryFields.length;a++){var b=this.summaryFields[a],c=b.field,e=b.total;switch(b.type){case "count":e=
this.summaryFeatures.length;break;case "area":e=B.getArea(this.summaryFeatures,this.summaryGeoms,this.config.distanceSettings,this.config.distanceUnits);break;case "length":e=B.getLength(this.summaryFeatures,this.summaryGeoms,this.config.distanceSettings,this.config.distanceUnits);break;case "sum":e=B.getSum(this.summaryFeatures,c);break;case "avg":e=B.getSum(this.summaryFeatures,c)/this.summaryFeatures.length;break;case "min":e=B.getMin(this.summaryFeatures,c);break;case "max":e=B.getMax(this.summaryFeatures,
c)}b.total=e}},_processResults:function(a){this._prepResults();var c,d=this.summaryFields,g=0,k;if(a)c=new l;else{this.container.innerHTML="";h.remove(this.container,"loading");if(0===this.summaryFeatures.length){this.container.innerHTML=this.parent.nls.noFeaturesFound;return}k=y.create("div",{style:"width:"+220*(d.length+1)+"px;"},this.container);h.add(k,"SAT_tabPanelContent");var m=y.create("div",{},k);h.add(m,"SATcolExport");h.add(m,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");
m=y.create("div",{"data-dojo-attach-point":"SA_SAT_download",title:this.parent.nls.downloadCSV},m);h.add(m,[this.parent.isBlackTheme?"btnExportBlack":"btnExport","download"]);q(m,"click",f.hitch(this,this._exportToCSV,d))}for(var m=[],r=0;r<d.length;r++){var x=d[r],n=e.stripHTML(x.alias?x.alias:"")+"\x3cbr/\x3e",g=x.alias===this.parent.nls.area||x.alias===this.parent.nls.length?x.total:Math.round(x.total);isNaN(g)&&(g=0);x=b.format(g);if(a)m.push({num:x,info:n,total:g});else{g=y.create("div",{"class":"SATcol"},
k);h.add(g,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var u=y.create("div",{style:"max-height: 60px;"},g);y.create("div",{"class":" SATcolWrap",style:"max-height: 30px; overflow: hidden;",innerHTML:n},u);y.create("div",{"class":" colSummary",innerHTML:x},g)}}d=[];k=null!==this.graphicsLayer;!a&&k&&(this.graphicsLayer.clear(),this.tab.tabLayers[1].clear());if(this.summaryFeatures)for(r=0;r<this.summaryFeatures.length;r++)n=this.summaryFeatures[r],this.lyrSymbol?n.symbol=this.lyrSymbol:
k&&this.graphicsLayer.renderer?(x=this.graphicsLayer.renderer.getSymbol(n),n.symbol=x):this.summaryLayer.renderer&&this.summaryLayer.renderer.getSymbol&&(n.symbol=this.summaryLayer.renderer.getSymbol(n)),!a&&k?(this.graphicsLayer.add(n),this.tab.tabLayers[1].add(n)):d.push(n);!a&&k&&(this.graphicsLayer.setVisibility(!0),this.parent._toggleTabLayersNew(this.tabNum),this.tab.restore&&this.emit("summary-complete",{bubbles:!0,cancelable:!0,tab:this.tabNum}));if(a)return c.resolve({graphics:d,analysisResults:m,
context:this}),c},_exportToCSV:function(a,b,c,e){a=B.exportToCSV(this.summaryFeatures,b,c,e,{type:"summary",baseLabel:this.baseLabel,csvAllFields:this.parent.config.csvAllFields,layer:this.summaryLayer,opLayers:this.parent.opLayers,nlsValue:this.parent.nls.summary,nlsCount:this.parent.nls.count,summaryFields:this.summaryFields,calcFields:this.calcFields});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(a){var b=B.getSkipFields(a),c=[];if("undefined"!==typeof this.tab.advStat){var e=
this.tab.advStat.stats,d;for(d in e)0<e[d].length&&p.forEach(e[d],function(a){c.push({field:a.expression,alias:a.label+"",type:d,total:0})})}else{if(a.infoTemplate)e=a.infoTemplate.info.fieldInfos;else if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var g=this.tab.tabLayers[0].url.split("MapServer/")[1],k=this.parent.map.itemInfo.itemData.operationalLayers,e=null,h=0;h<k.length;h++){var l=k[h];if(l.layerObject.infoTemplates&&(l=l.layerObject.infoTemplates[g])){e=l.infoTemplate.info.fieldInfos;
break}}else e=a.fields;e||(e=a.fields);for(g=0;g<e.length;g++)if(k=e[g],"undefined"!==typeof a.fields){var h=a.fields[g].type,q;k.name===a.objectIdField||"esriFieldTypeDouble"!==h&&"esriFieldTypeInteger"!==h&&"esriFieldTypeSmallInteger"!==h||("undefined"!==typeof k.visible?k.visible&&(q={field:k.fieldName,alias:k.label,type:"sum",total:0}):q={field:k.name,alias:k.alias,type:"sum",total:0},q&&-1===b.indexOf(q.field)&&c.push(q),q=null)}}this.calcFields=f.clone(c);if(this.allFields)for(e=0;e<a.fields.length;e++){q=
a.fields[e];g=!0;k=0;b:for(;k<c.length;k++)if(q.name===c[k].field){g=!1;break b}-1===b.indexOf(q.name)&&g&&c.push({field:q.name,alias:q.alias,type:q.type})}return c}})})},"widgets/SituationAwareness/js/analysisUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has esri/tasks/query esri/geometry/geometryEngine esri/geometry/Polyline ./CSVUtils jimu/utils".split(" "),function(t,n,p,v,l,f,d,c,h,y,w){function m(b){return function(c,d){return c.attributes[b]<
d.attributes[b]?-1:c.attributes[b]>d.attributes[b]?1:0}}return{getFields:function(b,c,d,f){var a=this.getSkipFields(b),e=[];if(!d&&c.advStat&&c.advStat.stats&&c.advStat.stats.outFields&&0<c.advStat.stats.outFields.length)t.forEach(c.advStat.stats.outFields,function(a){e.push(a.expression)});else{if(b.infoTemplate)c=b.infoTemplate.info.fieldInfos;else if(0<f.map.itemInfo.itemData.operationalLayers.length){f=f.map.itemInfo.itemData.operationalLayers;c=null;var g=0;a:for(;g<f.length;g++){var h=f[g];
if("ArcGISMapServiceLayer"===h.layerType&&"undefined"!==typeof h.layers)for(var l=0;l<h.layers.length;l++){var m=h.layers[l];if(m.id===b.layerId&&m.popupInfo){c=m.popupInfo.fieldInfos;break a}}}c||(c=b.fields)}else c=b.fields;if(c)for(f=0;f<c.length;f++)g=c[f],d||"undefined"===typeof g.visible?(g=g.name?g.name:g.fieldName,-1===a.indexOf(g)&&e.push(g)):g.visible&&-1===a.indexOf(g.fieldName)&&e.push(g.fieldName)}b=this.getSpecialFields(b);return{dateFields:b.dateFields,specialFields:b.specialFields,
fields:3<e.length&&!d?e.slice(0,3):e,allFields:e}},getField:function(b,c){for(var d=0;d<b.length;d++){var f=b[d];if(f.name===c||f.alias===c)return f}},getFieldValue:function(b,c,d,f,a){var e=c;d[b]&&(d=d[b],"esriFieldTypeDate"===d.type?e=w.fieldFormatter.getFormattedDate(new Date(c),"undefined"!==f[b]?{dateFormat:f[b]}:{dateFormat:a}):t.some(d.domain.codedValues,function(a){if(a.code===c)return e=a.name,!0}));return e},getSkipFields:function(b){var c=[];if(b.fields)for(var d=0;d<b.fields.length;d++){var f=
b.fields[d];f&&f.type&&f.name&&"esriFieldTypeGeometry"===f.type&&c.push(f.name)}b.globalIdField&&""!==b.globalIdField&&c.push(b.globalIdField);b.objectIdField&&""!==b.objectIdField&&c.push(b.objectIdField);return c},getSpecialFields:function(b){var c={},d=[];b.fields&&t.forEach(b.fields,n.hitch(this,function(g){if("esriFieldTypeDate"===g.type||g.domain){if("esriFieldTypeDate"===g.type&&b.infoTemplate)for(var a in b.infoTemplate._fieldsMap)"undefined"!==typeof b.infoTemplate._fieldsMap[a].fieldName&&
b.infoTemplate._fieldsMap[a].fieldName===g.name&&"undefined"!==typeof b.infoTemplate._fieldsMap[a].format.dateFormat&&(d[g.name]=b.infoTemplate._fieldsMap[a].format.dateFormat);c[g.name]=g}}));return{specialFields:c,dateFields:d}},getSummaryFields:function(){},getDisplayFields:function(b){var c;"undefined"!==typeof b.advStat&&"undefined"!==typeof b.advStat.stats&&"undefined"!==typeof b.advStat.stats.outFields?c=b.advStat.stats.outFields:(c=[],0<b.tabLayers.length&&t.forEach(b.tabLayers,n.hitch(this,
function(b){"undefined"!==typeof b.popupInfo?t.forEach(b.popupInfo.fieldInfos,n.hitch(this,function(b){if(b.visible){var a={value:0};a.expression=b.fieldName;a.label=b.label;c.push(a)}})):b.infoTemplate?t.forEach(b.infoTemplate.info.fieldInfos,n.hitch(this,function(b){if(b.visible){var a={value:0};a.expression=b.fieldName;a.label=b.label;c.push(a)}})):t.forEach((b.layerObject?b.layerObject:b).fields,n.hitch(this,function(b){var a={value:0};a.expression=b.name;a.label=b.alias;c.push(a)}))})));return c},
exportToCSV:function(b,c,d,f,a){if(0===b.length)return!1;var e=a.baseLabel,g=[],h=[];"proximity"===a.type&&b.sort(this.compareDistance);var l;"undefined"===typeof c.altKey?l=c:(l=!1,d=a.csvAllFields);t.forEach(b,function(b){"proximity"!==a.type&&"closest"!==a.type||delete b.attributes.DISTANCE;g.push(b.attributes)});if("summary"===a.type||"grouped"===a.type)if(!0===a.csvAllFields||"true"===a.csvAllFields)for(var m in g[0])h.push(m);else for(b=0;b<a.summaryFields.length;b++)h.push(a.summaryFields[b].field);
else for(var q in g[0])h.push(q);b=a.layer;m=b.fields;if(b&&b.loaded&&m||l){q=c?[]:this.getSkipFields(b);var r={};if(a.opLayers&&a.opLayers._layerInfos){var p=a.opLayers.getLayerInfoById(b.id);p&&(r.popupInfo=p.getPopupInfo())}var p=[],C=0;for(;C<h.length;C++){var v=h[C];if(-1===q.indexOf(v)){var w=!1,R,D=0;b:for(;D<m.length;D++)if(R=m[D],R.name===v){w=!0;break b}w?p.push(R):p.push({name:v,alias:v,show:!0,type:"esriFieldTypeString"})}}r.datas=g;r.fromClient=!1;r.withGeometry=!1;r.outFields=p;r.formatDate=
!0;r.formatCodedValue=!0;r.formatNumber=!1;var k=[],B=[];if(!c&&d&&"undefined"!==typeof f)switch(a.type){case "proximity":k.push(a.nlsCount);B.push(f);break;case "closest":var A=0;t.forEach(f,n.hitch(this,function(a){0===A&&(t.forEach(a,function(a){k.push(a.label)}),A+=1);var b=[];t.forEach(a,function(a){b.push(a.value)});B.push(b)}));break;case "summary":t.forEach(f,n.hitch(this,function(b){var c=b.info.replace("\x3cbr/\x3e",""),e=!1,d=0;a:for(;d<a.calcFields.length;d++)if(c===a.calcFields[d].alias){e=
!0;break a}e&&(k.push(c),B.push(b.total))}));break;case "grouped":t.forEach(f,function(a){k.push(a.info.replace("\x3cbr/\x3e",""));B.push(a.total)})}if(l)return{summaryLayer:b,details:p};y.exportCSVFromFeatureLayer(e,b,r);return{summaryLayer:b,details:{appendColumns:k,appendDatas:B,name:e,type:a.nlsValue}}}y.exportCSV(e,g,h)},isURL:function(b){return/(https?:\/\/|ftp:)/g.test(b)},isEmail:function(b){return/\S+@\S+\.\S+/.test(b)},queryTabCount:function(){},performQuery:function(){},getGeoms:function(b){for(var d=
[],g=[],f=0;f<b.length;f++){var a=b[f].geometry?b[f].geometry:b[f];if("polygon"===a.type&&-1===d.indexOf(f)){for(var e=0;e<b.length;e++)if(e!==f&&-1===d.indexOf(e)){var h=b[e].geometry?b[e].geometry:b[e];"polygon"===h.type?c.intersects(a,h)&&(d.push(e),a=c.union(a,h)):d.push(e)}g.push(a)}}return g},createDefArray:function(b,c){for(var f=[],h=0;h<b.length;h++){var a=b[h],e=new d;e.returnGeometry=!1;e.geometry=c;"undefined"!==typeof a.queryCount?f.push(a.queryCount(e)):"undefined"!==typeof a.queryIds?
f.push(a.queryIds(e)):"undefined"!==typeof a.queryFeatures&&f.push(a.queryFeatures(e))}return f},updateTabCount:function(b,c,d,f,a){var e="undefined"!==typeof a&&0<a?!0:!1;a=v.position(c).w;"undefined"!==typeof b&&0===b?(p.remove(c,"noFeatures"),p.remove(c,"noFeaturesActive"),p.add(c,e?"noFeaturesActive":"noFeatures")):(e&&p.contains(c,"noFeatures")&&p.remove(c,"noFeatures"),e&&p.contains(c,"noFeaturesActive")&&p.remove(c,"noFeaturesActive"));d&&(b="undefined"!==typeof b?f+" ("+w.localizeNumber(b).toString()+
")":f,c.innerHTML=b);d=v.position(c).w;b=0;var g;d>a?(g=!0,b=d-a):a>d&&(g=!1,b=a-d);a=v.position(c.parentNode).w;if(0<a){g=g?a+b:a-b;l.set(c.parentNode,"width",g+"px");c=c.parentNode.parentNode;a=c.parentNode;var h;if(a&&a.children&&0<a.children.length)for(b=0;b<a.children.length;b++)if(d=a.children[b],-1<d.className.indexOf("SA_panelRight")){h=d;break}h&&c&&(g>v.position(a).w?(l.set(c,"right","58px"),l.set(h,"display","block")):(l.set(c,"right","24px"),l.set(h,"display","none")))}},getSum:function(b,
c){var d=0;t.forEach(b,function(b){d+=b.attributes[c]});return d},getMin:function(b,c){b.sort(m(c));return b[0].attributes[c]},getMax:function(b,c){b.sort(m(c));b.reverse();return b[0].attributes[c]},getArea:function(b,d,f,h){var a=0;f=n.clone(f);f.miles=109413;f.kilometers=109414;f.feet=109405;f.meters=109404;f.yards=109442;f.nauticalMiles=109409;var e=f[h];t.forEach(b,function(b){for(var f=0;f<d.length;f++){var g=c.intersect(b.geometry,d[f]);null!==g&&(a+=c.geodesicArea(g,e))}});return a},getLength:function(b,
d,f,h){var a=0,e=f[h];t.forEach(b,function(b){for(var f=0;f<d.length;f++){var g=c.intersect(b.geometry,d[f]);null!==g&&(a+=c.geodesicLength(g,e))}});return a},getDistance:function(b,d,g){var l="point"!==b.type?b.getExtent().getCenter():b;d="point"!==d.type?d.getExtent().getCenter():d;l=new h([[l.x,l.y],[d.x,d.y]]);l.spatialReference=b.spatialReference;g="nauticalMiles"===g?"nautical-miles":g;return 4326!==b.spatialReference.wkid&&!b.spatialReference.isWebMercator()||f("safari")?c.planarLength(l,g):
c.geodesicLength(l,g)},compareDistance:function(b,c){return b.attributes.DISTANCE<c.attributes.DISTANCE?-1:b.attributes.DISTANCE>c.attributes.DISTANCE?1:0}}})},"widgets/SituationAwareness/js/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query".split(" "),function(t,n,p,v,l,f,d,c,h,y){function w(c){var b=n.clone(c.attributes);(c=c.geometry)&&"point"===c.type&&("x"in b?b._x=c.x:b.x=c.x,
"y"in b?b._y=c.y:b.y=c.y);return b}t.exportCSV=function(c,b,d,f,h){return t._createCSVStr(b,d,f,h).then(function(a){return t._download(c+".csv",a)})};t.exportCalculatedResultsCSV=function(c,b){var d="",f=0;p.forEach(b,function(g){d+=g.name+" ("+g.type+")\r\n";t._createCSVStr([],[],g.appendColumns,g.appendDatas).then(function(a){d+=a;f++;if(f===b.length)return t._download(c+".csv",d);d+="\r\n\r\n"})})};t.exportCSVFromFeatureLayer=function(c,b,d){d=d||{};return t._getExportData(b,{datas:d.datas,fromClient:d.fromClient,
withGeometry:d.withGeometry,outFields:d.outFields,filterExpression:d.filterExpression}).then(function(f){return t._formattedData(b,f,{formatNumber:d.formatNumber,formatDate:d.formatDate,formatCodedValue:d.formatCodedValue,popupInfo:d.popupInfo,appendColumns:d.appendColumns,appendDatas:d.appendDatas}).then(function(b){return t.exportCSV(c,b.datas,b.columns,b.appendColumns,b.appendDatas)})})};t.exportCSVByAttributes=function(c,b,d,f){f=n.mixin({},f);f.datas=d;return t.exportCSVFromFeatureLayer(c,b,
f)};t.exportCSVByGraphics=function(c,b,d,f){d=p.map(d,function(b){return b.attributes});return t.exportCSVByAttributes(c,b,d,f)};t._createCSVStr=function(c,b,d,g){var h=new f,a="",e=0,l=0,m="",n="";try{if(b&&0<b.length){p.forEach(b,function(b){a=a+m+b;m=","});for(var a=a+"\r\n",e=c.length,l=b.length,q=0;q<e;q++){for(var m="",x=0;x<l;x++)(n=c[q][b[x]])||"number"===typeof n||(n=""),n&&/[",\r\n]/g.test(n)&&(n='"'+n.replace(/(")/g,'""')+'"'),a=a+m+n,m=",";a+="\r\n"}}"undefined"!==typeof d&&"undefined"!==
typeof g&&0<d.length&&0<g.length&&(m="",p.forEach(d,function(b){a=a+m+b;m=","}),m="",a+="\r\n",p.forEach(g,function(b){Array.isArray(b)?(p.forEach(b,function(b){a=a+m+b;m=","}),m="",a+="\r\n"):(a=a+m+b,m=",")}));h.resolve(a)}catch(N){console.error(N),h.resolve("")}return h};t._isIE11=function(){return 11===d.has("ie")};t._isEdge=function(){return d.has("edge")};t._getDownloadUrl=function(c){return window.Blob&&window.URL&&window.URL.createObjectURL?(c=new Blob(["\ufeff"+c],{type:"text/csv"}),URL.createObjectURL(c)):
"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(c)};t._download=function(c,b){var d=new f;try{if(l("ie")&&10>l("ie")){var g=window.top.open("about:blank","_blank");g.document.write("sep\x3d,\r\n"+b);g.document.close();g.document.execCommand("SaveAs",!0,c);g.close()}else if(10===l("ie")||t._isIE11()||t._isEdge()){var h=new Blob(["\ufeff"+b],{type:"text/csv"});navigator.msSaveBlob(h,c)}else{var a=v.create("a",{href:t._getDownloadUrl(b),target:"_blank",download:c},document.body);if(l("safari")){var e=
document.createEvent("MouseEvents");e.initEvent("click",!0,!0);a.dispatchEvent(e)}else a.click();v.destroy(a)}d.resolve()}catch(u){d.reject(u)}return d};t._getExportData=function(c,b){var d=new f,g=null,h=b.datas,a=b.withGeometry,g=b.outFields;g&&g.length||(g=c.fields);g=n.clone(g);if(a&&!(h&&0<h.length)){var e="",e=-1!==g.indexOf("x")?"_x":"x";g.push({name:e,alias:e,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});e=-1!==g.indexOf("y")?"_y":"y";g.push({name:e,alias:e,format:{digitSeparator:!1,
places:6},show:!0,type:"esriFieldTypeDouble"})}h&&0<h.length?d.resolve({data:h||[],outFields:g}):b.fromClient?(h=p.map(c.graphics,function(b){return a?w(b):n.clone(b)}),d.resolve({data:h||[],outFields:g})):t._getExportDataFromServer(c,g,b).then(function(a){d.resolve({data:a||[],outFields:g})});return d};t._getExportDataFromServer=function(c,b,d){var g=new f;if("esri.layers.FeatureLayer"!==c.declaredClass)return g.resolve([]),g;var l=new h(c.url),a=new y;a.where=d.filterExpression||c.getDefinitionExpression&&
c.getDefinitionExpression()||"1\x3d1";0<b.length?(c=p.map(b,function(a){return a.name}),a.outFields=c):a.outFields=["*"];a.returnGeometry=d.withGeometry;l.execute(a,function(a){a=p.map(a.features,function(a){return w(a)});g.resolve(a)},function(a){console.error(a);g.resolve([])});return g};t._formattedData=function(c,b,d){var g=new f,h=[],a=b.data;b=b.outFields;for(var e=0,l=a.length;e<l;e++){for(var m={},n=0;n<b.length;n++){var q=b[n];m[q.alias||q.name]=t._getExportValue(a[e][q.name],q,c.objectIdField,
c.typeIdField,a[e][c.typeIdField],c.types,d)}h.push(m)}c=p.map(b,function(a){return a.alias||a.name});g.resolve({datas:h,columns:c,appendColumns:d.appendColumns,appendDatas:d.appendDatas});return g};t._getExportValue=function(f,b,h,g,l,a,e){function m(a){if(n&&c.isDefined(n.fieldInfos))for(var b=0,d=n.fieldInfos.length;b<d;b++){var e=n.fieldInfos[b];if(e.fieldName===a)return e.format}return null}var n=e.popupInfo,q=!!b.domain&&e.formatCodedValue;e="esriFieldTypeDate"===b.type&&e.formatDate;var r=
h&&b.name===h;g=g&&b.name===g;return e?d.fieldFormatter.getFormattedDate(f,m(b.name)):g?d.fieldFormatter.getTypeName(f,a):q?d.fieldFormatter.getCodedValue(b.domain,f):q||e||r||g?f:(q=null,h&&a&&0<a.length&&(h=(h=p.filter(a,function(a){return a.id===l}))&&h[0])&&h.domains&&h.domains[b.name]&&h.domains[b.name].codedValues&&(q=d.fieldFormatter.getCodedValue(h.domains[b.name],f)),null!==q?q:f)}})},"widgets/SituationAwareness/js/GroupedCountInfo":function(){define("dojo/_base/declare dojo/Evented dojo/_base/array dojo/DeferredList dojo/Deferred dojo/_base/lang dojo/_base/Color dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/number dojo/on dojo/has dijit/form/Button jimu/dijit/Popup jimu/utils jimu/dijit/Message esri/config esri/geometry/geometryEngine esri/geometry/mathUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query ./analysisUtils".split(" "),
function(t,n,p,v,l,f,d,c,h,y,w,m,b,q,g,r,a,e,u,F,E,z,x,N,S,C,G,U,R,D,k,B){return t("GroupedCountInfo",[n],{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],tabNum:null,popupFields:[],groupedResults:{},specialFields:null,dateFields:{},symbolField:null,graphicsLayer:null,lyrRenderer:null,lyrSymbol:null,featureCount:0,incidentCount:0,displayCount:!1,allFields:!1,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.config=c.config;this.graphicsLayer=null;this.specialFields=
{};this.dateFields={};this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:a.layers},queryTabCount:function(a,b,c,d){var e=new l;this.displayCount=d;this.incidentCount=a.length;var g=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(g=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var k;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=
this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded?(this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(a,b,c,d,g).then(function(a){e.resolve(a)})):(k=new C(this.summaryLayer.url),k.infoTemplate=this.tab.tabLayers[0].infoTemplate,g=[k],this.tab.tabLayers=g,q(k,"load",f.hitch(this,function(){this.summaryLayer=k;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(a,b,c,d,g).then(function(a){e.resolve(a)})})))):this.loading||
(k=new C(this.tab.tabLayers[0].url),this.loading=!0,q(k,"load",f.hitch(this,function(){this.summaryLayer=k;this.summaryFields=this._getFields(this.summaryLayer);for(var f=this.tab.tabLayers[0].url.split("MapServer/")[1],h=this.parent.map.itemInfo.itemData.operationalLayers,l=0;l<h.length;l++){var m=h[l];if("undefined"!==typeof m.layerObject&&m.layerObject.infoTemplates&&(m=m.layerObject.infoTemplates[f])){k.infoTemplate=m.infoTemplate;break}}g=[k];this.tab.tabLayers=g;this.loading=!1;this._performQuery(a,
b,c,d,g).then(function(a){e.resolve(a)})})))}this.mapServiceLayer||this._performQuery(a,b,c,d,g).then(function(a){e.resolve(a)});return e},_performQuery:function(a,b,c,d,e){var g=new l,k=[],h,m;0<b.length?m=B.getGeoms(b):0<a.length&&(m=B.getGeoms(a));this.summaryGeoms=m;if(0<m.length)for(a=0;a<m.length;a++)k=m[a],b=B.createDefArray(e,k),h=0===a?k=b:k=h.concat(b);(new v(k)).then(f.hitch(this,function(a){for(var b=0,e=0;e<a.length;e++){var k=a[e][1];isNaN(k)?k&&k.features?b+=k.features.length:k&&"undefined"!==
typeof k.length&&(b+=k.length):b+=k}this.updateTabCount(b,c,d);this.queryOnLoad&&f.hitch(this,this._queryFeatures(this.summaryGeoms));g.resolve(b)}));return g},updateTabCount:function(a,b,c){this.displayCount=c;this.featureCount=a;B.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(a,b,c,d,e,k,g){this.incidentCount=a.length;this.allFields="undefined"!==typeof k&&"undefined"!==typeof g?k?!0:g:!1;var m="undefined"!==typeof e,n;this.tabNum=d;m?n=new l:
(this.container.innerHTML="",h.add(this.container,"loading"));this.summaryIds=[];this.summaryFeatures=[];this.groupedResults={};if(0<this.tab.tabLayers.length){var x=[];if(0<b.length)x=b;else for(b=0;b<a.length;b++)d=a[b].geometry?a[b].geometry:a[b],"polygon"===d.type&&x.push(d);var p;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],p=new C(this.summaryLayer.url),p.infoTemplate=this.tab.tabLayers[0].infoTemplate,this.tab.tabLayers[1]=p,this.summaryFields=
this._getFields(this.tab.tabLayers[0]),m?this._queryFeatures(x,m).then(function(a){n.resolve(a)}):(this._initGraphicsLayer(c),f.hitch(this,this._queryFeatures(x,m)))):(p=new C(this.tab.tabLayers[0].url),q(p,"load",f.hitch(this,function(){this.summaryLayer=p;if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var a=this.tab.tabLayers[0].url.split("MapServer/")[1],b=this.parent.map.itemInfo.itemData.operationalLayers,d=0;d<b.length;d++){var e=b[d];if("undefined"!==typeof e.layerObject&&e.layerObject.infoTemplates&&
(e=e.layerObject.infoTemplates[a])){p.infoTemplate=e.infoTemplate;break}}this.tab.tabLayers[1]=p;this.summaryFields=this._getFields(this.tab.tabLayers[1]);m?this._queryFeatures(x,m).then(function(a){n.resolve(a)}):(this._initGraphicsLayer(c),f.hitch(this,this._queryFeatures(x)))})));if(m)return n}},_initGraphicsLayer:function(a){null!==a&&(this.graphicsLayer=a,this.graphicsLayer.clear(),this.summaryLayer&&(this.summaryLayer.renderer&&(this.lyrRenderer=this.summaryLayer.renderer,this.graphicsLayer.renderer=
this.lyrRenderer,"undefined"!==typeof this.summaryLayer.renderer.attributeField?this.symbolField=this.summaryLayer.renderer.attributeField:this.lyrSymbol=this.lyrRenderer.symbol),null===this.specialFields&&B.getSpecialFields(this.summaryLayer)))},_queryFeatures:function(a,b){var c;b&&(c=new l);var d=[],e=this.tab.tabLayers[0].id,g="";this.parent.opLayers.traversal(function(a){if(e===a.id&&a.getFilter())return g=a.getFilter(),!0});for(var h=new k,m=0;m<a.length;m++)h.geometry=a[m],h.where=g,d.push(this.summaryLayer.queryIds(h));
(new v(d)).then(f.hitch(this,function(a){for(var d,e,f=0;f<a.length;f++)a[f][0]&&(d=a[f][1],e=d=0===f?d:e.concat(d));d?(this.summaryIds=d,0<this.summaryIds.length?b?this._queryFeaturesByIds(b).then(function(a){c.resolve(a)}):this._queryFeaturesByIds():b||this._processResults()):b||this._processResults()}),f.hitch(this,function(a){console.error(a);new u({message:a})}));if(b)return c},_queryFeaturesByIds:function(a){var b,c=[];a&&(b=new l);var d=this.summaryLayer.maxRecordCount||1E3,e=this.summaryIds.slice(0,
d);this.summaryIds.splice(0,d);var g=new k,m=!1;p.some(this.summaryFields,f.hitch(this,function(a){if("area"===a.type||"length"===a.type||this.graphicsLayer)return m=!0}));a&&(m=!0);g.returnGeometry=m;var n=[];p.forEach(this.summaryFields,function(a){n.push(a.field)});this.symbolField&&n.push(this.symbolField);if(!0===this.config.csvAllFields||"true"===this.config.csvAllFields)g.outFields=["*"];else{if(0<this.popupFields.length)for(var x=0;x<this.popupFields.length;x++){var q=this.popupFields[x];
-1===n.indexOf(q)&&n.push(q)}g.outFields=n}g.objectIds=e;for(c.push(this.summaryLayer.queryFeatures(g));0<this.summaryIds.length;)e=this.summaryIds.slice(0,d),this.summaryIds.splice(0,d),g.objectIds=e,c.push(this.summaryLayer.queryFeatures(g));(new v(c)).then(f.hitch(this,function(c){for(var d=0;d<c.length;d++)if(c[d][0]){var e=c[d][1];e.features&&(this.summaryFeatures=this.summaryFeatures.concat(e.features))}a?this._processResults(a).then(f.hitch(this,function(a){this.SA_SAT_download&&h.replace(this.SA_SAT_download,
"download","processing");b.resolve(a)})):(this._processResults(),this.SA_SAT_download&&h.replace(this.SA_SAT_download,"download","processing"));this.SA_SAT_download&&h.replace(this.SA_SAT_download,"download","processing")}),f.hitch(this,function(a){console.error(a);new u({message:a})}));if(a)return b},_prepGroupedResults:function(){for(var a=0;a<this.summaryFeatures.length;a++){var b=this.summaryFeatures[a];if("undefined"!==typeof this.summaryFields&&0<this.summaryFields.length){var c=B.getFieldValue(this.summaryFields[0].field,
b.attributes[this.summaryFields[0].field],this.specialFields,this.dateFields,"longMonthDayYear"),c="undefined"!==typeof c&&null!==c?e.stripHTML(c.toString()):"";c in this.groupedResults?this.groupedResults[c].features.push(b):this.groupedResults[c]={features:[b]}}}},_prepResults:function(){for(var a in this.groupedResults){var b=this.summaryFields[0];b.total=this.groupedResults[a].features.length;this.groupedResults[a].total=b.total;this.groupedResults[a].type=b.type;this.groupedResults[a].label=
b.alias}},_processResults:function(a){this._prepGroupedResults();this._prepResults();var c=this.groupedResults,d=0,g,k;if(a)k=new l;else{this.container.innerHTML="";h.remove(this.container,"loading");if(0===Object.keys(this.groupedResults).length){this.container.innerHTML=this.parent.nls.noFeaturesFound;return}var m=Object.keys(this.groupedResults).length+1;g=y.create("div",{style:"width:"+220*m+"px;"},this.container);h.add(g,"SAT_tabPanelContent");m=y.create("div",{},g);h.add(m,"SATcolExport");h.add(m,
this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");m=y.create("div",{"data-dojo-attach-point":"SA_SAT_download",title:this.parent.nls.downloadCSV},m);h.add(m,[this.parent.isBlackTheme?"btnExportBlack":"btnExport","download"]);q(m,"click",f.hitch(this,this._exportToCSV,c))}var n=Object.keys(c).sort(),m=[];this.displayCount&&m.push({total:this.featureCount,a:void 0,info:this.parent.nls.count,c:void 0});for(var x in n){var d=n[x],p=c[d],u=e.stripHTML(d.toString()),d=d===this.parent.nls.area||
d===this.parent.nls.length?p.total:Math.round(p.total);isNaN(d)&&(d=0);var d=b.format(d),r="pre"===p.type?p.label.trim():u,u="pre"===p.type?u:p.label.trim(),p=""!==p.label?"colGroupedSummary":"colSummary";if(a)m.push({total:d,a:r,info:""===u?r:u,c:p});else{var C=y.create("div",{"class":"SATcol"},g);h.add(C,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var t=y.create("div",{style:"max-height: 45px;"},C);y.create("div",{"class":"SATcolWrap",style:"max-height: 30px; overflow: hidden;",
innerHTML:r},t);y.create("div",{"class":"SATcolWrap",style:"max-height: 30px; overflow: hidden;",innerHTML:u},t);y.create("div",{"class":p,innerHTML:d},C)}}c=[];x=null!==this.graphicsLayer;!a&&x&&(this.graphicsLayer.clear(),this.tab.tabLayers[1]&&this.tab.tabLayers[1].clear());if(this.summaryFeatures)for(g=0;g<this.summaryFeatures.length;g++)n=this.summaryFeatures[g],this.lyrSymbol?n.symbol=this.lyrSymbol:this.graphicsLayer?this.graphicsLayer.renderer&&(d=this.graphicsLayer.renderer.getSymbol(n),
n.symbol=d):this.summaryLayer.renderer&&this.summaryLayer.renderer.getSymbol&&(n.symbol=this.summaryLayer.renderer.getSymbol(n)),!a&&x?(this.graphicsLayer.add(n),this.tab.tabLayers[1].add(n)):c.push(n);!a&&x&&(this.graphicsLayer.setVisibility(!0),this.parent._toggleTabLayersNew(this.tabNum),this.tab.retsore&&this.emit("summary-complete",{bubbles:!0,cancelable:!0,tab:this.tabNum}));if(a)return k.resolve({graphics:c,analysisResults:m,context:this}),k},_exportToCSV:function(a,b,c,d){a=B.exportToCSV(this.summaryFeatures,
b,c,d,{type:"grouped",baseLabel:this.baseLabel,csvAllFields:this.parent.config.csvAllFields,layer:this.summaryLayer,opLayers:this.parent.opLayers,nlsValue:this.parent.nls.groupedSummary,nlsCount:this.parent.nls.count,summaryFields:this.summaryFields});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(a){var b=B.getSkipFields(a),c,d=[];if("undefined"!==typeof this.tab.advStat){var e=this.tab.advStat.stats,f;for(f in e)0<e[f].length&&p.forEach(e[f],function(a){var b={field:a.expression,
alias:a.label+"",type:f,total:0};c=a.expression;d.push(b)})}e=B.getSpecialFields(a);this.dateFields=e.dateFields;this.specialFields=e.specialFields;if(this.allFields)for(e=0;e<a.fields.length;e++){var g=a.fields[e];-1===b.indexOf(g.name)&&c!==g.name&&d.push({field:g.name,alias:g.alias,type:g.type})}return d}})})},"widgets/SituationAwareness/js/WeatherInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct esri/geometry/webMercatorUtils esri/request".split(" "),
function(t,n,p,v,l,f){return t("WeatherInfo",null,{constructor:function(d,c,f){this.tab=d;this.container=c;this.parent=f;this.weatherURL=d.url;this.weatherDict={119:["Cloudy","cloudy5.png","cloudy5.png"],377:["Moderate or heavy showers of ice pellets","hail.png","hail.png"],374:["Light showers of ice pellets","hail.png","hail.png"],350:["Ice pellets","hail.png","hail.png"],353:["Light rain shower","light_rain.png","light_rain.png"],302:["Moderate rain","light_rain.png","light_rain.png"],296:["Light rain",
"light_rain.png","light_rain.png"],293:["Patchy light rain","light_rain.png","light_rain.png"],266:["Light drizzle","light_rain.png","light_rain.png"],263:["Patchy light drizzle","light_rain.png","light_rain.png"],122:["Overcast","overcast.png","overcast.png"],359:["Torrential rain shower","shower3.png","shower3.png"],308:["Heavy rain","shower3.png","shower3.png"],365:["Moderate or heavy sleet showers","sleet.png","sleet.png"],362:["Light sleet showers","sleet.png","sleet.png"],320:["Moderate or heavy sleet",
"sleet.png","sleet.png"],317:["Light sleet","sleet.png","sleet.png"],314:["Moderate or Heavy freezing rain","sleet.png","sleet.png"],311:["Light freezing rain","sleet.png","sleet.png"],284:["Heavy freezing drizzle","sleet.png","sleet.png"],281:["Freezing drizzle","sleet.png","sleet.png"],185:["Patchy freezing drizzle nearby","sleet.png","sleet.png"],182:["Patchy sleet nearby","sleet.png","sleet.png"],395:["Moderate or heavy snow in area with thunder","snow4.png","snow4.png"],335:["Patchy heavy snow",
"snow4.png","snow4.png"],230:["Blizzard","snow4.png","snow4.png"],227:["Blowing snow","snow4.png","snow4.png"],371:["Moderate or heavy snow showers","snow5.png","snow5.png"],338:["Heavy snow","snow5.png","snow5.png"],389:["Moderate or heavy rain in area with thunder","tstorm3.png","tstorm3.png"],392:["Patchy light snow in area with thunder","snow2.png","snow2_night.png"],386:["Patchy light rain in area with thunder","tstorm1.png","tstorm1_night.png"],368:["Light snow showers","snow2.png","snow2_night.png"],
356:["Moderate or heavy rain shower","shower2.png","shower2_night.png"],332:["Moderate snow","snow3.png","snow3_night.png"],329:["Patchy moderate snow","snow2.png","snow2_night.png"],326:["Light snow","snow1.png","snow1_night.png"],323:["Patchy light snow","snow1.png","snow1_night.png"],305:["Heavy rain at times","shower2.png","shower2_night.png"],299:["Moderate rain at times","shower2.png","shower2_night.png"],260:["Freezing fog","fog.png","fog_night.png"],248:["Fog","fog.png","fog_night.png"],200:["Thundery outbreaks in nearby",
"tstorm1.png","tstorm1_night.png"],179:["Patchy snow nearby","snow1.png","snow1_night.png"],176:["Patchy rain nearby","shower1.png","shower1_night.png"],143:["Mist","mist.png","mist_night.png"],116:["Partly Cloudy","cloudy3.png","cloudy3_night.png"],113:["Clear/Sunny","sunny.png","sunny_night.png"]}},queryTabCount:function(d,c,f){this.updateTabCount(this.parent.incidents.length,f,!1)},updateTabCount:function(d,c){d=this.parent.incidents.length;"undefined"!==typeof d&&0===d?p.contains(c,"noFeatures")||
p.add(c,"noFeatures"):p.contains(c,"noFeatures")&&p.remove(c,"noFeatures")},updateForIncident:function(d){d=d[0];this.container.innerHTML="";p.add(this.container,"loading");var c=d=d.geometry;"point"!==d.type&&(c=d.getExtent().getCenter());d=l.webMercatorToGeographic(c);d=d.y+","+d.x;c="";"Weather"!==this.tab.label?(c=this.weatherURL,this.container.innerHTML="\x3cimg style\x3d'height:100%;' src\x3d'"+this.weatherURL+"' /\x3e"):(c=this.weatherURL+"\x26q\x3d"+d,f({url:c,callbackParamName:"callback"},
{useProxy:!1}).then(n.hitch(this,function(c){return this._resultsHandler(c)}),n.hitch(this,function(c){c=this._errorHandler(c);console.log(c)})))},_resultsHandler:function(d){d=d.data;console.log(d);var c=d.current_condition;d=d.weather;var f=1;this.container.innerHTML="";p.remove(this.container,"loading");var l=v.create("div",{style:"width:"+165*(d.length+3)+"px;"},this.container);p.add(l,"SAT_tabPanelContent");var n=this.parent.config.celsius?"C":"F",m,b;if(0<c.length){c=c[0];m=c.localObsDateTime.split(" ");
b=m[2];m=m[1].split(":");m=parseInt(m[0],10);if("AM"===b){if(6>m||12===m)f=2}else 6<m&&12>m&&(f=2);b=c.temp_F;this.parent.config.celsius&&(b=c.temp_C);m=c.weatherCode;m=this.weatherDict[parseInt(m,10)];m=this.parent.nls.now+"\x3cbr/\x3e\x3cimg style\x3d'height:45px' src\x3d'"+this.parent.folderUrl+"images/w/"+m[f]+"' /\x3e\x3cbr/\x3e"+b+"\x26deg;"+n;b=v.create("div",{innerHTML:m},l);p.add(b,"SATcolSmall");p.add(b,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");b=c.windspeedMiles;m=" mph";
this.parent.config.celsius&&(b=c.windspeedKmph,m=" km/h");m=this.parent.nls.wind+"\x3cbr/\x3e\x3cspan style\x3d'font-size: 30px; line-height:47px'\x3e"+c.winddir16Point+"\x3c/span\x3e\x3cbr/\x3e"+b+m;c=v.create("div",{innerHTML:m},l);p.add(c,"SATcolSmall");p.add(c,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder")}for(b=0;b<d.length;b++){var c=d[b],q=this._getDay(c.date),g=c.tempMaxF||c.maxtempF,r=c.tempMinF||c.mintempF;this.parent.config.celsius&&(g=c.tempMaxC||c.maxtempC,r=c.tempMinC||
c.mintempC);m=c.weatherCode;m=this.weatherDict[parseInt(m,10)];m=q+"\x3cbr/\x3e\x3cimg style\x3d'height:45px' src\x3d'"+this.parent.folderUrl+"images/w/"+m[f]+"' /\x3e\x3cbr/\x3e"+g+"\x26deg;"+n+" | "+r+"\x26deg;"+n;c=v.create("div",{innerHTML:m},l);p.add(c,"SATcolSmall");p.add(c,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder")}d=v.create("div",{innerHTML:'\x3cbr/\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d"font-size:11px;color:#6e6e6e"\x3e'+this.parent.nls.poweredBy+'\x3cbr/\x3e\x3ca style\x3d"color:#6e6e6e;text-decoration:none" href\x3d"http://www.worldweatheronline.com/" title\x3d"Free Weather API" target\x3d"_blank"\x3eWorld Weather Online\x3c/a\x3e\x3c/span\x3e'},
l);p.add(d,"SATcolSmall");p.add(d,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");p.add(d,"SATcolLast")},_getDay:function(d){d=d.split("-");d="SUN MON TUE WED THU FRI SAT".split(" ")[(new Date(d[0],d[1]-1,d[2])).getDay()];return this.parent.nls[d]},_errorHandler:function(d){console.log(d.message);d=v.create("div",{innerHTML:d.message},this.container);p.add(d,"SATcolSmall");p.add(d,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder")}})})},"widgets/SituationAwareness/js/ClosestInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on jimu/utils esri/geometry/geometryEngine esri/graphic esri/Color esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query ./analysisUtils".split(" "),
function(t,n,p,v,l,f,d,c,h,y,w,m,b,q,g,r,a,e,u,F,E,z){return t("ClosestInfo",null,{featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.graphicsLayer=this.incident=null;this.map=c.map;this.specialFields={};this.dateFields={};this.config=c.config;this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:a.layers},queryTabCount:function(a,c,d,e){var g=new f;this.incidentCount=a.length;var h=this.parent.config.distanceSettings[this.parent.config.distanceUnits],
l=this.parent.config.maxDistance;c=[];for(var m=0;m<a.length;m++)c.push(b.buffer(a[m].geometry,l,h));var k=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(k=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var x;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded?
(this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(a,c,d,e,k).then(function(a){g.resolve(a)})):(x=new r(this.summaryLayer.url),x.infoTemplate=this.tab.tabLayers[0].infoTemplate,k=[x],this.tab.tabLayers=k,w(x,"load",n.hitch(this,function(){this.summaryLayer=x;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(a,c,d,e,k).then(function(a){g.resolve(a)})})))):this.loading||(x=new r(this.tab.tabLayers[0].url),this.loading=!0,w(x,"load",n.hitch(this,function(){this.summaryLayer=
x;this.summaryFields=this._getFields(this.summaryLayer);for(var b=this.tab.tabLayers[0].url.split("MapServer/")[1],f=this.parent.map.itemInfo.itemData.operationalLayers,h=0;h<f.length;h++){var l=f[h];if("undefined"!==typeof l.layerObject&&l.layerObject.infoTemplates&&(l=l.layerObject.infoTemplates[b])){x.infoTemplate=l.infoTemplate;break}}k=[x];this.tab.tabLayers=k;this.loading=!1;this._performQuery(a,c,d,e,k).then(function(a){g.resolve(a)})})))}this.mapServiceLayer||this._performQuery(a,c,d,e,k).then(function(a){g.resolve(a)});
return g},_performQuery:function(a,b,c,d,e){var g=new f,h=[],m,k;this.summaryGeoms=b;if(0<b.length)for(a=0;a<b.length;a++)h=b[a],k=z.createDefArray(e,h),m=0===a?h=k:h=m.concat(k);(new l(h)).then(n.hitch(this,function(a){for(var b=0,e=0;e<a.length;e++){var f=a[e][1];isNaN(f)?f&&f.features?0<f.features.length&&(b+=1):f&&"undefined"!==typeof f.length&&0<f.length&&(b+=1):0<f&&(b+=1)}this.updateTabCount(b,c,d);g.resolve(b)}));return g},updateTabCount:function(a,b,c){this.featureCount=0===parseInt(a,10)?
0:a;z.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(a,b,c,d,e,g){this.incidentCount=a.length;this.allFields="undefined"!==typeof e&&"undefined"!==typeof g?e?!0:g:!1;var h="undefined"!==typeof d,l;v.forEach(this.tab.tabLayers,n.hitch(this,function(e){if("undefined"!==typeof e.empty&&e.url){var g=new r(e.url);w(g,"load",n.hitch(this,function(){this.tab.tabLayers=[g];h?(l=new f,this.processIncident(a,b,c,d).then(n.hitch(this,function(a){l.resolve(a)}),
n.hitch(this,function(a){console.error(a);l.reject(a)}))):this.processIncident(a,b,c,d)}))}else h?(l=new f,this.processIncident(a,b,c,d).then(n.hitch(this,function(a){l.resolve(a)}),n.hitch(this,function(a){console.error(a);l.reject(a)}))):this.processIncident(a,b,c,d)}));if(h)return l},processIncident:function(a,c,e,g){this.incidents=a;var h,m="undefined"!==typeof g;m?h=new f:(this.container.innerHTML="",d.add(this.container,"loading"));var x=[];g=this.parent.config.distanceSettings[this.parent.config.distanceUnits];
for(var p=[],k=0;k<a.length;k++){var u=a[k].geometry,r=b.buffer(u,c,g);p.push({geometry:u,buffer:r})}(this.graphicsLayer=e)&&this.graphicsLayer.clear();a=[];c=this.tab.tabLayers[0];var t=this._getFields(c);for(e=0;e<p.length;e++)g=new E,g.returnGeometry=!0,g.geometry=p[e].buffer,g.outFields="true"===this.parent.config.csvAllFields||!0===this.parent.config.csvAllFields?["*"]:t,"undefined"!==typeof c.queryFeatures&&a.push(c.queryFeatures(g));(new l(a)).then(n.hitch(this,function(a){for(var b=0;b<a.length;b++)if(a[b][0]){var c=
a[b][1].features,d=[],e=p[b].geometry;if(c&&0<c.length){for(var f=0;f<c.length;f++){for(var g=new q(c[f].toJson()),k=z.getDistance(e,g.geometry,this.parent.config.distanceUnits),l={DISTANCE:k},u=0;u<t.length;u++)l[t[u]]=g.attributes[t[u]];!0===this.config.csvAllFields||"true"===this.config.csvAllFields?g.attributes.DISTANCE=k:g.attributes=l;d.push(g)}d.sort(z.compareDistance);x.push(d[0])}}else a[b][1]&&a[b][1].message&&console.log(a[b][1].message);x.sort(z.compareDistance);m?this._processResults(x,
!0).then(n.hitch(this,function(a){h.resolve(a)})):this._processResults(x)}),n.hitch(this,function(a){console.error(a);h.reject(a)}));if(m)return h},_processResults:function(b,l){var x,r,t=b&&0<b.length;if(t&&"point"!==b[0].geometry.type)for(var v=b.length-1;0<=v;v--)"undefined"===typeof b[v].geometry.getExtent()&&b.splice(v,1);l?x=new f:(this.container.innerHTML="",d.remove(this.container,"loading"),t&&(r=c.create("div",{"class":"SAT_tabPanelContent"},this.container),v=c.create("div",{},r),d.add(v,
"SATcolExport"),d.add(v,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),v=c.create("div",{title:this.parent.nls.downloadCSV},v),d.add(v,"btnExport"),w(v,"click",n.hitch(this,this._exportToCSV,b))));var v=this.parent.nls[this.parent.config.distanceUnits],N=[],D=220;if(t)for(var k=0;k<b.length;k++){var B=k+1,A=b[k],E=A.geometry,J=E;"point"!==E.type&&(J=E.getExtent().getCenter());var E=A.attributes,P;"point"===this.incidents[0].geometry.type&&(P=Math.round(100*E.DISTANCE)/100+" "+v+" ("+
this.parent.nls.approximate+")");var M="",H=0,I=[];if("undefined"!==typeof this.displayFields)for(var Q=0;Q<this.displayFields.length;Q++){var V=this.displayFields[Q],K;for(K in E)if("DISTANCE"!==K&&3>H&&V.expression===K){var L=z.getFieldValue(K,E[K],this.specialFields,this.dateFields,"longMonthDayYear"),L="undefined"!==typeof L&&null!==L?m.stripHTML(L.toString()):"",T;if(A._layer&&A._layer.fields){var W=z.getField(A._layer.fields,K);W&&(T=W.alias)}if("undefined"===typeof T||T in[""," ",null,void 0])T=
K;z.isURL(L)?L='\x3ca href\x3d"'+L+'" target\x3d"_blank" style\x3d"color: inherit;"\x3e'+T+"\x3c/a\x3e":z.isEmail(L)&&(L='\x3ca href\x3d"mailto:'+L+'" style\x3d"color: inherit;"\x3e'+T+"\x3c/a\x3e");M+=L+"\x3cbr/\x3e";H+=1;I.push({value:-1<L.indexOf(",")?L.replace(",",""):L,label:T})}}N.push(I);l||(A=c.create("div",{},r),d.add(A,"SATcolRec"),d.add(A,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),H=c.create("div",{},A),d.add(H,"SATcolRecBar"),I=c.create("div",{innerHTML:B},H),d.add(I,
"SATcolRecNum"),y.set(I,"backgroundColor",this.parent.config.activeColor),w(I,"click",n.hitch(this,this._zoomToLocation,J)),P&&(I=c.create("div",{innerHTML:P},H),d.add(I,"SATcolDistance")),this.parent.config.enableRouting&&(H=c.create("div",{title:this.parent.nls.get_directions},H),d.add(H,"SATcolDir"),w(H,"click",n.hitch(this,this._routeToIncident,J))),M=c.create("div",{"class":"SATcolWrap",innerHTML:M},A),d.add(M,"SATcolInfo"),D+=h.position(A).w,M=new e(e.STYLE_SOLID,new p.fromRgb(this.parent.config.activeMapGraphicColor),
1),M=new a(a.STYLE_CIRCLE,24,M,new p.fromRgb(this.parent.config.activeMapGraphicColor)),A=new u,A.family="Arial",A.size="12px",B=new F(B,A,new g(this.parent.config.fontColor)),B.setOffset(0,-4),this.graphicsLayer.add(new q(J,M,E)),this.graphicsLayer.add(new q(J,B,E)))}if(!l&&t)y.set(r,"width",D);else if(t)return x.resolve({graphics:b,analysisResults:N,context:this}),x},_exportToCSV:function(a,b,c,d){a=z.exportToCSV(a,b,c,d,{type:"closest",baseLabel:this.baseLabel,csvAllFields:this.parent.config.csvAllFields,
layer:this.tab.tabLayers[0],opLayers:this.parent.opLayers,nlsValue:this.parent.nls.closest,nlsCount:this.parent.nls.count});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(a){a=z.getFields(a,this.tab,this.allFields,this.parent);this.dateFields=a.dateFields;this.specialFields=a.specialFields;this.displayFields=z.getDisplayFields(this.tab);return a.fields},_zoomToLocation:function(a){this.parent.zoomToLocation(a)},_routeToIncident:function(a){this.parent.routeToIncident(a)}})})},
"widgets/SituationAwareness/js/ProximityInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on esri/graphic esri/Color esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query esri/geometry/geometryEngine jimu/utils ./analysisUtils".split(" "),function(t,n,p,v,l,f,d,
c,h,y,w,m,b,q,g,r,a,e,u,F,E,z){return t("ProximityInfo",null,{featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.graphicsLayer=this.incident=null;this.specialFields={};this.dateFields={};this.config=c.config;this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:a.layers},queryTabCount:function(a,b,c,d){var e=new f;this.incidentCount=a.length;var g=[this.tab.tabLayers[0]];this.mapServiceLayer&&
1<this.tab.tabLayers.length&&(g=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var h;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded?(this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(a,b,c,d,g).then(function(a){e.resolve(a)})):(h=new q(this.summaryLayer.url),
h.infoTemplate=this.tab.tabLayers[0].infoTemplate,g=[h],this.tab.tabLayers=g,w(h,"load",n.hitch(this,function(){this.summaryLayer=h;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(a,b,c,d,g).then(function(a){e.resolve(a)})})))):this.loading||(h=new q(this.tab.tabLayers[0].url),this.loading=!0,w(h,"load",n.hitch(this,function(){this.summaryLayer=h;this.summaryFields=this._getFields(this.summaryLayer);for(var f=this.tab.tabLayers[0].url.split("MapServer/")[1],g=this.parent.map.itemInfo.itemData.operationalLayers,
l=0;l<g.length;l++){var m=g[l];if("undefined"!==typeof m.layerObject&&m.layerObject.infoTemplates&&(m=m.layerObject.infoTemplates[f])){h.infoTemplate=m.infoTemplate;break}}this.tab.tabLayers=[h];this.loading=!1;this._performQuery(a,b,c,d,this.tab.tabLayers).then(function(a){e.resolve(a)})})))}this.mapServiceLayer||this._performQuery(a,b,c,d,g).then(function(a){e.resolve(a)});return e},_performQuery:function(a,b,c,d,e){var g=new f,h=[],m,k;0<b.length?k=z.getGeoms(b):0<a.length&&(k=z.getGeoms(a));this.summaryGeoms=
k;if(0<k.length)for(a=0;a<k.length;a++)h=k[a],b=z.createDefArray(e,h),m=0===a?h=b:h=m.concat(b);(new l(h)).then(n.hitch(this,function(a){for(var b=0,e=0;e<a.length;e++){var f=a[e][1];isNaN(f)?f&&f.features?b+=f.features.length:f&&"undefined"!==typeof f.length&&(b+=f.length):b+=f}this.updateTabCount(b,c,d);g.resolve(b)}));return g},updateTabCount:function(a,b,c){this.featureCount=a;z.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(a,b,c,d,e,g){this.incidentCount=
a.length;this.allFields="undefined"!==typeof e&&"undefined"!==typeof g?e?!0:g:!1;var h="undefined"!==typeof d,l;v.forEach(this.tab.tabLayers,n.hitch(this,function(e){if("undefined"!==typeof e.empty&&e.url){var g=new q(e.url);w(g,"load",n.hitch(this,function(){this.tab.tabLayers=[g];h?(l=new f,this.processIncident(a,b,c,d).then(n.hitch(this,function(a){l.resolve(a)}),n.hitch(this,function(a){console.error(a);l.reject(a)}))):this.processIncident(a,b,c,d)}))}else h?(l=new f,this.processIncident(a,b,
c,d).then(n.hitch(this,function(a){l.resolve(a)}),n.hitch(this,function(a){console.error(a);l.reject(a)}))):this.processIncident(a,b,c,d)}));if(h)return l},processIncident:function(a,b,c,e){this.incidents=a;var g=[],h;if(0===b.length)for(var m=0;m<a.length;m++)h=a[m],h=h.geometry?h.geometry:h,"polygon"===h.type?(b.push(h),g.push({geometry:h,buffer:h})):g.push({geometry:void 0,buffer:void 0});else for(m=0;m<a.length;m++){h=a[m];var p=b[m].geometry?b[m].geometry:b[m];h=h.geometry?h.geometry:h;g.push({geometry:h,
buffer:p})}if(0!==b.length){for(a=0;a<g.length;a++)if(b=g[a].buffer,"undefined"!==typeof b)for(h=0;h<g.length;h++)if(h!==a&&(m=g[h].buffer,"undefined"!==typeof m&&F.overlaps(b,m))){g[a].buffer=F.difference(b,m);g[h].buffer=F.difference(m,b);m=F.union(m,b);m=F.difference(m,g[a].buffer);m=F.difference(m,g[h].buffer);if(Array.isArray(g[a].geometry)){if(Array.isArray(g[h].geometry))for(p=0;p<g[h].geometry.length;p++)g[a].geometry.push(g[h].geometry[p]);else g[a].geometry.push(g[h].geometry);p=g[a].geometry}else if(p=
[],p.push(g[a].geometry),Array.isArray(g[h].geometry))for(var k=0;k<g[h].geometry.length;k++)p.push(g[h].geometry[k]);else p.push(g[h].geometry);g.push({geometry:p,buffer:m})}var q,r="undefined"!==typeof e;r?q=new f:(this.container.innerHTML="",d.add(this.container,"loading"));var x=[];this.graphicsLayer=c;c=this.tab.tabLayers[0];var t=this._getFields(c);e=[];for(a=0;a<g.length;a++)b=new u,b.returnGeometry=!0,b.geometry=g[a].buffer,b.outFields="true"===this.parent.config.csvAllFields||!0===this.parent.config.csvAllFields?
["*"]:t,"undefined"!==typeof c.queryFeatures&&e.push(c.queryFeatures(b));(new l(e)).then(n.hitch(this,function(a){for(var b=0;b<a.length;b++){var c=a[b][1];if(c&&c.features)for(var c=c.features,d=g[b].geometry,e=0;e<c.length;e++){var f=c[e],h=f.geometry,k;if(Array.isArray(d)){var l;for(k=0;k<d.length;k++){var m=z.getDistance(d[k],h,this.parent.config.distanceUnits);if("undefined"===typeof l||m<l)l=m}k=l;h={DISTANCE:l}}else k=z.getDistance(d,h,this.parent.config.distanceUnits),h={DISTANCE:k};for(m=
0;m<t.length;m++)h[t[m]]=f.attributes[t[m]];!0===this.config.csvAllFields||"true"===this.config.csvAllFields?f.attributes.DISTANCE=k:f.attributes=h;x.push(f)}}x.sort(z.compareDistance);r?q.resolve({graphics:x,analysisResults:x.length,context:this}):this._processResults(x)}),n.hitch(this,function(a){console.error(a);q.reject(a)}));if(r)return q}},_processResults:function(f){this.container.innerHTML="";d.remove(this.container,"loading");this.graphicsLayer.clear();if("point"!==f[0].geometry.type)for(var l=
f.length-1;0<=l;l--)"undefined"===typeof f[l].geometry.getExtent()&&f.splice(l,1);var l=c.create("div",{"class":"SAT_tabPanelContent"},this.container),q=this.parent.nls[this.parent.config.distanceUnits],u=c.create("div",{},l);d.add(u,"SATcolExport");d.add(u,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");u=c.create("div",{title:this.parent.nls.downloadCSV},u);d.add(u,"btnExport");w(u,"click",n.hitch(this,this._exportToCSV,f));var x;"undefined"!==typeof this.tab.advStat&&"undefined"!==
typeof this.tab.advStat.stats&&"undefined"!==typeof this.tab.advStat.stats.outFields?x=this.tab.advStat.stats.outFields:(x=[],0<this.tab.tabLayers.length&&v.forEach(this.tab.tabLayers,n.hitch(this,function(a){"undefined"!==typeof a.popupInfo?v.forEach(a.popupInfo.fieldInfos,n.hitch(this,function(a){if(a.visible){var b={value:0};b.expression=a.fieldName;b.label=a.label;x.push(b)}})):a.infoTemplate?v.forEach(a.infoTemplate.info.fieldInfos,n.hitch(this,function(a){if(a.visible){var b={value:0};b.expression=
a.fieldName;b.label=a.label;x.push(b)}})):v.forEach((a.layerObject?a.layerObject:a).fields,n.hitch(this,function(a){var b={value:0};b.expression=a.name;b.label=a.alias;x.push(b)}))})));for(var u=220,t=0;t<f.length;t++){var F=t+1,D=f[t],k=D.geometry,B=k;"point"!==k.type&&(B=k.getExtent().getCenter());var k=D.attributes,A;"point"===this.incidents[0].geometry.type&&(A=Math.round(100*k.DISTANCE)/100+" "+q+" ("+this.parent.nls.approximate+")");var O="",J=0;if("undefined"!==typeof x)for(var P=0;P<x.length;P++){var M=
x[P],H;for(H in k)if("DISTANCE"!==H&&3>J&&M.expression===H){var I=z.getFieldValue(H,k[H],this.specialFields,this.dateFields,"longMonthDayYear"),I="undefined"!==typeof I&&null!==I?E.stripHTML(I.toString()):"",Q;if(D._layer&&D._layer.fields){var V=z.getField(D._layer.fields,H);V&&(Q=V.alias)}if("undefined"===typeof Q||Q in[""," ",null,void 0])Q=H;z.isURL(I)?I='\x3ca href\x3d"'+I+'" target\x3d"_blank" style\x3d"color: inherit;"\x3e'+Q+"\x3c/a\x3e":z.isEmail(I)&&(I='\x3ca href\x3d"mailto:'+I+'" style\x3d"color: inherit;"\x3e'+
Q+"\x3c/a\x3e");O+=I+"\x3cbr/\x3e";J+=1}}D=c.create("div",{},l);d.add(D,"SATcolRec");d.add(D,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");J=c.create("div",{},D);d.add(J,"SATcolRecBar");P=c.create("div",{innerHTML:F},J);d.add(P,"SATcolRecNum");y.set(P,"backgroundColor",this.parent.config.activeColor);w(P,"click",n.hitch(this,this._zoomToLocation,B));A&&(P=c.create("div",{innerHTML:A},J),d.add(P,"SATcolDistance"));this.parent.config.enableRouting&&(J=c.create("div",{title:this.parent.nls.get_directions},
J),d.add(J,"SATcolDir"),w(J,"click",n.hitch(this,this._routeToIncident,B)));O=c.create("div",{"class":"SATcolWrap",innerHTML:O},D);d.add(O,"SATcolInfo");u+=h.position(D).w;O=new r(r.STYLE_SOLID,new p.fromString(this.parent.config.activeMapGraphicColor),1);O=new g(g.STYLE_CIRCLE,24,O,new p.fromString(this.parent.config.activeMapGraphicColor));D=new a;D.family="Arial";D.size="12px";F=new e(F,D,new b(this.parent.config.fontColor));F.setOffset(0,-4);this.graphicsLayer.add(new m(B,O,k));this.graphicsLayer.add(new m(B,
F,k))}y.set(l,"width",u+"px")},_exportToCSV:function(a,b,c,d){a=z.exportToCSV(a,b,c,d,{type:"proximity",baseLabel:this.baseLabel,csvAllFields:this.parent.config.csvAllFields,layer:this.tab.tabLayers[0],opLayers:this.parent.opLayers,nlsValue:this.parent.nls.proximity,nlsCount:this.parent.nls.count});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(a){a=z.getFields(a,this.tab,this.allFields,this.parent);this.dateFields=a.dateFields;this.specialFields=a.specialFields;return a.fields},
_zoomToLocation:function(a){this.parent.zoomToLocation(a)},_routeToIncident:function(a){this.parent.routeToIncident(a)}})})},"widgets/SituationAwareness/js/SnapShot":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/DeferredList dojo/_base/array esri/request esri/geometry/webMercatorUtils esri/geometry/Polygon esri/geometry/Point esri/geometry/Multipoint esri/geometry/Polyline jimu/utils jimu/portalUtils jimu/portalUrlUtils jimu/tokenUtils jimu/dijit/Message ./CSVUtils".split(" "),
function(t,n,p,v,l,f,d,c,h,y,w,m,b,q,g,r,a){return t("SnapShot",null,{portal:null,portalUrl:"",baseName:"",logo:"",originMapId:"",originAppId:"",credential:null,nls:null,layerArray:[],parent:null,downloadAll:!1,time:null,constructor:function(a){this.parent=a;this.mapItemInfo=this.parent.map.itemInfo;this.extent=this.parent.map.extent;this.nls=n.mixin(this.parent.nls,window.jimuNls.drawBox);this.downloadAll=this.parent.config.csvAllFields;a=a.appConfig;this.portalUrl=a.portalUrl;this.portal=b.getPortal(this.portalUrl);
this.selfUrl=q.getPortalSelfInfoUrl(this.portalUrl);this.baseUrl=this.portalUrl+"sharing/rest/";this.logo=a.logo;this.originMapId=a.map.itemId;this.originAppId=a.appId},createSnapShot:function(a){var b=new p;this.baseName=m.stripHTML(a.name);this.layerArray=[];var c=new Date(a.time),d=c.getTimezoneOffset();this.time=m.fieldFormatter.getFormattedDate(c,{dateFormat:"shortDateShortTime"})+" "+this.nls.utc+(0>d?"+"+Math.abs(d)/60:"-"+d/60);this.portal.getUser().then(n.hitch(this,function(c){this.createFolder(c,
this.time).then(n.hitch(this,function(d){this.createLayerItems(c,d,a).then(n.hitch(this,function(a){this.addLayers(c,d,a).then(n.hitch(this,function(a){this.createMap(c,d,a,this.mapItemInfo).then(n.hitch(this,function(a){new r({message:'\x3ca href\x3d"'+(this.portalUrl+"home/webmap/viewer.html?webmap\x3d"+a.id)+'" target\x3d"_blank"\x3e'+(a.success?this.nls.snapshot_complete:this.nls.snapshot_failed)+"\x3c/a\x3e"});b.resolve("success")}),function(a){b.reject(a)})}),function(a){b.reject(a)})}),function(a){b.reject(a)})}),
function(a){b.reject(a)})}),function(a){b.reject(a)});return b},createFolder:function(a,b){var c=new p,d={url:this.baseUrl+"content/users/"+a.username+"/createFolder",content:{f:"json",folderName:this.baseName+"_"+b,title:this.baseName+"_"+b,description:this.baseName+" "+this.nls.snapshot},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(d.content.token=this.credential.token);f(d,{usePost:!0}).then(n.hitch(this,function(a){c.resolve(a)}),n.hitch(this,function(a){c.reject(a)}));
return c},createLayerItems:function(a,b,c){var d=new p;a=c.layers;this.buffers=c.buffers;this.incidents=c.incidents;c=[];for(b=0;b<a.length;b++){var e=!0;a[b].analysisObject&&"undefined"!==typeof a[b].analysisObject.featureCount&&0===a[b].analysisObject.featureCount&&(e=!1);a[b].graphics&&0===a[b].graphics.length&&(e=!1);e&&c.push(this.createItem(a[b],this.incidents,this.buffers,this.time,this.nls,this.baseName))}var f=[];(new v(c)).then(n.hitch(this,function(a){for(var b=0;b<a.length;b++)f.push(a[b][1]);
d.resolve(f)}),n.hitch(this,function(a){d.reject(a)}));return d},addLayers:function(a,b,c){for(var d=new p,e=[],f=0;f<c.length;f++)e.push(a.addItem(c[f],b.folder.id));var g=[];(new v(e)).then(n.hitch(this,function(a){for(var b=0;b<a.length;b++){var c=a[b][1];c.success&&g.push(c.id)}d.resolve(g)}),n.hitch(this,function(a){d.reject(a)}));return d},createItem:function(a,b,c,d,f,g){var e=new p,h={label:a.label,title:a.label+"_"+d,desc:f.snapshot_append+" "+f.of_append+" "+a.type+" "+f.layer_append+" "+
a.label+" ("+d+")",name:a.label+" ("+d+")",tags:[g+","+f.snapshot_append]};if(a.layerObject){var l=a.layerObject;g=a.analysisObject;this.layerArray.push({layer:{id:h.title,label:h.title,opacity:1,visible:!1},label:h.name});var m;l.infoTemplate&&l.infoTemplate.info&&(m=l.infoTemplate.info);h.popupInfo=m;"groupedSummary"===a.type||"summary"===a.type?g.updateForIncident(b,c,null,null,!0,!0,!0).then(n.hitch(this,function(a){a=this.createAnalysisLayerJSON(a,l,f,d,h);e.resolve(a)})):g.updateForIncident(b,
"closest"===a.type?this.parent.config.maxDistance:c,null,!0,!0,!0).then(n.hitch(this,function(a){a=this.createAnalysisLayerJSON(a,l,f,d,h);e.resolve(a)}))}else a=this.createIncidentBufferLayerJSON(a.graphics,f,d,h),e.resolve(a);return e},createAnalysisLayerJSON:function(a,b,c,d,f){var e=a.graphics;(a=a.context._exportToCSV(e,!0))&&a.push({name:c.snapshot_append,alias:c.snapshot_append,type:"esriFieldTypeString"});for(var g=[],h=0;h<e.length;h++){var l=e[h];l.attributes[c.snapshot_append]=d;l.geometry.cache&&
(l.geometry.clearCache(),delete l.geometry.cahce);g.push({attributes:l.attributes,geometry:l.geometry})}return{title:f.title,type:"Feature Collection",tags:f.tags,description:f.desc,extent:b.fullExtent,name:f.title,text:JSON.stringify({layers:[{layerDefinition:{capabilities:"Query",name:f.name,geometryType:b.geometryType,objectIdField:b.objectIdField,type:"Feature Layer",extent:b.fullExtent,drawingInfo:{renderer:b.renderer.toJson()},fields:a},popupInfo:f.popupInfo,featureSet:{features:g,geometryType:b.geometryType}}]}),
f:"json"}},createIncidentBufferLayerJSON:function(a,b,d,f){var e=[],g=[],h=[];l.forEach(a,function(a){switch(a.geometry.type){case "point":e.push(a);break;case "polyline":g.push(a);break;case "polygon":h.push(a)}});a=[];0<h.length&&a.push(h);0<g.length&&a.push(g);0<e.length&&a.push(e);for(var m=[],n={point:"esriGeometryPoint",polyline:"esriGeometryPolyline",polygon:"esriGeometryPolygon"},p={point:this.nls.point,polyline:this.nls.line,polygon:this.nls.polygon},q={xmin:this.extent.xmin,ymin:this.extent.ymin,
xmax:this.extent.xmax,ymax:this.extent.ymax,spatialReference:this.extent.spatialReference},r=0;r<a.length;r++){var u=a[r],k;if(0<u.length){var t=u[0];k=p["undefined"!==typeof t.geometry?t.geometry.type:t.type];for(var v=n["undefined"!==typeof t.geometry?t.geometry.type:t.type],y=t.symbol.toJson(),F=[],E=0;E<u.length;E++){var t=u[E],M;switch(v){case "esriGeometryPolyline":M=t.geometry.paths;break;case "esriGeometryPolygon":M=t.geometry.rings;break;case "esriGeometryPoint":M=[t.geometry]}var H=0,I;
l.forEach(M,function(a){switch(v){case "esriGeometryPolyline":I=new w(a);I.spatialReference=t.geometry.spatialReference;break;case "esriGeometryPolygon":I=new c(a);I.spatialReference=t.geometry.spatialReference;break;case "esriGeometryPoint":I=a}a={attributes:{ObjectID:E+H},geometry:I};a.attributes[b.snapshot_append]=d;F.push(a);H+=1})}m.push({layerDefinition:{capabilities:"Query",name:1===a.length?f.name:k,geometryType:v,objectIdField:"ObjectID",type:"Feature Layer",extent:q,drawingInfo:{renderer:{type:"simple",
label:"",description:"",symbol:y}},fields:[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID"},{name:b.snapshot_append,alias:b.snapshot_append,type:"esriFieldTypeString"}]},featureSet:{features:F,geometryType:v}})}}this.layerArray.push({layer:{id:f.title,label:f.title,opacity:1,visible:!0},label:f.name});return{title:f.title,type:"Feature Collection",tags:f.tags,description:f.desc,extent:q,name:f.title,text:JSON.stringify({layers:m}),f:"json"}},createMap:function(a,b,c,f){var e=f.itemData;
f=this.baseName+" ("+this.nls.snapshot_append+" "+this.time+")";for(var g,h=[],l=0;l<e.baseMap.baseMapLayers.length;l++)g=e.baseMap.baseMapLayers[l],h.push({id:g.id,layerType:g.layerType,url:g.url,visibility:g.visibility,opacity:g.opacity,title:g.title}),g=g.resourceInfo.spatialReference;e={baseMapLayers:h};h=[];for(l=0;l<this.layerArray.length;l++){var m=this.layerArray[l];h.push({id:m.layer.id,layerType:"ArcGISFeatureLayer",visibility:m.layer.visible,opacity:m.layer.opacity,title:m.label,type:"Feature Collection",
itemId:c[l]})}c=d.webMercatorToGeographic(this.extent);c={title:f,type:"Web Map",item:f,extent:c.xmin+","+c.ymin+","+c.xmax+","+c.ymax,text:JSON.stringify({operationalLayers:h,baseMap:e,spatialReference:g,authoringApp:"WebMapViewer",authoringAppVersion:"4.1",version:"2.4"}),tags:this.baseName+","+this.nls.snapshot_append,wabType:"HTML"};return a.addItem(c,b.folder.id)},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||this.clearCredentialAndUser();return a},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=g.getPortalCredential(this.portalUrl))},clearCredentialAndUser:function(){this.user=this.credential=null},createDownloadZip:function(b,c,d){var e=new p,f=this.nls.calculated_results;this._performAnalysis(b,c,d,this.downloadAll,!1).then(function(b){for(var c=[],d=0;d<b.length;d++){var g=b[d];(g=g.context._exportToCSV(g.graphics,!1,!0,g.analysisResults))&&c.push(g)}0<c.length&&a.exportCalculatedResultsCSV(f,
c);e.resolve("success")},function(a){e.reject(a)});return e},_performAnalysis:function(a,b,c,d,f){for(var e=new p,g=[],h=0;h<a.length;h++){var l=a[h];console.log("AO: "+l);var m=!0;l.analysisObject&&"undefined"!==typeof l.analysisObject.featureCount&&0===l.analysisObject.featureCount&&(m=!1);m&&("groupedSummary"===l.type||"summary"===l.type?g.push(l.analysisObject.updateForIncident(b,c,null,null,!0,f,d)):g.push(l.analysisObject.updateForIncident(b,"closest"===l.type?this.parent.config.maxDistance:
c,null,!0,f,d)))}var q=[];(new v(g)).then(n.hitch(this,function(a){for(var b=0;b<a.length;b++)q.push(a[b][1]);e.resolve(q)}),n.hitch(this,function(a){console.error(a);e.reject(a)}));return e}})})},"widgets/SituationAwareness/js/SnapshotName":function(){define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/query jimu/BaseWidget dojo/text!./SnapshotName.html dojo/Evented dijit/form/ValidationTextBox".split(" "),function(t,n,p,v,l,f,d,c,
h,y){return t([c,n,y],{templateString:h,baseClass:"jimu-widget-SAT-snapshot-name",constructor:function(){},postMixInProperties:function(){this.inherited(arguments);this.nls.common=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.nameSpan.innerHTML=this.nls.common.name+":";this.startup()},startup:function(){this.snapshotName.invalidMessage=this.nls.invalid_snapshot_name;this.snapshotName.validator=this.checkString;this.btnCancel.innerText=this.nls.common.cancel;this.own(f(this.btnCancel,
"click",p.hitch(this,function(){this.emit("cancel")})));this.btnOk.innerText=this.nls.common.ok;this.own(f(this.btnOk,"click",p.hitch(this,function(){l.contains(this.btnOk,"jimu-state-disabled")||this.emit("ok",this.snapshotName.value.trim())})))},checkString:function(c){c=c.trim();c=50>c.length&&/^[\w ]+$/.test(c)?!0:!1;var f=d(".snapshot-name-footer")[0];f&&(c?v.removeClass(f.children[0],"jimu-state-disabled"):v.addClass(f.children[0],"jimu-state-disabled"));return c},destroy:function(){}})})},
"widgets/SituationAwareness/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/js/SnapshotName.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"jimu-r-row"\x3e\r\n    \x3cspan class\x3d"label" data-dojo-attach-point\x3d"nameSpan"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"jimu-r-row" style\x3d"padding-top: 10px;"\x3e\r\n    \x3cinput class\x3d"validationBox" data-dojo-attach-point\x3d"snapshotName" data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n      title\x3d"${nls.snapshot_name}"/\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"snapshot-name-footer jimu-float-trailing" style\x3d"padding-top: 10px;"\x3e\r\n    \x3cdiv class\x3d"jimu-btn ok jimu-state-disabled" data-dojo-attach-point\x3d"btnOk"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn cancel" data-dojo-attach-point\x3d"btnCancel"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"panelBottom" class\x3d"panelBottom"\x3e\r\n\r\n    \x3c!-- Panel Footer --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"footerNode" class\x3d"SA_panelFooter dart-bgcolor box-bgcolor jimu-main-background"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"panelLeft" class\x3d"SA_panelLeft" data-dojo-attach-event\x3d"onclick:_navTabsLeft"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"footerContentNode" class\x3d"SA_panelFooterContent"\x3e\r\n        \x3c!-- Tabs --\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"tabsNode" class\x3d"SA_SAT_tabs"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"panelRight" class\x3d"SA_panelRight" data-dojo-attach-event\x3d"onclick:_navTabsRight"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"SA_panelClose" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3c!--Panel Container --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"panelContainer" class\x3d"panelContainer dart-bgcolor box-bgcolor jimu-main-background"\x3e\r\n      \x3c!-- Panel Incident --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"innerBL" class\x3d"innerBL" data-dojo-attach-event\x3d"onclick:_navLeft"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"SA_tabPanel0" class\x3d"SAT_tabPanel"\x3e\r\n        \x3cdiv class\x3d"SAT_tabPanelContent" style\x3d"min-width: 510px"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"incidentsLocate" class\x3d"SATcolLocate" style\x3d"width:auto; min-width:220px"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"locateIncident" class\x3d"label locateIncident"\x3e\x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"clearIncident" class\x3d"label clearIncident" data-dojo-attach-event\x3d"onclick:_clear"\x3e\r\n              ${nls.clearIncident}\r\n            \x3c/div\x3e\r\n            \x3cbr /\x3e\r\n            \x3cdiv class\x3d"locateIncidentContainer"\x3e\r\n              \x3cdiv class\x3d"colBar SATdrawCol"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"imgContainer" class\x3d"imgContainer"\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cimg class\x3d"btn32img" data-dojo-attach-point\x3d"SA_btn0"\x3e \x3c/img\x3e \x3c/span\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cimg class\x3d"btn32img" data-dojo-attach-point\x3d"SA_btn1"\x3e \x3c/img\x3e \x3c/span\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cimg class\x3d"btn32img" data-dojo-attach-point\x3d"SA_btn2"\x3e \x3c/img\x3e \x3c/span\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n              \x3cdiv class\x3d"bufferIncidentContainer"\x3e\r\n                \x3cdiv class\x3d"bufferControlsContainer"\x3e\r\n                  \x3cdiv data-dojo-attach-point\x3d"buffer_lbl" class\x3d"label bufferLabel"\x3e\x3c/div\x3e          \r\n                  \x3cdiv class\x3d"spinnerValueDIV"\x3e\r\n                    \x3cinput data-dojo-attach-point\x3d"spinnerValue" data-dojo-type\x3d"dijit/form/NumberSpinner" class\x3d"spinnerValue" name\x3d"spinnerValue" value\x3d"15" /\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"buffer_lbl_unit" class\x3d"label bufferUnit"\x3e\x3c/div\x3e\r\n                  \x3c/div\x3e       \r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"saveOptions" class\x3d"SATcol2"\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"div_reverse_geocoding" class\x3d"SATcol reverseGeocodingDIV"\x3e\r\n            \x3cdiv class\x3d"label"\x3e\r\n              ${nls.reverse_geocoded_address}\r\n            \x3c/div\x3e\r\n            \x3c/br\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"div_reversed_address" class\x3d"label reversedAddressDIV"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"innerBR" class\x3d"innerBR" data-dojo-attach-event\x3d"onclick:_navRight"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Message --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"messageNode" class\x3d"SA_panelMessage"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"messageTextNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/css/style.css":".jimu-widget-SAT {color: #ffffff !important; background-color: #4c4c4c; left: 0px; right: 0px; bottom: 0px; height: 155px !important; display: block; z-index: 100 !important;}.action2 {padding-left: 10px;}.jimu-widget-SAT .innerBL {display: none; width: 10px; height: 20px; background-image: url('images/nav_left.png'); background-repeat: no-repeat; background-size:cover; position: fixed; bottom: 45px; left: 0px; z-index: 2; background-size:cover; opacity: .6;}.jimu-rtl .jimu-widget-SAT .innerBL {right: 0px;}.jimu-widget-SAT .innerBL:hover {width: 20px; height: 35px; opacity: 1; cursor: pointer; bottom: 30px;}.jimu-widget-SAT .innerBR {display: none; width: 10px; height: 20px; background-image: url('images/nav_right.png'); background-repeat: no-repeat; background-size:cover; position: fixed; bottom: 45px; right: 0px; z-index: 2; opacity: .6;}.jimu-rtl .jimu-widget-SAT .innerBR {left: 0px;}.jimu-widget-SAT .innerBR:hover {width: 20px; height: 35px; opacity: 1; cursor: pointer; bottom: 30px;}.jimu-widget-SAT .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-SAT .roundedL {-moz-border-radius: 5px 0px 0px 5px; -webkit-border-radius: 5px 0px 0px 5px; border-radius: 5px 0px 0px 5px;}.jimu-widget-SAT .roundedR {-moz-border-radius: 0px 5px 5px 0px; -webkit-border-radius: 0px 5px 5px 0px; border-radius: 0px 5px 5px 0px;}.jimu-widget-SAT .reverseGeocodingDIV {visibility: hidden;}.jimu-widget-SAT .reversedAddressDIV {width:100%;}.jimu-widget-SAT .spinnerValue {width: 80px; align: left;}.jimu-widget-SAT .panelBottom {position: absolute; width: 100%; height: 155px; left: 0px; top: 0px; text-align: center; color: #ffffff; padding: 0px;}.jimu-widget-SAT .SA_panelMessage {position: absolute; top: 0px; text-align: center; width: 100%; height: 40px; line-height: 40px; display: none;}.jimu-widget-SAT .SA_panelFooter {position: absolute; top: 0px; left: 0px; right: 0px; height: 30px; line-height: 30px; overflow: hidden; border-bottom: 1px solid #353535; border-bottom: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .SA_panelFooterContent {position: absolute; left: 0px; right: 24px; height: 30px; overflow-x: hidden; overflow-y: hidden; display: block;}.jimu-rtl .jimu-widget-SAT .SA_panelFooterContent {position: absolute; left: 24px; right: 0px;}.jimu-widget-SAT .SA_panelClose {position: absolute; left: auto; right: 0px; width: 24px; height: 30px; line-height: 30px; text-align: center; display: block; cursor: pointer; background-image: url('images/x.png'); background-repeat: no-repeat; background-position: center center; background-size: 12px;}.jimu-widget-SAT .SA_panelRight {display: none; position: absolute; left: auto; right: 24px; width: 34px; height: 30px; line-height: 30px; cursor: pointer; background-image: url('images/nav_right.png'); background-repeat: no-repeat; background-position: center center; background-size: 10px; opacity: .4;}.jimu-widget-SAT .SA_panelRight:hover {opacity: 1; background-size: 16px;}.jimu-widget-SAT .SA_panelLeft {display: none; position: absolute; left: 0px; right: auto; height: 30px; line-height: 30px; cursor: pointer; background-image: url('images/nav_left.png'); background-repeat: no-repeat; background-position: center center; background-size: 10px; opacity: .4;}.jimu-widget-SAT .SA_panelLeft:hover {opacity: 1; background-size: 16px;}.jimu-rtl .jimu-widget-SAT .SA_panelClose {position: absolute; left: 0px; right: auto;}.jimu-widget-SAT .panelContainer {position: absolute; top: 30px; width: 100%; height: 125px; overflow: hidden; display: block;}.jimu-widget-SAT .SAT_tabPanel {position: absolute; top: 10px; left: 0px; right: 0px; height: 115px; display: none; overflow: auto;}.jimu-widget-SAT .SAT_tabPanelContent {position: absolute; top: 0px; height: 100px; white-space: nowrap; display: block; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none;}.jimu-widget-SAT .locateIncidentContainer {display: flex; float: left; margin-top: 20px;}.jimu-rtl .jimu-widget-SAT .locateIncidentContainer {display: flex; float: right; margin-top: 20px;}.jimu-widget-SAT .bufferIncidentContainer {display: table-cell;}.jimu-widget-SAT .bufferControlsContainer {float: left; padding-left: 20px;}.jimu-widget-SAT .SA_SAT_tabs {position: absolute; white-space: nowrap; height: 30px; padding: 0px; overflow-x: visible; overflow-y: hidden;}.jimu-widget-SAT .SATTab {width: auto; max-width: 220px; overflow: hidden; text-overflow: ellipsis; height: 30px; float: left; line-height: 30px; font-size: 13px; padding: 0 30px 0 30px; cursor: pointer; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; opacity: .85; border-right: 1px solid #d2dae2;}.jimu-rtl .jimu-widget-SAT .SATTab {float: right;}.jimu-widget-SAT .active {background-color: #353535; background-color: rgba(0, 0, 0, 0.3); opacity: 1; border-top: 2px solid #15a4fa;}.jimu-widget-SAT .activeBlack {background-color: #353535; opacity: 1; border-top: 2px solid #15a4fa;}.jimu-widget-SAT .SATcol {float: left; height: 100px; width: 220px; border-left: none; margin-left: 0; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcol {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .SATcolExport {float: left; height: 100px; width: 65px; border-left: none; margin-left: 0; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcolExport {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .lightThemeBorder{border-right: 1px solid #353535; border-right: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .darkThemeBorder{border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5);}.jimu-rtl .jimu-widget-SAT .lightThemeBorder{border-left: 1px solid #353535; border-left: 1px solid rgba(0, 0, 0, 0.3);}.jimu-rtl .jimu-widget-SAT .darkThemeBorder{border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5);}.jimu-widget-SAT .SATcolLocate {float: left; height: 100px; width: 220px; border-left: none; margin-left: 0; padding: 0 30px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcolLocate {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .SATcolWrap {white-space: pre-wrap; white-space: -moz-pre-wrap; word-wrap: break-word;}.jimu-widget-SAT .SATcol2 {float: left; height: 100px; border-left: none; margin-left: 15px; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden; display: table;}.jimu-rtl .jimu-widget-SAT .SATcol2 {float: right; border-right: none; overflow: hidden; margin-right: 15px;}.jimu-widget-SAT .SATcolSmall {float: left; height: 90px; width: 165px; border-left: none; margin-left: 0; padding: 0 20px; overflow: hidden; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-SAT .SATcolSmall {float: right; border-right: none;}.jimu-widget-SAT .SATcolLast {border-left: none; border-right: none;}.jimu-widget-SAT .SATcol .label,.jimu-widget-SAT .SATcolSmall .label {font-size: 13px; padding: 2px 0;}.jimu-widget-SAT .SATcol .colBar {height: 32px; display: table-cell; width: 130px;}.jimu-widget-SAT .SATdrawCol {display: block; float: left;}.jimu-rtl .jimu-widget-SAT .SATdrawCol {display: block; float: right;}.jimu-widget-SAT .displayTC{display: table-cell;}.jimu-widget-SAT .displayTR{display: table-row;}.jimu-widget-SAT .displayT{display: table;}.jimu-widget-SAT .display-on{display: block;}.jimu-widget-SAT .display-off{display: none;}.jimu-widget-SAT .btnOn {border: 1px solid #ffffff; border: 1px solid rgba(255, 255, 255, 0.75); background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btn32 {width: 32px; height: 32px; border-radius: 2px; margin-right: 15px; cursor: pointer;}.jimu-widget-SAT .btn32img {padding: 8px;}.jimu-widget-SAT .lightThemeBackground{background-color: #353535; background-color: rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .darkThemeBackground{}.jimu-widget-SAT .btn32img:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btn32imgBlack {padding: 8px;}.jimu-widget-SAT .btn32imgBlack:hover {background-color: #262626;}.jimu-widget-SAT .dijitTextBox,.jimu-widget-SAT .dijitTextBoxHover,.jimu-widget-SAT .dijitTextBoxFocused,.jimu-widget-SAT .dijitTextBoxHoverFocused {background-color: #393939; background-color: rgba(0, 0, 0, 0.25) !important; color: #ffffff !important; border: 1px solid #a6a6a6; border: 1px solid rgba(255, 255, 255, 0.5) !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-SAT .dijitTextBoxFocused,.jimu-widget-SAT .dijitInputInner,.jimu-widget-SAT .dijitInputContainer {background: transparent !important; color: #ffffff !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-SAT .dijitInputField {padding: 0px 10px !important;}.jimu-widget-SAT .btnExport {border-radius: 2px; padding: 10px 10px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer; height: 40px;}.jimu-widget-SAT .btnExport:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btnExportBlack {border-radius: 2px; padding: 10px 10px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer; height: 40px;}.jimu-widget-SAT .btnExportBlack:hover {background-color: #262626;}.jimu-widget-SAT .download {background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right 0px center;}.jimu-widget-SAT .processing {background-image: url('images/processing.gif'); background-repeat: no-repeat; background-position: right 10px center;}.jimu-widget-SAT .loading {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center 10px;}.jimu-widget-SAT .snapshot {background-image: url('images/snapshot.png'); background-repeat: no-repeat; background-position: center center; height: 32px; width: 32px;}.jimu-widget-SAT .snapshotProcessing {background-image: url('images/processing.gif'); background-repeat: no-repeat; background-position: center center; height: 32px; width: 32px;}.jimu-widget-SAT .downloadAll {background-image: url('images/download_all.png'); background-repeat: no-repeat; background-position: center center; height: 32px; width: 32px;}.jimu-widget-SAT .save {background-image: url('images/save.png'); background-repeat: no-repeat; background-position: center center; height: 32px; width: 32px;}.jimu-widget-SAT .btnDisabled {opacity: .5; cursor: default;}.jimu-widget-SAT .colSummary {font-size: 28px; padding-top: 10px;}.jimu-widget-SAT .colGroupedSummary {font-size: 28px; padding-top: 3px;}.jimu-widget-SAT .SATcolRec {float: left; height: 100%; border-left: none; margin-left: 0; padding: 0 10px; text-align: left; text-overflow: ellipsis; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; min-width: 220px; max-width: 300px;}.jimu-rtl .jimu-widget-SAT .SATcolRec {float: right; border-right: none; text-align: right;}.jimu-widget-SAT .SATcolRecBar {position: relative; height: 26px; width: 100%; display: block;}.jimu-widget-SAT .SATcolRecNum {position: absolute; width: 26px; height: 26px; background-color: #393939; background-color: rgba(0, 0, 0, 0.25); line-height: 26px; text-align: center; border-radius: 13px; font-size: 11px; cursor: pointer;}.jimu-widget-SAT .SATcolDir {position: absolute; right: 0px; width: 26px; height: 26px; background-image: url('images/car.png'); background-repeat: no-repeat; background-position: center center; cursor: pointer;}.jimu-rtl .jimu-widget-SAT .SATcolDir {position: absolute; left: 0px; right: auto;}.jimu-widget-SAT .SATcolDistance {position: absolute; left: 30px; right: 30px; height: 26px; font-size: 11px; line-height: 26px;}.jimu-widget-SAT .SATcolInfo {position: relative; margin-top: 5px; width: 100%; display: block; overflow: hidden;}.jimu-widget-SAT .noFeaturesActive {opacity: .5; cursor: default;}.jimu-widget-SAT .noFeatures {display: none;}.jimu-widget-SAT .locateIncident{float: left;}.jimu-rtl .jimu-widget-SAT .locateIncident{float: right;}.jimu-widget-SAT .clearIncident{float: right; text-decoration: underline; cursor: pointer;}.jimu-rtl .jimu-widget-SAT .clearIncident{float: left; text-decoration: underline; cursor: pointer;}.jimu-widget-SAT .imgContainer{display: table; width: 130px; padding-top: 10px;}.jimu-widget-SAT .bufferLabel{}.jimu-widget-SAT .spinnerValueDIV{float: right; margin-top: 8px; margin-left: 4px; display: table-row;}.jimu-rtl .jimu-widget-SAT .spinnerValueDIV{float: left; margin-top: 8px; margin-right: 4px; display: table-row;}.jimu-widget-SAT .bufferUnit{display: inline; margin-left: 4px; margin-top: 7px;}.jimu-widget-SAT .saveIncidentDiv{position: absolute; top: 0px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .saveIncidentDiv{position: absolute; top: 0px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .downlaodAllDiv{position: absolute; top: 35px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .downlaodAllDiv{position: absolute; top: 35px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .createSnapshotDiv{position: absolute; top: 70px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .createSnapshotDiv{position: absolute; top: 70px; right: 270px; line-height: 26px; font-size: 13px;}.esriAttributeInspector .atiRichTextField{}.esriAttributeInspector div.dijitEditorIFrameContainer {height: 78px; width: 100%;}.esriAttributeInspector .dijitTextBox.dijitTextArea {height: 32px;}.esriAttributeInspector .atiButton {padding-top:2px; margin-right: 10px; display: inline-table; background-image: none;}.esriAttributeInspector .atiButtons {height:30px; width:100%; display:inline-block; width:100%;}.esriAttributeInspector {display:inline-block;} .esriAttributeInspector .dijitArrowButtonContainer {margin-top:0px; margin-right:0px; margin-bottom:0px; width:18px;}.esriAttributeInspector .atiNavButtons {display:none; visibility:hidden; height: 0px;}.esriPopup .spinner {display: none;}",
"*now":function(t){t(['dojo/i18n!*preload*widgets/SituationAwareness/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dijit/form/Button jimu/BaseWidget jimu/dijit/Message jimu/utils jimu/LayerInfos/LayerInfos jimu/portalUtils dojo/_base/Color dojo/_base/html dojo/dom dojo/on dojo/dom-style dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/_base/lang dojo/_base/array dojo/_base/xhr dojo/query dojo/json dojo/has dojo/topic dojo/Deferred dojo/DeferredList esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Polygon esri/geometry/Point esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/webMercatorUtils esri/tasks/ProjectParameters esri/geometry/jsonUtils esri/graphic esri/graphicsUtils esri/Color esri/layers/GraphicsLayer esri/layers/FeatureLayer esri/SpatialReference esri/symbols/Font esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/TextSymbol esri/tasks/locator esri/tasks/BufferParameters esri/tasks/GeometryService esri/toolbars/draw esri/domUtils esri/dijit/AttributeInspector esri/dijit/Popup jimu/dijit/Popup esri/tasks/query esri/request ./js/SummaryInfo ./js/GroupedCountInfo ./js/WeatherInfo ./js/ClosestInfo ./js/ProximityInfo ./js/SnapShot ./js/SnapshotName dojo/keys dojo/domReady!".split(" "),function(t,
n,p,v,l,f,d,c,h,y,w,m,b,q,g,r,a,e,u,F,E,z,x,N,S,C,G,U,R,D,k,B,A,O,J,P,M,H,I,Q,V,K,L,T,W,aa,na,ba,X,oa,ca,pa,ea,da,Y,fa,ga,ha,ia,ja,Z,ka,la){return t([v,n],{baseClass:"jimu-widget-SAT",name:"IncidentAnalysis",opLayers:null,curTab:0,lyrBuffer:null,lyrIncidents:null,lyrClosest:null,lyrProximity:null,lyrSummary:null,lyrEdit:null,toolbar:null,tool:-1,symPoint:null,symLine:null,symPoly:null,symBuffer:null,symRoute:null,incidents:[],buffers:[],gsvc:null,locator:null,stops:[],initalLayerVisibility:{},startX:0,
mouseDown:!1,btnNodes:[],panelNodes:[],tabNodes:[],currentSumLayer:null,currentGrpLayer:null,mapBottom:null,mapResize:null,geomExtent:void 0,selectedGraphic:!1,honorTemplate:!1,Incident_Local_Storage_Key:"SAT_Incident",SLIDER_MAX_VALUE:1E4,postCreate:function(){this.inherited(arguments);this.nls=a.mixin(this.nls,window.jimuNls.units);this.widgetActive=!0;window.localStorage.setItem(this.Incident_Local_Storage_Key,null)},startup:function(){this.inherited(arguments);this.btnNodes=[];this.panelNodes=
[];this.tabNodes=[];this.editTemplate=this.config.editTemplate;this.saveEnabled=this.config.saveEnabled;this.summaryDisplayEnabled=this.config.summaryDisplayEnabled;this.snapshotEnabled="undefined"!==typeof this.config.snapshotEnabled?this.config.snapshotEnabled:!1;this.isSafari=z("safari");this._getStyleColor();this._createUI();this._loadUI();this._initLayers();this._verifyRouting();this._getAttributeTable();this.SLIDER_MAX_VALUE=this.config.bufferRange.maximum;this.opLayers=this.map.itemInfo.itemData.operationalLayers;
this._mapLoaded()},onOpen:function(){this.inherited(arguments);this.widgetActive=!0;this.map.infoWindow.isShowing&&this.map.infoWindow.hide();this.setPosition();this.windowResize=m(window,"resize",a.hitch(this,this._resize));null===this.mapResize&&(this.mapResize=this.map.on("resize",a.hitch(this,this._mapResize)));this._mapResize();this.own(x.subscribe("changeMapPosition",a.hitch(this,this._onMapPositionChange)));this._storeInitalVisibility();this._checkHideContainer();this._initEditInfo();this._clickTab(0);
this._updateCounts(!0);this._restoreIncidents()},_checkHideContainer:function(){this.hideContainer=!1;var b=this.map.infoWindow;b.popupInfoView&&b.popupInfoView.container&&(this.hideContainer=!0,this.own(m(b,"show",a.hitch(this,this._handlePopup))))},onClose:function(){this._storeIncidents();this._toggleTabLayersOld();this._resetInfoWindow();this.mapResize&&(this.mapResize.remove(),this.mapResize=null);this.windowResize.remove();this.windowResize=null;this._clear(!0);this.widgetActive=!1;this.saveEnabled&&
(this.scSignal.remove(),this.sfSignal.remove());this._mapResize();this._resetInitalVisibility();this.inherited(arguments);this._resetMapPosition()},onDeActive:function(){this._clickIncidentsButton(-1)},destroy:function(){this._clear(!0);this._toggleTabLayersOld();this.lyrBuffer&&this.map.removeLayer(this.lyrBuffer);this.lyrIncidents&&this.map.removeLayer(this.lyrIncidents);this.lyrClosest&&this.map.removeLayer(this.lyrClosest);this.lyrProximity&&this.map.removeLayer(this.lyrProximity);this.lyrSummary&&
this.map.removeLayer(this.lyrSummary);this.lyrGroupedSummary&&this.map.removeLayer(this.lyrGroupedSummary);this.inherited(arguments)},onAppConfigChanged:function(a,b){switch(b){case "themeChange":case "layoutChange":case "styleChange":this._updateUI(a);break;case "widgetPoolChange":this._verifyRouting();break;case "mapChange":window.localStorage.setItem(this.Incident_Local_Storage_Key,null);break;case "attributeChange":this._updateUI(a)}},_handlePopup:function(){this._clearMobileSetAsIncidentStyle();
var a=w.byId("main-page"),b,c,d;this.map.infoWindow.popupInfoView?(b=this.map.infoWindow.popupInfoView.container,c=".mainSection { overflow-y: auto; height: "+(a.clientHeight-60).toString()+"px; }",d=".atiAttributes {overflow: auto; height: "+(a.clientHeight-130).toString()+"px; }"):(b=F("div.atiAttributes",this.map.infoWindow.domNode)[0],c=".mainSection { overflow-y: none; }",d=".atiAttributes {overflow: none; }");a.clientHeight&&b&&(a=document.createElement("style"),a.type="text/css",a.id="_tempMainSectionOverride",
b.appendChild(a),a.sheet.insertRule(c,0),a.sheet.insertRule(d,1))},_updateUI:function(a){this._getStyleColor(a)},_updateFontColor:function(a){"undefined"===typeof a&&(a=this.appConfig);a=g.create("div",{id:"tempTitle",innerHTML:a.title}).getElementsByTagName("font");this.config.fontColor=a&&0<a.length?/^#[0-9A-F]{6}$/i.test(a[0].color)?a[0].color:"#ffffff":"#ffffff";g.destroy("tempTitle");a=document.querySelectorAll(".panelBottom ");for(var b=0;b<a.length;b++)a[b].style.color=this.config.fontColor},
_updateButtonBackgrounds:function(a,b){e.forEach(this.imgContainer.children,function(c){q.contains(c.children[0],a?"btn32img":"btn32imgBlack")&&q.remove(c.children[0],a?"btn32img":"btn32imgBlack");q.add(c.children[0],a?"btn32imgBlack":"btn32img");q.contains(c.children[0],b?"darkThemeBackground":"lightThemeBackground")&&q.remove(c.children[0],b?"darkThemeBackground":"lightThemeBackground");q.add(c.children[0],b?"lightThemeBackground":"darkThemeBackground")});e.forEach(this.saveOptions.children,function(c){q.contains(c.children[0],
a?"btn32img":"btn32imgBlack")&&q.remove(c.children[0],a?"btn32img":"btn32imgBlack");q.add(c.children[0],a?"btn32imgBlack":"btn32img");q.contains(c.children[0],b?"darkThemeBackground":"lightThemeBackground")&&q.remove(c.children[0],b?"darkThemeBackground":"lightThemeBackground");q.add(c.children[0],b?"lightThemeBackground":"darkThemeBackground")})},_getStyleColor:function(b){this._updateFontColor(b);setTimeout(a.hitch(this,function(){var a=window.getComputedStyle(this.footerNode,null).getPropertyValue("background-color");
this.config.activeMapGraphicColor=a;a=h.fromRgb(a);this.lightTheme=210>.2126*a.r+.7152*a.g+.0722*a.b?!1:!0;this.config.color=a.toHex();this.isBlackTheme="#000000"===this.config.color?!0:!1;this._updateButtonBackgrounds(this.isBlackTheme,this.lightTheme);this.updateActiveNodes(this.lightTheme,!0);this.updateActiveNodes(this.lightTheme,!1);this.isBlackTheme?(q.remove(this.tabNodes[this.curTab],"active"),q.add(this.tabNodes[this.curTab],"activeBlack"),this.config.activeColor="rgb(53, 53, 53)"):(q.remove(this.tabNodes[this.curTab],
"activeBlack"),q.add(this.tabNodes[this.curTab],"active"),this.config.activeColor="rgba(39, 39, 39, 0.3)");this._setupSymbols();this.dataValue&&(this._drawIncident(this.dataValue),this.dataValue=void 0);this._bufferIncident()}),300)},updateActiveNodes:function(a,b){var c,d,f;b?(c=[".SATcolLocate",".SATcol",".SATcolRec",".SATcol2",".SATcolSmall"],d="lightThemeBorder",f="darkThemeBorder"):(c=".btn32img .innerBL .innerBR .SA_panelClose .SA_panelRight .SA_panelLeft".split(" "),d="lightThemeBackground",
f="darkThemeBackground");e.forEach(c,function(b){b=F(b);for(var c=0;c<b.length;c++){var e=b[c];q.remove(e,a?f:d);q.add(e,a?d:f)}})},setPosition:function(a,b){if(this.widgetActive){this.position="TabTheme"===this.appConfig.theme.name?{left:this.widgetManager.getControllerWidgets()[0].domNode.clientWidth,right:0,bottom:24,height:155,relativeTo:"browser"}:{left:0,right:0,bottom:0,height:155,relativeTo:"browser"};var c=f.getPositionStyle(this.position);c.position="absolute";y.place(this.domNode,window.jimuConfig.layoutId);
y.setStyle(this.domNode,c);this.started&&this.resize();x.publish("changeMapPosition",{bottom:155})}},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},_setEventLocation:function(a){var b=this.map.infoWindow.getSelectedFeature();if(a&&"add"===a.type)b={eventType:"IncidentLocationAdd",dataValue:b},this.incidents=[],this.buffers=[],this.lyrIncidents.clear(),this.lyrBuffer.clear();else{for(var c=!0,d,e=
0;e<this.lyrIncidents.graphics.length;e++){var f=this.lyrIncidents.graphics[e];if(f.geometry.type===b.geometry.type){var g=!G.equals(f.geometry,b.geometry);f.attributes&&b.attributes&&!g&&(g=g&&E.stringify(f.attributes)===E.stringify(b.attributes));c=c&&g;g||(d=f)}}b={eventType:c?"IncidentLocationAdd":"IncidentLocationRemove",dataValue:b,removeGraphic:d}}this.onReceiveData("","",b);this.map.infoWindow.isShowing&&this.map.infoWindow.hide();a&&(a=this.map.infoWindow,a.popupNavigationBar&&(b=F(".esriMobileNavigationBar",
a.popupNavigationBar.domNode),0<b.length&&y.setStyle(b[0],"display","none")),a.popupInfoView&&(b=F(".esriMobileInfoView",a.popupInfoView.domNode),0<b.length&&y.setStyle(b[0],"display","none")))},_initLayers:function(){this.gsvc=new ba(this.config.geometryService.url);this.locator=new aa(this.config.geocodeService.url);this.own(m(this.locator,"location-to-address-complete",a.hitch(this,this._showIncidentAddress)));this.own(m(this.locator,"error",a.hitch(this,this._onAddressError)));this.lyrBuffer=
new H;this.map.addLayer(this.lyrBuffer);this.lyrIncidents=new H;this.map.addLayer(this.lyrIncidents);this.lyrClosest=new H;this.lyrClosest.setVisibility(!1);this.map.addLayer(this.lyrClosest);this.lyrProximity=new H;this.lyrProximity.setVisibility(!1);this.map.addLayer(this.lyrProximity);this.summaryDisplayEnabled&&(this.lyrSummary=new H,this.lyrSummary.setVisibility(!1),this.map.addLayer(this.lyrSummary),this.lyrGroupedSummary=new H,this.lyrGroupedSummary.setVisibility(!1),this.map.addLayer(this.lyrGroupedSummary))},
_mapLoaded:function(){F("[data-reference]").style("z-index",0);this.map.itemId&&d.getInstance(this.map,this.map.itemInfo).then(a.hitch(this,function(b){this.opLayers=b;this._processOperationalLayers();if(this.saveEnabled){b=this.map.infoWindow;this.config.saveEnabled&&"undefined"===typeof this.config.savePolys&&"undefined"===typeof this.config.saveLines&&"undefined"===typeof this.config.savePoints&&(this.config.savePolys=!0,this.config.polyEditLayer=this.config.editLayer,this.polyTemplate=this.config.editTemplate,
this.honorTemplate=!0);this.config.savePoints&&this._initEditLayer(this.config.pointEditLayer,"point");this.config.saveLines&&this._initEditLayer(this.config.lineEditLayer,"line");this.config.savePolys&&this._initEditLayer(this.config.polyEditLayer,"poly");this.scSignal=m(b,"selection-change",a.hitch(this,this._selectionChanged));this.sfSignal=m(b,"set-features",a.hitch(this,this._setPopupFeature));var c=F(".esriPopupWrapper",b.domNode);0<c.length&&"undefined"!==typeof c[0].clientHeight&&"undefined"!==
typeof c[0].clientWidth&&(this.defaultPopupSize={width:c[0].clientWidth});b.highlight=!0}}));var b=this.map.itemInfo.itemData.baseMap.baseMapLayers[0];"ArcGISTiledMapServiceLayer"===b.layerType&&b.resourceInfo.singleFusedMapCache||(this.config.defaultZoomLevel=.5);this._clickTab(0)},_initEditLayer:function(b,c){var d;"point"===c?(this.pointEditLayer=this.opLayers.getLayerInfoById(b).layerObject,this.isPointEditable=this._isEditable(this.pointEditLayer),d=this.pointEditLayer,d.templates&&0<d.templates.length?
this.pointTemplate=d.templates[0]:d.types&&0<d.types.length&&(this.pointTemplate=d.types[0].templates[0]),this.pointTemplate&&(this.pointEditLayerPrototype=this.pointTemplate.prototype)):"line"===c?(this.lineEditLayer=this.opLayers.getLayerInfoById(b).layerObject,this.isLineEditable=this._isEditable(this.lineEditLayer),d=this.lineEditLayer,d.templates&&0<d.templates.length?this.lineTemplate=d.templates[0]:d.types&&0<d.types.length&&(this.lineTemplate=d.types[0].templates[0]),this.lineTemplate&&(this.lineEditLayerPrototype=
this.lineTemplate.prototype)):"poly"===c&&(this.polyEditLayer=this.opLayers.getLayerInfoById(b).layerObject,this.isPolyEditable=this._isEditable(this.polyEditLayer),d=this.polyEditLayer,this.honorTemplate||(d.templates&&0<d.templates.length?this.polyTemplate=d.templates[0]:d.types&&0<d.types.length&&(this.polyTemplate=d.types[0].templates[0])),this.polyTemplate&&(this.polyEditLayerPrototype=this.polyTemplate.prototype));d&&this.own(m(d,"click",a.hitch(this,function(a){if(a.graphic)switch(a=a.graphic,
a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=a;break;case "polygon":this.polyUpdateFeature=a}})))},_isEditable:function(a){var b=!1;a.isEditable()&&a.getEditCapabilities&&(b=a.getEditCapabilities());return b&&b.canUpdate&&b.canCreate},_initEditInfo:function(){if(this.saveEnabled){var b=!1;this.polyEditLayer&&this.isPolyEditable&&(b=!0,this.defaultPolyContent=this.polyEditLayer.infoTemplate?this.polyEditLayer.infoTemplate.content:void 0,this.polyEditLayer.infoTemplate.setContent(a.hitch(this,
this._setEditLayerPopup)));this.lineEditLayer&&this.isLineEditable&&(b=!0,this.defaultLineContent=this.lineEditLayer.infoTemplate?this.lineEditLayer.infoTemplate.content:void 0,this.lineEditLayer.infoTemplate.setContent(a.hitch(this,this._setEditLayerPopup)));this.pointEditLayer&&this.isPointEditable&&(b=!0,this.defaultPointContent=this.pointEditLayer.infoTemplate?this.pointEditLayer.infoTemplate.content:void 0,this.pointEditLayer.infoTemplate.setContent(a.hitch(this,this._setEditLayerPopup)));b&&
this.map.infoWindow.resize(350,340)}},_setPopupFeature:function(){if(0<this.map.infoWindow.count){var a=this.map.infoWindow.getSelectedFeature();switch(a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=a;break;case "poly":this.polyUpdateFeature=a}}},_selectionChanged:function(){if(0<this.map.infoWindow.count){var a=this.map.infoWindow.getSelectedFeature();switch(a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=
a;break;case "poly":this.polyUpdateFeature=a}}},_setEditLayerPopup:function(b){var c;"polygon"===b.geometry.type&&(c=this.polyEditLayer);"polyline"===b.geometry.type&&(c=this.lineEditLayer);"point"===b.geometry.type&&(c=this.pointEditLayer);for(var d=[],e=this._getPopupFields(c),f=0;f<e.length;f++){var h=e[f];h.isEditable&&h.isEditableOnLayer&&d.push({fieldName:h.fieldName,isEditable:h.isEditable})}this.attInspector=new ca({layerInfos:[{featureLayer:c,showAttachments:!1,isEditable:!0,fieldInfos:d}]},
g.create("div"));d=new p({label:this.nls.update_btn},g.create("div"));g.place(d.domNode,this.attInspector.deleteBtn.domNode.parentNode);this.own(m(d,"click",a.hitch(this,function(){c.applyEdits(null,[b],null,a.hitch(this,function(){this.map.infoWindow.hide()}),function(a){var b="Error";"undefined"!==typeof a.details&&(b=a.details);"undefined"!==typeof a.message&&(b=a.message);new l({message:b})})})));this.own(m(this.attInspector,"attribute-change",a.hitch(this,function(a){switch(a.feature.geometry.type){case "point":this.pointUpdateFeature=
a.feature;this.pointUpdateFeature.attributes[a.fieldName]=a.fieldValue;break;case "polyline":this.lineUpdateFeature=a.feature;this.lineUpdateFeature.attributes[a.fieldName]=a.fieldValue;break;case "polygon":this.polyUpdateFeature=a.feature,this.polyUpdateFeature.attributes[a.fieldName]=a.fieldValue}})));this.own(m(this.attInspector,"next",a.hitch(this,function(a){switch(a.feature.geometry.type){case "point":this.pointUpdateFeature=a.feature;break;case "polyline":this.pointUpdateFeature=a.feature;
break;case "poly":this.pointUpdateFeature=a.feature}})));this.own(m(this.attInspector,"delete",a.hitch(this,function(a){var b=!1;if(0<this.incidents.length){for(var d=0;d<this.incidents.length;d++)G.equals(a.feature.geometry,this.incidents[d].geometry)&&(b=!0);if(!b&&0<this.lyrBuffer.graphics.length)for(d=0;d<length;d++)G.equals(a.feature.geometry,this.lyrBuffer.graphics[d].geometry)&&(b=!0)}c.applyEdits(null,null,[a.feature],function(){},function(a){var b="Error";"undefined"!==typeof a.details&&
(b=a.details);"undefined"!==typeof a.message&&(b=a.message);new l({message:b})});this.pointEditLayer&&(this.pointUpdateFeature=this.pointEditLayerPrototype);this.lineEditLayer&&(this.lineUpdateFeature=this.lineEditLayerPrototype);this.polyEditLayer&&(this.polyUpdateFeature=this.polyEditLayerPrototype);b&&this._clear(!1);this.map.infoWindow.hide()})));switch(b.geometry.type){case "point":this.pointUpdateFeature=b;break;case "polyline":this.lineUpdateFeature=b;break;case "polygon":this.polyUpdateFeature=
b}this.attInspector.showFeature(b);return this.attInspector.domNode},_getPopupFields:function(a){var b;if(a.infoTemplate)b=a.infoTemplate.info.fieldInfos;else if(-1<this.tab.tabLayers[0].url.indexOf("MapServer")){var c=this.tab.tabLayers[0].url.split("MapServer/")[1],d=this.parent.map.itemInfo.itemData.operationalLayers;b=null;for(var e=0;e<d.length;e++){var f=d[e];if(f.layerObject.infoTemplates&&(f=f.layerObject.infoTemplates[c])){b=f.infoTemplate.info.fieldInfos;break}}}else b=a.fields;b||(b=a.fields);
return b},_updatePopup:function(b,c,d){c=[];for(d=0;d<b.length;d++){var e=b[d],f=new da;f.objectIds=[e.oid];c.push(e.layer.selectFeatures(f,I.SELECTION_NEW))}(new S(c)).then(a.hitch(this,function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d[0]){d=d[1][0];b.push(d);switch(d.geometry.type){case "point":this.pointUpdateFeature=d;break;case "polyline":this.lineUpdateFeature=d;break;case "poly":this.polyUpdateFeature=d}this.attInspector||this._setEditLayerPopup(d);this.attInspector&&this.attInspector.showFeature(d)}}}))},
_processOperationalLayers:function(){for(var a=0;a<this.config.tabs.length;a++){var b=this.config.tabs[a];b.layers&&""!==b.layers&&(this.hasLayerTitle="undefined"!==typeof b.layerTitle,b.tabLayers=this._getTabLayers(b.layers))}},_createUI:function(){var c=f.stripHTML(this.config.bufferLabel?this.config.bufferLabel:"");this.buffer_lbl.innerHTML=c;this.buffer_lbl_unit.innerHTML=this.nls[this.config.distanceUnits];c=this.config.bufferRange.minimum;this.spinnerValue.set("data-dojo-props","constrains: {min: "+
c+", max: "+this.config.bufferRange.maximum+"}, intermediateChanges: true, places:0");this.spinnerValue.set("value",c);this.locateIncident.innerHTML="undefined"!==typeof this.config.locateIncidentLabel?this.config.locateIncidentLabel:this.nls.locate_incident;this.config.tabs.splice(0,0,{type:"incidents",label:"undefined"!==typeof this.config.incidentLabel?this.config.incidentLabel:this.nls.incident,color:this.config.color});this.panelNodes.push(this.SA_tabPanel0);for(var c=this.panelContainer,d=this.tabsNode,
e=0,h=0;h<this.config.tabs.length;h++){var k=this.config.tabs[h],l=k.label;"weather"===k.type&&(l=this.nls.weather);l&&""!==l||(l=k.layerTitle?k.layerTitle:k.layers);l=g.create("div",{"data-dojo-attach-point":"SA_tab"+h,innerHTML:f.stripHTML(l?l:"")},d);this.tabNodes.push(l);q.add(l,"SATTab");e+=r.position(l).w;m(l,"click",a.hitch(this,this._clickTab,h));0<h&&(l=g.create("div",{"data-dojo-attach-point":"SA_tabPanel"+h,innerHTML:""},c),this.panelNodes.push(l),q.add(l,"SAT_tabPanel"),"summary"===k.type&&
(k.summaryInfo=new fa(k,l,this),this.own(m(k.summaryInfo,"summary-complete",a.hitch(this,this.restore)))),"groupedSummary"===k.type&&(k.groupedSummaryInfo=new ga(k,l,this),this.own(m(k.groupedSummaryInfo,"summary-complete",a.hitch(this,this.restore)))),"weather"===k.type&&(k.weatherInfo=new ha(k,l,this)),"closest"===k.type&&(k.closestInfo=new ia(k,l,this)),"proximity"===k.type&&(k.proximityInfo=new ja(k,l,this)))}e+=10;b.set(d,"width",e+"px");e>r.position(this.footerNode).w&&(b.set(this.footerContentNode,
"right","58px"),b.set(this.panelRight,"display","block"));m(d,"scroll",a.hitch(this,this._onPanelScroll))},restore:function(a){a.tab===this.curTab&&this._clickTab(a.tab)},validateSavePrivileges:function(){var b=new N;c.getPortal(this.appConfig.portalUrl).getUser().then(a.hitch(this,function(a){b.resolve(-1<a.privileges.indexOf("features:user:edit")?!0:!1)}),a.hitch(this,function(a){console.log(a);b.resolve(!0)}));return b},validateSnapshotPrivileges:function(){var b=new N;c.getPortal(this.appConfig.portalUrl).getUser().then(a.hitch(this,
function(a){b.resolve(-1<a.privileges.indexOf("portal:publisher:publishFeatures")&&-1<a.privileges.indexOf("portal:user:createItem")?!0:!1)}),a.hitch(this,function(a){console.log(a);b.resolve(!1)}));return b},_loadUI:function(){var b={0:this.nls.drawPoint,1:this.nls.drawLine,2:this.nls.drawPolygon};this.btnNodes=[this.SA_btn0,this.SA_btn1,this.SA_btn2];var c=g.create("span",{"class":"btn32 displayT"},this.saveOptions);this.downloadAllButon=g.create("div",{"class":"downloadAll",title:this.nls.downloadAll},
c);this.own(m(this.downloadAllButon,"click",a.hitch(this,this._downloadAll)));this.saveEnabled&&(this.saveButtonSpan=g.create("span",{"class":"btn32 displayT"},this.saveOptions),this.validateSavePrivileges().then(a.hitch(this,function(b){this.userCanSave=b;this.saveButton=g.create("div",{"class":b?"save":"save btnDisabled",title:b?this.nls.saveIncident:this.nls.user_credentials},this.saveButtonSpan);b&&this.own(m(this.saveButton,"click",a.hitch(this,this._saveIncident)))}),function(a){console.log(a)}));
this.snapshotEnabled&&(this.createSnapshotButtonSpan=g.create("span",{"class":"btn32 displayT"},this.saveOptions),this.validateSnapshotPrivileges().then(a.hitch(this,function(b){this.userCanSnapshot=b;this.createSnapshotButton=g.create("div",{"class":b?"snapshot":"snapshot btnDisabled",title:b?this.nls.createSnapshot:this.nls.user_credentials},this.createSnapshotButtonSpan);b&&this.own(m(this.createSnapshotButton,"click",a.hitch(this,this._createSnapshot)))}),function(a){console.log(a)}));for(c=0;3>
c;c++){var d=this.btnNodes[c];y.setAttr(d,"src",this.folderUrl+"images/btn"+c+".png");y.setAttr(d,"title",b[c]);this.own(m(d,"click",a.hitch(this,this._clickIncidentsButton,c)))}this.toolbar=new X(this.map,{tooltipOffset:20,drawTime:90});this.toolbar.on("draw-end",a.hitch(this,this._drawIncident));this.own(m(this.spinnerValue,"change",a.hitch(this,this._sliderTextChange)));this.own(m(this.spinnerValue,"blur",a.hitch(this,function(a){this._updateSpinnerValue(!0)})));this.own(m(this.spinnerValue,"keyup",
a.hitch(this,function(a){a.keyCode===la.ENTER?this._updateSpinnerValue(!0):this._updateSpinnerValue(!1)})))},_locateBuffer:function(a){if(null!==a&&(a="extent"===a.type?a:a.getExtent(),null!==a)){a=a.expand(1.5);var b=80/this.map.height,c=a.getHeight();a.update(a.xmin,a.ymin-c*b,a.xmax,a.ymax-c*b,this.map.spatialReference);this.map.setExtent(a,!0)}},_clickIncidentsButton:function(a){var b;if(3>a){for(var c=0;3>c;c++)b=this.btnNodes[c],q.remove(b,"btnOn");-1<a&&a!==this.tool?(b=this.btnNodes[a],3>
a&&q.add(b,"btnOn"),this.tool=a):this.tool=-1;switch(this.tool){case -1:this.toolbar.deactivate();this.enableWebMapPopup();break;case 0:this._clear(!1);this.toolbar.activate(X.POINT);this.disableWebMapPopup();break;case 1:this._clear(!1);this.toolbar.activate(X.POLYLINE);this.disableWebMapPopup();break;case 2:this._clear(!1),this.toolbar.activate(X.POLYGON),this.disableWebMapPopup()}}else this._clear(!0)},_saveIncident:function(){this.map.infoWindow.hide();this._updateProcessing(this.saveButton,!0,
"save");var a=[];this.config.saveEnabled&&"undefined"===typeof this.config.savePolys&&"undefined"===typeof this.config.saveLines&&"undefined"===typeof this.config.savePoints&&(this.config.savePolys=!0);if(this.config.savePolys){var b=this._getIncidentGraphics("polygon",this.polyEditLayerPrototype);0<b.length&&a.push({layer:this.polyEditLayer,graphics:b})}this.config.saveLines&&(b=this._getIncidentGraphics("polyline",this.lineEditLayerPrototype),0<b.length&&a.push({layer:this.lineEditLayer,graphics:b}));
this.config.savePoints&&(b=this._getIncidentGraphics("point",this.pointEditLayerPrototype),0<b.length&&a.push({layer:this.pointEditLayer,graphics:b}));0<a.length?this._applyEdits(a):this._updateProcessing(this.saveButton,!1,"save");this._clickIncidentsButton(-1)},_getIncidentGraphics:function(a,b){var c=[],d=E.parse(E.stringify(b));if("polygon"===a)for(var e=0;e<this.lyrBuffer.graphics.length;e++){var f=this.lyrBuffer.graphics[e],g=new J;g.geometry=f.geometry;g.setAttributes(d.attributes);c.push(g)}for(e=
0;e<this.incidents.length;e++)f=this.incidents[e],f.geometry.type===a&&(g=new J,g.geometry=f.geometry,g.setAttributes(d.attributes),c.push(g));return c},_applyEdits:function(b){for(var c=new N,d=[],e=[],f=0;f<b.length;f++){var g=b[f];g.layer.visible||g.layer.setVisibility(!0);var h=[];if(1<g.graphics.length&&"polygon"===g.graphics[0].geometry.type){var k=g.graphics[0],m=g.graphics.map(function(a){return a.geometry});if(m=G.union(m))k.geometry=m,h.push(k)}d.push(g.layer.applyEdits(0<h.length?h:g.graphics,
null,null))}(new S(d)).then(a.hitch(this,function(a){for(var d=!1,f=0;f<a.length;f++){var g=a[f][1][0];g.success&&(d=!0,g.hasOwnProperty("objectId")&&e.push({oid:g.objectId,layer:b[f].layer}))}if(!this.map.infoWindow.isShowing){a=this.incidents[0].geometry;var h;switch(a.type){case "point":h=a;break;case "polyline":h=a.paths[0][parseInt(a.paths[0].length/2,10)];h=new R(h[0],h[1],a.spatialReference);break;case "polygon":h=a.getCentroid()}a=this.map.toScreen(h);0<e.length&&this._updatePopup(e,h,a);
this._updateProcessing(this.saveButton,!1,"save");this.map.emit("click",{bubbles:!0,cancelable:!0,screenPoint:a,mapPoint:h})}c.resolve(d)}),a.hitch(this,function(a){console.error(a);this._updateProcessing(this.saveButton,!1,"save");new l({message:a});c.reject(a)}));return c},_clear:function(a){this.map.graphics.clear();this.lyrIncidents.clear();this.lyrBuffer.clear();this.lyrProximity.clear();this.lyrClosest.clear();this.geomExtent=void 0;this.summaryDisplayEnabled&&this.lyrSummary&&this.lyrSummary.clear();
this.summaryDisplayEnabled&&this.lyrGroupedSummary&&this.lyrGroupedSummary.clear();q.remove(this.saveOptions,"displayT");q.add(this.saveOptions,"display-off");q.remove(this.clearIncident,"display-on");q.add(this.clearIncident,"display-off");this.incidents=[];this.buffers=[];this.div_reversed_address&&(this.div_reversed_address.innerHTML="");this.div_reverse_geocoding&&y.setStyle(this.div_reverse_geocoding,"visibility","hidden");this._updateCounts(!0);this._clearGraphics();a&&this.spinnerValue.set("value",
this.config.bufferRange.minimum);this.pointEditLayer&&(this.pointUpdateFeature=this.pointEditLayerPrototype);this.lineEditLayer&&(this.lineUpdateFeature=this.lineEditLayerPrototype);this.polyEditLayer&&(this.polyUpdateFeature=this.polyEditLayerPrototype);this._clearMobileSetAsIncidentStyle()},_clearMobileSetAsIncidentStyle:function(){g.destroy(w.byId("_tempMainSectionOverride"))},_sliderTextChange:function(){this._bufferIncident()},_updateSpinnerValue:function(a){var b=this.spinnerValue.displayedValue;
"string"===typeof b&&(b=parseInt(b,10));b<this.config.bufferRange.minimum?this.spinnerValue.set("value",this.config.bufferRange.minimum):b>this.SLIDER_MAX_VALUE&&this.spinnerValue.set("value",this.SLIDER_MAX_VALUE);a&&this._bufferIncident()},_clickTab:function(a){this._validateFeatureCount(a)&&(this._toggleTabs(a),this._toggleTabLayers(a),this.curTab=a,this._clickIncidentsButton(-1))},_validateFeatureCount:function(a){var b=!0;a=this.config.tabs[a];switch(a.type){case "summary":b=0<a.summaryInfo.featureCount;
break;case "groupedSummary":b=0<a.groupedSummaryInfo.featureCount;break;case "weather":b=0<this.incidents.length;break;case "closest":b=0<a.closestInfo.featureCount;break;case "proximity":b=0<a.proximityInfo.featureCount}return b},_toggleTabs:function(a){for(var c=0;c<this.config.tabs.length;c++)c===a?(q.add(this.tabNodes[c],this.isBlackTheme?"activeBlack":"active"),b.set(this.panelNodes[c],"display","block")):(q.remove(this.tabNodes[c],"active"),q.remove(this.tabNodes[c],"activeBlack"),b.set(this.panelNodes[c],
"display","none"));this._scrollToTab(a)},_toggleTabLayers:function(a){this._toggleTabLayersOld();this._toggleTabLayersNew(a)},_toggleTabLayersOld:function(){var a=this.config.tabs[this.curTab];a&&(this.lyrClosest.setVisibility(!1),this.lyrProximity.setVisibility(!1),this.lyrSummary&&this.lyrSummary.setVisibility(!1),this.lyrGroupedSummary&&this.lyrGroupedSummary.setVisibility(!1),a.tabLayers&&e.forEach(a.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!1)}))},_toggleTabLayersNew:function(b){var c=
this.config.tabs[b];switch(c.type){case "summary":var d=!1;this.lyrSummary&&(this.currentSumLayer!==b&&(d=!0),this.lyrSummary.clear());c.tabLayers&&1<c.tabLayers.length&&(this.lyrSummary&&(this.lyrSummary.infoTemplate=c.tabLayers[1].infoTemplate,e.forEach(c.tabLayers[1].graphics,a.hitch(this,function(a){this.lyrSummary.add(a)})),this.lyrSummary.setVisibility(!0)),d&&(this.currentSumLayer=b,this._toggleTabLayersNew(b)));0<this.incidents.length&&!0===c.updateFlag&&(c.summaryInfo.updateForIncident(this.incidents,
this.buffers,this.summaryDisplayEnabled?this.lyrSummary:null,b),c.updateFlag=!1,this.currentSumLayer=b);break;case "groupedSummary":this.lyrGroupedSummary&&(this.currentSumLayer!==b&&(d=!0),this.lyrGroupedSummary.clear());c.tabLayers&&1<c.tabLayers.length&&(this.lyrGroupedSummary&&(this.lyrGroupedSummary.infoTemplate=c.tabLayers[1].infoTemplate,e.forEach(c.tabLayers[1].graphics,a.hitch(this,function(a){this.lyrGroupedSummary.add(a)})),this.lyrGroupedSummary.setVisibility(!0)),d&&(this.currentSumLayer=
b,this._toggleTabLayersNew(b)));0<this.incidents.length&&!0===c.updateFlag&&(c.groupedSummaryInfo.updateForIncident(this.incidents,this.buffers,this.summaryDisplayEnabled?this.lyrGroupedSummary:null,b),c.updateFlag=!1,this.currentGrpLayer=b);break;case "weather":c.tabLayers&&e.forEach(c.tabLayers,function(a){a.setVisibility(!0)});0<this.incidents.length&&!0===c.updateFlag&&(c.weatherInfo.updateForIncident(this.incidents),c.updateFlag=!1);break;case "closest":c.tabLayers&&e.forEach(c.tabLayers,function(a){"undefined"!==
typeof a.visible&&a.setVisibility(!0)});this.lyrClosest.setVisibility(!0);0<this.incidents.length&&(c.closestInfo&&c.closestInfo.container&&(c.closestInfo.container.innerHTML="",q.add(c.closestInfo.container,"loading")),!1===c.updateFlag&&this.lyrClosest.clear(),c.closestInfo.updateForIncident(this.incidents,this.config.maxDistance,this.lyrClosest),c.updateFlag=!1);break;case "proximity":c.tabLayers&&e.forEach(c.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!0)}),this.lyrProximity.setVisibility(!0),
0<this.incidents.length&&(c.proximityInfo&&c.proximityInfo.container&&(c.proximityInfo.container.innerHTML="",q.add(c.proximityInfo.container,"loading")),!1===c.updateFlag&&this.lyrProximity.clear(),c.proximityInfo.updateForIncident(this.incidents,this.buffers,this.lyrProximity),c.updateFlag=!1)}c.updateFlag=!1},_drawIncident:function(a,b,c){a=Array.isArray(a)?a:[a];for(var d=!1,e=0;e<a.length;e++){var f=a[e],g=f.geometry.type;null===this.symPoint&&this._getStyleColor();var h=this.symPoint;"polyline"===
g&&(h=this.symLine,d=this.isLineEditable);"polygon"===g&&(h=this.symPoly,d=this.isPolyEditable);"point"===g&&(this._getIncidentAddress(f.geometry),d=this.isPointEditable);f=new J(f.geometry,h,f.attributes,f.infoTemplate);this.incidents.push(f);this.lyrIncidents.add(f)}this.div_reversed_address.innerHTML="";y.setStyle(this.div_reverse_geocoding,"visibility","hidden");this.toolbar.deactivate();this._clickIncidentsButton(-1);this.saveEnabled&&(q.remove(this.saveButton,"display-off"),(d=d&&this.userCanSave)&&
q.contains(this.saveButton,"btnDisabled")&&q.remove(this.saveButton,"btnDisabled"),q.add(this.saveButton,d?"displayT":"displayT btnDisabled"));q.remove(this.saveOptions,"display-off");q.add(this.saveOptions,"displayT");q.remove(this.clearIncident,"display-off");q.add(this.clearIncident,"display-on");this._bufferIncident(b,c)},_getIncidentAddress:function(b){this.incidentPoint=b;this.map.graphics.clear();this._getPoint(b).then(a.hitch(this,function(a){this.locator.locationToAddress(a,100)}),function(a){console.log(a)})},
_getPoint:function(b){var c=new N,d=new Q(3857);B.canProject(b,d)?c.resolve(B.webMercatorToGeographic(B.project(b,d))):(d=G.buffer(b,100,9001),d={url:this.gsvc.url+"/findTransformations",content:{f:"json",inSR:b.spatialReference.wkid,outSR:4326,extentOfInterest:E.stringify(d.getExtent().toJson())},handleAs:"json",callbackParamName:"callback"},Y(d,{usePost:!1}).then(a.hitch(this,function(d){d=(d=d&&d.transformations?d.transformations:void 0)&&0<d.length?d[0].wkid:void 0;var e=new A;e.outSR=new Q(4326);
e.geometries=[b];e.transformForward=!0;e.transformation=d;this.gsvc.project(e,a.hitch(this,function(a){c.resolve(a[0])}),function(a){c.reject(a)})}),a.hitch(this,function(a){c.reject(a)})));return c},_showIncidentAddress:function(a){if(a.address.address){var b=a.address.address.Address,c=new V;c.family="Arial";c.size="18px";c=new W(b,c,new M("#000000"));c.setOffset(20,-4);c.horizontalAlignment="left";this.map.graphics.add(new J(this.incidentPoint,c,{}));this.div_reversed_address.innerHTML=b+"\x3c/br\x3e"+
a.address.address.City+", "+a.address.address.Region+" "+a.address.address.Postal;y.setStyle(this.div_reverse_geocoding,"visibility","visible")}},_onAddressError:function(){this.div_reversed_address.innerHTML=this.nls.reverse_geocoded_error;y.setStyle(this.div_reverse_geocoding,"visibility","visible")},_bufferIncident:function(a,b){if(0!==this.incidents.length){for(var c=0;c<this.config.tabs.length;c++)this.config.tabs[c].updateFlag=!0;this.buffers=[];this.lyrBuffer.clear();for(var c=!1,d=0;d<this.incidents.length;d++){var e=
this.incidents[d],f=this.spinnerValue.get("value"),g=this.config.distanceSettings[this.config.distanceUnits];0<f?(e=4326!==e.geometry.spatialReference.wkid&&!e.geometry.spatialReference.isWebMercator()||this.isSafari?G.buffer(e.geometry,f,g):G.geodesicBuffer(e.geometry,f,g),this.buffers.push(e)):(a=!1,e=e.geometry.type,"polyline"!==e||c||(c=this.isLineEditable),"polygon"!==e||c||(c=this.isPolyEditable),"point"!==e||c||(c=this.isPointEditable))}0<this.buffers.length?(this.saveEnabled&&(q.remove(this.saveButton,
"display-off"),q.contains(this.saveButton,"btnDisabled")&&this.isPolyEditable&&this.userCanSave&&q.remove(this.saveButton,"btnDisabled"),q.add(this.saveButton,"displayT")),this._handleBuffers(this.symPoly,a)):(this.saveEnabled&&(c&&this.userCanSave?q.contains(this.saveButton,"btnDisabled")&&q.remove(this.saveButton,"btnDisabled"):q.add(this.saveButton,"btnDisabled")),this.zoomToIncidents(b))}},_handleBuffers:function(a,b){this.bufferLookUp=[];for(var c=0;c<this.buffers.length;c++){var d=new J(this.buffers[c],
a);this.lyrBuffer.add(d);this.bufferLookUp[c]=d}b||this._locateBuffer(G.union(this.buffers));this._performAnalysis()},_performAnalysis:function(){this._updateCounts(!1);this._toggleTabLayersNew(this.curTab)},_updateCounts:function(b){for(var c=[],d=0;d<this.config.tabs.length;d++){b&&0<d&&this.panelNodes[d]&&(this.panelNodes[d].innerHTML="");var e=this.config.tabs[d],f=this.tabNodes[d],g=null,h=!1;e.advStat&&e.advStat.stats&&("undefined"!==typeof e.advStat.stats.tabCount?h=e.advStat.stats.tabCount:
e.advStat.stats.count&&(h=!0));"proximity"===e.type?g=e.proximityInfo:"closest"===e.type?g=e.closestInfo:"summary"===e.type?g=e.summaryInfo:"groupedSummary"===e.type?g=e.groupedSummaryInfo:"weather"===e.type&&(g=e.weatherInfo);g&&(b?("undefined"!==typeof g.incidentCount&&(g.incidentCount=0),g.updateTabCount(0,f,h)):"weather"===e.type?g.queryTabCount(this.incidents,this.buffers,f,h):c.push(g.queryTabCount(this.incidents,this.buffers,f,h)))}(new S(c)).then(a.hitch(this,function(a){for(var b=0,c=0;c<
a.length;c++){var d=a[c][1];isNaN(d)||(b+=d)}this._updateBtnState(this.downloadAllButon,"btnDisabled",b);this.userCanSnapshot&&this._updateBtnState(this.createSnapshotButton,"btnDisabled",b)}))},_updateBtnState:function(a,b,c){a&&(0===c?q.add(a,b):q.contains(a,b)&&q.remove(a,b))},_verifyRouting:function(){if(this.config.enableRouting){this.config.enableRouting=!1;var b=this.appConfig.getConfigElementsByName("Directions");e.forEach(b,a.hitch(this,function(a){"Directions"===a.name&&(this.dirConfig=
a,this.config.enableRouting=!0)}))}},_getAttributeTable:function(){var b=this.appConfig.getConfigElementsByName("AttributeTable");e.forEach(b,a.hitch(this,function(a){"AttributeTable"===a.name&&(this.attributeTable=a)}))},zoomToIncidents:function(a){var b,c=!1;if(0<this.incidents.length){var d;1<this.buffers.length?d=G.union(this.buffers):1===this.buffers.length&&(d=this.buffers[0]);b=this.incidents;var e;d&&(c=!0,e=new J(d,d.spatialReference),b.push(e));this.geomExtent=P.graphicsExtent(this.incidents);
e&&e.destroy&&e.destroy()}"undefined"===typeof a&&(this.geomExtent?this.map.setExtent(this.geomExtent.expand(1.5)):b&&(a=b[0].geometry&&"point"===b[0].geometry.type?b[0].geometry:b[0].geometry.getCentroid(),this.map.centerAndZoom(a,this.config.defaultZoomLevel)));if(!c){for(a=0;a<this.incidents.length;a++)if("polygon"===this.incidents[a].geometry.type){c=!0;break}this._performAnalysis()}c&&this._performAnalysis()},zoomToLocation:function(a){var b;if(.5===this.config.defaultZoomLevel){var c;if(0<this.buffers.length)c=
G.union(this.buffers)._extent;else if(0<this.incidents.length){for(var d=[],e=[],f=[],g=0;g<this.incidents.length;g++){var h=this.incidents[g];switch(h.geometry.type){case "point":d.push(h.geometry._extent);break;case "polyline":e.push(h.geometry);break;case "polygon":f.push(h.geometry)}}g=[];0<d.length&&g.push(G.union(d)._extent);0<e.length&&g.push(G.union(e)._extent);0<f.length&&g.push(G.union(f)._extent);1<g.length?c=G.union(g)._extent:1===g.length&&(1<d.length||0<e.length||0<f.length)&&(c=g[0])}c&&
(b=c.expand(.5))}"undefined"===typeof a&&(a=b.getCentroid());b&&this.map.setExtent(b);this.map.centerAt(a)},routeToIncident:function(b){var c=this.incidents[0].geometry,d=c;"point"!==c.type&&(d=null);this.stops=[d,b];this.widgetManager.triggerWidgetOpen(this.dirConfig.id).then(a.hitch(this,function(b){if(b&&"closed"!==b.state){var c=b._dijitDirections;c?this._addStops(c):b.getDirectionsDijit().then(a.hitch(this,function(a){this._addStops(a)}))}}))},_addStops:function(a){a.clearDirections();a.removeStops();
a.reset();a.addStops(this.stops)},_getTabLayers:function(b){var c=[];e.forEach(this.opLayers._layerInfos,a.hitch(this,function(a){if(0<a.newSubLayers.length)this._recurseOpLayers(a.newSubLayers,c,b);else{var d=this.hasLayerTitle?a.id:a.title;if(Array.isArray(b)?-1<b.indexOf(d):b===d)c.push(a.layerObject),"undefined"===typeof a.layerObject.visible||a.layerObject.visible||(a.layerObject.setVisibility(!0),a.layerObject.setVisibility(!1))}}));return c},_recurseOpLayers:function(b,c,d){e.forEach(b,a.hitch(this,
function(a){if(0<a.newSubLayers.length)this._recurseOpLayers(a.newSubLayers,c,d);else{var b=this.hasLayerTitle?a.id:a.title;(Array.isArray(d)?-1<d.indexOf(b):d===b)&&c.push(a.layerObject)}}))},_setupSymbols:function(){var a=h.fromString(this.config.color),b=a.toRgb();b.push(.2);var c=h.fromString("#000000"),a=h.blendColors(a,c,.2).toRgb(),c=new K(K.STYLE_SOLID,new h([255,255,255,.25]),1);this.symPoint=new T(T.STYLE_CIRCLE,20,c,new h([a[0],a[1],a[2],.7]));this.symLine=new K(K.STYLE_SOLID,new h([a[0],
a[1],a[2],.7]),3);this.symPoly=new L(L.STYLE_SOLID,this.symLine,new h([a[0],a[1],a[2],.3]));this.symBuffer=new L(L.STYLE_SOLID,c,new h(b));this.symSelection=new L(L.STYLE_NULL,new K(K.STYLE_SOLID,new h([0,255,255]),2),new h([0,0,0,0]))},onReceiveData:function(a,b,c){null!==c&&c.eventType&&("IncidentLocationAdd"===c.eventType?c.dataValue&&null!==c.dataValue&&(this._clickTab(0),null===this.symPoint?this.dataValue=c.dataValue:this._drawIncident(c.dataValue)):"IncidentLocationRemove"===c.eventType?(a=
this.incidents.indexOf(c.removeGraphic),this.incidents.splice(a,1),this.lyrIncidents.remove(c.removeGraphic),this.bufferLookUp&&0<this.bufferLookUp.length&&(this.lyrBuffer.remove(this.bufferLookUp[a]),this.bufferLookUp.splice(a,1)),this.buffers&&0<this.buffers.length&&this.buffers.splice(a,1),this.incidents&&0<this.incidents.length?(this.config.tabs[this.curTab].updateFlag=!0,this._performAnalysis()):this._clear(!1)):"WebMapChanged"===c.eventType&&this._storeIncidents())},_storeIncidents:function(){if(0<
this.incidents.length){for(var a=[],b=0;b<this.incidents.length;b++)a.push(E.stringify(this.incidents[b].geometry.toJson()));a={location:E.stringify(a),hasBuffer:0<this.lyrBuffer.graphics.length,buffer_dist:this.spinnerValue.get("value"),unit:this.config.distanceUnits,curTab:this.curTab,extent:E.stringify(this.map.extent.toJson())};a=E.stringify(a);window.localStorage.setItem(this.Incident_Local_Storage_Key,a);console.log("Incident saved to storage")}},_restoreIncidents:function(){var a=window.localStorage.getItem(this.Incident_Local_Storage_Key);
if(null!==a&&"null"!==a){window.localStorage.setItem(this.Incident_Local_Storage_Key,null);var a=E.parse(a,!0),b=a.buffer_dist,c=E.parse(a.location);this.curTab=a.curTab;for(var d=[],e=0;e<c.length;e++)d.push({geometry:O.fromJson(E.parse(c[e]))});this.spinnerValue.set("value",b);for(b=0;b<this.config.tabs.length;b++)this.config.tabs[b].restore=!0;this._drawIncident(d,!0,!0);this._clickTab(0,!0);this._toggleTabs(a.curTab);this._toggleTabLayers(a.curTab);this.curTab=a.curTab;this._clickIncidentsButton(-1);
this._updateW();a=O.fromJson(E.parse(a.extent));G.equals(a,this.map.extent)||this.map.setExtent(a,!1)}else q.remove(this.saveOptions,"displayT"),q.add(this.saveOptions,"display-off"),q.remove(this.clearIncident,"display-on"),q.add(this.clearIncident,"display-off")},_updateW:function(){for(var a=0,c=0;c<this.tabNodes.length;c++)a+=r.position(this.tabNodes[c]).w;a+=10;b.set(this.tabsNode,"width",a+"px");a>r.position(this.footerNode).w&&(b.set(this.footerContentNode,window.isRTL?"left":"right","58px"),
b.set(this.panelRight,"display","block"))},_mapResize:function(){var a=b.getComputedStyle(this.map.container);if(a){var c=this._getSAPanelHeight(),a=parseFloat(a.bottom.replace("px",""));if("opened"===this.state||"active"===this.state){var d=this._getAttributeTableHeight();d>c&&(c=d);a<=c&&x.publish("changeMapPosition",{bottom:c})}}},_onMapPositionChange:function(a){a&&(this.left=a.left,this.right=a.right,isFinite(this.left)&&"number"===typeof this.left&&b.set(this.domNode,window.isRTL?"right":"left",
parseFloat(this.left)+"px"),isFinite(this.right)&&"number"===typeof this.right&&b.set(this.domNode,window.isRTL?"left":"right",parseFloat(this.right)+"px"));this._onPanelScroll()},_resetMapPosition:function(){x.publish("changeMapPosition",{bottom:this._getAttributeTableHeight()})},_getSAPanelHeight:function(){var a=parseInt(this.position.height.toString().replace("px",""),10),b=parseInt(this.position.bottom.toString().replace("px",""),10);return a+b},_getAttributeTableHeight:function(){var a=parseInt(this.position.bottom.toString().replace("px",
""),10);if(this.attributeTable){var c=w.byId(this.attributeTable.id);c&&(c=b.getComputedStyle(c))&&c.height&&(a+=parseInt(c.height.toString().replace("px",""),10))}return a},_resize:function(a){try{this._onPanelScroll(this.curTab),this.hideContainer&&this._handlePopup(),this._clearMobileSetAsIncidentStyle(),this._resetInfoWindow(),this._initEditInfo(),this._checkHideContainer()}catch(ma){console.log(ma)}},_onPanelScroll:function(a){var c,d,e,f;a=this.footerContentNode.getBoundingClientRect();for(var g=
0;g<this.tabsNode.children.length;g++)if(f=this.tabsNode.children[g],f=f.getBoundingClientRect(),f=window.isRTL?f.right:f.left,0<=f){c=g;e=f;break}for(g=0;g<this.tabsNode.children.length;g++)if(f=this.tabsNode.children[g],f=f.getBoundingClientRect(),(window.isRTL?f.left:f.right)>(window.isRTL?a.left:a.right)){d=g;break}a=this.footerContentNode;d=d<=this.tabsNode.children.length;b.set(a,window.isRTL?"left":"right",d?"58px":"24px");b.set(this.panelRight,"display",d?"block":"none");d=0;"TabTheme"===
this.appConfig.theme.name&&(d+=window.isRTL?this.right:this.left);c=1<=c||e<d;b.set(a,window.isRTL?"right":"left",c?"34px":"0px");b.set(this.panelLeft,"display",c?"block":"none");b.set(this.panelLeft,"width",c?"34px":"0px")},_scrollToTab:function(a){var b=r.position(this.footerContentNode).w;if(r.position(this.tabsNode).w>b){var c=r.getMarginBox(this.tabNodes[a]);this.footerContentNode.scrollLeft=c.l-(b-c.w)/2}this._onPanelScroll(a)},_navLeft:function(a){},_navRight:function(a){},_navTabsLeft:function(a){this._navTabs(!1)},
_navTabsRight:function(a){this._navTabs(!0)},_navTabs:function(a){for(var b=this.footerContentNode.getBoundingClientRect(),c=0;c<this.tabsNode.children.length;c++){var d=this.tabsNode.children[c].getBoundingClientRect();if(a){if(d.right>b.right){this._scrollToTab(c);break}}else if(0<d.right){this._scrollToTab(c);break}}},_storeInitalVisibility:function(){e.forEach(this.config.tabs,a.hitch(this,function(b){e.forEach(b.tabLayers,a.hitch(this,function(a){"undefined"!==typeof a.visible&&(a.id in this.initalLayerVisibility||
(this.initalLayerVisibility[a.id]=a.visible),a.setVisibility(!1))}))}))},_resetInitalVisibility:function(){e.forEach(this.config.tabs,a.hitch(this,function(b){e.forEach(b.tabLayers,a.hitch(this,function(a){"undefined"!==typeof a.visible&&a.id in this.initalLayerVisibility&&(a.setVisibility(this.initalLayerVisibility[a.id]),a.hasOwnProperty("visible")&&(a.visible=this.initalLayerVisibility[a.id]),a.redraw?a.redraw():a.refresh&&a.refresh())}))}));this.initalLayerVisibility=[]},_clearGraphics:function(){e.forEach(this.config.tabs,
a.hitch(this,function(a){if("summary"===a.type&&a.tabLayers&&1<a.tabLayers.length)for(var b=1;b<a.tabLayers.length;b++)a.tabLayers.pop()}))},_resetInfoWindow:function(){this.defaultPointContent&&this.pointEditLayer.infoTemplate.setContent(this.defaultPointContent);this.defaultLineContent&&this.lineEditLayer.infoTemplate.setContent(this.defaultLineContent);this.defaultPolyContent&&this.polyEditLayer.infoTemplate.setContent(this.defaultPolyContent);this.defaultPopupSize&&this.map.infoWindow.resize(this.defaultPopupSize.width,
"auto");this.map.infoWindow.isShowing&&this.map.infoWindow.hide()},_close:function(){this.widgetManager.closeWidget(this.id)},_downloadAll:function(){for(var b=this.downloadAllButon.classList,c=!0,d=0;d<b.length;d++)if("btnDisabled"===b[d]){c=!1;break}c&&(this._updateProcessing(this.downloadAllButon,!0,"downloadAll"),this._verifyIncident(!1)&&(b=this._getAnalysisObjects(),(new Z(this)).createDownloadZip(b,this.incidents,this.buffers).then(a.hitch(this,function(a){this._updateProcessing(this.downloadAllButon,
!1,"downloadAll")}),function(a){this._updateProcessing(this.downloadAllButon,!1,"downloadAll");new l({message:a.message})})))},_updateProcessing:function(a,b,c){q.remove(a,b?c:"snapshotProcessing");q.add(a,b?"snapshotProcessing":c)},_getAnalysisObjects:function(){var a=["proximity","closest","summary","groupedSummary"],b=[];e.forEach(this.config.tabs,function(c){if(-1<a.indexOf(c.type)){var d;switch(c.type){case "proximity":d=c.proximityInfo;break;case "closest":d=c.closestInfo;break;case "summary":d=
c.summaryInfo;break;case "groupedSummary":d=c.groupedSummaryInfo}var e="undefined"!==typeof c.layerTitle?c.layerTitle:c.layers;b.push({layerObject:c.tabLayers[0],label:""!==c.label?c.label:e,analysisObject:d,type:c.type})}});return b.reverse()},_verifyIncident:function(a){if(0===this.buffers.length){for(var b=!1,c=0;c<this.incidents.length;c++)if("polygon"===this.incidents[c].geometry.type){b=!0;break}b||new l({message:a?this.nls.notPolySnapShot:this.nls.notValidDownload});return b}return!0},getSnapshotName:function(){var b=
new N,c=new ka({nls:this.nls}),d=new ea({width:300,autoHeight:!0,content:c,titleLabel:this.nls.snapshot_name});this.own(m(c,"ok",a.hitch(this,function(a){c.destroy();c=null;d.close();b.resolve(a)})));this.own(m(c,"cancel",a.hitch(this,function(){c.destroy();c=null;d.close();b.resolve("cancel")})));return b},_createSnapshot:function(){for(var b=this.createSnapshotButton.classList,c=!0,d=0;d<b.length;d++)if("btnDisabled"===b[d]){c=!1;break}c&&this._verifyIncident(!0)&&this.getSnapshotName().then(a.hitch(this,
function(b){if(b&&"cancel"!==b){this._updateProcessing(this.createSnapshotButton,!0,"snapshot");var c=[];0<this.buffers.length&&c.push({graphics:this.lyrBuffer.graphics,label:1<this.buffers.length?this.nls.buffers:this.nls.buffer});c.push({graphics:this.incidents,label:1<this.incidents.length?this.nls.incidents:this.nls.incident});c=this._getAnalysisObjects().concat(c);(new Z(this)).createSnapShot({layers:c,incidents:this.incidents,buffers:this.buffers,time:Date.now(),name:b}).then(a.hitch(this,function(a){this._updateProcessing(this.createSnapshotButton,
!1,"snapshot")}),a.hitch(this,function(a){this._updateProcessing(this.createSnapshotButton,!1,"snapshot");new l({message:a.message})}))}else this._updateProcessing(this.createSnapshotButton,!1,"snapshot")}))}})});