// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),function(S,H,q,p,a,h,u,N){function T(a,m){this.start=a;this.end=m}function n(a,m,k){this.start=a;this.end=m;this.units=k}function c(a,m){this.start=a;this.end=m;this.temp=new p}function w(a){this.values=a;this.length=a.length}function D(a,m){this.values=a;this.def=m?m:{}}function O(a,m){this.stack=a;this.original=m}function t(a,
m,k,h){if(a.values)return new w(a.values);var r,B;B=a.start?H.normalizeColor(a.start):r=m?k?m[k]:m:h;a.end?a=H.normalizeColor(a.end):(r||(r=m?k?m[k]:m:h),a=r);return new c(B,a)}var P=H.fx={};T.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};n.prototype.getValue=function(a){return(this.end-this.start)*a+this.start+this.units};c.prototype.getValue=function(a){return p.blendColors(this.start,this.end,a,this.temp)};w.prototype.getValue=function(a){return this.values[Math.min(Math.floor(a*
this.length),this.length-1)]};D.prototype.getValue=function(a){var m=S.clone(this.def),k;for(k in this.values)m[k]=this.values[k].getValue(a);return m};O.prototype.getValue=function(c){var m=[];a.forEach(this.stack,function(k){if(k instanceof q.Matrix2D)m.push(k);else if("original"==k.name&&this.original)m.push(this.original);else if("matrix"==k.name){if(k.start instanceof q.Matrix2D&&k.end instanceof q.Matrix2D){var h=new q.Matrix2D,r;for(r in k.start)h[r]=(k.end[r]-k.start[r])*c+k.start[r];m.push(h)}}else k.name in
q&&(h=q[k.name],"function"!=typeof h?m.push(h):(r=a.map(k.start,function(a,m){return(k.end[m]-a)*c+a}),h=h.apply(q,r),h instanceof q.Matrix2D&&m.push(h)))},this);return m};var z=new p(0,0,0,0);P.animateStroke=function(a){a.easing||(a.easing=h._defaultEasing);var c=new h.Animation(a),k=a.shape,n;u.connect(c,"beforeBegin",c,function(){n=k.getStroke();var c=a.color,m={},h;c&&(m.color=t(c,n,"color",z));(c=a.style)&&c.values&&(m.style=new w(c.values));if(c=a.width){var B=c,p=n;B.values?h=new w(B.values):
(c=B.start?B.start:h=p?p.width:1,B.end?h=B.end:"number"!=typeof h&&(h=p?p.width:1),h=new T(c,h));m.width=h}(c=a.cap)&&c.values&&(m.cap=new w(c.values));if(c=a.join)c.values?m.join=new w(c.values):(h=c.start?c.start:n&&n.join||0,c=c.end?c.end:n&&n.join||0,"number"==typeof h&&"number"==typeof c&&(m.join=new T(h,c)));this.curve=new D(m,n)});u.connect(c,"onAnimate",k,"setStroke");return c};P.animateFill=function(a){a.easing||(a.easing=h._defaultEasing);var c=new h.Animation(a),k=a.shape,n;u.connect(c,
"beforeBegin",c,function(){n=k.getFill();var c=a.color;c&&(this.curve=t(c,n,"",z))});u.connect(c,"onAnimate",k,"setFill");return c};P.animateFont=function(a){a.easing||(a.easing=h._defaultEasing);var c=new h.Animation(a),k=a.shape,p;u.connect(c,"beforeBegin",c,function(){p=k.getFont();var c=a.style,m={},h,q;c&&c.values&&(m.style=new w(c.values));(c=a.variant)&&c.values&&(m.variant=new w(c.values));(c=a.weight)&&c.values&&(m.weight=new w(c.values));(c=a.family)&&c.values&&(m.family=new w(c.values));
(c=a.size)&&c.units&&(h=parseFloat(c.start?c.start:k.font&&k.font.size||"0"),q=parseFloat(c.end?c.end:k.font&&k.font.size||"0"),m.size=new n(h,q,c.units));this.curve=new D(m,p)});u.connect(c,"onAnimate",k,"setFont");return c};P.animateTransform=function(c){c.easing||(c.easing=h._defaultEasing);var m=new h.Animation(c),k=c.shape,n;u.connect(m,"beforeBegin",m,function(){n=k.getTransform();this.curve=new O(c.transform,n)});u.connect(m,"onAnimate",k,"setTransform");if("svg"===H.renderer&&(9<=N("ie")||
N("ff")))var p=[u.connect(m,"onBegin",m,function(){for(var a=k.getParent();a&&a.getParent;)a=a.getParent();a&&(k.__svgContainer=a.rawNode.parentNode,k.__svgRoot=a.rawNode,k.__svgRoot&&k.__svgRoot.getAttribute&&(k.__svgWidth=parseInt(k.__svgRoot.getAttribute("width"),10),isNaN(k.__svgWidth)&&delete k.__svgWidth))}),u.connect(m,"onAnimate",m,function(){try{if(k.__svgContainer){var a=k.__svgContainer.style.visibility;k.__svgContainer.style.visibility="visible";k.__svgContainer.style.visibility=a;var c=
k.__svgWidth;if(!isNaN(c))try{k.__svgRoot.setAttribute("width",c-5E-6),k.__svgRoot.setAttribute("width",c)}catch(Q){}}}catch(Q){}}),u.connect(m,"onEnd",m,function(){a.forEach(p,u.disconnect);if(k.__svgContainer){var c=k.__svgContainer;if(null==c.getAttribute("__gotVis")){c.setAttribute("__gotVis",!0);var m=k.__svgContainer.style.visibility,h=k.__svgRoot,n=k.__svgWidth;c.style.visibility="visible";setTimeout(function(){try{c.style.visibility=m;c.removeAttribute("__gotVis");c=null;try{isNaN(n)||(h.setAttribute("width",
n-5E-6),h.setAttribute("width",n))}catch(E){}}catch(E){}},100)}}delete k.__svgContainer;delete k.__svgRoot;delete k.__svgWidth})];return m};return P})},"widgets/InfoSummary/js/ClusterLayer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/lang dojo/_base/Color dojo/_base/html dojo/DeferredList dojo/dom-class dojo/dom dojox/gfx/fx dojo/on dojo/Evented jimu/utils esri/layers/GraphicsLayer esri/graphic esri/geometry/Extent esri/geometry/Point esri/symbols/PictureMarkerSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/TextSymbol esri/symbols/Font esri/renderers/SimpleRenderer esri/tasks/query esri/tasks/QueryTask esri/symbols/jsonUtils esri/renderers/jsonUtils esri/layers/FeatureLayer".split(" "),
function(S,H,q,p,a,h,u,N,T,n,c,w,D,O,t,P,z,B,m,k,W,r,Y,y,Q,R,E,V){return S("ClusterLayer",[O,w],{constructor:function(d){this.clusterGraphics=null;this.cancelRequest=!1;this.clusterSize=120;this._singles=[];this._showSingles=!0;this.updateFeatures=[];this.hidePanel=d.hidePanel;this._parent=d._parent;if(this._parentLayer=d.parentLayer)this.objectIdField=this._parentLayer.objectIdField,this.fields=this._parentLayer.fields;this.name=d.name;this._map=d.map;this.color=a.fromString(d.color||"#ff0000");
this._styleColor=d._styleColor;this.symbolData=d.lyrInfo.symbolData;this.countColor=this.symbolData._highLightColor;this.itemId=d.lyrInfo.itemId;this.refresh=d.lyrInfo.refresh;this.displayFeatureCount=this.symbolData.displayFeatureCount;this.node=d.node;this.countEnabled=d.countEnabled;this.legendNode=d.legendNode;this.id=d.id;this.infoTemplate=d.infoTemplate;this.url=d.lyrInfo.url;this._testRenderer=d.lyrInfo.renderer;(this.originOperLayer=d.originOperLayer)&&this._getInfoTemplate(this.originOperLayer);
this.lyrInfo=d.lyrInfo;this.lyrType=d.lyrType;this.filter=d.filter;this._setupSymbols();this._setFieldNames();this.countFeatures(this._parentLayer);0<this._parentLayer.refreshInterval&&setInterval(p.hitch(this,this._updateEnd),6E4*this._parentLayer.refreshInterval)},countFeatures:function(d){var a=new y;a.geometry=this._map.extent;d.queryCount?d.queryCount(a,p.hitch(this,function(a){if(0<a)this.hidePanel||(this.nodeCount=a),this._initFeatures(this._parentLayer);else if(!this.hidePanel){this.nodeCount=
0;var Z=new V(d.url);c(Z,"load",p.hitch(this,function(){this.countFeatures(Z)}))}})):this._initFeatures(this._parentLayer)},_initFeatures:function(d){this._features=[];var a=!0,c=new y;-1<["CSV","Feature Collection","GeoRSS","KML"].indexOf(this.lyrType)||null===this.url?(this._getSourceFeatures(d.graphics),this.clusterFeatures()):"undefined"!==typeof this.url?this.loadData(this.url):(c.where=this.filter?this.filter:"1\x3d1",c.outFields=this._fieldNames,c.returnGeometry=!0,d.queryFeatures?d.queryFeatures(c).then(p.hitch(this,
function(d){d.features&&(this._getSourceFeatures(d.features),this.clusterFeatures())})):a="error");"error"!==a&&(this.extentChangeSignal||(this.extentChangeSignal=this._map.on("extent-change",p.hitch(this,this.handleMapExtentChange))),this.clickSignal||(this.clickSignal=this.on("click",p.hitch(this,this.handleClick))))},_getSourceFeatures:function(d){this._features=[];for(var a=0;a<d.length;a++){var c=d[a];c.geometry&&this._features.push(c)}},_getInfoTemplate:function(d){d=d.parentLayerInfo?d.parentLayerInfo:
d;if(d.controlPopupInfo&&(d=d.controlPopupInfo.infoTemplates)){if(this.url){var a=this.url.split("/").pop();a&&(d.indexOf?-1<d.indexOf(a)&&(this.infoTemplate=d[a].infoTemplate):d.hasOwnProperty(a)&&(this.infoTemplate=d[a].infoTemplate))}this.setInfoTemplate(this.infoTemplate)}},_setFieldNames:function(){this._fieldNames=[];if(this.infoTemplate&&"undefined"!==typeof this.infoTemplate.info){var d=this.infoTemplate.info.fieldInfos;if(d)for(var a=0;a<d.length;a++)d[a].visible&&this._fieldNames.push(d[a].fieldName)}if(this.symbolData.featureDisplayOptions&&
0<this.symbolData.featureDisplayOptions.fields.length)for(d=0;d<this.symbolData.featureDisplayOptions.fields.length;d++)a=this.symbolData.featureDisplayOptions.fields[d],-1===this._fieldNames.indexOf(a.name)&&this._fieldNames.push(a.name);1>this._fieldNames.length&&(this._fieldNames=["*"])},setLayerInfo:function(a){this.lyrInfo=a},clearSingles:function(a){H.forEach(a||this._singles,function(a){this.remove(a)},this);this._singles.length=0},_getSingleGraphic:function(a){a=new t(new z(a.geometry.x,a.geometry.y,
this._map.spatialReference),null,a.attributes);a.setSymbol(this._singleSym);return a},_addSingles:function(a){H.forEach(a,function(a){a=this._getSingleGraphic(a);this._singles.push(a);this._showSingles&&this.add(a)},this);this._map.infoWindow.setFeatures(this._singles)},initalCount:function(a){if(!this.hidePanel){var d=new y;d.returnGeometry=!1;d.geometry=this._map.extent;d.where=this.filter?this.filter:"1\x3d1";(new Q(a)).executeForIds(d).then(p.hitch(this,function(a){var d;this.node?(N.contains(this.node,
"searching")&&N.remove(this.node,"searching"),this.node.innerHTML=a?D.localizeNumber(a.length):0,d=this.node.parentNode):this.legendNode&&(d=this.legendNode.previousSibling);this.updateExpand(d,a?!1:!0)}))}},updateExpand:function(a,c){if(!this.hidePanel&&"undefined"!==typeof a){var d;-1<a.id.indexOf("rec_")&&(d=a.id.replace("rec_",""),d=T.byId("exp_"+d));c?(a&&(h.addClass(a,"recDefault"),h.addClass(a,"inActive")),d&&h.addClass(d,"expandInActive")):(a&&(h.removeClass(a,"recDefault"),h.removeClass(a,
"inActive")),d&&h.removeClass(d,"expandInActive"))}},loadData:function(a){if(0<a.length){this.initalCount(a);var d=new y;d.where="1\x3d1";this.filter&&(d.where=this.filter);d.returnGeometry=!1;this.queryPending=!0;(new Q(a)).executeForIds(d).then(p.hitch(this,function(d){if(d){this.queryIDs=d;d=[];var c,k;c=0;for(k=this.queryIDs.length;c<k;c+=1E3){var m=this.queryIDs.slice(c,c+1E3),h=new y;h.outFields=this._fieldNames;h.objectIds=m;h.returnGeometry=!0;h.outSpatialReference=this._map.spatialReference;
m=new Q(a);d.push(m.execute(h))}this._features=[];this.cancelRequest?console.log("Cancelled ClusterLayer 1"):(new u(d)).then(p.hitch(this,function(a){this.queryPending=!1;if(this.cancelRequest)console.log("Cancelled ClusterLayer 2");else if(a){for(var b=this._map.spatialReference,l=[],f=0;f<a.length;f++)if(a[f][1].features)for(var g=0;g<a[f][1].features.length;g++){var e=a[f][1].features[g];if("undefined"!==typeof e.geometry&&null!==e.geometry&&e.geometry){var d=new z(e.geometry.x,e.geometry.y,b),
d=new t(d);d.setAttributes(e.attributes);this.infoTemplate&&d.setInfoTemplate(this.infoTemplate);l.push(d)}}a=!0;1E4>l&&(a=JSON.stringify(this._features)!==JSON.stringify(l));a&&(this._features=l,this.clusterFeatures(),this.emit("update-end",{bubbles:!0,cancelable:!0}))}}))}}))}},handleClick:function(a){var d=[];if(a.graphic&&(d=a.graphic,d.attributes)){var c=d.attributes;c.Data&&1<c.Data.length?(this.clearSingles(this._singles),d=c.Data,a.stopPropagation(),this._addSingles(d)):c.Data&&1===c.Data.length?
(c.Data[0].symbol=d.symbol,this._map.infoWindow.setFeatures([c.Data[0]])):this._map.infoWindow.setFeatures([d])}this.infoTemplate&&this._map.infoWindow.show(a.mapPoint);q.stop(a)},handleMapExtentChange:function(a){if(a.levelChange)this.clusterFeatures();else if(a.delta){a=a.delta;var d=Math.abs(a.y);(50<Math.abs(a.x)||50<d)&&this.clusterFeatures()}},refreshFeatures:function(a){if(this.itemId){a=a.featureSet.features;"undefined"===typeof this.updateFeatures&&(this.updateFeatures=a);var d=!0;1E4>a.length&&
(d=JSON.stringify(this.updateFeatures)!==JSON.stringify(a));if(d){this._features=[];this._parentLayer.clear();var d=this._parentLayer.spatialReference,c;this._parentLayer.renderer?c=this._parentLayer.renderer:this._testRenderer&&(c=this._testRenderer);for(var k=0;k<a.length;k++){var m=a[k];if(m.geometry){var h=new t(this.getGraphicOptions(m,d,c));h.setAttributes(m.attributes);this.infoTemplate&&h.setInfoTemplate(this.infoTemplate);h.setSymbol(c.getSymbol(h));this._parentLayer.add(h);this._features.push(h)}else console.log("Null geometry skipped")}this.clusterFeatures()}this.updateFeatures=
a}else this.url&&this.loadData(this.url)},getGraphicOptions:function(a,c,k){return"undefined"!==typeof a.geometry.rings?{geometry:{rings:a.geometry.rings,spatialReference:{wkid:c.wkid}}}:"undefined"!==typeof a.geometry.paths?{geometry:{paths:a.geometry.paths,spatialReference:{wkid:c.wkid}}}:{geometry:new z(a.geometry.x,a.geometry.y,a.geometry.spatialReference),symbol:k.symbol}},flashFeatures:function(){this._map.graphics.clear();this.flashGraphics(this.graphics)},flashSingle:function(d){if("undefined"===
typeof d.symbol){var c=new k(k.STYLE_NULL,new a(0,0,0,0),0),h=this.color.toRgb();d.setSymbol(new m(m.STYLE_CIRCLE,9,c,new a([h[0],h[1],h[2],.5])))}this.flashGraphics([d])},flashGraphics:function(a){for(var c=0;c<a.length;c++)this._flashFeature(a[c]);setTimeout(p.hitch(this,this._clearFeatures),1100)},_flashFeature:function(c){var d;if(c.geometry){var h=a.fromHex(this._styleColor),q=p.clone(h);q.a=.4;"undefined"!==typeof c.symbol&&(d=new m(m.STYLE_CIRCLE,c.symbol.size,new k(k.STYLE_SOLID,h,1),q))}"undefined"!==
typeof d&&(c=new t(c.geometry,d),this._map.graphics.add(c),d=c.getDojoShape())&&(n.animateStroke({shape:d,duration:700,color:{start:d.strokeStyle.color,end:d.strokeStyle.color},width:{start:18,end:0}}).play(),setTimeout(this._clearFeature,850,c))},_clearFeatures:function(){this._map.graphics.clear()},_clearFeature:function(a){a.getLayer().remove(a)},setColor:function(a){this.color=a},setStyleColor:function(a){this._styleColor=a},cancelPendingRequests:function(){console.log("Cancel Query...");this.queryPending&&
(this.cancelRequest=!0);this.removeEventListeners()},removeEventListeners:function(){this.extentChangeSignal&&(this.extentChangeSignal.remove(),this.extentChangeSignal=null);this.clickSignal&&(this.clickSignal.remove(),this.clickSignal=null)},clusterFeatures:function(){this.clear();null===this._map&&(this._map=this._parent.map);this._map.infoWindow.isShowing&&this._map.infoWindow.hide();var a=this._features,c=0;if("undefined"!==typeof a){if(0<a.length&&this.visible){var k=this.clusterSize;this.clusterGraphics=
[];for(var h=this._map.spatialReference,m=this._map.extent,n=new z(m.xmin,m.ymax,h),p=Math.ceil(this._map.height/k),q=Math.ceil(this._map.width/k),b=m.getWidth()/this._map.width*k,k=m.getHeight()/this._map.height*k,m=0;m<p;m++)for(var l=0;l<q;l++){var f=n.x+b*l,g=n.y-k*m,g=new P(f,g-k,f+b,g,h),f=[],e;for(e in a){var X=a[e];g.contains(X.geometry)&&(c+=1,f.push(X))}0<f.length&&(g=this.getClusterCenter(f),this.clusterGraphics.push({center:g,graphics:f}))}for(var F in this.clusterGraphics){a=this.clusterGraphics[F];
h=a.graphics.length;n=a.graphics;b=D.localizeNumber(h);q=p=19*b.length;p+=5;e=new r;e.family="Arial";e.size="16px";b=new W(b,e,this.countColor);b.setOffset(0,-4);var v;this.symbolData&&this.symbolData.symbol?this.symbolData.symbol.size?v=this.symbolData.symbol.size:this.symbolData.symbol.width&&(v=this.symbolData.symbol.width,e=this.symbolData.symbol.height,v=v>=e?v:e):this.icon.width?(p=this.icon.width>=p?this.icon.width+5:p,p=this.icon.height>=p?this.icon.height+5:p,q=this.icon.width>=q?this.icon.width+
1:q,q=this.icon.height>=q?this.icon.height+1:q):this.icon.size&&(v=this.icon.size);v&&(p=v>=p?v+5:p,q=v>=q?v+1:q);q>=p&&(p+=0===q-p?4:q-p+5);this._setSymbols(p+15,p);n={Count:h,Data:n};1<h?"undefined"!==typeof this.symbolData?"CustomSymbol"!==this.symbolData.symbolType?(this.add(new t(a.center,this.csym,n)),this.displayFeatureCount?this.add(new t(a.center,b,n)):this.add(new t(a.center,this.csym3,n))):(this.add(new t(a.center,this.csym,n)),this.displayFeatureCount?this.add(new t(a.center,b,n)):this.add(new t(a.center,
this.psym,n))):(this.add(new t(a.center,this.csym,n)),this.displayFeatureCount?this.add(new t(a.center,b,n)):this.add(new t(a.center,this.psym,n))):(a=a.graphics[0].geometry,this.renderer&&(this.renderer.hasOwnProperty("getSymbol")&&"LayerSymbol"===this.symbolData.symbolType?(a=new t(a,null,n.Data[0].attributes,this.infoTemplate),a.setSymbol(this.renderer.getSymbol(a))):this.renderer.hasOwnProperty("symbol")&&"LayerSymbol"===this.symbolData.symbolType?(a=new t(a,null,n.Data[0].attributes,this.infoTemplate),
a.setSymbol(R.fromJson(this.renderer.symbol))):a="EsriSymbol"===this.symbolData.symbolType?new t(a,R.fromJson(this.symbolData.symbol),n,this.infoTemplate):"LayerSymbol"!==this.symbolData.symbolType?new t(a,this.psym,n,this.infoTemplate):this.renderer.symbol?new t(a,this.renderer.symbol,n,this.infoTemplate):new t(a,this.psym,n,this.infoTemplate),"undefined"!==typeof a&&this.add(a)))}}this._updateNode(c)}},_getSym:function(a){var c;this.renderer.hasOwnProperty("getSymbol")&&"LayerSymbol"===this.symbolData.symbolType?
c=this.renderer.getSymbol(a):this.renderer.hasOwnProperty("symbol")&&"LayerSymbol"===this.symbolData.symbolType?c=this.renderer.symbol:"EsriSymbol"===this.symbolData.symbolType?c=this.symbolData.symbol:this.symbolData.symbol&&(c=this.symbolData.symbol);return c},_updateNode:function(a){if(!this.hidePanel){var c;this.node?(this.node.innerHTML=a?D.localizeNumber(a):0,c=this.node.parentNode):this.legendNode&&(c=this.legendNode.previousSibling);this.updateExpand(c,a&&this.visible?!1:!0)}},_updatePanelTime:function(a){if(!this.hidePanel){this.pageTitle.innerHTML=
"\x3cdiv\x3e\x3c/div\x3e";var c="";""!==this.config.mainPanelText&&(c=this.config.mainPanelText+" ");this.pageTitle.innerHTML=c+(new Date(a)).toLocaleDateString(navigator.language,{month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}},_setSymbols:function(c,h){var d=this.color.toRgb(),n,q,u;if("undefined"!==typeof this.symbolData){var t;"custom"===this.backgroundClusterSymbol?t=d:(n=R.fromJson(this.backgroundClusterSymbol),0===n.outline.color.a||0===n.outline.width?
(q=k.STYLE_NULL,u=0):(q=k.STYLE_SOLID,u=n.outline.width));n?(d=k(q,n.outline.color,u),t=n.color.toRgb(),this.csym=new m(m.STYLE_CIRCLE,c,d,new a([t[0],t[1],t[2],.75]))):this.csym=new m(m.STYLE_CIRCLE,c,null,new a([t[0],t[1],t[2],.75]));(d=this.symbolData.s)&&-1<d.indexOf("${appPath}")?(d=window.location.pathname.replace("index.html",""),d=this.symbolData.s.replace("${appPath}",window.location.origin+d)):d=this.symbolData.s?this.symbolData.s:this.icon.imageData;if(d&&"CustomIcon"===this.symbolData.iconType){var r,
b;this.symbolData.symbol&&this.symbolData.symbol.height&&(r=this.symbolData.symbol.height);this.symbolData.symbol&&this.symbolData.symbol.width&&(b=this.symbolData.symbol.width);r&&b?b=r=b>r?b:r:(r=this.symbolData.icon.height?this.symbolData.icon.height:h,b=this.symbolData.icon.width?this.symbolData.icon.width:h);this.psym=new B(d,r,b)}else d&&"LayerIcon"===this.symbolData.iconType?this.psym=R.fromJson(this.symbolData.symbol):(r=k(this.icon.outline.style,this.icon.outline.color,this.icon.outline.width),
this.psym=new m(this.icon.style,this.icon.size,r,this.icon.color));this.csym2=p.clone(this.psym);this.csym3=p.clone(this.csym2);"undefined"!==typeof this.csym2.xoffset&&(this.csym3.xoffset=0);"undefined"!==typeof this.csym2.yoffset&&(this.csym3.yoffset=0)}else r=new k(k.STYLE_NULL,new a(0,0,0,0),0),this.csym=new m(m.STYLE_CIRCLE,c,r,new a([d[0],d[1],d[2],.5])),this.psym=new B(this.icon.url,c-10,c-10),this.psym2=new B(this.icon.url,h-7,h-7),r=new k(k.STYLE_NULL,new a(0,0,0,0),0),this.csym2=new m(m.STYLE_CIRCLE,
h,r,new a([d[0],d[1],d[2],.5]))},_setupSymbols:function(){if("undefined"!==typeof this.symbolData){this.countColor=this.symbolData._highLightColor;this.backgroundClusterSymbol=this.symbolData.clusterSymbol;this.icon=this.symbolData.icon;"LayerSymbol"===this.symbolData.symbolType?this._parentLayer.renderer?this.renderer=this._parentLayer.renderer.toJson?this._parentLayer.renderer:E.fromJson(this._parentLayer.renderer):this._testRenderer?this.renderer=E.fromJson(this._testRenderer):this.symbolData.renderer&&
(this.renderer=this.symbolData.renderer.toJson?this.symbolData.renderer:E.fromJson(this.symbolData.renderer)):this.renderer=new Y(R.fromJson(this.symbolData.symbol));var c=this.color.toRgb(),h=new k(k.STYLE_NULL,new a(0,0,0,0),0);this._singleSym=new m(m.STYLE_CIRCLE,9,h,new a([c[0],c[1],c[2],.5]))}},getLayer:function(){return this},getClusterCenter:function(a){var c=0,d=0,h=a.length;H.forEach(a,function(a){c+=a.geometry.x;d+=a.geometry.y},this);return new z(c/h,d/h,a[0].geometry.spatialReference)},
destroy:function(){this._clear();this.removeEventListeners()},_clear:function(){this.clear();this._features=[]},_updateEnd:function(){this.loadData(this.url)}})})},"widgets/InfoSummary/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/InfoSummary/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"panelContent" data-dojo-attach-point\x3d"panelMain"\x3e\r\n    \x3cdiv class\x3d"page"\x3e\r\n      \x3cdiv class\x3d"pageContent rounded" data-dojo-attach-point\x3d"pageContent"\x3e\r\n        \x3cdiv class\x3d"pageHeader roundedTop jimu-main-background dart-bgcolor box-bgcolor" data-dojo-attach-point\x3d"pageHeader"\x3e\r\n          \x3cdiv class\x3d"pageLabel" data-dojo-attach-point\x3d"pageLabel"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"pageCounter"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"panelMainIcon" /\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"pageTitle" data-dojo-attach-point\x3d"pageTitle"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"lastUpdated" data-dojo-attach-point\x3d"lastUpdated"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"pageClose" data-dojo-attach-point\x3d"pageCloseMain" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"pageBody" data-dojo-attach-point\x3d"pageBody"\x3e\r\n        \x3cdiv class\x3d"resultsContent noselect" data-dojo-attach-point\x3d"pageMain"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/InfoSummary/css/style.css":".jimu-widget-InfoSummary{width: 360px; height: 100%;}.jimu-widget-InfoSummary .legendLayer{font-size: 12px;}.jimu-widget-InfoSummary .legendOff{overflow: hidden; display: none;}.jimu-widget-InfoSummary .legendOn{display: block; width: 100%; visibility: visible; height: auto; overflow: hidden;}.jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; min-height: 30px;}.jimu-rtl .jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; min-height: 30px;}.jimu-widget-InfoSummary .solidBorder-dart {border-bottom: 1px solid rgba(0,0,0,.5);}.jimu-widget-InfoSummary .page-dart {position: relative; width: 360px; margin-left: 0; height: 100%; display: block;}.jimu-widget-InfoSummary .pageContent-dart {position:absolute; left: 10px; right: 10px; top: 5px; bottom: 5px; overflow: hidden; display: block; background-color: #4c4c4c;}.jimu-widget-InfoSummary .featureItem-dart{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: left; min-height: 30px; color: whitesmoke;}.jimu-rtl .jimu-widget-InfoSummary .featureItem-dart{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: right; min-height: 30px; color: whitesmoke;}.jimu-widget-InfoSummary .featureItem-dart:hover{background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItem-dart{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-rtl .jimu-widget-InfoSummary .groupItem-dart{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right;}.jimu-widget-InfoSummary .groupItemTitle-dart:hover .groupItemImageUp-dart{background-image: url(../images/_nav_up.png); background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemTitle-dart:hover .groupItemImageDown-dart{background-image: url(../images/_nav_down.png); background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemTitle-dart{width: 100%; height: 30px; display: table; color: whitesmoke;}.jimu-widget-InfoSummary .groupItemImage-dart{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor:pointer; vertical-align:middle; -webkit-border-radius:10px; -moz-border-radius:10px; -o-border-radius:10px; -ms-border-radius:10px; border-radius: 10px; border: 2px solid rgba(0,0,0,.5); color: whitesmoke;}.jimu-widget-InfoSummary .groupItemImageUp-dart{background-image: url(../images/_nav_up.png);}.jimu-widget-InfoSummary .groupItemImageDown-dart {background-image: url(../images/_nav_down.png);}.jimu-widget-InfoSummary .expand-dart{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: #4c4c4c; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand-dart{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: #4c4c4c; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandUp-dart{background-image: url(../images/_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid rgba(0,0,0,.5); border-left: 1px solid rgba(0,0,0,.5); border-right: 1px solid rgba(0,0,0,.5); -webkit-border-top-radius:8px; -moz-border-top-radius:8px; -o-border-top-radius:8px; -ms-border-top-radius:8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown-dart{background-image: url(../images/_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid rgba(0,0,0,.5); -webkit-border-bottom-radius:8px; -moz-border-bottom-radius:8px; -o-border-bottom-radius:8px; -ms-border-bottom-radius:8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .rec-dart {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; color: #6e6e6e; cursor:pointer;}.jimu-widget-InfoSummary .rec-dart:hover .expandUp-dart {background-color: black; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec-dart:hover .expandDown-dart {background-color: black; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .layer-row-mouseover{background-color: #f2f2f2;}.jimu-widget-InfoSummary .layer-row-mouseover-dart{background-color: black;}.jimu-widget-InfoSummary .groupField{text-align: left; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-left: 5px;}.jimu-rtl .jimu-widget-InfoSummary .groupField{text-align: right; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-right: 5px;}.jimu-widget-InfoSummary .groupFieldImage{text-align: left; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-left: 20px;}.jimu-rtl .jimu-widget-InfoSummary .groupFieldImage{text-align: right; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-right: 20px;}.jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-rtl .jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageUp{background-image: url(../images/_nav_up.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageDown{background-image: url(../images/_nav_down.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle{width: 100%; height: 30px; display: table;}.jimu-widget-InfoSummary .groupItemImage{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor:pointer; vertical-align:middle; -webkit-border-radius:10px; -moz-border-radius:10px; -o-border-radius:10px; -ms-border-radius:10px; border-radius: 10px; border: 2px solid #dcdcdc;}.jimu-widget-InfoSummary .groupItemImageUp{background-image: url(../images/default_nav_up.png); background-color: white;}.jimu-widget-InfoSummary .groupItemImageDown{background-image: url(../images/default_nav_down.png); background-color: white;}.jimu-widget-InfoSummary .groupOff{display: none;}.jimu-widget-InfoSummary .groupOn{height: auto; display: block;}.jimu-widget-InfoSummary .featureItem:hover{background-color: lightgray;}.jimu-widget-InfoSummary .clusterSymbol{margin: 4px 4px 4px 4px; display: block; width: 35px; visibility: visible; height: 35px; float: left; -moz-border-radius: 30px; -webkit-border-radius: 30px; border-radius: 30px; opacity:0.60; filter: alpha(opacity\x3d30); z-index: 3;}.jimu-widget-InfoSummary .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-InfoSummary .roundedTop {-moz-border-radius: 5px 5px 0 0; -webkit-border-radius: 5px 5px 0 0; border-radius: 5px 5px 0 0;}.jimu-widget-InfoSummary .panelMain {display: block;}.jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; top: 0px; width: 360px; height: 100%;}.jimu-widget-InfoSummary .page {position: relative; width: 360px; margin-left: 0; height: 100%; display: block; background-color: rgba(0,0,0,0.1);}.jimu-widget-InfoSummary .pageContent {position:absolute; left: 10px; right: 10px; top: 5px; bottom: 5px; overflow: hidden; display: block; background-color: rgba(255,255,255,1);}.jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 190px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 210px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 190px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 8px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleRefresh {position: absolute; left: 0px; bottom: 25px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .lastUpdated {position: absolute; left: 0px; bottom: 5px; height: auto; font-size: 12px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleWidth {width: 100%;}.jimu-widget-InfoSummary .pageCounter {position: absolute; top: 40px; width: auto; height: auto; left: 15px; right:15px;}.jimu-widget-InfoSummary .pageClose {position: absolute; right: 0px; top: 0px; background: url(../images/x.png) no-repeat 50% 50%; cursor: pointer; width: 30px; height: 30px; display: block;}.jimu-rtl .jimu-widget-InfoSummary .pageClose {position: absolute; left: 0px; top: 0px; background: url(../images/x.png) no-repeat 50% 50%; cursor: pointer; width: 30px; height: 30px; display: block;}.jimu-widget-InfoSummary .pageBody {position: absolute; top: 190px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 210px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 190px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .resultsContent {width: 100%; min-height: 100%; overflow-x: hidden; overflow-y: hidden;}.jimu-widget-InfoSummary .recDefault {cursor: default;}.jimu-widget-InfoSummary .recIcon {position: absolute; left: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-rtl .jimu-widget-InfoSummary .recIcon {position: absolute; right: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-widget-InfoSummary .thumb2{width: 43px; height: 43px; align-content: center; vertical-align: super; z-index: 1;}.jimu-widget-InfoSummary .active {opacity:0.8; filter:alpha(opacity\x3d80); background-color: rgba(0,0,0,0.25);}.jimu-rtl .jimu-widget-InfoSummary .active {opacity:0.8; filter:alpha(opacity\x3d80); background-color: rgba(0,0,0,0.25);}.jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-right: 10px;}.jimu-rtl .jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-left: 10px;}.jimu-widget-InfoSummary .inActive {opacity:0.6; filter:alpha(opacity\x3d60);}.jimu-widget-InfoSummary .lightThemeColor {color: #000000;}.jimu-widget-InfoSummary .darkThemeColor {color: whitesmoke;}.jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-left: 65px; text-overflow: ellipsis; width: 100%; padding-right: 10px; max-width: 100px; overflow: hidden; word-wrap: break-word;}.jimu-rtl .jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-right: 65px; text-overflow: ellipsis; width: 100%; padding-left: 10px; max-width: 200px; overflow: hidden; word-wrap: break-word;}.jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-left: 65px; margin-right: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-rtl .jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-right: 65px; margin-left: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-widget-InfoSummary .recNumInActive {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: none; width: 0px; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNumInActive {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: left; display: none; width: 0px; padding-left: 10px;}.jimu-widget-InfoSummary .recNum {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: table-cell; width: auto; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNum {height: 100%; text-align: center; font-size: 28px; margin-left: 10px; float: left; display: table-cell; width: auto; padding-right: 10px;}.jimu-widget-InfoSummary .innerMainPanelIcon {background-size: contain; width: 100%; max-width: 310px; height: 120px; background-repeat: no-repeat; background-position: 50% 50%; display: inline-block;}.jimu-widget-InfoSummary .innerSVGPosition {width: 100%; height: 100%; vertical-align: middle;}.jimu-widget-InfoSummary .innerCirclePosition {position: relative; top: 8px; left: 8px;}.jimu-widget-InfoSummary .pageBodyNoIcon {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}.jimu-widget-InfoSummary .pageHeaderNoIcon {position: relative; width: 100%; height: 35px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageBodyNoIconRefresh {position: absolute; top: 55px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}.jimu-widget-InfoSummary .pageHeaderNoIconRefresh {position: relative; width: 100%; height: 55px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageLabel {padding-top: 10px; color: whitesmoke; font-size: 17px; text-align: center;}.jimu-widget-InfoSummary .solidBorder {border-bottom: 1px solid #dcdcdc;}.jimu-widget-InfoSummary .imageDataGFX {width: 20px; height: 20px; display: block; float: left;}.jimu-rtl .jimu-widget-InfoSummary .imageDataGFX {width: 20px; height: 20px; display: block; float: right;}.jimu-widget-InfoSummary .expandArrow {width: 100%; height: 20px;}.jimu-widget-InfoSummary .rec {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; color: #6e6e6e; cursor:pointer;}.jimu-widget-InfoSummary .rec:hover .expandUp {background-image: url(../images/nav_up.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec:hover .expandDown {background-image: url(../images/nav_down.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; right: 0px;}.jimu-rtl .jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; left: 0px;}.jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; right: 0px; display: block;}.jimu-rtl .jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; left: 0px; display: block;}.jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandInActive{opacity: 0; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-right: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-right: 5px;}.jimu-rtl .jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-left: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-left: 5px;}.jimu-widget-InfoSummary .expandUp{background-image: url(../images/default_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid #dcdcdc; border-left: 1px solid #dcdcdc; border-right: 1px solid #dcdcdc; -webkit-border-top-radius:8px; -moz-border-top-radius:8px; -o-border-top-radius:8px; -ms-border-top-radius:8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown{background-image: url(../images/default_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid #dcdcdc; -webkit-border-bottom-radius:8px; -moz-border-bottom-radius:8px; -o-border-bottom-radius:8px; -ms-border-bottom-radius:8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.noselect {-webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}@media only screen and (max-width: 750px) {.jimu-widget-InfoSummary .pageContent {} .jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 35px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 65px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 25px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 5px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px;} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 65px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;} .jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 25px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}}@media only screen and (max-width: 470px) {.jimu-widget-InfoSummary{width: 100% !important; height: 50%;} .jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; bottom: 0px; width: 100%;} .jimu-widget-InfoSummary .page {position: relative; width: 100%; height: 100%; display: block; background-color: rgba(0,0,0,0.15);} .jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 35px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 65px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 16px; color: #ffffff; text-align: center; top: 25px; bottom: 0px; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 5px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px; opacity:0.3; filter:alpha(opacity\x3d30);} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 65px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto; overflow-y: auto;}}",
"*now":function(S){S(['dojo/i18n!*preload*widgets/InfoSummary/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("jimu/BaseWidget jimu/LayerInfos/LayerInfos jimu/utils dojo/dom dojo/dom-class dojo/dom-construct dojo/on dojo/dom-style dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/Color dojo/promise/all dojo/_base/array dojo/query dojox/gfx/fx dojox/gfx dojo/_base/xhr dijit/_WidgetsInTemplateMixin esri/graphic esri/geometry/Point esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/arcgis/utils esri/symbols/jsonUtils esri/request esri/renderers/SimpleRenderer esri/renderers/jsonUtils ./js/ClusterLayer esri/layers/LayerDrawingOptions".split(" "),function(S,
H,q,p,a,h,u,N,T,n,c,w,D,O,t,P,z,B,m,k,W,r,Y,y,Q,R,E,V,d,Z,aa,ba,da,ea,fa,ca){return T([S,m],{baseClass:"jimu-widget-InfoSummary",name:"InfoSummary",opLayers:null,opLayerInfos:null,layerList:{},UNIQUE_APPEND_VAL_CL:"_CL",widgetChange:!1,refreshInterval:0,refreshIntervalValue:0,configLayerInfos:[],legendNodes:[],currentQueryList:[],symbols:[],postCreate:function(){this.inherited(arguments);this.setupOrientationChange();this.inPanelOverrides(this.appConfig.theme.name);this.configLayerInfos=this.config.layerInfos;
this.layerList={};this._initWidget()},setupOrientationChange:function(){window.hasOwnProperty("matchMedia")&&window.matchMedia("(orientation: portrait)").addListener(n.hitch(this,this._orientationChange))},_orientationChange:function(){470>=window.innerWidth?p.byId("map").style.bottom=window.innerHeight/2+"px":this._resetMapDiv()},inPanelOverrides:function(b){(this.isDartTheme="DartTheme"===b)?a.contains(this.pageContent,"pageContent")&&(a.remove(this.pageContent,"pageContent"),a.add(this.pageContent,
"pageContent-dart")):a.contains(this.pageContent,"pageContent-dart")&&(a.remove(this.pageContent,"pageContent-dart"),a.add(this.pageContent,"pageContent"))},startup:function(){this.inherited(arguments);this.hidePanel||(this.mapExtentChangedHandler=this.map.on("extent-change",n.hitch(this,this._mapExtentChange)),this._mapExtentChange())},onOpen:function(){this.widgetChange=!1;this.hidePanel||this._updatePanelHeader();this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&this._updateStyleColor(this.appConfig.theme.styles[0]);
var b=[],a;for(a in this.layerList){var f=this.layerList[a],g=f.li,e=f.layerObject;if(g&&g.orgRenderer){if(e.setRenderer)e.setRenderer(g.newRenderer);else if(e.setLayerDrawingOptions){var c=[],d=new ca;d.renderer=g.newRenderer;c[g.subLayerId]=d;e.setLayerDrawingOptions(c)}else console.log("Error setting the new renderer...will use the default rendering of the layer");e.refresh()}var v;e&&e.layerInfos?v=e:g&&"undefined"!==typeof g.parentLayerID&&(v=this.map.getLayer(g.parentLayerID));if(v&&v.visibleLayers){e=
!1;c=0;b:for(;c<b.length;c++)if(b[c].id===v.id){e=!0;break b}0!==b.length&&e||b.push({id:v.id,layers:v.visibleLayers});e=0;e;b:for(;e<b.length;e++)if(b[e].id===v.id)break b;c=b[e].layers;if(v.layerInfos){if(0<v.layerInfos.length&&g&&"undefined"!==typeof g.subLayerId){var d=-1<c.indexOf(g.subLayerId),h=f.parentLayerVisible,k=f.layerObject.parentLayerVisible;"ClusterLayer"===f.type&&(d||h||k)?(f.parentLayerVisible=!0,f.layerObject.parentLayerVisible=!0,f.visible=!0,d&&c.splice(c.indexOf(g.subLayerId),
1)):d||h?(f.parentLayerVisible=!0,f.visible=!0,-1===c.indexOf(g.subLayerId)&&c.push(g.subLayerId)):(f.parentLayerVisible=!1,f.visible=!1,d&&c.splice(c.indexOf(g.subLayerId),1),"ClusterLayer"===f.type&&(f.layerObject.parentLayerVisible=!1,-1<this.map.graphicsLayerIds.indexOf(f.id)&&(g=this.map.getLayer(f.id),g.setVisibility(!1))))}b[e].layers=c}this.updatePanelVisibility(f,a,f)}else e&&("ClusterLayer"===f.type&&e._parentLayer&&(-1<this.map.graphicsLayerIds.indexOf(f.id)&&(g=this.map.getLayer(f.id),
"undefined"===typeof f.layerObject.parentLayerVisible&&(f.parentLayerVisible=e._parentLayer.visible,f.layerObject.parentLayerVisible=e._parentLayer.visible),g.setVisibility(f.layerObject.parentLayerVisible)),e._parentLayer.setVisibility&&e._parentLayer.setVisibility(!1)),this.updatePanelVisibility(e,a,f))}for(a=0;a<b.length;a++)(f=this.map.getLayer(b[a].id))&&f.setVisibleLayers(b[a].layers);this.hidePanel||"undefined"!==typeof this.mapExtentChangedHandler||(this.mapExtentChangedHandler=this.map.on("extent-change",
n.hitch(this,this._mapExtentChange)),this._mapExtentChange());this.config.refreshEnabled&&this.enableRefresh();this.map.infoWindow.highlight=!0},updatePanelVisibility:function(b,l,f){if(!this.hidePanel&&"undefined"!==typeof b.visible){var g=p.byId("recLabel_"+l);b.visible?(a.contains("recIcon_"+l,"active")||a.add("recIcon_"+l,"active"),this.config.countEnabled&&a.contains("recNum_"+l,"recNumInActive")&&(a.remove("recNum_"+l,"recNumInActive"),a.add("recNum_"+l,"recNum")),g&&g.firstChild&&a.remove(g.firstChild,
"inActive"),a.contains("exp_"+l,"expandInActive")&&a.remove("exp_"+l,"expandInActive"),a.contains("rec_"+l,"recDefault")&&a.remove("rec_"+l,"recDefault")):(a.contains("recIcon_"+l,"active")&&a.remove("recIcon_"+l,"active"),this.config.countEnabled&&a.contains("recNum_"+l,"recNum")&&(a.remove("recNum_"+l,"recNum"),a.add("recNum_"+l,"recNumInActive")),g&&g.firstChild&&a.add(g.firstChild,"inActive"),a.contains("exp_"+l,"expandInActive")||a.add("exp_"+l,"expandInActive"),f.toggleLegend.remove(),a.contains("rec_"+
l,"rec")&&a.add("rec_"+l,"recDefault"))}},enableRefresh:function(){var b=null,a=!1,f;for(f in this.layerList){b=this.layerList[f];if("ClusterLayer"!==b.type)!a&&b.li&&b.li.itemId&&(this.getItem(b.li.itemId),a=!0),b=b.layerObject;else for(var g=0;g<this.opLayers.length;g++){var e=this.opLayers[g];if(e.layerObject){b=e.layerObject;break}}b&&(b.refreshInterval=this.config.refreshInterval)}b=6E4*this.config.refreshInterval;0===this.refreshInterval&&0===this.refreshIntervalValue?(this.refreshIntervalValue=
b,this.refreshInterval=setInterval(n.hitch(this,this.refreshLayers),this.refreshIntervalValue)):0!==this.refreshIntervalValue&&this.refreshIntervalValue!==b&&(this.refreshIntervalValue=b,clearInterval(this.refreshInterval),this.refreshInterval=0,this.refreshInterval=setInterval(n.hitch(this,this.refreshLayers),this.refreshIntervalValue))},getItem:function(b){var a=("/"!==window.portalUrl.substr(-1)?window.portalUrl+="/":window.portalUrl)+"sharing/rest/content/items/"+b;ba({url:a,content:{f:"json",
requestTime:Date.now()}}).then(n.hitch(this,function(f){if(f){f=f.modified;var g=!0;this.lastModifiedTime&&(g=this.lastModifiedTime<f);-1<this.currentQueryList.indexOf(b)&&this.currentQueryList.splice(this.currentQueryList.indexOf(b),1);g&&(this.lastModifiedTime=f,this._updatePanelTime(f),ba({url:a+"/data",content:{f:"json",requestTime:Date.now()}}).then(n.hitch(this,this._updateItem,b)))}}))},_updatePanelTime:function(b){this.hidePanel||(this.lastUpdated.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.lastUpdated.innerHTML=
q.fieldFormatter.getFormattedDate(new Date(b),{dateFormat:"shortDateShortTime"}))},refreshLayers:function(){for(var b in this.layerList){var a=this.layerList[b],f;a.li&&a.li.itemId?f=a.li.itemId:a.layerObject.itemId&&(f=a.layerObject.itemId);f&&-1===this.currentQueryList.indexOf(f)&&(this.currentQueryList.push(f),this.getItem(f))}},_updateItem:function(b,a){for(var f=0;f<a.layers.length;f++)this._updateLayerItem(a.layers[f],this.lastModifiedTime);this.currentQueryList.splice(this.currentQueryList.indexOf(b),
1)},_updateLayerItem:function(b){var a,f,g;for(g in this.layerList)if(this.layerList[g].pl&&this.layerList[g].pl.layerDefinition){if(this.layerList[g].pl.layerDefinition.name===b.layerDefinition.name){a=this.layerList[g];f=a.pl;break}}else this.layerList[g].layerObject._parentLayer&&this.layerList[g].layerObject._parentLayer.name===b.layerDefinition.name&&(this.layerList[g].layerObject.refreshFeatures(b),this.layerList[g].layerObject&&this._loadList(this.layerList[g],!0));if(b&&f){b=b.featureSet.features;
g=f.featureSet.features;var e=!0;1E4>b.length&&(e=JSON.stringify(g)!==JSON.stringify(b));if(e){f.layerObject.clear();g=a.layerObject.spatialReference;for(e=0;e<b.length;e++){var c=b[e];if(c.geometry){var d=this.getGraphicOptions(c,g,a.layerObject.renderer),v=new k(d);v.setSymbol(d.symbol);v.setAttributes(c.attributes);this._infoTemplate&&v.setInfoTemplate(this._infoTemplate);f.layerObject.add(v)}else console.log("Null geometry skipped")}a.layerObject.refresh();f.layerObject.refresh();f.featureSet.features=
b;this.countFeatures(a);a.layerObject&&this._loadList(a,!0)}}},getGraphicOptions:function(b,a,f){return"undefined"!==typeof b.geometry.rings?{geometry:{rings:b.geometry.rings,spatialReference:{wkid:a.wkid}}}:"undefined"!==typeof b.geometry.paths?{geometry:{paths:b.geometry.paths,spatialReference:{wkid:a.wkid}}}:{geometry:new W(b.geometry.x,b.geometry.y,b.geometry.spatialReference),symbol:f.symbol}},_initWidget:function(){this.hidePanel="undefined"!==typeof this.config.hidePanel?this.config.hidePanel:
!1;this.map.itemId&&H.getInstance(this.map,this.map.itemInfo).then(n.hitch(this,function(b){this.opLayers=b._operLayers;this.opLayerInfos=b._layerInfos;this.operLayerInfos=b;this._createPanelUI(this.configLayerInfos,b);this._addFilterChanged(b);this._addVisibleChanged(b)}))},_addFilterChanged:function(b){if(2.1<=parseFloat(this.appConfig.wabVersion))b.on("filterChanged",n.hitch(this,function(b){O.forEach(b,n.hitch(this,function(b){var a=b.id,f=b.id+this.UNIQUE_APPEND_VAL_CL;this.layerList.hasOwnProperty(a)?
this.layerList[a].filter=b.getFilter():this.layerList.hasOwnProperty(f)&&(this.layerList[f].filter=b.getFilter())}))}))},_addVisibleChanged:function(b){this.own(b.on("layerInfosIsVisibleChanged",n.hitch(this,function(b){O.forEach(b,function(b){var a=b.id,f=b.isShowInMap();if(this.layerList.hasOwnProperty(a))a===this.layerList[a].li.id&&this.layerList[a].visible!==f?this._toggleLayerUI(this.layerList[a].li,f):a===this.layerList[a].id&&this.layerList[a].visible!==f&&this._toggleLayerUI(b,f);else for(var l in this.layerList){var c=
f,d=this.layerList[l];if(d.layerObject&&d.layerObject.id===a){var h=this.operLayerInfos.getLayerInfoById(l),c=b.layerObject&&b.layerObject.visibleLayers&&d.hasOwnProperty("li")&&d.li.hasOwnProperty("subLayerId")?f&&-1<b.layerObject.visibleLayers.indexOf(d.li.subLayerId):f&&h._visible;d.visible!==c&&this._toggleLayerUI(h,c)}}},this)})))},_updatePanelHeader:function(){this.pageLabel.innerHTML=q.stripHTML(this.label);N.set(this.pageLabel,"display","block");var b;b=this.map.width;this.config.displayPanelIcon&&
750<b?(this.pageHeader&&(c.removeClass(this.pageHeader,"pageHeaderNoIcon"),c.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?c.addClass(this.pageHeader,"pageHeaderRefresh"):c.addClass(this.pageHeader,"pageHeaderRefreshNoText"):c.addClass(this.pageHeader,"pageHeader")),this.pageBody&&(c.removeClass(this.pageBody,"pageBodyNoIcon"),c.removeClass(this.pageBody,"pageBodyNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?
c.addClass(this.pageBody,"pageBodyRefresh"):c.addClass(this.pageBody,"pageBodyRefreshNoText"):c.addClass(this.pageBody,"pageBody")),this.pageTitle&&(c.addClass(this.pageTitle,"pageTitleWidth"),this.config.refreshEnabled?(c.removeClass(this.pageTitle,"pageTitle"),c.addClass(this.pageTitle,"pageTitleRefresh")):(c.removeClass(this.pageTitle,"pageTitleRefresh"),c.addClass(this.pageTitle,"pageTitle"))),b=this.config.mainPanelText,"undefined"===typeof b&&(b=""),this.pageTitle.innerHTML=b,this.panelMainIcon.innerHTML=
this.config.mainPanelIcon):this.config.displayPanelIcon||this.config.refreshEnabled?!this.config.displayPanelIcon&&this.config.refreshEnabled?(this.pageHeader&&(c.removeClass(this.pageHeader,"pageHeader"),c.removeClass(this.pageHeader,"pageHeaderNoIcon"),c.addClass(this.pageHeader,"pageHeaderNoIconRefresh")),this.pageBody&&(c.removeClass(this.pageBody,"pageBody"),c.removeClass(this.pageBody,"pageBodyNoIcon"),c.addClass(this.pageBody,"pageBodyNoIconRefresh")),this.pageTitle&&c.removeClass(this.pageTitle,
"pageTitleWidth"),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e"):this.config.displayPanelIcon&&750>=b&&this.config.refreshEnabled&&(this.pageHeader&&(c.removeClass(this.pageHeader,"pageHeaderNoIcon"),c.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),c.removeClass(this.pageHeader,"pageHeader"),""!==this.config.mainPanelText?c.addClass(this.pageHeader,"pageHeaderRefresh"):c.addClass(this.pageHeader,"pageHeaderRefreshNoText")),this.pageBody&&
(c.removeClass(this.pageBody,"pageBodyNoIcon"),c.removeClass(this.pageBody,"pageBodyNoIconRefresh"),c.removeClass(this.pageBody,"pageBody"),""!==this.config.mainPanelText?c.addClass(this.pageBody,"pageBodyRefresh"):c.addClass(this.pageBody,"pageBodyRefreshNoText")),this.pageTitle&&c.addClass(this.pageTitle,"pageTitleWidth"),b=this.config.mainPanelText,"undefined"===typeof b&&(b=""),this.pageTitle.innerHTML=b):(this.pageHeader&&(c.removeClass(this.pageHeader,"pageHeader"),c.removeClass(this.pageHeader,
"pageHeaderNoIconRefresh"),c.addClass(this.pageHeader,"pageHeaderNoIcon")),this.pageBody&&(c.removeClass(this.pageBody,"pageBody"),c.removeClass(this.pageBody,"pageBodyNoIconRefresh"),c.addClass(this.pageBody,"pageBodyNoIcon")),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e")},_createPanelUI:function(b,a){this.numClusterLayers=0;this.hidePanel||(this._updatePanelHeader(),this._updateUI(null),this._clearChildNodes(this.pageMain),this.updateEnd=
[]);for(var f=0;f<b.length;f++){var g=b[f];"ThemeCluster"===g.symbolData.clusterType&&this.updateThemeClusterSymbol(g,f);var e=a.getLayerInfoById(g.id);this._createLayerListItem(g,e)}if(!this.hidePanel){h.create("div",{"class":"expandArrow"},this.pageMain);for(var l in this.layerList)f=this.layerList[l],"ClusterLayer"!==f.type&&this.updateEnd.push(this.own(u(f.layerObject,"update-end",n.hitch(this,this.onUpdateEnd))))}this.addMapLayers()},updateThemeClusterSymbol:function(b,a){var f=b.symbolData;
this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&"undefined"===typeof this._styleColor&&this._updateStyleColor(this.appConfig.theme.styles[0]);if(this._styleColor){var g=w.fromHex(this._styleColor),e=a+1,l=0<e?30*e:30,c=0===e%2,d=g.g,h=g.b,g=g.r-l;c&&(255<g?g-=255:0>g&&(g+=255));h-=l;0===e%3&&c&&(255<h?h-=255:0>h&&(h+=255));l=d-l;0===e%5&&c&&(255<l?l-=255:0>l&&(l+=255));f.clusterType="CustomCluster";f.clusterSymbol={color:[g,l,h,1],outline:{color:[0,0,0,0],width:0,type:"esriSLS",style:"esriSLSNull"},
type:"esriSFS",style:"esriSFSSolid"}}},_createLayerListItem:function(b,a){for(var f=["ArcGISFeatureLayer","KML","ArcGISStreamLayer","CSV","GeoRSS"],g=0;g<this.opLayers.length;g++){var e=this.opLayers[g];if(e.id===b.id||e.id===b.parentLayerID)if("ArcGISMapServiceLayer"===e.layerType){if(e=this._getSubLayerByURL(b.id),"undefined"!==typeof e){this.updateLayerList(e,b,"Feature Layer",a);break}}else if(-1<f.indexOf(e.layerType)||"undefined"===typeof e.layerType)if(e.layerObject&&e.id===b.id){this.updateLayerList(e,
b,"Feature Layer",a);break}else if(e.featureCollection)for(var l=0;l<e.featureCollection.layers.length;l++){var c=e.featureCollection.layers[l];if(c.id===b.id||e.id===b.id){this.updateLayerList(c,b,"Feature Collection",a);break}}else if(e.layerObject&&e.id===b.parentLayerID){var d,h;"GeoRSS"===e.type?(h="GeoRSS",d=e.layerObject.getFeatureLayers()):"KML"===e.type&&(h="KML",d=e.layerObject.getLayers());if(d)for(e=0;e<d.length;e++)if(l=d[e],l.id===b.id){this.updateLayerList(l,b,h,a);break}}}},removeOldClusterLayers:function(b){var a=
[],f;for(f in this.layerList)if("ClusterLayer"===this.layerList[f].type){var g=0;b:for(;g<b.length;g++){var e=b[g];if(e.id+this.UNIQUE_APPEND_VAL_CL===f){e.symbolData&&!e.symbolData.clusteringEnabled&&a.push(f);break b}}}if(0<a.length)for(var c in a)this.layerList.hasOwnProperty(a[c])&&(this.layerList[a[c]].layerObject.destroy(),delete this.layerList[a[c]])},addMapLayers:function(){for(var b=Object.keys(this.layerList).reverse(),a=0;a<b.length;a++){var f=b[a],g=this.layerList[f];g.type&&"ClusterLayer"===
g.type&&-1===this.map.graphicsLayerIds.indexOf(f)&&this.map.addLayer(g.layerObject)}},_getSubLayerByURL:function(b){for(var a=null,f=0;f<this.opLayerInfos.length;f++){var g=this.opLayerInfos[f];if(0<g.newSubLayers.length&&(a=this._recurseOpLayers(g.newSubLayers,b)))break}return a},_recurseOpLayers:function(b,a){for(var f=0;f<b.length;f++){var g=b[f];if(0<g.newSubLayers.length)this._recurseOpLayers(g.newSubLayers,a);else if(g.id===a)return g}},updateLayerList:function(b,a,f,g){var e=null,c=null,l=
null,d=null,d=a.layerObject?a.layerObject:b,h=this._getInfoTemplate(d&&d.originOperLayer?d.originOperLayer:b),k=(g=null===g?this.operLayerInfos.getLayerInfoById(b.id):g)&&g.isShowInMap?g.isShowInMap():!0;"ArcGISFeatureLayer"===b.layerType?a.symbolData.clusteringEnabled?(e=this._getClusterLayer(a,b,g,f),this.layerList[e.id]={type:"ClusterLayer",layerObject:e,visible:e.visible,id:e.id,li:a,filter:this.supportsFilter&&g?g.getFilter():"1\x3d1",infoTemplate:h},this.hidePanel||this.own(u(e,"update-end",
n.hitch(this,function(){this._loadList(this.layerList[e.id],!0)}))),this.numClusterLayers+=1):(b.parentLayerInfo&&b.parentLayerInfo.layerObject&&(c=b.parentLayerInfo.layerObject,l=a.id),e=b.layerObject,d=l?l:a.id,this.layerList[d]={type:c?f:e.type,layerObject:c?c:e,visible:k,pl:b,li:a,filter:this.supportsFilter&&g?g.getFilter():"1\x3d1",infoTemplate:h},this.updateRenderer(d)):"ArcGISStreamLayer"===b.layerType?(e=b.layerObject,this.layerList[e.id]={type:"StreamLayer",layerObject:e,visible:k,id:e.id,
filter:this.supportsFilter&&g?g.getFilter():"1\x3d1",infoTemplate:h}):a.symbolData.clusteringEnabled?(e=this._getClusterLayer(a,b,g,f),this.layerList[e.id]={type:"ClusterLayer",layerObject:e,visible:e.visible,id:e.id,li:a,filter:this.supportsFilter&&g?g.getFilter():"1\x3d1",infoTemplate:h},this.hidePanel||this.own(u(e,"update-end",n.hitch(this,function(){this._loadList(this.layerList[e.id],!0)}))),this.numClusterLayers+=1):(b.parentLayerInfo&&b.parentLayerInfo.layerObject&&(c=b.parentLayerInfo.layerObject,
l=c.visibleLayers?b.id:c.id),e=b.layerObject,d=l?l:b.id,this.layerList[d]={type:c?f:e?e.type:f,layerObject:c?c:e?e:b,visible:k,pl:b,li:a,filter:this.supportsFilter&&g?g.getFilter():"1\x3d1",infoTemplate:h},this.updateRenderer(d));this.hidePanel||this._addPanelItem(c?c:e?e:b,a)},updateRenderer:function(b){b=this.layerList[b];if("LayerSymbol"!==b.li.symbolData.symbolType){"undefined"===typeof b.li.orgRenderer&&(b.li.orgRenderer=b.layerObject.renderer?b.layerObject.renderer:b.li.renderer);var a=new da(aa.fromJson(b.li.symbolData.symbol));
b.li.newRenderer=a;if(b.layerObject.setRenderer)b.layerObject.setRenderer(a);else if(b.layerObject.setLayerDrawingOptions){var f=[],g=new ca;g.renderer=a;f[b.li.subLayerId]=g;b.layerObject.setLayerDrawingOptions(f)}else console.log("Error setting the new renderer...will use the default rendering of the layer");b.layerObject.refresh()}},_onRecNodeMouseover:function(b){a.add(b,this.isDartTheme?"layer-row-mouseover-dart":"layer-row-mouseover")},_onRecNodeMouseout:function(b){a.remove(b,this.isDartTheme?
"layer-row-mouseover-dart":"layer-row-mouseover")},_addPanelItem:function(b,a){var f=b.visibleLayers?a.id:b.id,g=this.layerList[f].type,e;e=this.isDartTheme?["rec-dart","expand-dart","expandDown-dart","solidBorder-dart"]:["rec","expand","expandDown","solidBorder"];var l=h.create("div",{"class":e[0]+" "+e[3],id:"rec_"+f},this.pageMain);this.own(u(l,"mouseover",n.hitch(this,this._onRecNodeMouseover,l)));this.own(u(l,"mouseout",n.hitch(this,this._onRecNodeMouseout,l)));h.create("div",{"class":e[1]+" "+
e[2],id:"exp_"+f},l);e=h.create("div",{"class":"recIcon active",id:"recIcon_"+f},l);if(a.panelImageData&&-1<a.panelImageData.toString().indexOf("\x3cimg")){var d=document.createElement("div");d.innerHTML=a.panelImageData;d=new Y(d.children[0].src,26,26);a.panelImageData=this._createImageDataDiv(d,44,44,void 0,!0).innerHTML}e.innerHTML=a.panelImageData;N.set(e.firstChild,"border-radius","41px");var d=this.isDartTheme?" darkThemeColor":" lightThemeColor",k,m;this.config.countEnabled?(k=h.create("div",
{"class":"recLabel"+d,id:"recLabel_"+f,innerHTML:"\x3cp\x3e"+a.label+"\x3c/p\x3e"},l),c.setStyle(k,"top","20px"),m=h.create("div",{"class":"recNum"+d,id:"recNum_"+f,innerHTML:""},l)):k=h.create("div",{"class":"recLabelNoCount"+d,id:"recLabel_"+f,innerHTML:"\x3cp\x3e"+a.label+"\x3c/p\x3e"},l);"ClusterLayer"===g?(b.node=m,this._addLegend(f,this.layerList[f]),b._updateNode(b.nodeCount)):("StreamLayer"===g?(this.layerList[f].node=m,this.countFeatures(this.layerList[f])):this.layerList[f].node=m,this._addLegend(f,
this.layerList[f]));u(e,"click",n.hitch(this,this._toggleLayerVisibility,this.layerList[f]));this.layerList[f].toggleLegend=u(l,"click",n.hitch(this,this._toggleLegend,this.layerList[f]));this.layerList[f].pl&&(this.layerList[f].pl.featureSet||this.countFeatures(this.layerList[f]))},_addLegend:function(b,a){a.legendNode=h.create("div",{"class":"legendLayer legendOff",id:"legend_"+b},this.pageMain);"ClusterLayer"===a.type&&(a.layerObject.legendNode=a.legendNode)},_loadList:function(b,c){if(!this.hidePanel){var f=
[],g=[],e=b.layerObject.id in this.layerList?b.layerObject.id:b.li.id;c&&this._addSearching(e);var l=[],d;b.layerObject&&b.layerObject.infoTemplate?d=b.layerObject.infoTemplate:b.li.infoTemplate&&(d=b.li.infoTemplate);if(d&&d.info){var h=d.info.fieldInfos;if("undefined"!==typeof h)for(var k=0;k<h.length;k++)h[k].visible&&l.push(h[k].fieldName)}if(b.li.symbolData&&(h=b.li.symbolData.featureDisplayOptions)){if(h.fields)for(k=0;k<h.fields.length;k++)-1===l.indexOf(h.fields[k].name)&&l.push(h.fields[k].name);
h.groupField&&-1===l.indexOf(h.groupField.name)&&l.push(h.groupField.name)}if(0===l.length||"undefined"===typeof d)l=["*"];"*"!==l[0]&&b.layerObject&&b.layerObject.objectIdField&&-1===l.indexOf(b.layerObject.objectIdField)&&l.push(b.layerObject.objectIdField);if("ClusterLayer"===b.type){var m=[];if(b.layerObject.clusterGraphics){e=b.layerObject.clusterGraphics;for(d=0;d<e.length;d++)if(h=e[d],h.graphics&&0<h.graphics.length)for(k=0;k<h.graphics.length;k++)m.push(h.graphics[k]);setTimeout(n.hitch(this,
function(){this._updateList(m,b.legendNode,b.layerObject.node,l,c,b)}),100)}else this._removeSearching(e,b.legendNode?!a.contains(b.legendNode,"legendOff"):!0)}e=["StreamLayer","GeoRSS","KML","Feature Layer"];if("ClusterLayer"!==b.type){if(b.pl&&b.pl.featureSet){this.getFeatures(b,l,c);return}if(-1<e.indexOf(b.type)||"CSV"===b.pl.type){this.getFeatures(b,l,c);return}}b.li&&b.li.url&&"ClusterLayer"!==b.type&&"undefined"===typeof b.queryFeatures&&(d=b.li.url,-1<d.indexOf("MapServer")||-1<d.indexOf("FeatureServer"))&&
(this.promises&&(this.promises.cancel("redundant",!1),this.promises=void 0),e=new E,e.where=b.filter?b.filter:"1\x3d1",e.geometry=this.map.extent,e.returnGeometry=!0,e.outFields=l,d=new V(d),f.push(d.execute(e)),g.push({node:b.node,legendNode:b.legendNode,fields:l,updateCount:c,li:b.li}));0<f.length&&(this.promises=D(f).then(n.hitch(this,function(b){this.promises=void 0;if(b)for(var a=0;a<b.length;a++)if(b[a]){var f=g[a];this._updateList(b[a].features,f.legendNode,f.node,f.fields,f.updateCount,f.li)}})))}},
_addSearching:function(b){var c=this.isDartTheme?"expandDown-dart":"expandDown",f=this.isDartTheme?"expandUp-dart":"expandUp";a.contains("exp_"+b,c)&&(a.remove("exp_"+b,c),a.add("exp_"+b,"expandSearching"));a.contains("exp_"+b,f)&&(a.remove("exp_"+b,f),a.add("exp_"+b,"expandSearching"))},_removeSearching:function(b,c){var f=this.isDartTheme?"expandDown-dart":"expandDown",g=this.isDartTheme?"expandUp-dart":"expandUp";a.contains("exp_"+b,"expandSearching")&&(a.remove("exp_"+b,"expandSearching"),a.add("exp_"+
b,c?g:f))},_getClusterLayer:function(b,a,f,c){var e=a.layerObject?a.layerObject:a,g=b.infoTemplate,l=e&&e.originOperLayer?e.originOperLayer:a.parentLayerInfo;a=null;a=b.id+this.UNIQUE_APPEND_VAL_CL;-1<this.map.graphicsLayerIds.indexOf(a)||-1<this.map._layers.indexOf(a)?(a=this.map.getLayer(a),g=e=!1,JSON.stringify(a.symbolData)!==JSON.stringify(b.symbolData)&&(a.symbolData=b.symbolData,a.countColor=b.symbolData._highLightColor,g=!0),c=h.toDom(b.panelImageData),JSON.stringify(a.icon)!==JSON.stringify(c.src)&&
(a.icon=c.src,g=!0),h.destroy(c.id),a.displayFeatureCount=b.symbolData.displayFeatureCount,a.refresh!==b.refresh&&(a.refresh=b.refresh,e=!0),g&&a._setupSymbols(),a.countEnabled=this.config.countEnabled,a.hidePanel=this.hidePanel,e?a.refreshFeatures(a.url):g&&a.clusterFeatures()):a=new fa({name:b.label+this.UNIQUE_APPEND_VAL_CL,id:a,map:this.map,node:p.byId("recNum_"+a),legendNode:p.byId("legend_"+a),infoTemplate:"undefined"!==typeof e.infoTemplate?e.infoTemplate:g,refreshInterval:this.config.refreshInterval,
refreshEnabled:this.config.refreshEnabled,parentLayer:e,lyrInfo:b,lyrType:c,_styleColor:this._styleColor,originOperLayer:l,countEnabled:this.config.countEnabled,hidePanel:this.hidePanel,filter:this.supportsFilter&&f?f.getFilter():"1\x3d1"});a.setVisibility(f.isShowInMap?f.isShowInMap():!0);return a},_createImageDataDiv:function(a,c,f,g,e){var b;if(a){b=c;var l=f;if(a.height&&a.width){var d;if(a.height>a.width)d=a.width/a.height,l=c*d;else if(a.width===a.height||a.width>a.height)l=c,d=a.width/a.height,
b=0<d?f*d:f}"undefined"!==typeof a.setWidth?"undefined"!==typeof a.setHeight?(a.setWidth(e?l-.25*l:l),a.setHeight(e?b-.25*b:b)):a.setWidth(2):"undefined"!==typeof a.size&&20<a.size&&a.setSize(20);b=h.create("div",{"class":"imageDataGFX"},g);g=z.createSurface(b,c,f);a=aa.getShapeDescriptors(a);g.createShape(a.defaultShape).setFill(a.fill).setStroke(a.stroke).applyTransform({dx:c/2,dy:f/2})}return b},_updateUI:function(a){this.styleName=a},_toggleLayerVisibility:function(b,c){c.stopPropagation();this.map.infoWindow.hide();
var f=b.id?b.id:b.layerObject.id,g=this.layerList[f];g||(g=this.layerList[f]);g||(b.pl&&(f=b.pl.id),g=this.layerList[f]);if(g){g.layerObject.hasOwnProperty("visibleAtMapScale");var e=!1;g.li&&g.li.hasOwnProperty("subLayerId")&&(e="undefined"!==typeof g.li.subLayerId&&"-1"!==g.li.subLayerId.toString());if(a.contains("recIcon_"+f,"active"))if(e&&"ClusterLayer"!==g.type){f=g.layerObject.visibleLayers;for(e=f.length;e--;)-1===f[e]&&f.splice(e,1);e=f.indexOf(g.li.subLayerId);-1<e&&f.splice(e,1);g.layerObject.setVisibleLayers(f);
g.layerObject.setVisibility(!0)}else g&&(g.layerObject.setVisibility(!1),"undefined"!==typeof g.pl&&(g.pl.visibility=!1,-1<this.map.graphicsLayerIds.indexOf(f)&&(g=this.map.getLayer(f),g.setVisibility(!1))));else if(e&&"ClusterLayer"!==g.type){f=g.layerObject.visibleLayers;f.push(g.li.subLayerId);for(e=f.length;e--;)-1===f[e]&&f.splice(e,1);g.layerObject.setVisibleLayers(f);g.layerObject.setVisibility(!0)}else g&&(g.layerObject.setVisibility(!0),"ClusterLayer"===g.type&&(g.layerObject.handleMapExtentChange({levelChange:!0}),
g.layerObject.flashFeatures()),"undefined"!==typeof g.pl&&(g.pl.visibility=!0,-1<this.map.graphicsLayerIds.indexOf(f)&&(g=this.map.getLayer(f),g.setVisibility(!0))))}return!1},_toggleLayerUI:function(b,c){var f=this.isDartTheme?" darkThemeColor":" lightThemeColor",g=b.id?b.id:b.layerObject.id,e=this.layerList[g];e||(e=this.layerList[g]);e||(b.pl&&(g=b.pl.id),e=this.layerList[g]);if(e){var l=!0;e.layerObject&&e.layerObject.hasOwnProperty("visibleAtMapScale")&&(l=e.layerObject.visibleAtMapScale);var d=
p.byId("recLabel_"+g);if(c){a.add("recIcon_"+g,"active");e&&(this.layerList[g].visible=!0,this.layerList[g].parentLayerVisible=!0);this.layerList[g].visible=!0;this.layerList[g].parentLayerVisible=!0;"ClusterLayer"===e.type&&(this.layerList[g].layerObject.parentLayerVisible=!0);this._loadList(e,!0);this.config.countEnabled&&a.contains("recNum_"+g,"recNumInActive")&&(a.remove("recNum_"+g,"recNumInActive"),a.add("recNum_"+g,"recNum"+f));d&&d.firstChild&&a.remove(d.firstChild,"inActive");a.contains("exp_"+
g,"expandInActive")&&l&&a.remove("exp_"+g,"expandInActive");e.toggleLegend&&e.toggleLegend.remove();if(f=p.byId("rec_"+g))e.toggleLegend=u(f,"click",n.hitch(this,this._toggleLegend,e));a.contains("rec_"+g,"recDefault")&&a.remove("rec_"+g,"recDefault")}else a.remove("recIcon_"+g,"active"),this.layerList[g].visible=!1,this.layerList[g].parentLayerVisible=!1,"ClusterLayer"===this.layerList[g].type&&(this.layerList[g].layerObject.parentLayerVisible=!1),this._clearList(this.layerList[g]),this.config.countEnabled&&
a.contains("recNum_"+g,"recNum")&&(a.remove("recNum_"+g,"recNum"),a.add("recNum_"+g,"recNumInActive"+f)),d&&d.firstChild&&a.add(d.firstChild,"inActive"),a.contains("exp_"+g,"expandInActive")||a.add("exp_"+g,"expandInActive"),e.legendOpen&&a.contains("legend_"+g,"legendOn")&&(this.layerList[g].legendOpen=!1,a.remove("legend_"+g,"legendOn"),a.add("legend_"+g,"legendOff"),f=this.isDartTheme?"expandDown-dart":"expandDown",l=this.isDartTheme?"expandUp-dart":"expandUp",a.contains("exp_"+g,l)&&(a.remove("exp_"+
g,l),a.add("exp_"+g,f))),e.toggleLegend&&e.toggleLegend.remove(),a.contains("rec_"+g,"rec")&&a.add("rec_"+g,"recDefault")}return!1},_toggleLegend:function(b,c){if("thumb2"!==c.currentTarget.className&&"recIcon"!==c.currentTarget.className){var f=b.layerObject.id in this.layerList?b.layerObject.id:b.li.id;if(a.contains("legend_"+f,"legendOff"))this._addSearching(f),this.layerList[f].legendOpen=!0,"undefined"===typeof this.layerList[f].li.layerListExtentChanged&&(this.layerList[f].li.layerListExtentChanged=
!0),this.layerList[f].li.layerListExtentChanged?setTimeout(n.hitch(this,function(){this._loadList(b,!1)}),500):this._removeSearching(f,!0),a.remove("legend_"+f,"legendOff"),a.add("legend_"+f,"legendOn");else if(a.contains("legend_"+f,"legendOn")){this.layerList[f].legendOpen=!1;var g=this.isDartTheme?"expandDown-dart":"expandDown",e=this.isDartTheme?"expandUp-dart":"expandUp";a.contains("exp_"+f,e)&&(a.remove("exp_"+f,e),a.add("exp_"+f,g));a.remove("legend_"+f,"legendOn");a.add("legend_"+f,"legendOff")}}c.stopPropagation()},
_toggleGroup:function(b,d){var f=d.currentTarget.id.slice(0,-2),g=this.isDartTheme?"featureItem-dart":"featureItem",e=!0;d.target.parentNode&&(""!==d.target.parentNode.id&&a.contains(d.target.parentNode.id,g)&&(e=!1),""!==d.target.id&&a.contains(d.target.id,g)&&(e=!1));var g=this.isDartTheme?"groupItemImage-dart":"groupItemImage",l=this.isDartTheme?"groupItemImageUp-dart":"groupItemImageUp",h=this.isDartTheme?"groupItemImageDown-dart":"groupItemImageDown";if(e){var e=b.layerObject.id in this.layerList?
b.layerObject.id:b.li.id,k=document.getElementById(d.currentTarget.id),m=k.childNodes[0].childNodes.length-1;a.contains(f,"groupOff")?(this.layerList[e].openGroups&&0<this.layerList[e].openGroups.length?-1===this.layerList[e].openGroups.indexOf(f)&&this.layerList[e].openGroups.push(f):this.layerList[e].openGroups=[f],a.remove(f,"groupOff"),a.add(f,"groupOn"),this.layerList[e].groupOpen=!0,-1<k.childNodes[0].childNodes[m].childNodes[0].className.indexOf(g)&&(c.removeClass(k.childNodes[0].childNodes[m].childNodes[0],
h),c.addClass(k.childNodes[0].childNodes[m].childNodes[0],l))):a.contains(f,"groupOn")&&(a.remove(f,"groupOn"),a.add(f,"groupOff"),this.layerList[e].openGroups&&0<this.layerList[e].openGroups.length?(f=this.layerList[e].openGroups.indexOf(f),-1<f&&this.layerList[e].openGroups.splice(f,1),0===this.layerList[e].openGroups.length&&(this.layerList[e].groupOpen=!1)):this.layerList[e].groupOpen=!1,-1<k.childNodes[0].childNodes[m].childNodes[0].className.indexOf(g)&&(c.removeClass(k.childNodes[0].childNodes[m].childNodes[0],
l),c.addClass(d.currentTarget.childNodes[0].childNodes[m].childNodes[0],h)))}},onAppConfigChanged:function(a,c,f){switch(c){case "themeChange":this.inPanelOverrides(f);break;case "layoutChange":this.destroy();break;case "styleChange":this.hidePanel||this._updateUI(f);this._updateStyleColor(f);break;case "widgetChange":this.widgetChange=!0;f&&f.config&&f.config.layerInfos&&this.removeOldClusterLayers(f.config.layerInfos);break;case "mapChange":this._clearMap()}},_updateStyleColor:function(a){setTimeout(n.hitch(this,
function(){this.getPanel();var b=window.getComputedStyle(this.pageHeader,null).getPropertyValue("background-color");this._styleColor=R.fromRgb(b).toHex();for(var f in this.layerList)b=this.layerList[f],"ClusterLayer"===b.type&&b.layerObject.setStyleColor(this._styleColor);this._updateUI(a)}),50)},_clearMap:function(){if(this.layerList){for(var a in this.layerList){var c=this.layerList[a];if("ClusterLayer"===c.type){var f=!0;"undefined"!==typeof this.continuousRefreshEnabled&&(f=!this.continuousRefreshEnabled);
f&&(c.layerObject._clear(),this.map.removeLayer(c.layerObject))}}this.layerList={}}},setPosition:function(a,d){var b;this.hidePanel?(this.inherited(arguments),this.position=b={right:"0px",bottom:"0px",top:"0px",height:"0px","z-index":"auto"},b=q.getPositionStyle(this.position),b.position="absolute",b.width="",d=this.map.id,c.place(this.domNode,d),c.setStyle(this.domNode,b)):"BoxTheme"===this.appConfig.theme.name?(this.inherited(arguments),this.position=b={right:"0px",bottom:"0px",top:"0px",height:"auto",
"z-index":"auto"},b=q.getPositionStyle(this.position),b.position="absolute",d=this.map.id,c.place(this.domNode,d),b.width="",c.setStyle(this.domNode,b),N.set(this.pageContent,"bottom","60px")):("DartTheme"===this.appConfig.theme.name?(this.inherited(arguments),this.position=b={right:"0px",bottom:"80px",top:"0px",height:"auto","z-index":"auto"},b=q.getPositionStyle(this.position),b.position="absolute",b.width="",d=this.map.id,c.place(this.domNode,d)):"LaunchpadTheme"===this.appConfig.theme.name?(this.inherited(arguments),
this.position=b={right:"0px",bottom:"130px",top:"70px",height:"auto","z-index":"auto"},b=q.getPositionStyle(this.position),b.position="absolute",b.width="",d=this.map.id,c.place(this.domNode,d)):470>=window.innerWidth?(this.position=b={right:"0px",bottom:"0px",height:"none","z-index":"auto",relativeTo:"browser"},b=q.getPositionStyle(this.position),b.position="absolute",b.width="",c.place(this.domNode,window.jimuConfig.layoutId),p.byId("map").style.bottom=window.innerHeight/2+"px"):(this.position=
b={right:"0px",bottom:"0px",height:"none","z-index":"auto"},b=q.getPositionStyle(this.position),b.position="absolute",b.width="",c.place(this.domNode,this.map.id)),c.setStyle(this.domNode,b))},_close:function(){this.widgetManager.closeWidget(this.id)},onClose:function(){this.inherited(arguments);for(var a in this.layerList){var c=this.layerList[a];c.li&&c.li.orgRenderer&&(c.layerObject.setRenderer?c.layerObject.setRenderer(c.li.orgRenderer):c.layerObject.setLayerDrawingOptions?c.layerObject.setLayerDrawingOptions([]):
console.log("Error re-setting the renderer"),c.layerObject.refresh())}a=!0;"undefined"!==typeof this.config.continuousRefreshEnabled&&(a=!this.config.continuousRefreshEnabled);a&&0!==this.refreshInterval&&(this.refreshIntervalValue=0,clearInterval(this.refreshInterval),this.refreshInterval=0);this.hidePanel||"undefined"===typeof this.mapExtentChangedHandler||(this.mapExtentChangedHandler.remove(),this.mapExtentChangedHandler=void 0);this._resetMapDiv()},_resetMapDiv:function(){p.byId("map").style.bottom=
"0px"},_clearChildNodes:function(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)},onUpdateEnd:function(a){a=this.layerList.hasOwnProperty(a.target.id)?a.target.id:a.target.id+"_CL";(a=this.layerList[a])&&a.visible&&(a.updateList?this._loadList(a,a.updateList):(this.config.countEnabled&&this.countFeatures(a),this._loadList(a,!0)))},_mapExtentChange:function(){var b=this.config.countEnabled,d=[],f=[],g;for(g in this.layerList){var e=this.layerList[g],h=!0;e.layerObject.hasOwnProperty("visibleAtMapScale")&&
(h=e.layerObject.visibleAtMapScale);if(!e.legendOpen||e.groupEnabled&&!e.groupOpen)if(this._clearList(e),e.li&&(e.li.layerListExtentChanged=!0),e.visible&&h){if(e.li&&e.li.url&&"ClusterLayer"!==e.type&&"undefined"===typeof e.layerObject.queryCount){var k=e.li.url;if(-1<k.indexOf("MapServer")||-1<k.indexOf("FeatureServer"))this.promises&&(this.promises.cancel("redundant",!1),this.promises=void 0),h=new E,h.where=e.filter?e.filter:"1\x3d1",h.geometry=this.map.extent,h.returnGeometry=!1,k=new V(k),d.push(k.executeForIds(h)),
b?f.push(e.node):f.push(e.legendNode)}"ClusterLayer"===e.type&&e.layerObject.initalLoad&&this.config.countEnabled&&e.layerObject._updateNode(e.layerObject.node.innerHTML);h=["StreamLayer","GeoRSS","KML"];"ClusterLayer"!==e.type&&("undefined"===typeof e.layerObject?console.log("layer object not known"):e.pl&&e.pl.featureSet?this.countFeatures(e):-1<h.indexOf(e.type)||"CSV"===e.pl.type?this.countFeatures(e):e.layerObject._autoSnapshot&&this.countFeatures(e))}else h||this._updateList([],e.legendNode,
e.node,[],!0,e);else e.visible&&h?(e.updateList=!0,this._loadList(e,e.updateList)):this._updateList([],e.legendNode,e.node,[],!0,e)}0<d.length&&(this.promises=D(d).then(function(e){this.promises=void 0;if(e)for(var g=0;g<e.length;g++){var d;e[g]?(a.contains(f[g].id,"searching")&&a.remove(f[g].id,"searching"),d=e[g].length):d=0;var l;b?(f[g].innerHTML=q.localizeNumber(d),l=f[g].parentNode):l=f[g].previousSibling;var h;-1<l.id.indexOf("rec_")&&(h=l.id.replace("rec_",""),h=p.byId("exp_"+h));0===d?(l&&
(c.addClass(l,"recDefault"),c.addClass(l,"inActive")),h&&c.addClass(h,"expandInActive")):(l&&(c.removeClass(l,"recDefault"),c.removeClass(l,"inActive")),h&&c.removeClass(h,"expandInActive"))}}))},getFeatures:function(a,c,f){var b=a.layerObject,e=a.legendNode,d=a.node,l=!0;b.hasOwnProperty("visibleAtMapScale")&&(l=b.visibleAtMapScale);var h=[],k=new E;k.geometry=this.map.extent;k.outFields=c;k.returnGeometry=!0;if(a.visible&&l)if(b.queryFeatures)h.push(b.queryFeatures(k));else{if(b=a.li.url,-1<b.indexOf("MapServer")||
-1<b.indexOf("FeatureServer"))b=new V(b),k.where=a.filter?a.filter:"1\x3d1",h.push(b.execute(k)),h.push(b.executeForIds(k))}else this._updateList([],a.legendNode,a.node,[],!0,a);0<h.length&&(this.featurePromises&&(this.featurePromises.cancel("redundant",!1),this.featurePromises=void 0),D(h).then(n.hitch(this,function(b){var g;d&&(g=this.config.countEnabled?d.parentNode:d.previousSibling);b&&b[0]?b[0].features?setTimeout(n.hitch(this,function(){this._updateList(b[0].features,e,d,c,f,a);this.config.countEnabled&&
1<b.length&&b[1]&&1E3<b[1].length&&(d.innerHTML=q.localizeNumber(b[1].length))}),100):0<b[0].length&&l?this._updateList(b[0],a.legendNode,a.node,[],!0,a,!0):this._updateList([],a.legendNode,a.node,[],!0,a):(this.config.countEnabled&&(d.innerHTML=q.localizeNumber(0)),this.updateExpand(g,!0));this._removeSearching(a.layerObject.id in this.layerList?a.layerObject.id:a.li.id,a.legendOpen)})))},_getInfoTemplate:function(a){var b;b=a.parentLayerInfo?a.parentLayerInfo:a;if(b.controlPopupInfo&&(a=b.controlPopupInfo.infoTemplates)&&
b.layerObject&&b.layerObject.url&&(b=b.layerObject.url,b=b.split("/").pop()))if(a.indexOf){if(-1<a.indexOf(b))return a[b].infoTemplate}else if(a.hasOwnProperty(b))return a[b].infoTemplate},_clearList:function(a){a.legendNode&&(a.legendNode.innerHTML="")},_updateList:function(b,c,f,g,e,d,k){"ClusterLayer"===d.type&&d.layerObject.node&&a.contains(d.layerObject.node.id,"searching")&&a.remove(d.layerObject.node.id,"searching");var l;if("undefined"!==typeof d.li.subLayerId){var m=d.layerObject.infoTemplates;
m&&m.hasOwnProperty(d.li.subLayerId)&&(l=m[d.li.subLayerId].infoTemplate)}m=d.li.symbolData.featureDisplayOptions;c.innerHTML="";e&&f&&this.config.countEnabled&&(f.innerHTML=q.localizeNumber(b.length));this.updateExpand(this.config.countEnabled?f.parentNode:c.previousSibling,0===b.length);if(!k){if(0<b.length){var p;"ClusterLayer"===d.type?p=d.layerObject.renderer:b[0]._graphicsLayer?p=b[0]._graphicsLayer.renderer:d.li.renderer&&(p=ea.fromJson(d.li.renderer));e=[];k=[];f=[];var t=0;for(;t<b.length;t++){var r=
b[t];"undefined"===typeof r.infoTemplate&&l&&(r.infoTemplate=l);var U;p&&p.getSymbol?U=p.getSymbol(r):r.symbol&&(U=aa.fromJson(r.symbol));var M,B;r._layer&&r._layer.objectIdField?(M=r.attributes[r._layer.objectIdField],B=r._layer.objectIdField):d.li&&d.li.oidFieldName?(M=r.attributes[d.li.oidFieldName.name],B=d.li.oidFieldName.name):d.layerObject&&d.layerObject.objectIdField?(M=r.attributes[d.layerObject.objectIdField],B=d.layerObject.objectIdField):M=c.id+t;var w,A=!1;"*"===g[0]?w=r.attributes:(w=
g,A=!0);A=this.getDisplayString(r,d,w,m,B,A);w=A.displayString;var F=A.aliasNames,I,G,K;if(m.groupEnabled){var C,y,D=void 0;if("undefined"===typeof m.groupByField||m.groupByField)A=m.groupField,C=r.attributes[A.name],K="byField",D=C;else if(A=m.groupByRendererOptions.fields[0],C=r.attributes[A.name],I=m.groupByRendererOptions.values,K="byRenderer",null!==C&&""!==C){G=0;b:for(;G<I.length;G++){var J=I[G],x=J.value,x=(x=x.split("\x26\x26"))&&1<x.length?C+x[0]+"\x26\x26 "+C+x[1]:isNaN(C)?"'"+C+"'"+J.value:
C+J.value;if(eval(x)){y=J;break b}}"undefined"!==typeof y&&null!==y&&(D=y.label.replace(/ /g,""))}I="group_"+d.li.id+"_"+A.name+"_"+D;var J=!0,H;if(0<e.length)b:for(G=0;G<e.length;G++)if(x=e[G],I===x.id&&("byField"===K&&C===x.value||"byRenderer"===K)){J=!1;H=x.node;G=x.parent;break b}if(J){G=h.create("div",{"class":this.isDartTheme?"groupItem-dart":"groupItem",id:I+"_c"});var J=h.create("div",{"class":this.isDartTheme?"groupItemTitle-dart":"groupItemTitle",id:I+"_t"},G),x="",L="byRenderer"===K?"":
A.name+": ";"undefined"!==typeof F&&F.hasOwnProperty(A.name)&&""!==F[A.name]&&(L="byField"===K?F[A.name]+": ":"");"byField"===K?"undefined"!==typeof A.label&&""!==A.label&&(L=x=A.label+": "):"undefined"!==typeof y?"undefined"!==typeof y.label&&""!==y.label&&(L=x=L+y.label):L=x=L+C;": "===x&&(L=x="");F=C;this._checkDateField(d,A.name)&&(F=this.formatDateValue(C,A.name,d));var z=this._checkDomainField(d,A.name);z&&(F=this.formatDomainValue(C,z));"byRenderer"===K&&U&&this._createImageDataDiv(n.clone(U),
30,30,J,E);h.create("div",{"class":"byField"===K?"groupField":"groupFieldImage",innerHTML:"byField"===K?x+F:x,title:"byField"===K?L+F:L},J);F=!1;d.openGroups&&0<d.openGroups.length&&(F=-1<d.openGroups.indexOf(I));E=h.create("div",{"class":"groupCountLabel"+(this.isDartTheme?" darkThemeColor":" lightThemeColor")},J);J=h.create("div",{"class":"expandImageContainer"},J);x=this.isDartTheme?"groupItemImageUp-dart":"groupItemImageUp";L=this.isDartTheme?"groupItemImageDown-dart":"groupItemImageDown";z=this.isDartTheme?
"groupItemImage-dart":"groupItemImage";z+=F?" "+x:" "+L;h.create("div",{"class":z},J);z=this.isDartTheme?"groupItem-dart":"groupItem";z=d.groupOpen&&F?z+" groupOn":z+" groupOff";I=h.create("div",{"class":z,id:I},G);e.push({id:"group_"+d.li.id+"_"+A.name+"_"+D,node:I,parent:G,value:C});k.push({value:C,node:G,countNode:E,count:1});u(G,"click",n.hitch(this,this._toggleGroup,d))}else k.filter(function(a){if(a.node.id===H.id+"_c")return a})[0].count+=1,I=H}M=h.create("div",{"class":this.isDartTheme?"featureItem-dart":
"featureItem",id:"feature_"+d.li.id+"_"+M});var E=!1;d.li&&d.li.symbolData&&(E="CustomSymbol"===d.li.symbolData.symbolType);!U||m.groupEnabled&&"byRenderer"===K||this._createImageDataDiv(n.clone(U),30,30,M,E);u(M,"click",n.hitch(this,this._panToFeature,r));-1<w.indexOf(" - ")&&(w=w.slice(0,-3));h.create("div",{style:"padding: 7px 5px 5px "+(m.groupEnabled&&"byRenderer"===K?"15px":"35px")+"; text-align: "+(window.isRTL?"right":"left")+";",innerHTML:w,title:w},M);f.push({node:M,updateNode:I?I:c})}if(0<
k.length){b=k.sort(function(a,b){return"undefined"===typeof a.value?b.value:"undefined"===typeof b.value?a.value:isNaN(a.value)?a.value.localeCompare(b.value):parseFloat(a.value)-parseFloat(b.value)});var X=this.config.countEnabled;O.forEach(b,function(a){X&&(a.countNode.innerHTML=q.localizeNumber(a.count));c.appendChild(a.node)})}0<f.length&&O.forEach(f,function(a){h.place(a.node,a.updateNode)})}d.li.layerListExtentChanged=!1;this._removeSearching(d.layerObject.id in this.layerList?d.layerObject.id:
d.li.id,d.legendOpen)}},updateDomainValues:function(a,c,f,d){var b,g,h,l;for(l in f)h=c?f[l]:l,b=this._checkDomainField(d,h),g=a.attributes[h],b&&(a.attributes[h]=this.formatDomainValue(g,b));return a},updateExpand:function(a,d){if("undefined"!==typeof a){var b;-1<a.id.indexOf("rec_")&&(b=a.id.replace("rec_",""),b=p.byId("exp_"+b));d?(a&&(c.addClass(a,"recDefault"),c.addClass(a,"inActive")),b&&c.addClass(b,"expandInActive")):(a&&(c.removeClass(a,"recDefault"),c.removeClass(a,"inActive")),b&&c.removeClass(b,
"expandInActive"))}},getDisplayString:function(a,c,f,d,e,h){var b,g,l,k="",m,n,p,q,r={},t;for(t in f)if(p=h?f[t]:t,g=this._checkDateField(c,p),l=this._checkDomainField(c,p),q=this._checkAliasName(c,p),b=!0,d.fields&&0<d.fields.length&&(b=this._checkDisplayField(d.fields,p)),m=""!==b.label?": ":" ",n=a.attributes[p],g&&(n=this.formatDateValue(n,p,c)),l&&(n=this.formatDomainValue(n,l)),b&&(r[p]=q),q&&(p=q),b&&d.fields&&0<d.fields.length)k+=b.label+m+n+" - ";else if(b)if(e&&p!==e){k+=p+m+n;break}else if("undefined"===
typeof e){k+=p+m+n;break}return{displayString:k,aliasNames:r}},formatDomainValue:function(a,c){if(c&&c.codedValues)for(var b=c.codedValues,d=0;d<b.length;d++){var e=b[d];if(e.code===a)return e.name}},formatDateValue:function(a,c,f){if(a){var b,d;f.layerObject&&f.layerObject.infoTemplate?d=f.layerObject.infoTemplate:f.li&&f.li.infoTemplate&&(d=f.li.infoTemplate);if(d&&(f=d._fieldsMap))for(var h in f)if(f[h].fieldName===c){b=f[h].format;break}"undefined"===typeof b&&(b={dateFormat:"shortDate"});return q.fieldFormatter.getFormattedDate(new Date(a),
b)}return""},_checkAliasName:function(a,c){var b=a.li.fields;if(b){for(var d=0;d<b.length;d++){var e=b[d];if(e.name===c)return"undefined"!==typeof e.alias?e.alias:!1}return!1}},_checkDomainField:function(a,c){var b=a.li.fields;if(b){for(var d=0;d<b.length;d++){var e=b[d];if(e.name===c)return"undefined"!==typeof e.domain?e.domain:!1}return!1}},_checkDateField:function(a,c){var b=a.li.fields;if(b){for(var d=0;d<b.length;d++){var e=b[d];if(e.name===c){if("esriFieldTypeDate"===e.type)return!0;break}}return!1}},
_checkDisplayField:function(a,c){var b=!0;if(a)for(var d=0;d<a.length;d++){if(a[d].name===c)return a[d];b=!1}return b},flashGraphics:function(a){for(var b=0;b<a.length;b++)this._flashFeature(a[b])},_flashFeature:function(a){var b;if(a.geometry){var c=R.fromHex(this._styleColor),d=n.clone(c);d.a=.4;switch(a.geometry.type){case "point":b=new r(r.STYLE_CIRCLE,15,new y(y.STYLE_SOLID,c,1),d);break;case "polyline":b=new y(y.STYLE_SOLID,c,3);break;case "polygon":b=new Q(Q.STYLE_DIAGONAL_CROSS,new y(y.STYLE_SOLID,
c,2),d)}}a=new k(a.geometry,b);this.map.graphics.add(a);if(b=a.getDojoShape())P.animateStroke({shape:b,duration:900,color:{start:b.strokeStyle.color,end:b.strokeStyle.color},width:{start:25,end:0}}).play(),setTimeout(this._clearFeature,1075,a)},_clearFeature:function(a){a.getLayer().remove(a)},_panToFeature:function(a){if(a.geometry){var b=a.geometry;if("polyline"===b.type)var c=b.paths[Math.ceil(b.paths.length/2)-1],c=c[Math.ceil((c.length-1)/2)],b=new W(c[0],c[1],b.spatialReference);"point"!==b.type&&
(b=b.getExtent().getCenter());this._flashFeature(a);if(a._layer&&a._layer.infoTemplate||a.infoTemplate)this.map.infoWindow.setFeatures([a]),this.map.infoWindow.select(0),this.map.infoWindow.show(b)}},countFeatures:function(a){var b=a.layerObject,c=this.config.countEnabled?a.node:a.legendNode;a=new E;a.geometry=this.map.extent;b.queryCount&&b.visible&&b.queryCount(a,n.hitch(this,function(a){if(c){var b;this.config.countEnabled?(c.innerHTML=q.localizeNumber(a),b=c.parentNode):b=c.previousSibling;this.updateExpand(b,
0===a)}}))}})});